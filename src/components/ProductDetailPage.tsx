import { ChevronRight, ChevronDown, ChevronUp, Plus, Minus, Check, MapPin, ImageOff, Circle, MoreVertical, X, AlertCircle } from 'lucide-react';
import { Button } from './ui/button';
import { Product, ProductCard } from './ProductCard';
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from './ui/collapsible';
import { useState, useEffect, useLayoutEffect, useMemo, useRef } from 'react';
import { Checkbox } from './ui/checkbox';
import { Textarea } from './ui/textarea';
import { ConfirmPickupDialog } from './ConfirmPickupDialog';
import { ImageWithFallback } from './figma/ImageWithFallback';
import { Popover, PopoverContent, PopoverTrigger } from './ui/popover';
import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogFooter, AlertDialogAction } from './ui/alert-dialog';
import { MobileHeader } from './MobileHeader';
import { AddonCard } from './product-detail/AddonCard';
import backgroundTexture from 'figma:asset/af0454752368adb907cfd39c5b04b0eb86327038.png';
import bottles20oz from 'figma:asset/5f91343c6bf3932f64c473c41da139aa32696135.png';
import bottles2liter from 'figma:asset/bfb04ac4c2a7fad7ca6a06efa7e9a0c5a29d98ea.png';
import ranchCup from 'figma:asset/b7be6f8b413b558ef35945cc4a768fbdc0a99c68.png';

import { 
  saladBases,
  saladDressings,
  dressingInstructions, 
  extraDressings, 
  specialInstructions as saladSpecialInstructions 
} from '../data/saladToppings';
import { appetizersProducts } from '../data/appetizers';
import { 
  RawSelectionShape, 
  completeSelectionsFromRawSources, 
  buildSelectionLookup, 
  registerOptionsToLookup,
  SelectionLookup,
  OptionConfig
} from '../utils/selectionsRegistry';
import { registerMissingArrays } from '../utils/registerMissingArrays';
import {
  calamariSubSauceOptions,
  musselsSauceOptions,
  seafoodComboSauceOptions,
  shrimpMarinaraSubSauceOptions,
  marinaraAppetizerSauceOptions,
  seafoodPastaTypes
} from '../utils/seafood-labels';

// Required Seafood Sauce Options (Strict Implementation)
const seafoodSauceOptions = [
  { id: "sf_sauce_marinara", label: "Marinara Sauce" },
  { id: "sf_sauce_white_wine_garlic", label: "White wine garlic sauce" },
];

const PLACEHOLDER_TOPPING_IMAGE = 'https://images.unsplash.com/photo-1513104890138-7c749659a591?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200';

// Sauce images
const SAUCE_IMAGES: { [key: string]: string } = {
  'buffalo': 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000',
  'bbq': 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000',
  'hot': 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000',
  'mild': 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000',
  'honey-mustard': 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000',
  'mild-honey': 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000',
  'crazy-hot': 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000',
  'garlic-parmesan': 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000',
  'sting-honey': 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000',
  'ranch': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000',
  'bleu-cheese': 'https://drive.google.com/thumbnail?id=1IC2l-gLbo0QYFislwjItAp__I6DaajmN&sz=w1000',
  'pomodoro-sauce': 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000',
  'default': 'https://images.unsplash.com/photo-1519666213631-be6e024eac6a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200'
};

// Helper function to get sauce image
const getSauceImage = (sauceName: string): string => {
  const nameLower = sauceName.toLowerCase();
  if (nameLower.includes('buffalo')) return SAUCE_IMAGES.buffalo;
  if (nameLower.includes('bbq')) return SAUCE_IMAGES.bbq;
  if (nameLower.includes('crazy hot')) return SAUCE_IMAGES['crazy-hot'];
  if (nameLower.includes('garlic parmesan') || nameLower.includes('garlic-parmesan')) return SAUCE_IMAGES['garlic-parmesan'];
  if (nameLower.includes('sting honey') || nameLower.includes('sting-honey')) return SAUCE_IMAGES['sting-honey'];
  if (nameLower.includes('honey mustard') || nameLower.includes('honey-mustard')) return SAUCE_IMAGES['honey-mustard'];
  if (nameLower.includes('hot') || nameLower.includes('spicy')) return SAUCE_IMAGES.hot;
  if (nameLower.includes('mild honey')) return SAUCE_IMAGES['mild-honey'];
  if (nameLower.includes('mild')) return SAUCE_IMAGES.mild;
  if (nameLower.includes('pomodoro')) return SAUCE_IMAGES['pomodoro-sauce'];
  if (nameLower.includes('ranch')) return SAUCE_IMAGES.ranch;
  if (nameLower.includes('bleu') || nameLower.includes('blue cheese')) return SAUCE_IMAGES['bleu-cheese'];
  return SAUCE_IMAGES.default;
};

// Salad Topping images
const SALAD_TOPPING_IMAGES: { [key: string]: string } = {
  'st1': 'https://drive.google.com/thumbnail?id=1raKjTe8PSZNQmy7KApo6PkWzm1IBto_P&sz=w1000', // Anchovies
  'st2': 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w1000', // Bacon
  'st3': 'https://drive.google.com/thumbnail?id=15XpbkSBwMaMwJ7hOgbtpW5ifIppKB5S3&sz=w1000', // Beets
  'st4': 'https://drive.google.com/thumbnail?id=1aCYhCnbMQeG8ZgI1dgZCdQvKrGmlDso9&sz=w400', // Black Olives
  'st5': 'https://drive.google.com/thumbnail?id=1AUvOA985D0AclEdTlq90zIOP1XOcyKz2&sz=w400', // Calamari Mix
  'st6': 'https://images.unsplash.com/photo-1724154854089-4bbd0e7d09c8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjYXByZXNlJTIwdG9tYXRvJTIwbW96emFyZWxsYXxlbnwxfHx8fDE3NjM3NDYzNDV8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Caprese Mix
  'st7': 'https://drive.google.com/thumbnail?id=1cfHdwjwPpiH-aGieXvqphSPRZl9DkXs8&sz=w400', // Carrots
  'st8': 'https://drive.google.com/thumbnail?id=1zd-TuUchSMSEHbuV1K15sTNCVnLjuuEM&sz=w400', // Celery
  'st9': 'https://drive.google.com/thumbnail?id=1Vm5_OiGyPVMo6OKFgWxvr8EFSjkiWsLU&sz=w400', // Chic Peas
  'st10': 'https://drive.google.com/thumbnail?id=1H4iNykLVvOiRItfPHBaar1PIbNWwsBjP&sz=w400', // Chopped Tomatoes
  'st11': 'https://drive.google.com/thumbnail?id=1i7pYCU1eDQpsq4Mg5lWMgb_fEHlbDaDj&sz=w400', // Corn
  'st12': 'https://drive.google.com/thumbnail?id=1EzFTywi3a1CCDJGsjNZwBVq06zZq_HSQ&sz=w1000', // Crispy Chicken
  'st13': 'https://drive.google.com/thumbnail?id=1I_nhAAJWYnyF8GKkBVRCh1wNYq6PqXfg&sz=w400', // Croutons
  'st14': 'https://drive.google.com/thumbnail?id=17_SsmNN8yRHgQDI0qTNyGy6fgGjSuGZ1&sz=w400', // Cucumbers
  'st15': 'https://drive.google.com/thumbnail?id=1ChKFHBmSnvu9ignxwQE4HXbAuIPCSB6R&sz=w400', // Dried Cranberries
  'st16': 'https://drive.google.com/thumbnail?id=1xVcUB9VG8db8ZpJRVHWgl1-g-l3yZ5ns&sz=w400', // Egg
  'st17': 'https://drive.google.com/thumbnail?id=15syrqQYrcPs_qwNm0dX0V1_hY7UYcERn&sz=w400', // Feta Cheese
  'st18': 'https://drive.google.com/thumbnail?id=1zqbadi42-LGOF4L7m7fPUWpSS7L4Yrd6&sz=w400', // Fresh Mozzarella
  'st19': 'https://drive.google.com/thumbnail?id=1g0nLELaMvLPMor90E9YMTY3KtMWFzV_o&sz=w400', // Green Olives
  'st20': 'https://drive.google.com/thumbnail?id=1LopXRbVMPA_vMg8UXPbMHTiUuwoV-4mT&sz=w400', // Green Peppers
  'st21': 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400', // Grilled Chicken
  'st22': 'https://drive.google.com/thumbnail?id=1_5UtdDm2QOO2iMUT9gIXDR8_JfozqkPl&sz=w400', // Ham
  'st23': 'https://drive.google.com/thumbnail?id=1Ol3OqaVbYxwLGAACMUPS_sJuca5IgfZS&sz=w400', // Mozzarella Cubed
  'st24': 'https://drive.google.com/thumbnail?id=1U8TjmY60nUhv2qUVFL4529RkvEY_FrqZ&sz=w400', // Parmigiano
  'st25': 'https://images.unsplash.com/photo-1630492782892-74f99406dc59?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwYXN0YSUyMHNhbGFkfGVufDF8fHx8MTc2MzYyODgxMXww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Pasta Mix
  'st26': 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400', // Pepperoni
  'st27': 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwZW5uZSUyMHBhc3RhfGVufDF8fHx8MTc2Mzc0NjMzNnww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Plain Pasta
  'st28': 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400', // Provolone
  'st29': 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400', // Raw Mushroom
  'st30': 'https://drive.google.com/thumbnail?id=1wLKWjZILxLADNJ-E47Tv3FfIl5ViQKLy&sz=w400', // Red Onions
  'st31': 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400', // Roasted Red Peppers
  'st32': 'https://drive.google.com/thumbnail?id=1fIoKedqNehipM6sH42oXVIG88CCGJbiA&sz=w400', // Shredded Cheddar
  'st33': 'https://drive.google.com/thumbnail?id=1zqbadi42-LGOF4L7m7fPUWpSS7L4Yrd6&sz=w400', // Shredded Mozzarella
  'st34': 'https://drive.google.com/thumbnail?id=14Jw0NQfkqCIITdEsMyP0ANQIjR9vLlcb&sz=w400', // Sun Dried Tomatoes
  'st35': 'https://drive.google.com/thumbnail?id=1RJ8C8XEoAolTupHi9tejd78hJdprbpn2&sz=w400', // Sunflower Seeds
  'st36': 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400', // Swiss
  'st37': 'https://drive.google.com/thumbnail?id=1_c5LAIEfTVfq-8jlrCVaJEUMSFPb1YcK&sz=w400', // Tortilla Strips
  'st38': 'https://drive.google.com/thumbnail?id=1Rwq4--zDS4XyHixY338vdKFNf9LLTGqW&sz=w400', // Tuna Mix
  'st39': 'https://drive.google.com/thumbnail?id=1alG3jOl-XS5Mg5ux7n7g0KotE9_yJ4th&sz=w400', // Turkey
};

// Salad Extra Topping images (for "Extra Toppings" section)
const SALAD_EXTRA_TOPPING_IMAGES: { [key: string]: string } = {
  'set1': 'https://drive.google.com/thumbnail?id=1raKjTe8PSZNQmy7KApo6PkWzm1IBto_P&sz=w1000', // Anchovies (from st1)
  'set2': 'https://drive.google.com/thumbnail?id=1xVcUB9VG8db8ZpJRVHWgl1-g-l3yZ5ns&sz=w400', // Egg (from st16)
  'set3': 'https://drive.google.com/thumbnail?id=15syrqQYrcPs_qwNm0dX0V1_hY7UYcERn&sz=w400', // Feta Cheese (from st17)
  'set4': 'https://drive.google.com/thumbnail?id=1fIoKedqNehipM6sH42oXVIG88CCGJbiA&sz=w400', // Shredded Cheddar (from st32)
  'set5': 'https://drive.google.com/thumbnail?id=1zqbadi42-LGOF4L7m7fPUWpSS7L4Yrd6&sz=w400', // Mozzarella Shredded (from st33)
  'set6': 'https://drive.google.com/thumbnail?id=1Ol3OqaVbYxwLGAACMUPS_sJuca5IgfZS&sz=w400', // Mozzarella Cubed (from st23)
  'set7': 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400', // Provolone (from st28)
  'set8': 'https://drive.google.com/thumbnail?id=1U8TjmY60nUhv2qUVFL4529RkvEY_FrqZ&sz=w400', // Parmigiano (from st24)
  'set9': 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400', // Swiss (from st36)
  'set10': 'https://drive.google.com/thumbnail?id=1ChKFHBmSnvu9ignxwQE4HXbAuIPCSB6R&sz=w400', // Dried Cranberries (from st15)
  'set11': 'https://drive.google.com/thumbnail?id=1I_nhAAJWYnyF8GKkBVRCh1wNYq6PqXfg&sz=w400', // Croutons (from st13)
  'set12': 'https://drive.google.com/thumbnail?id=1_c5LAIEfTVfq-8jlrCVaJEUMSFPb1YcK&sz=w400', // Tortilla Strips (from st37)
  'set13': 'https://drive.google.com/thumbnail?id=1RJ8C8XEoAolTupHi9tejd78hJdprbpn2&sz=w400', // Sunflower Seeds (from st35)
  'set14': 'https://drive.google.com/thumbnail?id=1H4iNykLVvOiRItfPHBaar1PIbNWwsBjP&sz=w400', // Chopped Tomatoes (from st10)
  'set15': 'https://drive.google.com/thumbnail?id=17_SsmNN8yRHgQDI0qTNyGy6fgGjSuGZ1&sz=w400', // Cucumbers (from st14)
  'set16': 'https://drive.google.com/thumbnail?id=1wLKWjZILxLADNJ-E47Tv3FfIl5ViQKLy&sz=w400', // Red Onions (from st30)
  'set17': 'https://drive.google.com/thumbnail?id=1LopXRbVMPA_vMg8UXPbMHTiUuwoV-4mT&sz=w400', // Green Peppers (from st20)
  'set18': 'https://drive.google.com/thumbnail?id=1cfHdwjwPpiH-aGieXvqphSPRZl9DkXs8&sz=w400', // Carrots (from st7)
  'set19': 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w1000', // Broccoli
  'set20': 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400', // Raw Mushrooms (from st29)
  'set21': 'https://drive.google.com/thumbnail?id=1aCYhCnbMQeG8ZgI1dgZCdQvKrGmlDso9&sz=w400', // Black Olives (from st4)
  'set22': 'https://drive.google.com/thumbnail?id=1xPlROHPgRsBfX4E5kYF8vygJkH51vLoW&sz=w1000', // Marinated Vegetables
  'set23': 'https://drive.google.com/thumbnail?id=15XpbkSBwMaMwJ7hOgbtpW5ifIppKB5S3&sz=w1000', // Beets (from st3)
  'set24': 'https://drive.google.com/thumbnail?id=1i7pYCU1eDQpsq4Mg5lWMgb_fEHlbDaDj&sz=w400', // Corn (from st11)
  'set25': 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400', // Roasted Red Peppers (from st31)
  'set26': 'https://drive.google.com/thumbnail?id=1g0nLELaMvLPMor90E9YMTY3KtMWFzV_o&sz=w400', // Green Olives (from st19)
  'set27': 'https://drive.google.com/thumbnail?id=14Jw0NQfkqCIITdEsMyP0ANQIjR9vLlcb&sz=w400', // Sun Dried Tomatoes (from st34)
  'set28': 'https://drive.google.com/thumbnail?id=1Vm5_OiGyPVMo6OKFgWxvr8EFSjkiWsLU&sz=w400', // Chic Peas (from st9)
  'set29': 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwZW5uZSUyMHBhc3RhfGVufDF8fHx8MTc2Mzc0NjMzNnww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Plain Pasta (from st27)
  'set30': 'https://drive.google.com/thumbnail?id=1zd-TuUchSMSEHbuV1K15sTNCVnLjuuEM&sz=w400', // Celery (from st8)
  'set31': 'https://images.unsplash.com/photo-1724154854089-4bbd0e7d09c8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjYXByZXNlJTIwdG9tYXRvJTIwbW96emFyZWxsYXxlbnwxfHx8fDE3NjM3NDYzNDV8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Caprese Mix (from st6)
  'set32': 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w1000', // Bacon (from st2)
  'set33': 'https://drive.google.com/thumbnail?id=1EzFTywi3a1CCDJGsjNZwBVq06zZq_HSQ&sz=w1000', // Crispy Chicken (from st12)
  'set34': 'https://drive.google.com/thumbnail?id=1alG3jOl-XS5Mg5ux7n7g0KotE9_yJ4th&sz=w400', // Turkey (from st39)
  'set35': 'https://drive.google.com/thumbnail?id=1Rwq4--zDS4XyHixY338vdKFNf9LLTGqW&sz=w400', // Tuna Mix (from st38)
  'set36': 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400', // Grilled Chicken (from st21)
  'set37': 'https://drive.google.com/thumbnail?id=1_5UtdDm2QOO2iMUT9gIXDR8_JfozqkPl&sz=w400', // Ham (from st22)
  'set38': 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400', // Pepperoni (from st26)
  'set39': 'https://drive.google.com/thumbnail?id=1AUvOA985D0AclEdTlq90zIOP1XOcyKz2&sz=w400', // Calamari Mix (from st5)
  'set40': 'https://drive.google.com/thumbnail?id=1zqbadi42-LGOF4L7m7fPUWpSS7L4Yrd6&sz=w400', // Fresh Mozzarella (from st18)
  'set41': 'https://images.unsplash.com/photo-1630492782892-74f99406dc59?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwYXN0YSUyMHNhbGFkfGVufDF8fHx8MTc2MzYyODgxMXww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Pasta Mix
};

// Salad Base images (for "Choose Your Base" section)
const SALAD_BASE_IMAGES: { [key: string]: string } = {
  // IDs from saladToppings.ts - using Google Drive images
  'iceberg': 'https://drive.google.com/thumbnail?id=1kAMqhapgNyOa2gMp2EG-YI45VRIFH4C1&sz=w1000', // Iceberg
  'romaine': 'https://drive.google.com/thumbnail?id=1jRQxEtXaI-5YwpCfeVtOYYDR6iZcSppk&sz=w1000', // Romaine
  'mixed-greens': 'https://images.unsplash.com/photo-1647268902830-298d9b6471ab?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtaXhlZCUyMGdyZWVucyUyMHNhbGFkJTIwYm93bHxlbnwxfHx8fDE3Njk4MTQ3NzJ8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', // Mixed Greens / Spring Mix
  'spinach': 'https://drive.google.com/thumbnail?id=1JdeEgQaRGlRswXCtvR4q3fpG7XGJGwPC&sz=w1000', // Spinach
  'mix-iceberg-romaine': 'https://drive.google.com/thumbnail?id=10ZeOYSS3QT0_sIUm72FWf0axNNBL01Rx&sz=w1000', // Mix Iceberg and Romaine
  // Legacy IDs for backwards compatibility
  'sb1': 'https://drive.google.com/thumbnail?id=1kAMqhapgNyOa2gMp2EG-YI45VRIFH4C1&sz=w1000', // Iceberg
  'sb2': 'https://drive.google.com/thumbnail?id=1jRQxEtXaI-5YwpCfeVtOYYDR6iZcSppk&sz=w1000', // Romaine
  'sb3': 'https://drive.google.com/thumbnail?id=10ZeOYSS3QT0_sIUm72FWf0axNNBL01Rx&sz=w1000', // Mix Romaine and Iceberg
  // Antipasto Salad IDs
  'asb1': 'https://drive.google.com/thumbnail?id=1kAMqhapgNyOa2gMp2EG-YI45VRIFH4C1&sz=w1000', // Iceberg
  'asb2': 'https://drive.google.com/thumbnail?id=1jRQxEtXaI-5YwpCfeVtOYYDR6iZcSppk&sz=w1000', // Romaine
  'asb3': 'https://drive.google.com/thumbnail?id=10ZeOYSS3QT0_sIUm72FWf0axNNBL01Rx&sz=w1000', // Mix Romaine and Iceberg
  'sb4': 'https://drive.google.com/thumbnail?id=1JdeEgQaRGlRswXCtvR4q3fpG7XGJGwPC&sz=w1000', // Spinach
  'sb5': 'https://drive.google.com/thumbnail?id=1CxSWYfTtzlrGe4h0_99Ol_V8bb_qFMyt&sz=w1000', // Spring Mix
};

// Salad Dressing images (for "Choose Your Dressing" section)
const SALAD_DRESSING_IMAGES: { [key: string]: string } = {
  // IDs from saladToppings.ts - using Google Drive images
  'avocado-ranch': 'https://drive.google.com/thumbnail?id=1Gg6iNlPUaImDp7LZTPQYmjbXrHZvB39x&sz=w1000', // Avocado Ranch
  'balsamic': 'https://drive.google.com/thumbnail?id=1q4TcoTy4bBKv6V-0lKdVwg4FhrPrGiZn&sz=w1000', // Balsamic Vinaigrette
  'balsamic-oil': 'https://drive.google.com/thumbnail?id=14SFcFmFhOVNs5fyInrhoF7VyLuYbio-G&sz=w1000', // Balsamic Vinegar & Oil
  'blue-cheese': 'https://drive.google.com/thumbnail?id=1IC2l-gLbo0QYFislwjItAp__I6DaajmN&sz=w1000', // Blue Cheese
  'buffalo': 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000', // Buffalo
  'caesar': 'https://drive.google.com/thumbnail?id=10VOoUiN14zDD_ype7l5BSEFgbJcf7IaA&sz=w1000', // Caesar
  'chipotle-ranch': 'https://drive.google.com/thumbnail?id=15HPwrLT70Gcs6LUkC5GXrpV-a2nUT0H5&sz=w1000', // Chipotle Ranch
  'creamy-italian': 'https://drive.google.com/thumbnail?id=1h-B9fqghICR_PZLYIXPd_VAWHQPL4HzI&sz=w1000', // Creamy Italian
  'fat-free-italian': 'https://drive.google.com/thumbnail?id=11WyvDp-cEGohwxEPW2yxgwAX1JJhVbzQ&sz=w1000', // Fat Free Italian
  'fat-free-ranch': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Fat Free Ranch
  'french': 'https://drive.google.com/thumbnail?id=1DD78wzRUoCiQ4C7gZLT_wVQZBJiqp4nu&sz=w1000', // French
  'green-goddess': 'https://drive.google.com/thumbnail?id=1v2T09u3nIJrT_i4seDT76K8ysG5opUBz&sz=w1000', // Green Goddess
  'honey-mustard': 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000', // Honey Mustard
  'lemon-oil': 'https://drive.google.com/thumbnail?id=1DX2c1hCjOoGBAOGUDrbgxOaKOfYQBx6m&sz=w1000', // Lemon Oil
  'lite-caesar': 'https://drive.google.com/thumbnail?id=10VOoUiN14zDD_ype7l5BSEFgbJcf7IaA&sz=w1000', // Lite Caesar
  'ranch': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Ranch
  'red-wine-vinegar-oil': 'https://drive.google.com/thumbnail?id=1sFzS6XXbS8bkOFKjZx4RZl2jbsGxUy1x&sz=w1000', // Red Wine Vinegar & Oil
  'russian': 'https://drive.google.com/thumbnail?id=1r_u8OvKKj5wKbcYi1IY1uem0-cNuBP48&sz=w1000', // Russian
  'white-balsamic-oil': 'https://drive.google.com/thumbnail?id=1Ry37WLAxDHV3s1_gwJbAnSuEXKGkkOnc&sz=w1000', // White Balsamic Vinegar & Oil
  // Legacy IDs for backwards compatibility
  'sd1': 'https://drive.google.com/thumbnail?id=1Gg6iNlPUaImDp7LZTPQYmjbXrHZvB39x&sz=w1000', // Avocado Ranch
  'sd2': 'https://drive.google.com/thumbnail?id=1GGvVde4_4JwEI6bzaMAVrbSAy0W_gg4i&sz=w1000', // Balsamic Vinaigrette
  'sd3': 'https://drive.google.com/thumbnail?id=14SFcFmFhOVNs5fyInrhoF7VyLuYbio-G&sz=w1000', // Balsamic Vinegar & Oil
  'sd4': 'https://drive.google.com/thumbnail?id=1IC2l-gLbo0QYFislwjItAp__I6DaajmN&sz=w1000', // Bleu Cheese
  'sd5': 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000', // Buffalo
  'sd6': 'https://drive.google.com/thumbnail?id=1L6oviEaIAB85VpWSvRsAyZvAiZTeSjJv&sz=w1000', // Caesar
  'sd7': 'https://drive.google.com/thumbnail?id=15HPwrLT70Gcs6LUkC5GXrpV-a2nUT0H5&sz=w1000', // Chipotle Ranch
  'sd8': 'https://drive.google.com/thumbnail?id=1h-B9fqghICR_PZLYIXPd_VAWHQPL4HzI&sz=w1000', // Creamy Italian
  'sd9': 'https://drive.google.com/thumbnail?id=11WyvDp-cEGohwxEPW2yxgwAX1JJhVbzQ&sz=w1000', // Fat Free Italian
  'sd10': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Fat Free Ranch
  'sd11': 'https://drive.google.com/thumbnail?id=1DD78wzRUoCiQ4C7gZLT_wVQZBJiqp4nu&sz=w1000', // French
  'sd12': 'https://drive.google.com/thumbnail?id=1v2T09u3nIJrT_i4seDT76K8ysG5opUBz&sz=w1000', // Green Goddess
  'sd13': 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000', // Honey Mustard
  'sd14': 'https://drive.google.com/thumbnail?id=1DX2c1hCjOoGBAOGUDrbgxOaKOfYQBx6m&sz=w1000', // Lemon Oil
  'sd15': 'https://drive.google.com/thumbnail?id=10VOoUiN14zDD_ype7l5BSEFgbJcf7IaA&sz=w1000', // Lite Caesar
  'sd16': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // No Dressing
  'sd17': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Ranch
  'sd18': 'https://drive.google.com/thumbnail?id=1sFzS6XXbS8bkOFKjZx4RZl2jbsGxUy1x&sz=w1000', // Red Wine Vinegar & Oil
  'sd19': 'https://drive.google.com/thumbnail?id=1r_u8OvKKj5wKbcYi1IY1uem0-cNuBP48&sz=w1000', // Russian
  'sd20': 'https://drive.google.com/thumbnail?id=1Ry37WLAxDHV3s1_gwJbAnSuEXKGkkOnc&sz=w1000', // White Balsamic Vinegar & Oil
  'sd21': 'https://drive.google.com/thumbnail?id=1AjIIFqxtZCJonUNFIFNP1hfUhZYkEI_S&sz=w1000', // Oil
  'sd22': 'https://drive.google.com/thumbnail?id=1T3FUU5BFv60sag9eIKbwwXMDTGRDkspF&sz=w1000', // Lemon
  'sd23': 'https://drive.google.com/thumbnail?id=1Bof4Gqrl0PeXgPxGpXbyCU2ZmZrF5dqj&sz=w1000', // Red Vinegar
  'sd24': 'https://drive.google.com/thumbnail?id=1q4TcoTy4bBKv6V-0lKdVwg4FhrPrGiZn&sz=w1000', // Balsamic Vinegar
};

// Salad Extra Dressing images (for "Extra Dressing" section)
const SALAD_EXTRA_DRESSING_IMAGES: { [key: string]: string } = {
  'sed1': 'https://drive.google.com/thumbnail?id=1WwLuvGOSu2ezGy38ztr39_wtWWX3k8XO&sz=w1000', // Avocado Ranch
  'sed2': 'https://drive.google.com/thumbnail?id=1q4TcoTy4bBKv6V-0lKdVwg4FhrPrGiZn&sz=w1000', // Balsamic Vinaigrette
  'sed3': 'https://drive.google.com/thumbnail?id=14SFcFmFhOVNs5fyInrhoF7VyLuYbio-G&sz=w1000', // Balsamic Vinegar & Oil
  'sed4': 'https://drive.google.com/thumbnail?id=1IC2l-gLbo0QYFislwjItAp__I6DaajmN&sz=w1000', // Bleu Cheese
  'sed5': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Buffalo (use Ranch image as placeholder)
  'sed6': 'https://drive.google.com/thumbnail?id=1L6oviEaIAB85VpWSvRsAyZvAiZTeSjJv&sz=w1000', // Caesar
  'sed7': 'https://drive.google.com/thumbnail?id=15HPwrLT70Gcs6LUkC5GXrpV-a2nUT0H5&sz=w1000', // Chipotle Ranch
  'sed8': 'https://drive.google.com/thumbnail?id=1h-B9fqghICR_PZLYIXPd_VAWHQPL4HzI&sz=w1000', // Creamy Italian
  'sed9': 'https://drive.google.com/thumbnail?id=11WyvDp-cEGohwxEPW2yxgwAX1JJhVbzQ&sz=w1000', // Fat Free Italian
  'sed10': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Fat Free Ranch
  'sed11': 'https://drive.google.com/thumbnail?id=1DD78wzRUoCiQ4C7gZLT_wVQZBJiqp4nu&sz=w1000', // French
  'sed12': 'https://drive.google.com/thumbnail?id=1v2T09u3nIJrT_i4seDT76K8ysG5opUBz&sz=w1000', // Green Goddess
  'sed13': 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000', // Honey Mustard
  'sed14': 'https://drive.google.com/thumbnail?id=1DX2c1hCjOoGBAOGUDrbgxOaKOfYQBx6m&sz=w1000', // Lemon Oil
  'sed15': 'https://drive.google.com/thumbnail?id=10VOoUiN14zDD_ype7l5BSEFgbJcf7IaA&sz=w1000', // Lite Caesar
  'sed16': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // No Dressing (use Ranch as placeholder)
  'sed17': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Ranch
  'sed18': 'https://drive.google.com/thumbnail?id=1sFzS6XXbS8bkOFKjZx4RZl2jbsGxUy1x&sz=w1000', // Red Wine Vinegar & Oil
  'sed19': 'https://drive.google.com/thumbnail?id=1r_u8OvKKj5wKbcYi1IY1uem0-cNuBP48&sz=w1000', // Russian
  'sed20': 'https://drive.google.com/thumbnail?id=1Ry37WLAxDHV3s1_gwJbAnSuEXKGkkOnc&sz=w1000', // White Balsamic Vinegar & Oil
  'sed21': 'https://drive.google.com/thumbnail?id=1AjIIFqxtZCJonUNFIFNP1hfUhZYkEI_S&sz=w1000', // Oil
  'sed22': 'https://drive.google.com/thumbnail?id=1T3FUU5BFv60sag9eIKbwwXMDTGRDkspF&sz=w1000', // Lemon
  'sed23': 'https://drive.google.com/thumbnail?id=1Bof4Gqrl0PeXgPxGpXbyCU2ZmZrF5dqj&sz=w1000', // Red Vinegar
  'sed24': 'https://drive.google.com/thumbnail?id=1q4TcoTy4bBKv6V-0lKdVwg4FhrPrGiZn&sz=w1000', // Balsamic Vinegar
  // Para los IDs de extraDressings
  'extra-avocado-ranch': 'https://drive.google.com/thumbnail?id=1WwLuvGOSu2ezGy38ztr39_wtWWX3k8XO&sz=w1000', // Avocado Ranch
  'extra-balsamic': 'https://drive.google.com/thumbnail?id=1q4TcoTy4bBKv6V-0lKdVwg4FhrPrGiZn&sz=w1000', // Balsamic Vinaigrette
  'extra-balsamic-oil': 'https://drive.google.com/thumbnail?id=14SFcFmFhOVNs5fyInrhoF7VyLuYbio-G&sz=w1000', // Balsamic Vinegar & Oil
  'extra-blue-cheese': 'https://drive.google.com/thumbnail?id=1IC2l-gLbo0QYFislwjItAp__I6DaajmN&sz=w1000', // Blue Cheese
  'extra-buffalo': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Buffalo
  'extra-caesar': 'https://drive.google.com/thumbnail?id=1L6oviEaIAB85VpWSvRsAyZvAiZTeSjJv&sz=w1000', // Caesar
  'extra-chipotle-ranch': 'https://drive.google.com/thumbnail?id=15HPwrLT70Gcs6LUkC5GXrpV-a2nUT0H5&sz=w1000', // Chipotle Ranch
  'extra-creamy-italian': 'https://drive.google.com/thumbnail?id=1h-B9fqghICR_PZLYIXPd_VAWHQPL4HzI&sz=w1000', // Creamy Italian
  'extra-fat-free-italian': 'https://drive.google.com/thumbnail?id=11WyvDp-cEGohwxEPW2yxgwAX1JJhVbzQ&sz=w1000', // Fat Free Italian
  'extra-fat-free-ranch': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Fat Free Ranch
  'extra-french': 'https://drive.google.com/thumbnail?id=1DD78wzRUoCiQ4C7gZLT_wVQZBJiqp4nu&sz=w1000', // French
  'extra-green-goddess': 'https://drive.google.com/thumbnail?id=1v2T09u3nIJrT_i4seDT76K8ysG5opUBz&sz=w1000', // Green Goddess
  'extra-honey-mustard': 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000', // Honey Mustard
  'extra-lemon-oil': 'https://drive.google.com/thumbnail?id=1DX2c1hCjOoGBAOGUDrbgxOaKOfYQBx6m&sz=w1000', // Lemon Oil
  'extra-lite-caesar': 'https://drive.google.com/thumbnail?id=10VOoUiN14zDD_ype7l5BSEFgbJcf7IaA&sz=w1000', // Lite Caesar
  'extra-ranch': 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000', // Ranch
  'extra-red-wine-vinegar-oil': 'https://drive.google.com/thumbnail?id=1sFzS6XXbS8bkOFKjZx4RZl2jbsGxUy1x&sz=w1000', // Red Wine Vinegar & Oil
  'extra-russian': 'https://drive.google.com/thumbnail?id=1r_u8OvKKj5wKbcYi1IY1uem0-cNuBP48&sz=w1000', // Russian
  'extra-white-balsamic-oil': 'https://drive.google.com/thumbnail?id=1Ry37WLAxDHV3s1_gwJbAnSuEXKGkkOnc&sz=w1000', // White Balsamic Vinegar & Oil
};

// Distribution icon component
const DistributionIcon = ({ 
  type, 
  isActive, 
  onClick,
  isInverted = false
}: { 
  type: 'left' | 'whole' | 'right'; 
  isActive: boolean; 
  onClick: () => void;
  isInverted?: boolean;
}) => {
  const activeColor = isInverted ? '#D1D5DB' : '#A72020';
  const inactiveColor = isInverted ? '#E08080' : '#D1D5DB';
  const fillColor = isActive ? activeColor : inactiveColor;
  
  return (
    <button
      type="button"
      onClick={(e) => {
        e.stopPropagation();
        onClick();
      }}
      className="w-7 h-7 flex items-center justify-center hover:scale-110 transition-transform"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke={fillColor} strokeWidth="2" fill="none" />
        {type === 'left' && (
          <path d="M12 2 A10 10 0 0 1 12 22 Z" fill={fillColor} />
        )}
        {type === 'whole' && (
          <circle cx="12" cy="12" r="9" fill={fillColor} />
        )}
        {type === 'right' && (
          <path d="M12 2 A10 10 0 0 0 12 22 Z" fill={fillColor} />
        )}
      </svg>
    </button>
  );
};

interface Topping {
  id: string;
  name: string;
  price?: number;
  largPrice?: number; // Price for large size
  image?: string;
  included?: boolean;
  removableIngredients?: { id: string; name: string; }[];
}

type SelectionType =
  | "topping"
  | "extra_topping"
  | "required_option"
  | "special_instruction"
  | "side"
  | "beverage"
  | "dessert"
  | "size"
  | "cheese"
  | "sauce"
  | "pasta_type"
  | "wrap_type"
  | "salad_base"
  | "dressing"
  | "other";

type BeverageCategory =
  | "20oz"
  | "2_liter"
  | "water"
  | "juice"
  | "other";

interface CartSelection {
  id: string;               // internal id/code (for logic and pricing)
  label: string;            // human-readable text (for UI display)
  type: SelectionType;      // what kind of selection this is
  groupId?: string;         // for toppings / grouped options
  groupTitle?: string;      // e.g. "Meats", "Cheeses", "Veggies"
  beverageCategory?: BeverageCategory; // if type === "beverage"
  distribution?: 'left' | 'whole' | 'right'; // for pizza topping distribution
  removedIngredients?: string[];
  productId?: string;
}

// LEGACY: Keep for backward compatibility during transition
interface CartItemCustomization {
  category: string;
  items: string[];
}

interface CartItem {
  id: string;
  productId: string;
  name: string;
  price: number;
  quantity: number;
  image?: string;
  customizations?: CartItemCustomization[]; // LEGACY - will be deprecated
  selections?: CartSelection[]; // NEW STRUCTURED MODEL
  category?: string;
}

interface ProductDetailPageProps {
  product: Product;
  onBack: () => void;
  onAddToCart: (product: Product, quantity: number, customizations?: CartItemCustomization[], selections?: CartSelection[]) => void;
  allProducts: Product[];
  isEditMode?: boolean;
  editingCartItem?: CartItem | null;
  deliveryMode: 'Pickup' | 'Delivery';
  onDeliveryModeChange: (mode: 'Pickup' | 'Delivery') => void;
  onProductChange?: (product: Product) => void;
  currentLocation?: string;
  scheduledTime?: string;
  cartItemsCount?: number;
  onLocationClick?: () => void;
  onCartClick?: () => void;
  mode?: 'regular' | 'ordernow' | 'catering';
  onModeChange?: (mode: 'regular' | 'ordernow' | 'catering') => void;
  activeCategory?: string;
  onCategoryChange?: (categoryId: string) => void;
}

const includedToppings: Topping[] = [
  {
    id: 't1',
    name: 'Mozzarella Cheese',
    included: true,
    image: 'https://images.unsplash.com/photo-1734774924912-dcbb467f8599?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtb3p6YXJlbGxhJTIwc3RpY2tzJTIwYXBwZXRpemVyfGVufDF8fHx8MTc2MjM1OTA1MHww&ixlib=rb-4.1.0&q=80&w=1080',
  },
  {
    id: 't2',
    name: 'Tomato Sauce',
    included: true,
    image: 'https://images.unsplash.com/photo-1472476443507-c7a5948772fc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx0b21hdG8lMjBzYXVjZXxlbnwxfHx8fDE3NjI4MDM1ODN8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral',
  },
  {
    id: 't3',
    name: 'Garlic Bread',
    included: true,
    image: 'https://images.unsplash.com/photo-1573140401552-3fab0b24306f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxnYXJsaWMlMjBicmVhZHxlbnwxfHx8fDE3NjIzNzM3MzR8MA&ixlib=rb-4.1.0&q=80&w=1080',
  },
  {
    id: 't4',
    name: 'Fresh Basil',
    included: true,
    image: 'https://images.unsplash.com/photo-1662422325326-19089df23d98?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxmcmVzaCUyMGJhc2lsJTIwbGVhdmVzfGVufDF8fHx8MTc2MjgxMDg0M3ww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral',
  },
  {
    id: 't5',
    name: 'Olive Oil',
    included: true,
    image: 'https://images.unsplash.com/photo-1743193144224-d2db90ea7784?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxvbGl2ZSUyMG9pbCUyMGRyaXp6bGV8ZW58MXx8fHwxNzYyODEwODQ0fDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral',
  },
];

const additionalToppings: Topping[] = [
  {
    id: 'a1',
    name: 'Cup n Char Pepperoni',
    price: 4.99,
    image: 'https://drive.google.com/thumbnail?id=1zLG_JHEEY8q_eH_EnMhOD7kx8nDHv9Rk&sz=w400',
  },
  {
    id: 'a2',
    name: 'Sausage',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1T7bfuraVR49J9dfJwBs8s2TSv4d7SoyI&sz=w400',
  },
  {
    id: 'a3',
    name: 'Pepperoni',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400',
  },
  {
    id: 'a4',
    name: 'Mushrooms',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400',
  },
  {
    id: 'a5',
    name: 'Fresh Mozzarella',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1Ol3OqaVbYxwLGAACMUPS_sJuca5IgfZS&sz=w400',
  },
  {
    id: 'a6',
    name: 'Grilled Onions',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400',
  },
  {
    id: 'a7',
    name: 'Sliced Black Olives',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1aCYhCnbMQeG8ZgI1dgZCdQvKrGmlDso9&sz=w400',
  },
  {
    id: 'a8',
    name: 'Ham',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1_5UtdDm2QOO2iMUT9gIXDR8_JfozqkPl&sz=w400',
  },
  {
    id: 'a9',
    name: 'Bacon',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400',
  },
  {
    id: 'a10',
    name: 'Chopped Garlic',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1uOj-ZtqX38qZMrDk-b03OjJ6-Nhoqyww&sz=w400',
  },
  {
    id: 'a11',
    name: 'Zucchini',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=17_SsmNN8yRHgQDI0qTNyGy6fgGjSuGZ1&sz=w400',
  },
  {
    id: 'a12',
    name: 'Sliced Hot Cherry Peppers',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400',
  },
  {
    id: 'a13',
    name: 'Mix Sweet Peppers',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400',
  },
  {
    id: 'a14',
    name: 'Roasted Peppers',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400',
  },
  {
    id: 'a15',
    name: 'Sundried Tomatoes',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=14Jw0NQfkqCIITdEsMyP0ANQIjR9vLlcb&sz=w400',
  },
  {
    id: 'a16',
    name: 'Anchovies',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1raKjTe8PSZNQmy7KApo6PkWzm1IBto_P&sz=w400',
  },
  {
    id: 'a17',
    name: 'Spinach',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1zc9sVnQ5fz4h_qpGq_RQnAhiiTYXyqCV&sz=w400',
  },
  {
    id: 'a18',
    name: 'Extra Cheese',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1zqbadi42-LGOF4L7m7fPUWpSS7L4Yrd6&sz=w400',
  },
  {
    id: 'a19',
    name: 'Ricotta Cheese',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1WD_EbE-L27RmlggvIuU656A6ChXpAufY&sz=w400',
  },
  {
    id: 'a20',
    name: 'Sliced Meatballs',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1f63otm7CqMF_7T9rnabUURnNZX-D_OYT&sz=w400',
  },
  {
    id: 'a21',
    name: 'Chopped Tomato',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1H4iNykLVvOiRItfPHBaar1PIbNWwsBjP&sz=w400',
  },
  {
    id: 'a22',
    name: 'Broccoli Florets',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w400',
  },
  {
    id: 'a23',
    name: 'Eggplant',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=121jJUd3UR30lBcXzKboSSEAat9_skQHO&sz=w400',
  },
  {
    id: 'a24',
    name: 'Artichokes',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1xmgRvCCIypumXrqHjuKHLGqmwuCQqIN5&sz=w400',
  },
  {
    id: 'a25',
    name: 'Pineapple',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1p0SdVWZmuq-h9D2t63hUZRTkKnurxie5&sz=w400',
  },
  {
    id: 'a26',
    name: "Mike's Hot Honey",
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=13sMdpB6f3mDzHju1EoQTXM71XE1DmBKd&sz=w400',
  },
  {
    id: 'a27',
    name: 'Grilled Chicken',
    price: 10.99,
    image: 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400',
  },
  {
    id: 'a28',
    name: 'Beef Steak',
    price: 10.99,
    image: 'https://drive.google.com/thumbnail?id=1iiKMtj4hlB8T3YiCG7RxjceQDmuwSxni&sz=w400',
  },
  {
    id: 'a29',
    name: 'Chicken Steak',
    price: 10.99,
    image: 'https://drive.google.com/thumbnail?id=1FO0Dts4Y4pCgE0WPax0ijSjKFzuXAqfj&sz=w400',
  },
  {
    id: 'a30',
    name: 'Banana Peppers',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400',
  },
  {
    id: 'a31',
    name: 'Mix Grilled Peppers',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400',
  },
  {
    id: 'a32',
    name: 'Raw Onions',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400',
  },
  {
    id: 'a33',
    name: 'Sliced Tomatoes',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400',
  },
];

// Topping Groups Configuration - DYNAMIC SECTION-BASED MAPPING
// This function searches through all topping arrays to find which section a topping belongs to
// and returns the ACTUAL section title from the UI, not a generic category

interface ToppingSection {
  toppings: Topping[] | readonly Topping[];
  sectionTitle: string;
  groupId: string;
}

// Helper function to get group info for a topping - searches ALL topping arrays dynamically
const getToppingGroupInfo = (toppingId: string): { groupId: string; groupTitle: string } => {
  // Define all topping sections with their ACTUAL UI titles
  // This will be populated lazily when needed to avoid issues with variables not being defined yet
  const getSections = (): ToppingSection[] => [
    // Pizza sections
    { toppings: includedToppings, sectionTitle: 'Included Toppings', groupId: 'included' },
    { toppings: additionalToppings.filter(t => ['a1', 'a27', 'a28', 'a29'].includes(t.id)), sectionTitle: 'Premium Meats', groupId: 'premium_meats' },
    { toppings: additionalToppings.filter(t => ['a2', 'a3', 'a8', 'a9', 'a16', 'a20'].includes(t.id)), sectionTitle: 'Meats', groupId: 'meats' },
    { toppings: additionalToppings.filter(t => ['a5', 'a18', 'a19'].includes(t.id)), sectionTitle: 'Cheeses', groupId: 'cheeses' },
    { toppings: additionalToppings.filter(t => ['a4', 'a6', 'a7', 'a10', 'a11', 'a12', 'a13', 'a14', 'a15', 'a17', 'a21', 'a22', 'a23', 'a24', 'a25', 'a30'].includes(t.id)), sectionTitle: 'Vegetables', groupId: 'veggies' },
    { toppings: additionalToppings.filter(t => ['a26'].includes(t.id)), sectionTitle: 'Sauces & Extras', groupId: 'sauces' },
    { toppings: specialtyToppings, sectionTitle: 'Add Toppings', groupId: 'specialty' },
    { toppings: specialtyToppingsSecondHalf, sectionTitle: 'Add Toppings (Second Half)', groupId: 'specialty_second' },
    
    // Cheesesteak sections
    { toppings: cheesesteakToppings, sectionTitle: 'Toppings', groupId: 'cheesesteak_toppings' },
    { toppings: createYourOwnCheesesteakToppings, sectionTitle: 'Add Toppings', groupId: 'create_cheesesteak' },
    { toppings: extraToppings, sectionTitle: 'Extra Toppings', groupId: 'extra_toppings' },
    { toppings: liteToppings, sectionTitle: 'Lite Toppings', groupId: 'lite_toppings' },
    { toppings: noToppings, sectionTitle: 'No Toppings', groupId: 'no_toppings' },
    { toppings: cheesesteakNoToppings, sectionTitle: 'No Toppings', groupId: 'cheesesteak_no_toppings' },
    
    // Burger sections
    { toppings: burgerAddToppings, sectionTitle: 'Add Toppings', groupId: 'burger_add' },
    { toppings: burgerExtraToppings, sectionTitle: 'Extra Toppings', groupId: 'burger_extra' },
    { toppings: burgerLiteToppings, sectionTitle: 'Lite Toppings', groupId: 'burger_lite' },
    { toppings: burgerSideToppings, sectionTitle: 'Side Toppings', groupId: 'burger_side' },
    
    // Brioche sections
    { toppings: briocheNoToppings, sectionTitle: 'No Toppings', groupId: 'brioche_no' },
    { toppings: briocheGrilledChickenNoToppings, sectionTitle: 'No Toppings', groupId: 'brioche_grilled_no' },
    { toppings: briocheMozzarellaGrilledChickenNoToppings, sectionTitle: 'No Toppings', groupId: 'brioche_mozz_no' },
    { toppings: briocheSideToppings, sectionTitle: 'Side Toppings', groupId: 'brioche_side' },
    
    // Hot Hoagie sections
    { toppings: hotHoagieExtraToppings, sectionTitle: 'Extra Toppings', groupId: 'hot_hoagie_extra' },
    { toppings: grilledChickenHoagieNoToppings, sectionTitle: 'No Toppings', groupId: 'grilled_chicken_no' },
    { toppings: sausagePeppersOnionsNoToppings, sectionTitle: 'No Toppings', groupId: 'sausage_peppers_no' },
    { toppings: cheeseBurgerDeluxeNoToppings, sectionTitle: 'No Toppings', groupId: 'cheeseburger_no' },
    
    // Pasta sections
    { toppings: pastaVegetables, sectionTitle: 'Vegetables', groupId: 'pasta_veggies' },
    { toppings: pastaProteins, sectionTitle: 'Proteins', groupId: 'pasta_proteins' },
    { toppings: pastaCheesesExtras, sectionTitle: 'Cheeses & Extras', groupId: 'pasta_cheese' },
    { toppings: kidsPastaToppings, sectionTitle: 'Add Toppings', groupId: 'kids_pasta_add' },
    { toppings: buildPastaToppings, sectionTitle: 'Add Toppings', groupId: 'build_pasta_add' },
    { toppings: kidsBakedExtraToppings, sectionTitle: 'Extra Toppings', groupId: 'kids_baked_extra' },
    { toppings: kidsBakedLiteToppings, sectionTitle: 'Lite Toppings', groupId: 'kids_baked_lite' },
    { toppings: kidsBakedNoToppings, sectionTitle: 'No Toppings', groupId: 'kids_baked_no' },
    { toppings: kidsPastaMeatballToppings, sectionTitle: 'Add Toppings', groupId: 'kids_meatball_add' },
    
    // Platter sections  
    { toppings: hoagiePlatterOptions, sectionTitle: 'Select Your Hoagies', groupId: 'hoagie_platter_options' },
    { toppings: hoagiePlatterSideToppings, sectionTitle: 'Side Toppings', groupId: 'hoagie_platter_side' },
    { toppings: wrapPlatterOptions, sectionTitle: 'Select Your Wraps', groupId: 'wrap_platter_options' },
    { toppings: wrapPlatterSideToppings, sectionTitle: 'Side Toppings', groupId: 'wrap_platter_side' },
    { toppings: hotSandwichPlatterOptions, sectionTitle: 'Select Your Hot Sandwiches', groupId: 'hot_sandwich_platter_options' },
    { toppings: hotSandwichPlatterSideToppings, sectionTitle: 'Side Toppings', groupId: 'hot_sandwich_platter_side' },
    
    // Cold Hoagie sections
    { toppings: coldHoagieAddToppings, sectionTitle: 'Add Toppings', groupId: 'cold_hoagie_add' },
    { toppings: coldHoagieExtraToppings, sectionTitle: 'Extra Toppings', groupId: 'cold_hoagie_extra' },
    { toppings: coldHoagieLiteToppings, sectionTitle: 'Lite Toppings', groupId: 'cold_hoagie_lite' },
    { toppings: coldHoagieNoToppings, sectionTitle: 'No Toppings', groupId: 'cold_hoagie_no' },
    { toppings: coldHoagieSideToppings, sectionTitle: 'Side Toppings', groupId: 'cold_hoagie_side' },
    
    // Panini sections
    { toppings: paniniLiteToppings, sectionTitle: 'Lite Toppings', groupId: 'panini_lite' },
    { toppings: paniniNoToppings, sectionTitle: 'No Toppings', groupId: 'panini_no' },
    { toppings: paniniSideToppings, sectionTitle: 'Side Toppings', groupId: 'panini_side' },
    
    // Wrap sections
    { toppings: wrapAddToppings, sectionTitle: 'Add Toppings', groupId: 'wrap_add' },
    { toppings: wrapLiteToppings, sectionTitle: 'Lite Toppings', groupId: 'wrap_lite' },
    { toppings: wrapNoToppings, sectionTitle: 'No Toppings', groupId: 'wrap_no' },
    { toppings: wrapSideToppings, sectionTitle: 'Side Toppings', groupId: 'wrap_side' },
    
    // Salad sections
    { toppings: saladToppingsOptions, sectionTitle: 'Choose Your Toppings', groupId: 'salad_toppings' },
    { toppings: saladExtraToppingsOptions, sectionTitle: 'Extra Toppings', groupId: 'salad_extra_toppings' },
    { toppings: saladExtraDressingOptions, sectionTitle: 'Extra Dressing', groupId: 'salad_extra_dressing' },
    
    // Additional sections
    { toppings: mashedPotatoesToppings, sectionTitle: 'Mashed Potatoes Toppings', groupId: 'mashed_potatoes' },
    { toppings: meatballsSausageSauceToppings, sectionTitle: 'Meatballs & Sausage Toppings', groupId: 'meatballs_sausage' },
  ];
  
  // Search through all sections to find which one contains this topping
  const sections = getSections();
  for (const section of sections) {
    const found = section.toppings.find((t: any) => t.id === toppingId);
    if (found) {
      return {
        groupId: section.groupId,
        groupTitle: section.sectionTitle
      };
    }
  }
  
  // Fallback for unmapped toppings
  return { groupId: 'other', groupTitle: 'Other Toppings' };
};

// Pasta toppings - for pasta dishes only
// Vegetables
const pastaVegetables: Topping[] = [
  {
    id: 'pv1',
    name: 'Mushrooms',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400',
  },
  {
    id: 'pv2',
    name: 'Spinach',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1zc9sVnQ5fz4h_qpGq_RQnAhiiTYXyqCV&sz=w400',
  },
  {
    id: 'pv3',
    name: 'Broccoli',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w400',
  },
  {
    id: 'pv4',
    name: 'Zucchini',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=17_SsmNN8yRHgQDI0qTNyGy6fgGjSuGZ1&sz=w400',
  },
  {
    id: 'pv5',
    name: 'Roasted Peppers',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400',
  },
  {
    id: 'pv6',
    name: 'Sundried Tomatoes',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=14Jw0NQfkqCIITdEsMyP0ANQIjR9vLlcb&sz=w400',
  },
  {
    id: 'pv7',
    name: 'Eggplant',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=121jJUd3UR30lBcXzKboSSEAat9_skQHO&sz=w400',
  },
  {
    id: 'pv8',
    name: 'Artichokes',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1xmgRvCCIypumXrqHjuKHLGqmwuCQqIN5&sz=w400',
  },
];

// Proteins
const pastaProteins: Topping[] = [
  {
    id: 'pp1',
    name: 'Add Chicken',
    price: 5.99,
    image: 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400',
  },
  {
    id: 'pp2',
    name: 'Add Shrimp',
    price: 8.49,
    image: 'https://drive.google.com/thumbnail?id=14mjBfgjg1U5hT7MS2L1MUTH1DwWO7jFF&sz=w1000',
  },
  {
    id: 'pp3',
    name: 'Sausage',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1T7bfuraVR49J9dfJwBs8s2TSv4d7SoyI&sz=w400',
  },
  {
    id: 'pp4',
    name: 'Meatballs',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1f63otm7CqMF_7T9rnabUURnNZX-D_OYT&sz=w400',
  },
  {
    id: 'pp5',
    name: 'Bacon',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400',
  },
  {
    id: 'pp6',
    name: 'Anchovies',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1raKjTe8PSZNQmy7KApo6PkWzm1IBto_P&sz=w400',
  },
];

// Cheeses & Extras
const pastaCheesesExtras: Topping[] = [
  {
    id: 'pc1',
    name: 'Fresh Mozzarella',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1Ol3OqaVbYxwLGAACMUPS_sJuca5IgfZS&sz=w400',
  },
  {
    id: 'pc2',
    name: 'Ricotta Cheese',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1WD_EbE-L27RmlggvIuU656A6ChXpAufY&sz=w400',
  },
  {
    id: 'pc3',
    name: 'Extra Cheese',
    price: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1zqbadi42-LGOF4L7m7fPUWpSS7L4Yrd6&sz=w400',
  },
  {
    id: 'pc4',
    name: 'Chopped Garlic',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1uOj-ZtqX38qZMrDk-b03OjJ6-Nhoqyww&sz=w400',
  },
];

// Baked Pasta toppings - Side Soups, Salads, & Extra Bread
const bakedPastaSides: Topping[] = [
  {
    id: 'bps1',
    name: 'Extra Bread',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1IvFgnN1WG37YCyBNpDof1Exz5hcPJpeh&sz=w400',
  },
  {
    id: 'bps2',
    name: 'Side Garden Salad',
    price: 7.99,
    image: 'https://drive.google.com/thumbnail?id=1-yLCsD6LDbyOhsYDMNDYfXW37hriuCMW&sz=w400',
    removableIngredients: [
      { id: 'sgs-tomatoes', name: 'Tomatoes' },
      { id: 'sgs-red-onions', name: 'Red Onions' },
      { id: 'sgs-carrots', name: 'Shredded Carrots' },
      { id: 'sgs-cucumbers', name: 'Cucumbers' },
      { id: 'sgs-green-peppers', name: 'Green Peppers' },
      { id: 'sgs-black-olives', name: 'Black Olives' },
    ]
  },
  {
    id: 'bps3',
    name: 'Side Caesar Salad',
    price: 7.99,
    image: 'https://drive.google.com/thumbnail?id=1J942Yn7FpSnBXzruFOr06uuk7m1Gyk0a&sz=w1000',
    removableIngredients: [
      { id: 'scs-parmesan', name: 'Shredded Parmesan Cheese' },
      { id: 'scs-croutons', name: 'Croutons' },
    ]
  },
  {
    id: 'bps4',
    name: '16oz Pasta Fagoli',
    price: 8.49,
    image: 'https://drive.google.com/thumbnail?id=15wBRDs037tG4neSd-IX-mdetvcIJ4w4M&sz=w400',
  },
  {
    id: 'bps5',
    name: '16oz Soup of the Day',
    price: 8.49,
    image: 'https://drive.google.com/thumbnail?id=1sG9VxC4eVV6sBHkEdzw1XhHvQou26X9J&sz=w400',
  },
];

// Baked Pasta Special Instructions
const bakedPastaSpecialInstructions: Topping[] = [
  {
    id: 'bpsi1',
    name: 'No Mozzarella Cheese on top',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
];

// Fish Special Instructions - For Fried Flounder and Tilapia
const fishSpecialInstructions: Topping[] = [
  {
    id: 'fsi1',
    name: 'Extra Lemon Wedge',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'fsi2',
    name: 'Extra Tartar Sauce',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'fsi3',
    name: 'Well Done',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
];

// Catering Entree Special Instructions - For Chicken & Meat Trays (c3-c9)
const cateringEntreeSpecialInstructions: Topping[] = [
  {
    id: 'cesi1',
    name: 'Cut in 1/2',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
];

// Pasta Types - For Catering Pasta with Sauce Trays (cp7-cp11)
const pastaTypes: Topping[] = [
  {
    id: 'pt6',
    name: 'Penne',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1giuOIv84WD3Z-yB3UAcpCDsp8-N91OJ-&sz=w400',
  },
  {
    id: 'pt1',
    name: 'Cappellini',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=11oENl2Sf2uVmtcQX5M9iyvG4u9poF4IH&sz=w400',
  },
  {
    id: 'pt2',
    name: 'Fettuccine',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1tzbNi9YKq3TC-B9_VkcqGqxSwqkKfz37&sz=w400',
  },
  {
    id: 'pt3',
    name: 'Gluten Free Penne',
    price: 10.00,
    image: 'https://drive.google.com/thumbnail?id=19DhUTVbcnbkHioBLbq9wZx-NRCvvu7Nl&sz=w400',
  },
  {
    id: 'pt5',
    name: 'Linguine',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1Ful6PZ4WaOug1uh2kOGZA9Q4tgnjTM59&sz=w400',
  },
  {
    id: 'pt4',
    name: 'Gnocchi',
    price: 5.00,
    image: 'https://drive.google.com/thumbnail?id=1fWZ6wibVSHz7SNWTaCKN38ycxbUt9k2z&sz=w400',
  },
  {
    id: 'pt7',
    name: 'Rigatoni',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w400',
  },
  {
    id: 'pt8',
    name: 'Spaghetti',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=10hgB8Hu9ZzN6zW-F_6EeAN3UuqTzSrAx&sz=w400',
  },
  {
    id: 'pt9',
    name: 'Ziti',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080',
  },
];

// Pasta Additions - For Catering Pasta with Sauce Trays (cp7-cp11)
const pastaAdditions: Topping[] = [
  {
    id: 'pa1',
    name: 'Grilled Chicken',
    price: 17.49, // Medium price
    largPrice: 34.99, // Large price
    image: 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w1080',
  },
  {
    id: 'pa2',
    name: 'Broccoli',
    price: 3.49,
    largPrice: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1K4Gzs-HYBa2bFz2MH75DyyxB5xm6Jf_A&sz=w1080',
  },
  {
    id: 'pa3',
    name: 'Mushrooms',
    price: 3.49,
    largPrice: 3.49,
    image: 'https://drive.google.com/thumbnail?id=1ZJblzVjTCHrc8BBpo_WV5EUOZs7LXv2x&sz=w1080',
  },
  {
    id: 'pa4',
    name: 'Shrimp',
    price: 8.49,
    largPrice: 8.49,
    image: 'https://drive.google.com/thumbnail?id=14mjBfgjg1U5hT7MS2L1MUTH1DwWO7jFF&sz=w1080',
  },
];

// Mashed Potatoes Toppings - Only for Mashed Potatoes (side-4)
const mashedPotatoesToppings: Topping[] = [
  {
    id: 'mp1',
    name: 'Add Gravy',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1644450605923-d5b0df52f50c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
  {
    id: 'mp2',
    name: 'No Gravy',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1644450605923-d5b0df52f50c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
];

// Meatballs & Sausage Sauce Toppings - Only for Meatballs (side-5) and Sausage (side-7)
const meatballsSausageSauceToppings: Topping[] = [
  {
    id: 'mss1',
    name: 'Lite Sauce',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1472476443507-c7a5948772fc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
  {
    id: 'mss2',
    name: 'No Sauce',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1472476443507-c7a5948772fc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
  {
    id: 'mss3',
    name: 'Sauce On The Side',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1472476443507-c7a5948772fc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
  {
    id: 'mss4',
    name: 'Add Extra Sauce',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1472476443507-c7a5948772fc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
];

// Pasta Fagioli Soup Toppings - Special Instructions and Substitute Cracker
const pastaFagioliSpecialInstructions: Topping[] = [
  {
    id: 'pfsi1',
    name: 'No Pasta',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1610565826403-0a8cecc8ce5e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
];

const pastaFagioliSubstituteCracker: Topping[] = [
  {
    id: 'pfsc1',
    name: 'Sub Saltine Crackers',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1626200949840-179d3e52f7fd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200',
  },
];

// Antipasto Salad Bowl - Base Options
const antipastoSaladBases: Topping[] = [
  { id: 'asb1', name: 'Iceberg', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1kAMqhapgNyOa2gMp2EG-YI45VRIFH4C1&sz=w1000' },
  { id: 'asb2', name: 'Romaine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1jRQxEtXaI-5YwpCfeVtOYYDR6iZcSppk&sz=w1000' },
  { id: 'asb3', name: 'Mix Romaine and Iceberg', price: 0.00, image: 'https://drive.google.com/thumbnail?id=10ZeOYSS3QT0_sIUm72FWf0axNNBL01Rx&sz=w1000' },
  { id: 'asb4', name: 'Spinach', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JdeEgQaRGlRswXCtvR4q3fpG7XGJGwPC&sz=w1000' },
  { id: 'asb5', name: 'Spring Mix', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1CxSWYfTtzlrGe4h0_99Ol_V8bb_qFMyt&sz=w1000' },
];

// Antipasto Salad Bowl - Dressing Choices
const antipastoSaladDressings: Topping[] = [
  { id: 'asd2', name: 'Balsamic Vinaigrette', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1q4TcoTy4bBKv6V-0lKdVwg4FhrPrGiZn&sz=w1000' },
  { id: 'asd3', name: 'Balsamic Vinegar & Oil', price: 0.00, image: 'https://drive.google.com/thumbnail?id=14SFcFmFhOVNs5fyInrhoF7VyLuYbio-G&sz=w1000' },
  { id: 'asd4', name: 'Buffalo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000' },
  { id: 'asd5', name: 'Caesar', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1L6oviEaIAB85VpWSvRsAyZvAiZTeSjJv&sz=w1000' },
  { id: 'asd6', name: 'Chipotle Ranch', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15HPwrLT70Gcs6LUkC5GXrpV-a2nUT0H5&sz=w1000' },
  { id: 'asd7', name: 'Creamy Italian', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1h-B9fqghICR_PZLYIXPd_VAWHQPL4HzI&sz=w1000' },
  { id: 'asd8', name: 'Fat Free Italian', price: 0.00, image: 'https://drive.google.com/thumbnail?id=11WyvDp-cEGohwxEPW2yxgwAX1JJhVbzQ&sz=w1000' },
  { id: 'asd9', name: 'Fat Free Ranch', price: 0.00, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'asd10', name: 'French', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1DD78wzRUoCiQ4C7gZLT_wVQZBJiqp4nu&sz=w1000' },
  { id: 'asd12', name: 'Honey Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000' },
  { id: 'asd13', name: 'Lemon Oil', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1DX2c1hCjOoGBAOGUDrbgxOaKOfYQBx6m&sz=w1000' },
  { id: 'asd14', name: 'Lite Caesar', price: 0.00, image: 'https://drive.google.com/thumbnail?id=10VOoUiN14zDD_ype7l5BSEFgbJcf7IaA&sz=w1000' },
  { id: 'asd15', name: 'No Dressing', price: 0.00, image: 'https://images.unsplash.com/photo-1472476443507-c7a5948772fc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'asd16', name: 'Ranch', price: 0.00, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'asd17', name: 'Red Wine Vinegar & Oil', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1sFzS6XXbS8bkOFKjZx4RZl2jbsGxUy1x&sz=w1000' },
  { id: 'asd18', name: 'Russian', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1r_u8OvKKj5wKbcYi1IY1uem0-cNuBP48&sz=w1000' },
  { id: 'asd19', name: 'White Balsamic Vinegar & Oil', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Ry37WLAxDHV3s1_gwJbAnSuEXKGkkOnc&sz=w1000' },
];

// Antipasto Salad - Special Instructions
const antipastoSaladSpecialInstructions: Topping[] = [
  { id: 'assi1', name: 'No Ham', price: 0.00, image: 'https://images.unsplash.com/photo-1542002976-c3be9b105508?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi2', name: 'No Provolone Cheese', price: 0.00, image: 'https://images.unsplash.com/photo-1486297678162-eb2a19b0a32d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi3', name: 'No Salami', price: 0.00, image: 'https://images.unsplash.com/photo-1551388389-b5d3f0e1f7cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi4', name: 'No Capicola', price: 0.00, image: 'https://images.unsplash.com/photo-1551182672-8d9be4e711d2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi5', name: 'No Black Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi6', name: 'No Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi7', name: 'No Onions', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi8', name: 'No Marinated Vegetables', price: 0.00, image: 'https://images.unsplash.com/photo-1592417817098-8fd3d9eb14a5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'assi9', name: 'No Green Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1622341357129-c460d41da93d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Caesar Salad Bowl - Special Instructions
const caesarSaladSpecialInstructions: Topping[] = [
  { id: 'cssi1', name: 'No Croutons', price: 0.00, image: 'https://images.unsplash.com/photo-1626200949840-179d3e52f7fd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'cssi2', name: 'No Parm Cheese', price: 0.00, image: 'https://images.unsplash.com/photo-1580981001482-61a9db9b8396?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Garden Salad - Special Instructions
const gardenSaladSpecialInstructions: Topping[] = [
  { id: 'gssi1', name: 'No Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'gssi2', name: 'No Red Onions', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'gssi3', name: 'No Shredded Carrots', price: 0.00, image: 'https://images.unsplash.com/photo-1582515073490-39981397c445?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'gssi4', name: 'No Cucumbers', price: 0.00, image: 'https://images.unsplash.com/photo-1604977042946-1eecc30f269e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'gssi5', name: 'No Green Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1622341357129-c460d41da93d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'gssi6', name: 'No Black Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Three Cheese Salad Bowl - Special Instructions
const threeCheeseSaladSpecialInstructions: Topping[] = [
  { id: 'tcsi1', name: 'No Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi2', name: 'No Cucumbers', price: 0.00, image: 'https://images.unsplash.com/photo-1604977042946-1eecc30f269e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi3', name: 'No Provolone Cheese', price: 0.00, image: 'https://images.unsplash.com/photo-1486297678162-eb2a19b0a32d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi4', name: 'No Mozzarella Cheese', price: 0.00, image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi5', name: 'No American Cheese', price: 0.00, image: 'https://images.unsplash.com/photo-1618164436241-4473940d1f5c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi6', name: 'No Green Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1622341357129-c460d41da93d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi7', name: 'No Onions', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tcsi8', name: 'No Black Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Traditional Chef Salad - Special Instructions
const traditionalChefSaladSpecialInstructions: Topping[] = [
  { id: 'trcsi1', name: 'No Ham', price: 0.00, image: 'https://images.unsplash.com/photo-1624360242295-6ac5f0d2f185?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi2', name: 'No Turkey', price: 0.00, image: 'https://images.unsplash.com/photo-1629032355159-f970dd98e9ff?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi3', name: 'No Provolone', price: 0.00, image: 'https://images.unsplash.com/photo-1486297678162-eb2a19b0a32d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi4', name: 'No Sliced Egg', price: 0.00, image: 'https://images.unsplash.com/photo-1587486937648-e279e95f9f2f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi5', name: 'No Green Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1622341357129-c460d41da93d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi6', name: 'No Black Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi7', name: 'No Croutons', price: 0.00, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi8', name: 'No Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi9', name: 'No Red Onions', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'trcsi10', name: 'No Shredded Carrots', price: 0.00, image: 'https://images.unsplash.com/photo-1582515073490-39981397c445?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Calamari Salad - Special Instructions
const calamariSaladSpecialInstructions: Topping[] = [
  { id: 'calsi1', name: 'No Celery', price: 0.00, image: 'https://images.unsplash.com/photo-1604594849809-dfedbc827105?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'calsi2', name: 'No Roasted Peppers', price: 0.00, image: 'https://images.unsplash.com/photo-1563565375-f3fdfdbefa83?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'calsi3', name: 'No Capers', price: 0.00, image: 'https://images.unsplash.com/photo-1610489935103-32cf4f78e5ce?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'calsi4', name: 'No Lemon Juice', price: 0.00, image: 'https://images.unsplash.com/photo-1587486937184-c6ce4bf1e011?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'calsi5', name: 'No Olive Oil', price: 0.00, image: 'https://images.unsplash.com/photo-1474979266404-7eaacbcd87c5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Caprese Salad - Special Instructions
const capreseSaladSpecialInstructions: Topping[] = [
  { id: 'capsi1', name: 'No Cherry Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1592841200221-a6898f307baa?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'capsi2', name: 'No Fresh Ciliegine Mozzarella', price: 0.00, image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'capsi3', name: 'No Olive Oil', price: 0.00, image: 'https://images.unsplash.com/photo-1474979266404-7eaacbcd87c5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'capsi4', name: 'No Basil Ribbons', price: 0.00, image: 'https://images.unsplash.com/photo-1618375569909-3c8616cf7e55?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Farfalle Pasta Salad - Special Instructions
const farfallePastaSaladSpecialInstructions: Topping[] = [
  { id: 'fpsi1', name: 'No Bow-Tie Pasta', price: 0.00, image: 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'fpsi2', name: 'No Chopped Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'fpsi3', name: 'No Shredded Carrots', price: 0.00, image: 'https://images.unsplash.com/photo-1582515073490-39981397c445?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'fpsi4', name: 'No Red Onions', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'fpsi5', name: 'No Cucumbers', price: 0.00, image: 'https://images.unsplash.com/photo-1604977042946-1eecc30f269e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'fpsi6', name: 'No Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Italian Chopped - Special Instructions
const italianChoppedSpecialInstructions: Topping[] = [
  { id: 'icsi1', name: 'No Salami', price: 0.00, image: 'https://images.unsplash.com/photo-1551388389-b5d3f0e1f7cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi2', name: 'No Tomatoes', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi3', name: 'No Cucumbers', price: 0.00, image: 'https://images.unsplash.com/photo-1604977042946-1eecc30f269e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi4', name: 'No Red Onions', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi5', name: 'No Green Peppers', price: 0.00, image: 'https://images.unsplash.com/photo-1563565375-f3fdfdbefa83?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi6', name: 'No Shredded Carrots', price: 0.00, image: 'https://images.unsplash.com/photo-1582515073490-39981397c445?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi7', name: 'No Mushrooms', price: 0.00, image: 'https://images.unsplash.com/photo-1622164425368-27d952c4d23d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi8', name: 'No Fresh Mozzarella', price: 0.00, image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'icsi9', name: 'No Shredded Parmesan Cheese', price: 0.00, image: 'https://images.unsplash.com/photo-1580981001482-61a9db9b8396?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Roasted Red Peppers Salad - Special Instructions
const roastedRedPeppersSaladSpecialInstructions: Topping[] = [
  { id: 'rrpsi1', name: 'No Roasted Red Peppers', price: 0.00, image: 'https://images.unsplash.com/photo-1563565375-f3fdfdbefa83?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'rrpsi2', name: 'No Ciliegine Mozzarella', price: 0.00, image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'rrpsi3', name: 'No Black Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Tuna Salad - Special Instructions
const tunaSaladSpecialInstructions: Topping[] = [
  { id: 'tssi1', name: 'No Chopped Tomato', price: 0.00, image: 'https://images.unsplash.com/photo-1546094096-0df4bcaaa337?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tssi2', name: 'No Tuna Mix', price: 0.00, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tssi3', name: 'No Red Onion', price: 0.00, image: 'https://images.unsplash.com/photo-1508747703725-719777637510?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tssi4', name: 'No Celery', price: 0.00, image: 'https://images.unsplash.com/photo-1604594849809-dfedbc827105?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tssi5', name: 'No Cucumbers', price: 0.00, image: 'https://images.unsplash.com/photo-1604977042946-1eecc30f269e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tssi6', name: 'No Green Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1622341357129-c460d41da93d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'tssi7', name: 'No Black Olives', price: 0.00, image: 'https://images.unsplash.com/photo-1596099477998-880bc06e09f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Hoagie Platter - Build Your Platter (Choose at least 4)
const hoagiePlatterOptions: Topping[] = [
  { id: 'hpo1', name: 'Ham & Cheese', price: 13.49, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hpo2', name: 'Italian', price: 13.49, image: 'https://images.unsplash.com/photo-1553909489-ec2175ef3f52?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hpo3', name: 'Tuna Fish', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hpo4', name: 'Turkey', price: 13.49, image: 'https://images.unsplash.com/photo-1629032355159-f970dd98e9ff?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Hoagie Platter - Cut Options
const hoagiePlatterCutOptions: Topping[] = [
  { id: 'hpco1', name: 'Cut in 2', price: 0.00, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hpco2', name: 'Cut in 3', price: 0.00, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hpco3', name: 'Cut in 4', price: 0.00, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Hoagie Platter - Side Toppings
const hoagiePlatterSideToppings: Topping[] = [
  { id: 'hpst1', name: 'Side Mayo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1fC91H85UmS3VJpsOGCjkP9VBZ2wYB7W7&sz=w400' },
  { id: 'hpst2', name: 'Side Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w400' },
  { id: 'hpst3', name: 'Side Ketchup', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1p7OU8cyqPg6I2EUGr6pyhgibS4Bg87Gm&sz=w400' },
  { id: 'hpst4', name: 'Side Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'hpst5', name: 'Side Tomatoes', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' },
  { id: 'hpst6', name: 'Side Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'hpst7', name: 'Side Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'hpst8', name: 'Side Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'hpst9', name: 'Side Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1ZJblzVjTCHrc8BBpo_WV5EUOZs7LXv2x&sz=w400' },
  { id: 'hpst10', name: 'Side Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'hpst11', name: 'Side Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'hpst12', name: 'Side Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
];

// Wrap Platter - Build Your Platter (Choose at least 4)
const wrapPlatterOptions: Topping[] = [
  { id: 'wpo1', name: 'Buffalo Chicken Cheesesteak Wrap', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo2', name: 'Cheesesteak Wrap', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo3', name: 'Chicken Caesar', price: 13.49, image: 'https://images.unsplash.com/photo-1546793665-c74683f339c1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo4', name: 'Chicken Cheesesteak Wrap', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo5', name: 'Grilled Chicken Wrap', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo10', name: 'Ham & American Cheese', price: 13.49, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo6', name: 'Italian', price: 13.49, image: 'https://images.unsplash.com/photo-1553909489-ec2175ef3f52?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo7', name: 'Tuna', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo8', name: 'Turkey', price: 13.49, image: 'https://images.unsplash.com/photo-1629032355159-f970dd98e9ff?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpo9', name: 'Veggie', price: 13.49, image: 'https://images.unsplash.com/photo-1572441713132-c542fc4fe282?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Wrap Platter - Wrap Type
const wrapPlatterWrapTypes: Topping[] = [
  { id: 'wpwt1', name: 'Mix White + Wheat', price: 0.00, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpwt2', name: 'White', price: 0.00, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wpwt3', name: 'Whole Wheat Wrap', price: 0.00, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Wrap Platter - Side Toppings (with counters)
const wrapPlatterSideToppings: Topping[] = [
  { id: 'wpst1', name: 'Side Mayo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1fC91H85UmS3VJpsOGCjkP9VBZ2wYB7W7&sz=w400' },
  { id: 'wpst2', name: 'Side Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w400' },
  { id: 'wpst3', name: 'Side Ketchup', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1p7OU8cyqPg6I2EUGr6pyhgibS4Bg87Gm&sz=w400' },
  { id: 'wpst4', name: 'Side Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'wpst5', name: 'Side Tomatoes', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' },
  { id: 'wpst6', name: 'Side Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'wpst7', name: 'Side Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'wpst8', name: 'Side Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'wpst9', name: 'Side Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1ZJblzVjTCHrc8BBpo_WV5EUOZs7LXv2x&sz=w400' },
  { id: 'wpst10', name: 'Side Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'wpst11', name: 'Side Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'wpst12', name: 'Side Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
];

// Hot Sandwich Platter - Build Your Platter (Choose at least 4)
const hotSandwichPlatterOptions: Topping[] = [
  { id: 'hspo1', name: 'Buffalo Chicken Cheesesteak', price: 13.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo2', name: 'Cheesesteak', price: 12.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo3', name: 'Cheesesteak Hoagie', price: 13.49, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo4', name: 'Chicken Cheesesteak', price: 12.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo5', name: 'Chicken Cheesesteak Hoagie', price: 13.49, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo6', name: 'Chicken Parm Sandwich', price: 13.49, image: 'https://images.unsplash.com/photo-1632778149955-e80f8ceca2e8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo7', name: 'Copper Passesteak', price: 16.49, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo8', name: 'Eggplant Parm Sandwich', price: 13.49, image: 'https://images.unsplash.com/photo-1572441713132-c542fc4fe282?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo9', name: 'Meatball Parm Sandwich', price: 13.49, image: 'https://images.unsplash.com/photo-1529042410759-befb1204b468?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo10', name: "Passariello's Cheesesteak", price: 13.99, image: 'https://images.unsplash.com/photo-1626200419199-391ae4be7a41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo11', name: 'Pizza Steak', price: 13.49, image: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo12', name: 'Sausage Parm Sandwich', price: 13.49, image: 'https://images.unsplash.com/photo-1608877907149-a206d75ba011?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspo13', name: 'Sausage, Peppers, Onions Sandwich', price: 13.49, image: 'https://images.unsplash.com/photo-1608877907149-a206d75ba011?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Hot Sandwich Platter - Cut Options
const hotSandwichPlatterCutOptions: Topping[] = [
  { id: 'hspco1', name: 'Cut in 2', price: 0.00, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspco2', name: 'Cut in 3', price: 0.00, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'hspco3', name: 'Cut in 4', price: 0.00, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Hot Sandwich Platter - Side Toppings (with counters)
const hotSandwichPlatterSideToppings: Topping[] = [
  { id: 'hspst1', name: 'Side Mayo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1fC91H85UmS3VJpsOGCjkP9VBZ2wYB7W7&sz=w400' },
  { id: 'hspst2', name: 'Side Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w400' },
  { id: 'hspst3', name: 'Side Ketchup', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1p7OU8cyqPg6I2EUGr6pyhgibS4Bg87Gm&sz=w400' },
  { id: 'hspst4', name: 'Side Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'hspst5', name: 'Side Tomatoes', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' },
  { id: 'hspst6', name: 'Side Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'hspst7', name: 'Side Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'hspst8', name: 'Side Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'hspst9', name: 'Side Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1ZJblzVjTCHrc8BBpo_WV5EUOZs7LXv2x&sz=w400' },
  { id: 'hspst10', name: 'Side Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'hspst11', name: 'Side Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'hspst12', name: 'Side Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
];

// Baby Clam Sauce Tray - Pasta Type (Choose exactly 1)
const babyClamPastaTypes: Topping[] = [
  { id: 'bcpt6', name: 'Penne', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l4luVReHbR9r-fyAAEtbs10S06SyKpQT&sz=w1000' },
  { id: 'bcpt1', name: 'Cappellini', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Fcq7TSl7D9-r_t-8zXrY-5YF37uL8Pn4&sz=w1000' },
  { id: 'bcpt2', name: 'Fettuccine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1ZagYj8uRHWq6jyyU8sR46VqfQ69AH9TH&sz=w1000' },
  { id: 'bcpt3', name: 'Gluten Free Penne', price: 10.00, image: 'https://drive.google.com/thumbnail?id=1dRXjZqbOQpxUGFj3whOJcARAifOXRLSK&sz=w1000' },
  { id: 'bcpt5', name: 'Linguine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1iX-Ufur3xVFi3TBC33TxDnC8xnh-WQEK&sz=w1000' },
  { id: 'bcpt4', name: 'Gnocchi', price: 5.00, image: 'https://drive.google.com/thumbnail?id=1GihoRLyGIS0u2-WlFNBcX8PxtrkOG05g&sz=w1000' },
  { id: 'bcpt7', name: 'Rigatoni', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000' },
  { id: 'bcpt8', name: 'Spaghetti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1dRIShq1iW1aVLKyBFremdlNa90Q_xFdY&sz=w1000' },
  { id: 'bcpt9', name: 'Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080' },
];

// Baby Clam Sauce Tray - Sauce Choice (Choose exactly 1)
const babyClamSauceChoices: Topping[] = [
  { id: 'bcsc1', name: 'Marinara Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1552056776-9b5657118ca4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'bcsc2', name: 'White Wine Garlic Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1599749012259-126a66c5f674?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Calamari Marinara Tray - Pasta Type (Choose exactly 1)
const calamariPastaTypes: Topping[] = [
  { id: 'cmpt6', name: 'Penne', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l4luVReHbR9r-fyAAEtbs10S06SyKpQT&sz=w1000' },
  { id: 'cmpt1', name: 'Cappellini', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Fcq7TSl7D9-r_t-8zXrY-5YF37uL8Pn4&sz=w1000' },
  { id: 'cmpt2', name: 'Fettuccine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1ZagYj8uRHWq6jyyU8sR46VqfQ69AH9TH&sz=w1000' },
  { id: 'cmpt3', name: 'Gluten Free Penne', price: 10.00, image: 'https://drive.google.com/thumbnail?id=1dRXjZqbOQpxUGFj3whOJcARAifOXRLSK&sz=w1000' },
  { id: 'cmpt5', name: 'Linguine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1iX-Ufur3xVFi3TBC33TxDnC8xnh-WQEK&sz=w1000' },
  { id: 'cmpt4', name: 'Gnocchi', price: 5.00, image: 'https://drive.google.com/thumbnail?id=1GihoRLyGIS0u2-WlFNBcX8PxtrkOG05g&sz=w1000' },
  { id: 'cmpt7', name: 'Rigatoni', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000' },
  { id: 'cmpt8', name: 'Spaghetti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1dRIShq1iW1aVLKyBFremdlNa90Q_xFdY&sz=w1000' },
  { id: 'cmpt9', name: 'Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080' },
];

// Calamari Marinara Tray - Sauce Choice (Choose exactly 1)
const calamariSubstituteSauce: Topping[] = [
  { id: 'cmss1', name: 'Marinara Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1552056776-9b5657118ca4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'cmss2', name: 'White Wine Garlic Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1599749012259-126a66c5f674?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Mussels Tray - Pasta Type (Choose exactly 1)
const musselsPastaTypes: Topping[] = [
  { id: 'mtpt6', name: 'Penne', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l4luVReHbR9r-fyAAEtbs10S06SyKpQT&sz=w1000' },
  { id: 'mtpt1', name: 'Cappellini', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Fcq7TSl7D9-r_t-8zXrY-5YF37uL8Pn4&sz=w1000' },
  { id: 'mtpt2', name: 'Fettuccine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1ZagYj8uRHWq6jyyU8sR46VqfQ69AH9TH&sz=w1000' },
  { id: 'mtpt3', name: 'Gluten Free Penne', price: 10.00, image: 'https://drive.google.com/thumbnail?id=1dRXjZqbOQpxUGFj3whOJcARAifOXRLSK&sz=w1000' },
  { id: 'mtpt5', name: 'Linguine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1iX-Ufur3xVFi3TBC33TxDnC8xnh-WQEK&sz=w1000' },
  { id: 'mtpt4', name: 'Gnocchi', price: 5.00, image: 'https://drive.google.com/thumbnail?id=1GihoRLyGIS0u2-WlFNBcX8PxtrkOG05g&sz=w1000' },
  { id: 'mtpt7', name: 'Rigatoni', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000' },
  { id: 'mtpt8', name: 'Spaghetti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1dRIShq1iW1aVLKyBFremdlNa90Q_xFdY&sz=w1000' },
  { id: 'mtpt9', name: 'Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080' },
];

// Mussels Tray - Sauce Choice (Choose exactly 1)
const musselsSauceChoices: Topping[] = [
  { id: 'mtsc1', name: 'Marinara Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1552056776-9b5657118ca4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'mtsc2', name: 'White Wine Garlic Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1599749012259-126a66c5f674?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Seafood Combo Tray - Pasta Type (Choose exactly 1)
const seafoodComboPastaTypes: Topping[] = [
  { id: 'scpt6', name: 'Penne', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l4luVReHbR9r-fyAAEtbs10S06SyKpQT&sz=w1000' },
  { id: 'scpt1', name: 'Cappellini', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Fcq7TSl7D9-r_t-8zXrY-5YF37uL8Pn4&sz=w1000' },
  { id: 'scpt2', name: 'Fettuccine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1ZagYj8uRHWq6jyyU8sR46VqfQ69AH9TH&sz=w1000' },
  { id: 'scpt3', name: 'Gluten Free Penne', price: 10.00, image: 'https://drive.google.com/thumbnail?id=1dRXjZqbOQpxUGFj3whOJcARAifOXRLSK&sz=w1000' },
  { id: 'scpt5', name: 'Linguine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1iX-Ufur3xVFi3TBC33TxDnC8xnh-WQEK&sz=w1000' },
  { id: 'scpt4', name: 'Gnocchi', price: 5.00, image: 'https://drive.google.com/thumbnail?id=1GihoRLyGIS0u2-WlFNBcX8PxtrkOG05g&sz=w1000' },
  { id: 'scpt7', name: 'Rigatoni', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000' },
  { id: 'scpt8', name: 'Spaghetti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1dRIShq1iW1aVLKyBFremdlNa90Q_xFdY&sz=w1000' },
  { id: 'scpt9', name: 'Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080' },
];

// Seafood Combo Tray - Sauce Choice (Choose exactly 1)
const seafoodComboSauceChoices: Topping[] = [
  { id: 'scsc1', name: 'Marinara Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1552056776-9b5657118ca4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'scsc2', name: 'White Wine Garlic Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1599749012259-126a66c5f674?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Shrimp Marinara Tray - Pasta Type (Choose exactly 1)
const shrimpMarinaraPastaTypes: Topping[] = [
  { id: 'smpt6', name: 'Penne', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1giuOIv84WD3Z-yB3UAcpCDsp8-N91OJ-&sz=w1000' },
  { id: 'smpt1', name: 'Cappellini', price: 0.00, image: 'https://drive.google.com/thumbnail?id=11oENl2Sf2uVmtcQX5M9iyvG4u9poF4IH&sz=w1000' },
  { id: 'smpt2', name: 'Fettuccine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1tzbNi9YKq3TC-B9_VkcqGqxSwqkKfz37&sz=w1000' },
  { id: 'smpt3', name: 'Gluten Free Penne', price: 20.00, image: 'https://drive.google.com/thumbnail?id=19DhUTVbcnbkHioBLbq9wZx-NRCvvu7Nl&sz=w1000' },
  { id: 'smpt5', name: 'Linguine', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Ful6PZ4WaOug1uh2kOGZA9Q4tgnjTM59&sz=w1000' },
  { id: 'smpt4', name: 'Gnocchi', price: 10.00, image: 'https://drive.google.com/thumbnail?id=1fWZ6wibVSHz7SNWTaCKN38ycxbUt9k2z&sz=w1000' },
  { id: 'smpt7', name: 'Rigatoni', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000' },
  { id: 'smpt8', name: 'Spaghetti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=10hgB8Hu9ZzN6zW-F_6EeAN3UuqTzSrAx&sz=w1000' },
  { id: 'smpt9', name: 'Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080' },
];

// Shrimp Marinara Tray - Sauce Choice (Choose exactly 1)
const shrimpMarinaraSubstituteSauce: Topping[] = [
  { id: 'smss1', name: 'Marinara Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1552056776-9b5657118ca4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'smss2', name: 'White Wine Garlic Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1599749012259-126a66c5f674?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Cannoli - Special Instruction
const cannoliSpecialInstruction: Topping[] = [
  { id: 'csi1', name: 'No Powdered Sugar', price: 0.00, image: 'https://images.unsplash.com/photo-1516594798947-e65505dbb29d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Dessert Trays - Special Instruction (Cut in 12)
const dessertTraySpecialInstruction: Topping[] = [
  { id: 'dtsi1', name: 'Cut in 12', price: 0.00, image: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Kids Pasta Type images
const KIDS_PASTA_TYPE_IMAGES: { [key: string]: string } = {
  'kpt1': 'https://drive.google.com/thumbnail?id=10hgB8Hu9ZzN6zW-F_6EeAN3UuqTzSrAx&sz=w400', // Spaghetti
  'kpt2': 'https://drive.google.com/thumbnail?id=1giuOIv84WD3Z-yB3UAcpCDsp8-N91OJ-&sz=w400', // Penne
  'kpt3': 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080', // Ziti
  'kpt4': 'https://drive.google.com/thumbnail?id=1Ful6PZ4WaOug1uh2kOGZA9Q4tgnjTM59&sz=w400', // Linguine
  'kpt5': 'https://drive.google.com/thumbnail?id=11oENl2Sf2uVmtcQX5M9iyvG4u9poF4IH&sz=w400', // Capellini
  'kpt6': 'https://drive.google.com/thumbnail?id=1tzbNi9YKq3TC-B9_VkcqGqxSwqkKfz37&sz=w400', // Fettuccine
  'kpt7': 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000', // Rigatoni
  'kpt8': 'https://drive.google.com/thumbnail?id=1fWZ6wibVSHz7SNWTaCKN38ycxbUt9k2z&sz=w1000', // Gnocchi
  'kpt9': 'https://drive.google.com/thumbnail?id=19DhUTVbcnbkHioBLbq9wZx-NRCvvu7Nl&sz=w1000', // GF Penne
};

// Seafood Pasta Type images
const SEAFOOD_PASTA_TYPE_IMAGES: { [key: string]: string } = {
  'sfp1': 'https://drive.google.com/thumbnail?id=10hgB8Hu9ZzN6zW-F_6EeAN3UuqTzSrAx&sz=w400', // Spaghetti
  'sfp2': 'https://drive.google.com/thumbnail?id=1giuOIv84WD3Z-yB3UAcpCDsp8-N91OJ-&sz=w400', // Penne
  'sfp3': 'https://drive.google.com/thumbnail?id=1Ful6PZ4WaOug1uh2kOGZA9Q4tgnjTM59&sz=w400', // Linguine
  'sfp4': 'https://drive.google.com/thumbnail?id=11oENl2Sf2uVmtcQX5M9iyvG4u9poF4IH&sz=w400', // Capellini
  'sfp5': 'https://drive.google.com/thumbnail?id=1tzbNi9YKq3TC-B9_VkcqGqxSwqkKfz37&sz=w400', // Fettuccine
  'sfp6': 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w1080', // Ziti
  'sfp9': 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000', // Rigatoni
  'sfp7': 'https://drive.google.com/thumbnail?id=1fWZ6wibVSHz7SNWTaCKN38ycxbUt9k2z&sz=w1000', // Gnocchi
  'sfp8': 'https://drive.google.com/thumbnail?id=19DhUTVbcnbkHioBLbq9wZx-NRCvvu7Nl&sz=w1000', // GF Penne
};

// Kids Pasta Sauce images
const KIDS_PASTA_SAUCE_IMAGES: { [key: string]: string } = {
  'kps1': 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w400', // Tomato
  'kps2': 'https://drive.google.com/thumbnail?id=1rZIRDMfpbmzGypgw2gaJNn4p0DizVeV1&sz=w400', // Alfredo
  'kps3': 'https://drive.google.com/thumbnail?id=1-wuPKIVgmQEaGzqHCoVcyQKSEgNkWlVB&sz=w400', // Butter Sauce
  'kps4': 'https://drive.google.com/thumbnail?id=1Zma9py9fX7tFp0oy6YtuPrfwVfqf4Pnf&sz=w400', // Vodka Sauce
  'kps5': 'https://drive.google.com/thumbnail?id=1_cydxB3cCNSNS_6po0G070Ud-3oyTXPq&sz=w400', // Pomodoro Sauce
  'kps6': 'https://drive.google.com/thumbnail?id=1dJv9IQB4oI22VT1Odktxcfpw-4ktW4dr&sz=w400', // Pomodoro Sauce & (1) Meatball
};

// Kids Pasta Topping images
const KIDS_PASTA_TOPPING_IMAGES: { [key: string]: string } = {
  'kpat1': 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400', // Mushrooms
  'kpat2': 'https://drive.google.com/thumbnail?id=1zc9sVnQ5fz4h_qpGq_RQnAhiiTYXyqCV&sz=w400', // Spinach
  'kpat3': 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w400', // Broccoli
  'kpat4': 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400', // Grilled Chicken Strips
  'kpat5': 'https://drive.google.com/thumbnail?id=14mjBfgjg1U5hT7MS2L1MUTH1DwWO7jFF&sz=w400', // Shrimp
};

// Kids Pasta Toppings
const kidsPastaTypes: Topping[] = [
  { id: 'kpt2', name: 'Penne', price: 0.00, image: 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpt5', name: 'Capellini', price: 0.00, image: 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpt6', name: 'Fettuccine', price: 0.00, image: 'https://images.unsplash.com/photo-1611171711882-7d7a1f5c1280?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpt9', name: 'GF Penne', price: 4.00, image: 'https://drive.google.com/thumbnail?id=19DhUTVbcnbkHioBLbq9wZx-NRCvvu7Nl&sz=w1000' },
  { id: 'kpt4', name: 'Linguine', price: 0.00, image: 'https://images.unsplash.com/photo-1611171711882-7d7a1f5c1280?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpt8', name: 'Gnocchi', price: 2.00, image: 'https://drive.google.com/thumbnail?id=1fWZ6wibVSHz7SNWTaCKN38ycxbUt9k2z&sz=w1000' },
  { id: 'kpt7', name: 'Rigatoni', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1B2GHWA0NHWvNNhfqEJSZvquTRnTOMrte&sz=w1000' },
  { id: 'kpt1', name: 'Spaghetti', price: 0.00, image: 'https://images.unsplash.com/photo-1600803907087-f56d462fd26b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpt3', name: 'Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w400' },
];

const kidsPastaSauces: Topping[] = [
  { id: 'kps2', name: 'Alfredo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1rZIRDMfpbmzGypgw2gaJNn4p0DizVeV1&sz=w400' },
  { id: 'kps3', name: 'Butter Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1596040008851-47b1b82c73df?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kps4', name: 'Vodka Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Zma9py9fX7tFp0oy6YtuPrfwVfqf4Pnf&sz=w400' },
  { id: 'kps5', name: 'Pomodoro Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1_cydxB3cCNSNS_6po0G070Ud-3oyTXPq&sz=w400' },
  { id: 'kps6', name: 'Pomodoro Sauce & (1) Meatball', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1dJv9IQB4oI22VT1Odktxcfpw-4ktW4dr&sz=w400' },
];

const kidsPastaToppings: Topping[] = [
  { id: 'kpat1', name: 'Mushrooms', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400' },
  { id: 'kpat2', name: 'Spinach', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1zc9sVnQ5fz4h_qpGq_RQnAhiiTYXyqCV&sz=w400' },
  { id: 'kpat3', name: 'Broccoli', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w400' },
  { id: 'kpat4', name: 'Grilled Chicken Strips', price: 1.99, image: 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400' },
  { id: 'kpat5', name: 'Shrimp', price: 4.99, image: 'https://images.unsplash.com/photo-1761095596550-63e8c2356bbc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

const kidsPastaSpecialInstructions: Topping[] = [
  { id: 'kpsi1', name: 'Sauce On The Side', price: 0.00, image: 'https://images.unsplash.com/photo-1610135373399-472c8722106f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Build Your Own Pasta Sauces (cp-1)
const buildPastaSauces: Topping[] = [
  { id: 'bps1', name: 'Pomodoro Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1_cydxB3cCNSNS_6po0G070Ud-3oyTXPq&sz=w400' },
  { id: 'bps2', name: 'Pomodoro Sauce with (2) Meatballs', price: 3.50, image: 'https://drive.google.com/thumbnail?id=1M2cJh1yIdIya0hzHH4Nr8ta-qW1YpVKF&sz=w400' },
  { id: 'bps3', name: 'Pomodoro Sauce with (2) Sausage', price: 3.50, image: 'https://drive.google.com/thumbnail?id=1QqsdG3YatAZb1W34OrFv_r0mTuIqwBYZ&sz=w400' },
  { id: 'bps4', name: 'Marinara Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=19r_ISTtvJc9WAPWoJqtXV3UZJUNvz0Yo&sz=w400' },
  { id: 'bps5', name: 'Bolognese Sauce', price: 2.00, image: 'https://drive.google.com/thumbnail?id=1toDglS09efc9ZspYl3fNc_o4fBudOrdv&sz=w400' },
  { id: 'bps6', name: 'Vodka Sauce', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1Zma9py9fX7tFp0oy6YtuPrfwVfqf4Pnf&sz=w400' },
  { id: 'bps7', name: 'Garlic & Oil', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1dGKmemolMs3Xu0roP7O98028DMI5-RJE&sz=w400' },
  { id: 'bps8', name: 'Butter Sauce', price: 0.00, image: '' },
  { id: 'bps9', name: 'Mushroom Sauce', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1Qcek_MmvxxYuVrJ-Q72z0Nv5WIAreTkN&sz=w400' },
  { id: 'bps10', name: 'Alfredo Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1rZIRDMfpbmzGypgw2gaJNn4p0DizVeV1&sz=w400' },
  { id: 'bps11', name: 'Sausage & Roasted Peppers', price: 2.00, image: 'https://drive.google.com/thumbnail?id=1qAoGivLdbLlBmeJW3LFoZJcWp57xkRV0&sz=w400' },
  { id: 'bps12', name: 'Pasta alla Passariello', price: 3.00, image: 'https://drive.google.com/thumbnail?id=1emSQwD76QRqnlFhF7zpqa_fIidO2T3Zf&sz=w400' },
];

// Build Your Own Pasta Sauce images
const BUILD_PASTA_SAUCE_IMAGES: { [key: string]: string } = {
  'bps1': 'https://drive.google.com/thumbnail?id=1_cydxB3cCNSNS_6po0G070Ud-3oyTXPq&sz=w400', // Pomodoro Sauce
  'bps2': 'https://drive.google.com/thumbnail?id=1M2cJh1yIdIya0hzHH4Nr8ta-qW1YpVKF&sz=w400', // Pomodoro Sauce with (2) Meatballs
  'bps3': 'https://drive.google.com/thumbnail?id=1QqsdG3YatAZb1W34OrFv_r0mTuIqwBYZ&sz=w400', // Pomodoro Sauce with (2) Sausage
  'bps4': 'https://drive.google.com/thumbnail?id=19r_ISTtvJc9WAPWoJqtXV3UZJUNvz0Yo&sz=w400', // Marinara Sauce
  'bps5': 'https://drive.google.com/thumbnail?id=1toDglS09efc9ZspYl3fNc_o4fBudOrdv&sz=w400', // Bolognese Sauce
  'bps6': 'https://drive.google.com/thumbnail?id=1Zma9py9fX7tFp0oy6YtuPrfwVfqf4Pnf&sz=w400', // Vodka Sauce
  'bps7': 'https://drive.google.com/thumbnail?id=1dGKmemolMs3Xu0roP7O98028DMI5-RJE&sz=w400', // Garlic & Oil
  'bps8': '', // Butter Sauce (no image)
  'bps9': 'https://drive.google.com/thumbnail?id=1Qcek_MmvxxYuVrJ-Q72z0Nv5WIAreTkN&sz=w400', // Mushroom Sauce
  'bps10': 'https://drive.google.com/thumbnail?id=1rZIRDMfpbmzGypgw2gaJNn4p0DizVeV1&sz=w400', // Alfredo Sauce
  'bps11': 'https://drive.google.com/thumbnail?id=1qAoGivLdbLlBmeJW3LFoZJcWp57xkRV0&sz=w400', // Sausage & Roasted Peppers
  'bps12': 'https://drive.google.com/thumbnail?id=1emSQwD76QRqnlFhF7zpqa_fIidO2T3Zf&sz=w400', // Pasta alla Passariello
};

// Build Your Own Pasta Toppings (cp-1)
const buildPastaToppings: Topping[] = [
  { id: 'bpt1', name: 'Grilled Chicken Strips (8oz)', price: 5.99, image: 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400' },
  { id: 'bpt2', name: 'Shrimp (8)', price: 8.49, image: 'https://drive.google.com/thumbnail?id=14mjBfgjg1U5hT7MS2L1MUTH1DwWO7jFF&sz=w400' },
  { id: 'bpt3', name: 'Two Meatballs', price: 9.49, image: 'https://drive.google.com/thumbnail?id=1Ynag62AV-JgSopOQ3h3ouWwarYBhlufz&sz=w400' },
  { id: 'bpt4', name: 'Two Italian Sausage', price: 9.49, image: 'https://drive.google.com/thumbnail?id=1VbYyk-he0f5GQ3La2jQKTjtnYQ6Ygzqo&sz=w400' },
  { id: 'bpt5', name: 'Broccoli', price: 1.49, image: 'https://drive.google.com/thumbnail?id=1K4Gzs-HYBa2bFz2MH75DyyxB5xm6Jf_A&sz=w400' },
];

// Build Your Own Pasta Topping images
const BUILD_PASTA_TOPPING_IMAGES: { [key: string]: string } = {
  'bpt1': 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400', // Grilled Chicken Strips
  'bpt2': 'https://drive.google.com/thumbnail?id=14mjBfgjg1U5hT7MS2L1MUTH1DwWO7jFF&sz=w400', // Shrimp
  'bpt3': 'https://drive.google.com/thumbnail?id=1Ynag62AV-JgSopOQ3h3ouWwarYBhlufz&sz=w400', // Two Meatballs
  'bpt4': 'https://drive.google.com/thumbnail?id=1VbYyk-he0f5GQ3La2jQKTjtnYQ6Ygzqo&sz=w400', // Two Italian Sausage
  'bpt5': 'https://drive.google.com/thumbnail?id=1K4Gzs-HYBa2bFz2MH75DyyxB5xm6Jf_A&sz=w400', // Broccoli
};

// Build Your Own Pasta Soup Options (cp-1)
const buildPastaSoups: Topping[] = [
  { id: 'bps1', name: 'Pasta e Fagioli', price: 8.49, image: 'https://drive.google.com/thumbnail?id=15wBRDs037tG4neSd-IX-mdetvcIJ4w4M&sz=w400' },
  { id: 'bps2', name: 'Soup of the day', price: 8.49, image: 'https://drive.google.com/thumbnail?id=1sG9VxC4eVV6sBHkEdzw1XhHvQou26X9J&sz=w400' },
  { 
    id: 'bps3', 
    name: 'Side Garden Salad', 
    price: 7.99, 
    image: 'https://drive.google.com/thumbnail?id=1Q9mQoORhLlbG_bP7CeiOwktAkYr7hf6u&sz=w400',
    removableIngredients: [
      { id: 'sgs-tomatoes', name: 'Tomatoes' },
      { id: 'sgs-red-onions', name: 'Red Onions' },
      { id: 'sgs-carrots', name: 'Shredded Carrots' },
      { id: 'sgs-cucumbers', name: 'Cucumbers' },
      { id: 'sgs-green-peppers', name: 'Green Peppers' },
      { id: 'sgs-black-olives', name: 'Black Olives' },
    ]
  },
  { 
    id: 'bps4', 
    name: 'Side Caesar Salad', 
    price: 7.99, 
    image: 'https://drive.google.com/thumbnail?id=1J942Yn7FpSnBXzruFOr06uuk7m1Gyk0a&sz=w400',
    removableIngredients: [
      { id: 'scs-parmesan', name: 'Shredded Parmesan Cheese' },
      { id: 'scs-croutons', name: 'Croutons' },
    ]
  }
];

// Build Your Own Pasta Soup images
const BUILD_PASTA_SOUP_IMAGES: { [key: string]: string } = {
  'bps1': 'https://drive.google.com/thumbnail?id=15wBRDs037tG4neSd-IX-mdetvcIJ4w4M&sz=w400', // Pasta e Fagioli
  'bps2': 'https://drive.google.com/thumbnail?id=1sG9VxC4eVV6sBHkEdzw1XhHvQou26X9J&sz=w400', // Soup of the day
};

// Kids Baked items (k2, k3, k4) Topping images
const KIDS_BAKED_TOPPING_IMAGES: { [key: string]: string } = {
  'kbt1': 'https://images.unsplash.com/photo-1553798411-c1022f992f28?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // Extra Sauce
  'kbt2': 'https://images.unsplash.com/photo-1723473620176-8d26dc6314cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // Extra Cheese
  'kbt3': 'https://images.unsplash.com/photo-1691480208637-6ed63aac6694?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // Lite Sauce
  'kbt5': 'https://images.unsplash.com/photo-1723473620176-8d26dc6314cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // No Mozzarella Cheese on top
};

// Kids Baked items Toppings
const kidsBakedExtraToppings: Topping[] = [
  { id: 'kbt1', name: 'Extra Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1553798411-c1022f992f28?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kbt2', name: 'Extra Cheese', price: 0.99, image: 'https://images.unsplash.com/photo-1723473620176-8d26dc6314cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

const kidsBakedLiteToppings: Topping[] = [
  { id: 'kbt3', name: 'Lite Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1691480208637-6ed63aac6694?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

const kidsBakedNoToppings: Topping[] = [
  { id: 'kbt5', name: 'No Mozzarella Cheese on top', price: 0.00, image: 'https://images.unsplash.com/photo-1723473620176-8d26dc6314cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Kids Pasta and Meatball (k6) - uses same pasta types as k1
const kidsPastaMeatballSpecialInstructions: Topping[] = [
  { id: 'kpmsi1', name: 'Extra Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1553798411-c1022f992f28?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpmsi2', name: 'Lite Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1691480208637-6ed63aac6694?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'kpmsi3', name: 'Sauce On The Side', price: 0.00, image: 'https://images.unsplash.com/photo-1610135373399-472c8722106f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

const kidsPastaMeatballToppings: Topping[] = [
  { id: 'kpmt1', name: 'Mushrooms', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400' },
  { id: 'kpmt2', name: 'Spinach', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1zc9sVnQ5fz4h_qpGq_RQnAhiiTYXyqCV&sz=w400' },
  { id: 'kpmt3', name: 'Broccoli', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w400' },
  { id: 'kpmt4', name: 'Grilled Chicken Strips', price: 1.99, image: 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400' },
  { id: 'kpmt5', name: 'Shrimp', price: 4.99, image: 'https://images.unsplash.com/photo-1761095596550-63e8c2356bbc?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Kids Pasta and Meatball (k6) Topping images
const KIDS_PASTA_MEATBALL_TOPPING_IMAGES: { [key: string]: string } = {
  'kpmsi1': 'https://images.unsplash.com/photo-1553798411-c1022f992f28?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // Extra Sauce
  'kpmsi2': 'https://images.unsplash.com/photo-1691480208637-6ed63aac6694?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // Lite Sauce
  'kpmsi3': 'https://images.unsplash.com/photo-1610135373399-472c8722106f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200', // Sauce On The Side
  'kpmt1': 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400', // Mushrooms
  'kpmt2': 'https://drive.google.com/thumbnail?id=1zc9sVnQ5fz4h_qpGq_RQnAhiiTYXyqCV&sz=w400', // Spinach
  'kpmt3': 'https://drive.google.com/thumbnail?id=1gwtm_YlInG0mAOpQfzXqOfNJNTW3Pkv3&sz=w400', // Broccoli
  'kpmt4': 'https://drive.google.com/thumbnail?id=1zU0PP9a8DjN0uhPKyFuyzjdXMVYNfPQw&sz=w400', // Grilled Chicken Strips
  'kpmt5': 'https://drive.google.com/thumbnail?id=14mjBfgjg1U5hT7MS2L1MUTH1DwWO7jFF&sz=w400', // Shrimp
};

const specialtyToppings: Topping[] = [
  {
    id: 's1',
    name: 'White',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 's2',
    name: 'Margherita',
    price: 5.00,
    image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=200',
  },
  {
    id: 's3',
    name: 'Toscana',
    price: 5.50,
    image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=200',
  },
  {
    id: 's4',
    name: 'Hawaiian',
    price: 5.00,
    image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=200',
  },
  {
    id: 's5',
    name: 'Veggie',
    price: 5.00,
    image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=200',
  },
  {
    id: 's6',
    name: 'Works',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1681567604770-0dc826c870ae?w=200',
  },
  {
    id: 's7',
    name: 'Chipotle Chicken',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1712579733874-c3a79f0f9d12?w=200',
  },
  {
    id: 's8',
    name: 'Buffalo Chicken',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1631897788978-da06ec45adcb?w=200',
  },
  {
    id: 's9',
    name: 'BBQ Chicken',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=200',
  },
  {
    id: 's10',
    name: 'Capri',
    price: 5.50,
    image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=200',
  },
  {
    id: 's11',
    name: 'Cheesesteak',
    price: 6.50,
    image: 'https://images.unsplash.com/photo-1677027201352-3c3981cb8b5c?w=200',
  },
  {
    id: 's12',
    name: 'Chicken Broccoli Alfredo',
    price: 6.50,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 's13',
    name: 'Chicken Parm',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1712579733874-c3a79f0f9d12?w=200',
  },
  {
    id: 's14',
    name: 'Baked Ziti',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 's15',
    name: 'Hot Honey Roni',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1759216282444-8996a7ab60ef?w=200',
  },
  {
    id: 's16',
    name: 'Penne Vodka',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 's17',
    name: 'Melanzana',
    price: 5.50,
    image: 'https://images.unsplash.com/photo-1533213520888-6aa83d71cc24?w=200',
  },
  {
    id: 's18',
    name: 'Bacon Chicken Ranch',
    price: 6.50,
    image: 'https://images.unsplash.com/photo-1608475861875-89c94a8dd8f3?w=200',
  },
  {
    id: 's19',
    name: 'Quattro Formaggi',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1574175679306-4c5f33146b6f?w=200',
  },
];

const noToppings: Topping[] = [
  {
    id: 'no1',
    name: 'No Fresh Mozzarella',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'no2',
    name: 'No Extra Basil',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'no3',
    name: 'No Pecorino Cheese',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  { id: 'no4', name: 'No Cherry Tomatoes', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no5', name: 'No Garlic', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no6', name: 'No Basil Ribbons', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no7', name: 'No Oil', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no8', name: 'No Eggplant', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no9', name: 'No Mozzarella Cheese', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no10', name: 'No Scampi Sauce', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no11', name: 'No Feta Cheese', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no12', name: 'No Provolone Cheese', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no13', name: 'No Parsley', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no14', name: 'No Shrimp', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no15', name: 'No Old Bay Spice', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no16', name: 'No Creamy Alfredo', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no17', name: 'No Pesto Basil', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no18', name: 'No Marinara Sauce', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no19', name: 'No Sundried Tomatoes', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no20', name: 'No Roasted Red Peppers', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no21', name: 'No Onions', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no22', name: 'No Black Olives', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no23', name: 'No Oregano', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no24', name: 'No Zucchini', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no25', name: 'No Green Olives', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no26', name: 'No Mushrooms', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
  { id: 'no27', name: 'No Pesto', price: 0.00, image: PLACEHOLDER_TOPPING_IMAGE },
];

const specialInstructionsBrooklyn: Topping[] = [
  {
    id: 'bsi1',
    name: 'Lite Cheese',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'bsi2',
    name: 'Double Cut',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'bsi4',
    name: 'lightly cooked',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
  {
    id: 'bsi5',
    name: 'Extra Sauce',
    price: 0.00,
    image: PLACEHOLDER_TOPPING_IMAGE,
  },
];

const cheesesteakToppings: Topping[] = [
  {
    id: 'cs1',
    name: 'Bacon',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400',
  },
  {
    id: 'cs2',
    name: 'Banana Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400',
  },
  {
    id: 'cs3',
    name: 'Grilled Mushrooms',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400',
  },
  {
    id: 'cs4',
    name: 'Grilled Onions',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400',
  },
  {
    id: 'cs5',
    name: 'Hot Cherry Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400',
  },
  {
    id: 'cs6',
    name: 'Ketchup',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w400',
  },
  {
    id: 'cs7',
    name: 'Mayo',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400',
  },
  {
    id: 'cs8',
    name: 'Mix Sweet Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400',
  },
  {
    id: 'cs9',
    name: 'Pepperoni',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400',
  },
  {
    id: 'cs10',
    name: 'Pickles',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w1000',
  },
  {
    id: 'cs11',
    name: 'Raw Onions',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400',
  },
  {
    id: 'cs12',
    name: 'Roasted Red Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400',
  },
  {
    id: 'cs13',
    name: 'Shredded Lettuce',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400',
  },
  {
    id: 'cs14',
    name: 'Tomatoes',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w1000',
  },
];

// Create Your Own Cheesesteak specific toppings with custom order and names
const createYourOwnCheesesteakToppings: Topping[] = [
  {
    id: 'cs7',
    name: 'Mayo',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400',
  },
  {
    id: 'cs6',
    name: 'Ketchup',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w400',
  },
  {
    id: 'cs1',
    name: 'Grilled Bacon',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400',
  },
  {
    id: 'cs4',
    name: 'Grilled Onions',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400',
  },
  {
    id: 'cs2',
    name: 'Grilled Banana Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400',
  },
  {
    id: 'cs5',
    name: 'Grilled Hot Cherry Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400',
  },
  {
    id: 'cs8',
    name: 'Grilled Mix Sweet Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400',
  },
  {
    id: 'cs3',
    name: 'Grilled Mushrooms',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1ZJblzVjTCHrc8BBpo_WV5EUOZs7LXv2x&sz=w400',
  },
  {
    id: 'cs9',
    name: 'Grilled Pepperoni',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400',
  },
  {
    id: 'cs12',
    name: 'Grilled Red Roasted Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400',
  },
  {
    id: 'cs13',
    name: 'Shredded Lettuce',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400',
  },
  {
    id: 'cs11',
    name: 'Raw Onions',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400',
  },
  {
    id: 'cs14',
    name: 'Tomatoes',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w1000',
  },
  {
    id: 'cs10',
    name: 'Pickles',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w1000',
  },
];

const extraToppings: Topping[] = [
  {
    id: 'ext1',
    name: 'Extra Cheese',
    price: 0.99,
  },
  {
    id: 'ext2',
    name: 'Extra Ketchup',
    price: 0.00,
  },
  {
    id: 'ext3',
    name: 'Extra Mayo',
    price: 0.00,
  },
];

const liteToppings: Topping[] = [
  {
    id: 'lite1',
    name: 'Lite Black Pepper',
    price: 0.00,
  },
  {
    id: 'lite2',
    name: 'Lite Cheese',
    price: 0.00,
  },
  {
    id: 'lite3',
    name: 'Lite Ketchup',
    price: 0.00,
  },
  {
    id: 'lite4',
    name: 'Lite Mayo',
    price: 0.00,
  },
  {
    id: 'lite5',
    name: 'Lite Salt',
    price: 0.00,
  },
];

const cheesesteakNoToppings: Topping[] = [
  {
    id: 'csno1',
    name: 'No Black Pepper',
    price: 0.00,
  },
  {
    id: 'csno2',
    name: 'No Salt',
    price: 0.00,
  },
  {
    id: 'csno3',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'csno4',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'csno5',
    name: 'No Raw Onions',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400',
  },
  {
    id: 'csno6',
    name: 'No Mushrooms',
    price: 0.00,
  },
  {
    id: 'csno7',
    name: 'No Mix Sweet Peppers',
    price: 0.00,
  },
  {
    id: 'csno8',
    name: 'No Grilled Onions',
    price: 0.00,
  },
  {
    id: 'csno9',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'csno10',
    name: 'No Olive Oil',
    price: 0.00,
  },
];

// Burger Toppings
const burgerAddToppings: Topping[] = [
  { id: 'ba1', name: 'Mayo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400' },
  { id: 'ba2', name: 'Add Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1RuwatWXYMRRV_17MFJ2PzCGKEo0zI5dc&sz=w400' },
  { id: 'ba3', name: 'Ketchup', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w400' },
  { id: 'ba4', name: 'Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'ba5', name: 'Tomato', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' },
  { id: 'ba6', name: 'Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'ba7', name: 'Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'ba8', name: 'Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'ba9', name: 'Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'ba10', name: 'Roasted Red Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400' },
  { id: 'ba11', name: 'Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400' },
  { id: 'ba12', name: 'Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'ba13', name: 'Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
  { id: 'ba14', name: 'Pepperoni', price: 1.49, image: 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400' },
  { id: 'ba15', name: 'Bacon', price: 1.49, image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400' },
];

const burgerExtraToppings: Topping[] = [
  { id: 'be1', name: 'Extra Mayo', price: 0.00 },
  { id: 'be2', name: 'Extra Mustard', price: 0.00 },
  { id: 'be3', name: 'Extra Ketchup', price: 0.00 },
  { id: 'be4', name: 'Extra Cheese', price: 0.99 },
];

const burgerLiteToppings: Topping[] = [
  { id: 'bl1', name: 'Lite Cheese', price: 0.00 },
  { id: 'bl2', name: 'Lite Mayo', price: 0.00 },
  { id: 'bl3', name: 'Lite Mustard', price: 0.00 },
  { id: 'bl4', name: 'Lite Ketchup', price: 0.00 },
  { id: 'bl5', name: 'Lite Salt', price: 0.00 },
  { id: 'bl6', name: 'Lite Black Pepper', price: 0.00 },
];

const burgerSideToppings: Topping[] = [
  { id: 'bs1', name: 'Side Mayo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400' },
  { id: 'bs2', name: 'Side Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1RuwatWXYMRRV_17MFJ2PzCGKEo0zI5dc&sz=w400' },
  { id: 'bs3', name: 'Side Ketchup', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w400' },
  { id: 'bs4', name: 'Side Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'bs5', name: 'Side Tomato', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' },
  { id: 'bs6', name: 'Side Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'bs7', name: 'Side Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'bs8', name: 'Side Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'bs9', name: 'Side Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'bs10', name: 'Side Roasted Red Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400' },
  { id: 'bs11', name: 'Side Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400' },
  { id: 'bs12', name: 'Side Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'bs13', name: 'Side Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
  { id: 'bs14', name: 'Side Pepperoni', price: 1.49, image: 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400' },
  { id: 'bs15', name: 'Side Bacon', price: 1.49, image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400' },
];

const burgerSubstituteCheese: Topping[] = [
  { id: 'bsc1', name: 'American', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400' },
  { id: 'bsc2', name: 'Cheddar Cheese Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400' },
  { id: 'bsc3', name: 'Cooper Sharp American', price: 0.00, image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w1000' },
  { id: 'bsc4', name: 'Mozzarella', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400' },
  { id: 'bsc5', name: 'Provolone', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400' },
  { id: 'bsc6', name: 'Swiss', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400' },
  { id: 'bsc7', name: 'No Cheese', price: 0.00 },
];

// Brioche Toppings
const briocheAddCheese: Topping[] = [
  { id: 'brc1', name: 'Provolone', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400' },
  { id: 'brc2', name: 'American', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400' },
  { id: 'brc3', name: 'Swiss', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400' },
  { id: 'brc4', name: 'Mozzarella', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400' },
  { id: 'brc5', name: 'Cooper Sharp American', price: 0.99, image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w1000' },
  { id: 'brc6', name: 'Cheddar Cheese Sauce', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400' },
  { id: 'brc7', name: 'No Cheese', price: 0.00 },
];

const briocheExtraCheese: Topping[] = [
  { id: 'brec1', name: 'Extra Cheese', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400' },
  { id: 'brec2', name: 'Side of Cheddar Sauce', price: 1.99, image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400' },
];

const briocheNoToppings: Topping[] = [
  { id: 'brn1', name: 'No Lettuce', price: 0.00 },
  { id: 'brn4', name: 'No Oregano', price: 0.00 },
];

// Additional "No" options specifically for Brioche Grilled Chicken
const briocheGrilledChickenNoToppings: Topping[] = [
  { id: 'brn2', name: 'No Pickles', price: 0.00 },
  { id: 'brn3', name: 'No Tomatoes', price: 0.00 },
  { id: 'bgc-no2', name: 'No Ranch', price: 0.00 },
];

// "No" options specifically for Brioche Mozzarella Grilled Chicken
const briocheMozzarellaGrilledChickenNoToppings: Topping[] = [
  { id: 'brn7', name: 'No Spinach', price: 0.00 },
  { id: 'brn5', name: 'No Roasted Red Peppers', price: 0.00 },
];

const briocheSideToppings: Topping[] = [
  { id: 'brs1', name: 'Side Mayo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400' },
  { id: 'brs2', name: 'Side Mustard', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1RuwatWXYMRRV_17MFJ2PzCGKEo0zI5dc&sz=w400' },
  { id: 'brs3', name: 'Side Ketchup', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w400' },
  { id: 'brs4', name: 'Side Ranch', price: 0.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
];

const specialtyToppingsSecondHalf: Topping[] = [
  {
    id: 'sh1',
    name: 'White',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 'sh2',
    name: 'Margherita',
    price: 5.00,
    image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=200',
  },
  {
    id: 'sh3',
    name: 'Toscana',
    price: 5.50,
    image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=200',
  },
  {
    id: 'sh4',
    name: 'Hawaiian',
    price: 5.00,
    image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=200',
  },
  {
    id: 'sh5',
    name: 'Veggie',
    price: 5.00,
    image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=200',
  },
  {
    id: 'sh6',
    name: 'Works',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1681567604770-0dc826c870ae?w=200',
  },
  {
    id: 'sh7',
    name: 'Chipotle Chicken',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1712579733874-c3a79f0f9d12?w=200',
  },
  {
    id: 'sh8',
    name: 'Buffalo Chicken',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1631897788978-da06ec45adcb?w=200',
  },
  {
    id: 'sh9',
    name: 'BBQ Chicken',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=200',
  },
  {
    id: 'sh10',
    name: 'Capri',
    price: 5.50,
    image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=200',
  },
  {
    id: 'sh11',
    name: 'Cheesesteak',
    price: 6.50,
    image: 'https://images.unsplash.com/photo-1677027201352-3c3981cb8b5c?w=200',
  },
  {
    id: 'sh12',
    name: 'Chicken Broccoli Alfredo',
    price: 6.50,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 'sh13',
    name: 'Chicken Parm',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1712579733874-c3a79f0f9d12?w=200',
  },
  {
    id: 'sh14',
    name: 'Baked Ziti',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 'sh15',
    name: 'Hot Honey Roni',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1759216282444-8996a7ab60ef?w=200',
  },
  {
    id: 'sh16',
    name: 'Penne Vodka',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1615932736372-f3ce2c21db45?w=200',
  },
  {
    id: 'sh17',
    name: 'Melanzana',
    price: 5.50,
    image: 'https://images.unsplash.com/photo-1533213520888-6aa83d71cc24?w=200',
  },
  {
    id: 'sh18',
    name: 'Bacon Chicken Ranch',
    price: 6.50,
    image: 'https://images.unsplash.com/photo-1608475861875-89c94a8dd8f3?w=200',
  },
  {
    id: 'sh19',
    name: 'Quattro Formaggi',
    price: 6.00,
    image: 'https://images.unsplash.com/photo-1574175679306-4c5f33146b6f?w=200',
  },
];

const cheeseOptions: Topping[] = [
  {
    id: 'cheese1',
    name: 'American',
    price: 0.99,
    image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400',
  },
  {
    id: 'cheese2',
    name: 'Cheddar Cheese Sauce',
    price: 0.99,
    image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400',
  },
  {
    id: 'cheese3',
    name: 'Cooper Sharp American',
    price: 0.99,
    image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w1000',
  },
  {
    id: 'cheese4',
    name: 'Mozzarella',
    price: 0.99,
    image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400',
  },
  {
    id: 'cheese6',
    name: 'Provolone',
    price: 0.99,
    image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400',
  },
  {
    id: 'cheese7',
    name: 'Swiss',
    price: 0.99,
    image: 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400',
  },
  {
    id: 'cheese5',
    name: 'No Cheese',
    price: 0.00,
  },
];

// Hot Hoagies Toppings
const hotHoagieExtraToppings: Topping[] = [
  {
    id: 'hh-extra1',
    name: 'Add Extra Sauce',
    price: 0.00,
  },
  {
    id: 'hh-extra2',
    name: 'Extra Cheese',
    price: 0.99,
  },
];

const hotHoagieSides: Topping[] = [
  {
    id: 'hh-side1',
    name: 'French Fries',
    price: 6.99,
    image: 'https://drive.google.com/thumbnail?id=1xz1mbhHg-7TJeZA0R-bgI8HqO1x8fEmP&sz=w1000',
  },
];

const hotHoagieSpecialInstructions: Topping[] = [
  {
    id: 'hh-si1',
    name: 'No Sauce',
    price: 0.00,
  },
  {
    id: 'hh-si2',
    name: 'Lite Sauce',
    price: 0.00,
  },
  {
    id: 'hh-si3',
    name: 'Lite Cheese',
    price: 0.00,
  },
];

// No Toppings for Grilled Chicken Hoagie
const grilledChickenHoagieNoToppings: Topping[] = [
  {
    id: 'gch-no1',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'gch-no2',
    name: 'No Shredded Lettuce',
    price: 0.00,
  },
  {
    id: 'gch-no3',
    name: 'No Raw Onions',
    price: 0.00,
  },
  {
    id: 'gch-no4',
    name: 'No Salt',
    price: 0.00,
  },
  {
    id: 'gch-no5',
    name: 'No Black Pepper',
    price: 0.00,
  },
  {
    id: 'gch-no6',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'gch-no7',
    name: 'No Olive Oil',
    price: 0.00,
  },
];

// No Toppings for Sausage, Peppers & Onions
const sausagePeppersOnionsNoToppings: Topping[] = [
  {
    id: 'spo-no1',
    name: 'No Salt',
    price: 0.00,
  },
  {
    id: 'spo-no2',
    name: 'No Black Pepper',
    price: 0.00,
  },
  {
    id: 'spo-no3',
    name: 'No Grilled Onions',
    price: 0.00,
  },
  {
    id: 'spo-no4',
    name: 'No Grilled Mix Sweet Peppers',
    price: 0.00,
  },
];

// No Toppings for Cheese Burger Deluxe
const cheeseBurgerDeluxeNoToppings: Topping[] = [
  {
    id: 'cbd-no1',
    name: 'No Salt',
    price: 0.00,
  },
  {
    id: 'cbd-no2',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'cbd-no3',
    name: 'No Raw Onions',
    price: 0.00,
  },
  {
    id: 'cbd-no4',
    name: 'No Shredded Lettuce',
    price: 0.00,
  },
  {
    id: 'cbd-no5',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'cbd-no6',
    name: 'No Black Pepper',
    price: 0.00,
  },
];

const hotHoagieExtraSides: Topping[] = [
  {
    id: 'hh-side-wings',
    name: 'Wings (10)',
    price: 16.99,
    image: 'https://drive.google.com/thumbnail?id=1ujoCteMfDts1Tt-7WRf5dc6DYjbg_yoy&sz=w1000',
  },
  {
    id: 'hh-side-fries',
    name: 'French Fries',
    price: 6.99,
    image: 'https://drive.google.com/thumbnail?id=1xz1mbhHg-7TJeZA0R-bgI8HqO1x8fEmP&sz=w1000?v=2',
  },
  {
    id: 'hh-side-cheese-ff',
    name: 'Cheese FF',
    price: 8.49,
    image: 'https://drive.google.com/thumbnail?id=1SMkT74Ru2ZtYe62tK3slyVlx1GbLqhq2&sz=w1000',
  },
  {
    id: 'hh-side-passariello-fries',
    name: 'Passariello Fries',
    price: 11.49,
    image: 'https://drive.google.com/thumbnail?id=1yEvT2uA7-8vynMXmCDhF55hi-4msjdzp&sz=w1000',
  },
  {
    id: 'hh-side-mozzarella-sticks',
    name: 'Mozzarella Sticks',
    price: 9.49,
    image: 'https://drive.google.com/thumbnail?id=1YysXjcJI-WRuuMOiCKasAEMYkyP-eEPS&sz=w1000',
  },
  {
    id: 'hh-side-onion-rings',
    name: 'Onion Rings',
    price: 7.99,
    image: 'https://drive.google.com/thumbnail?id=1YmMbZudkfZVNhXnkb9Yor9PMACEErYH9&sz=w1000',
  },
  {
    id: 'hh-side-broccoli-bites',
    name: 'Broccoli Cheddar Bites',
    price: 9.99,
    image: 'https://drive.google.com/thumbnail?id=1YQwDMyCE_VQZUMvTAb9OGhVbQElts9y1&sz=w1000',
  },
  {
    id: 'hh-side-mac-cheese-bites',
    name: 'Mac & Cheese Bites',
    price: 12.49,
    image: 'https://drive.google.com/thumbnail?id=1fBJdkpy8gqwTmdvrQoPevQ7Ypsrbb2CX&sz=w1000',
  },
];

const hotHoagieSubstituteCheese: Topping[] = [
  {
    id: 'hh-cheese6',
    name: 'American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400',
  },
  {
    id: 'hh-cheese4',
    name: 'Cheddar Cheese Sauce',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400',
  },
  {
    id: 'hh-cheese5',
    name: 'Cooper Sharp American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400',
  },
  {
    id: 'hh-cheese2',
    name: 'Mozzarella',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400',
  },
  {
    id: 'hh-cheese1',
    name: 'Provolone',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400',
  },
  {
    id: 'hh-cheese3',
    name: 'Swiss',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w400',
  },
  {
    id: 'hh-cheese7',
    name: 'No Cheese',
    price: 0.00,
  },
];

// Cold Hoagies Toppings
const coldHoagieAddCheese: Topping[] = [
  {
    id: 'ch-cheese1',
    name: 'American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400',
  },
  {
    id: 'ch-cheese2',
    name: 'Cooper Sharp American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w1000',
  },
  {
    id: 'ch-cheese3',
    name: 'Mozzarella',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400',
  },
  {
    id: 'ch-cheese4',
    name: 'Provolone',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400',
  },
  {
    id: 'ch-cheese5',
    name: 'Swiss',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400',
  },
  {
    id: 'ch-cheese7',
    name: 'No Cheese',
    price: 0.00,
  },
];

const coldHoagieSideToppingsRequired: Topping[] = [
  {
    id: 'ch-side-req2',
    name: 'Lettuce',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400',
  },
  {
    id: 'ch-side-req1',
    name: 'Tomatoes',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400',
  },
  {
    id: 'ch-side-req3',
    name: 'Raw Onions',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400',
  },
];

const cheesesteakSideToppingsRequired: Topping[] = [
  {
    id: 'cs-side-req2',
    name: 'Lettuce',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400',
  },
  {
    id: 'cs-side-req1',
    name: 'Tomatoes',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400',
  },
  {
    id: 'cs-side-req3',
    name: 'Raw Onions',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400',
  },
];

// Pasta e Fagioli Substitute Options
const pastaFagioliSubstituteOptions: Topping[] = [
  {
    id: 'pfs1',
    name: 'Homemade Bread',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1IvFgnN1WG37YCyBNpDof1Exz5hcPJpeh&sz=w400',
  },
  {
    id: 'pfs2',
    name: 'Crackers',
    price: 0.00,
    image: 'https://images.unsplash.com/photo-1666014313959-348bf6f7b0a4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=400',
  },
  {
    id: 'pfs3',
    name: 'None',
    price: 0.00,
    showCircle: true,
  },
];

const coldHoagieAddToppings: Topping[] = [
  {
    id: 'ch-add1',
    name: 'Mayo',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400',
  },
  {
    id: 'ch-add2',
    name: 'Add Mustard',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w400',
  },
  {
    id: 'ch-add3',
    name: 'Hot Cherry Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400',
  },
  {
    id: 'ch-add4',
    name: 'Mix Sweet Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400',
  },
  {
    id: 'ch-add5',
    name: 'Roasted Red Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400',
  },
  {
    id: 'ch-add6',
    name: 'Pickles',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w1000',
  },
  {
    id: 'ch-add7',
    name: 'Banana Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400',
  },
  {
    id: 'ch-add8',
    name: 'Pepperoni',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w400',
  },
  {
    id: 'ch-add9',
    name: 'Bacon',
    price: 1.49,
    image: 'https://drive.google.com/thumbnail?id=19q_8iv7dK5PVRy1lbDXn50wHmYbGL1jO&sz=w400',
  },
  {
    id: 'ch-add-oil',
    name: 'Oil',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1AjIIFqxtZCJonUNFIFNP1hfUhZYkEI_S&sz=w1000',
  },
  {
    id: 'ch-add-vinegar',
    name: 'Vinegar',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1Bof4Gqrl0PeXgPxGpXbyCU2ZmZrF5dqj&sz=w1000',
  },
];

const coldHoagieExtraToppings: Topping[] = [
  {
    id: 'ch-extra1',
    name: 'Extra Mayo',
    price: 0.00,
  },
  {
    id: 'ch-extra2',
    name: 'Extra Mustard',
    price: 0.00,
  },
  {
    id: 'ch-extra3',
    name: 'Extra Cheese',
    price: 0.99,
  },
];

const coldHoagieLiteToppings: Topping[] = [
  {
    id: 'ch-lite1',
    name: 'Lite Cheese',
    price: 0.00,
  },
  {
    id: 'ch-lite2',
    name: 'Lite Lettuce',
    price: 0.00,
  },
  {
    id: 'ch-lite3',
    name: 'Lite Tomatoes',
    price: 0.00,
  },
  {
    id: 'ch-lite4',
    name: 'Lite Raw Onions',
    price: 0.00,
  },
  {
    id: 'ch-lite5',
    name: 'Lite Mayo',
    price: 0.00,
  },
  {
    id: 'ch-lite6',
    name: 'Lite Mustard',
    price: 0.00,
  },
  {
    id: 'ch-lite7',
    name: 'Lite Oil',
    price: 0.00,
  },
  {
    id: 'ch-lite8',
    name: 'Lite Salt',
    price: 0.00,
  },
  {
    id: 'ch-lite9',
    name: 'Lite Oregano',
    price: 0.00,
  },
  {
    id: 'ch-lite10',
    name: 'Lite Vinegar',
    price: 0.00,
  },
];

const coldHoagieNoToppings: Topping[] = [
  {
    id: 'ch-no1',
    name: 'No Cheese',
    price: 0.00,
  },
  {
    id: 'ch-no2',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'ch-no3',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'ch-no4',
    name: 'No Raw Onions',
    price: 0.00,
  },
  {
    id: 'ch-no5',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'ch-no6',
    name: 'No Oil',
    price: 0.00,
  },
  {
    id: 'ch-no7',
    name: 'No Vinegar',
    price: 0.00,
  },
  {
    id: 'ch-no8',
    name: 'No Salt',
    price: 0.00,
  },
];

const coldHoagieSideOfChips: Topping[] = [
  {
    id: 'ch-chips',
    name: 'Extra Chips',
    price: 1.00,
  },
];

const coldHoagieSideToppings: Topping[] = [
  {
    id: 'ch-side1',
    name: 'Side Mayo',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w400',
  },
  {
    id: 'ch-side2',
    name: 'Side Mustard',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w400',
  },
  {
    id: 'ch-side3',
    name: 'Side Hot Cherry Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400',
  },
  {
    id: 'ch-side4',
    name: 'Side Pickles',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w1000',
  },
  {
    id: 'ch-side5',
    name: 'Side Mix Sweet Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400',
  },
  {
    id: 'ch-side6',
    name: 'Side Roasted Red Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400',
  },
  {
    id: 'ch-side7',
    name: 'Side Banana Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400',
  },
];

// Panini Toppings
const paniniChooseType: Topping[] = [
  {
    id: 'pn-type1',
    name: 'White',
    price: 0.00,
  },
  {
    id: 'pn-type2',
    name: 'Whole Wheat',
    price: 0.00,
  },
];

const paniniExtraCheese: Topping[] = [
  {
    id: 'pn-extra1',
    name: 'Extra Cheese',
    price: 0.99,
  },
];

const paniniLiteToppings: Topping[] = [
  {
    id: 'pn-lite1',
    name: 'Lite Cheese',
    price: 0.00,
  },
  {
    id: 'pn-lite2',
    name: 'Lite Lettuce',
    price: 0.00,
  },
  {
    id: 'pn-lite3',
    name: 'Lite Tomatoes',
    price: 0.00,
  },
  {
    id: 'pn-lite4',
    name: 'Lite Mayo',
    price: 0.00,
  },
  {
    id: 'pn-lite5',
    name: 'Lite Oregano',
    price: 0.00,
  },
  {
    id: 'pn-lite6',
    name: 'Lite Eggplant',
    price: 0.00,
  },
  {
    id: 'pn-lite7',
    name: 'Lite Zucchini',
    price: 0.00,
  },
  {
    id: 'pn-lite8',
    name: 'Lite Roasted Red Peppers',
    price: 0.00,
  },
  {
    id: 'pn-lite9',
    name: 'Lite Pesto Spread',
    price: 0.00,
  },
];

const paniniNoToppings: Topping[] = [
  {
    id: 'pn-no2',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'pn-no3',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'pn-no4',
    name: 'No Mayo',
    price: 0.00,
  },
  {
    id: 'pn-no5',
    name: 'No Potato Chips',
    price: 0.00,
  },
  {
    id: 'pn-no6',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'pn-no7',
    name: 'No Eggplant',
    price: 0.00,
  },
  {
    id: 'pn-no8',
    name: 'No Zucchini',
    price: 0.00,
  },
  {
    id: 'pn-no9',
    name: 'No Roasted Red Peppers',
    price: 0.00,
  },
  {
    id: 'pn-no10',
    name: 'No Pesto Spread',
    price: 0.00,
  },
];

const paniniSideToppings: Topping[] = [
  {
    id: 'pn-side1',
    name: 'Side Hot Cherry Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400',
  },
  {
    id: 'pn-side2',
    name: 'Side Pickles',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w1000',
  },
  {
    id: 'pn-side3',
    name: 'Side Mix Sweet Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400',
  },
  {
    id: 'pn-side4',
    name: 'Side Banana Peppers',
    price: 0.55,
    image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400',
  },
];

const paniniSubstituteCheese: Topping[] = [
  {
    id: 'pn-cheese1',
    name: 'American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400',
  },
  {
    id: 'pn-cheese2',
    name: 'Mozzarella',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400',
  },
  {
    id: 'pn-cheese3',
    name: 'Swiss',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400',
  },
  {
    id: 'pn-cheese4',
    name: 'Cooper Sharp American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w1000',
  },
  {
    id: 'pn-cheese5',
    name: 'Cheddar Cheese Sauce',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400',
  },
  {
    id: 'pn-cheese6',
    name: 'Provolone',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400',
  },
  {
    id: 'pn-cheese7',
    name: 'No Cheese',
    price: 0.00,
  },
];

// Wraps Options
const wrapTypeOptions: Topping[] = [
  {
    id: 'wrap-type1',
    name: 'Plain Wrap',
    price: 0.00,
  },
  {
    id: 'wrap-type2',
    name: 'Whole Wheat Wrap',
    price: 0.00,
  },
];

const wrapSubstituteCheese: Topping[] = [
  {
    id: 'wrap-cheese1',
    name: 'Cooper Sharp American',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w1000',
  },
  {
    id: 'wrap-cheese2',
    name: 'Mozzarella',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1EFXn4yCnIFq4RICCca9xiZduIJBDTZtx&sz=w400',
  },
  {
    id: 'wrap-cheese3',
    name: 'Provolone',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400',
  },
  {
    id: 'wrap-cheese4',
    name: 'Swiss',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1DqxGO7AXXSDOCVwpREo1n0M2aZ7HClW9&sz=w400',
  },
  {
    id: 'wrap-cheese5',
    name: 'Cheddar Sauce',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400',
  },
  {
    id: 'wrap-cheese6',
    name: 'American Cheese',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400',
  },
  {
    id: 'wrap-cheese7',
    name: 'No Cheese',
    price: 0.00,
  },
];

// Shredded Parmesan Cheese for Chicken Caesar Wrap only
const chickenCaesarWrapCheese: Topping[] = [
  {
    id: 'wrap-cheese8',
    name: 'Shredded Parmesan Cheese',
    price: 0.00,
    image: 'https://drive.google.com/thumbnail?id=1U8TjmY60nUhv2qUVFL4529RkvEY_FrqZ&sz=w400',
  },
];

const wrapAddToppings: Topping[] = [
  { id: 'wrap-add1', name: 'Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'wrap-add2', name: 'Tomatoes', price: 0.55, image: 'https://images.unsplash.com/photo-1615486171815-2611a6e3cd02?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzbGljZWQlMjB0b21hdG98ZW58MXx8fHwxNzYzMTUzNDE3fDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
  { id: 'wrap-add3', name: 'Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'wrap-add4', name: 'Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'wrap-add5', name: 'Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'wrap-add6', name: 'Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'wrap-add7', name: 'Roasted Red Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400' },
  { id: 'wrap-add8', name: 'Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400' },
  { id: 'wrap-add9', name: 'Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'wrap-add10', name: 'Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
];

const wrapExtraCheese: Topping[] = [
  {
    id: 'wrap-extra1',
    name: 'Extra Cheese',
    price: 0.99,
  },
];

const wrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite1',
    name: 'Lite Cheese',
    price: 0.00,
  },
  {
    id: 'wrap-lite2',
    name: 'Lite Salt',
    price: 0.00,
  },
  {
    id: 'wrap-lite3',
    name: 'Lite Black Pepper',
    price: 0.00,
  },
];

const wrapNoToppings: Topping[] = [
  {
    id: 'wrap-no2',
    name: 'No Potato Chips',
    price: 0.00,
  },
  {
    id: 'wrap-no3',
    name: 'No Salt',
    price: 0.00,
  },
  {
    id: 'wrap-no4',
    name: 'No Black Pepper',
    price: 0.00,
  },
];

// Additional Lite Toppings for Cheesesteak Wrap only
const cheesesteakWrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite4',
    name: 'Lite Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-lite5',
    name: 'Lite Tomatoes',
    price: 0.00,
  },
  {
    id: 'wrap-lite6',
    name: 'Lite Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-lite7',
    name: 'Lite Raw Onions',
    price: 0.00,
  },
];

// Additional No Toppings for Cheesesteak Wrap only
const cheesesteakWrapNoToppings: Topping[] = [
  {
    id: 'wrap-no5',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-no6',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'wrap-no7',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-no8',
    name: 'No Raw Onions',
    price: 0.00,
  },
];

// Additional Lite Toppings for Grilled Chicken Wrap only
const grilledChickenWrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite8',
    name: 'Lite Spinach',
    price: 0.00,
  },
  {
    id: 'wrap-lite9',
    name: 'Lite Roasted Red Peppers',
    price: 0.00,
  },
];

// Additional No Toppings for Grilled Chicken Wrap only
const grilledChickenWrapNoToppings: Topping[] = [
  {
    id: 'wrap-no9',
    name: 'No Spinach',
    price: 0.00,
  },
  {
    id: 'wrap-no10',
    name: 'No Roasted Red Peppers',
    price: 0.00,
  },
];

// Additional Lite Toppings for Italian Wrap only
const italianWrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite-ham',
    name: 'Lite Ham',
    price: 0.00,
  },
  {
    id: 'wrap-lite-capicola',
    name: 'Lite Capicola',
    price: 0.00,
  },
  {
    id: 'wrap-lite-salami',
    name: 'Lite Salami',
    price: 0.00,
  },
  {
    id: 'wrap-lite10',
    name: 'Lite Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-lite11',
    name: 'Lite Tomatoes',
    price: 0.00,
  },
  {
    id: 'wrap-lite12',
    name: 'Lite Raw Onions',
    price: 0.00,
  },
  {
    id: 'wrap-lite13',
    name: 'Lite Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-lite14',
    name: 'Lite Oil',
    price: 0.00,
  },
  {
    id: 'wrap-lite15',
    name: 'Lite Vinegar',
    price: 0.00,
  },
];

// Additional No Toppings for Italian Wrap only
const italianWrapNoToppings: Topping[] = [
  {
    id: 'wrap-no-ham',
    name: 'No Ham',
    price: 0.00,
  },
  {
    id: 'wrap-no-capicola',
    name: 'No Capicola',
    price: 0.00,
  },
  {
    id: 'wrap-no-salami',
    name: 'No Salami',
    price: 0.00,
  },
  {
    id: 'wrap-no11',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-no12',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'wrap-no13',
    name: 'No Raw Onions',
    price: 0.00,
  },
  {
    id: 'wrap-no14',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-no15',
    name: 'No Oil',
    price: 0.00,
  },
  {
    id: 'wrap-no16',
    name: 'No Vinegar',
    price: 0.00,
  },
];

// Additional Lite Toppings for Tuna Wrap only
const tunaWrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite16',
    name: 'Lite Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-lite17',
    name: 'Lite Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-lite18',
    name: 'Lite Tomatoes',
    price: 0.00,
  },
];

// Additional No Toppings for Tuna Wrap only
const tunaWrapNoToppings: Topping[] = [
  {
    id: 'wrap-no17',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-no18',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-no19',
    name: 'No Tomatoes',
    price: 0.00,
  },
];

// Additional Lite Toppings for Turkey Wrap only
const turkeyWrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite19',
    name: 'Lite Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-lite20',
    name: 'Lite Tomatoes',
    price: 0.00,
  },
  {
    id: 'wrap-lite21',
    name: 'Lite Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-lite22',
    name: 'Lite Raw Onions',
    price: 0.00,
  },
];

// Additional No Toppings for Turkey Wrap only
const turkeyWrapNoToppings: Topping[] = [
  {
    id: 'wrap-no20',
    name: 'No Lettuce',
    price: 0.00,
  },
  {
    id: 'wrap-no21',
    name: 'No Tomatoes',
    price: 0.00,
  },
  {
    id: 'wrap-no22',
    name: 'No Oregano',
    price: 0.00,
  },
  {
    id: 'wrap-no23',
    name: 'No Raw Onions',
    price: 0.00,
  },
];

// Additional Lite Toppings for Veggie Wrap only
const veggieWrapLiteToppings: Topping[] = [
  {
    id: 'wrap-lite23',
    name: 'Lite Grilled Eggplant',
    price: 0.00,
  },
  {
    id: 'wrap-lite24',
    name: 'Lite Grilled Zucchini',
    price: 0.00,
  },
  {
    id: 'wrap-lite25',
    name: 'Lite Roasted Red Peppers',
    price: 0.00,
  },
];

// Additional No Toppings for Veggie Wrap only
const veggieWrapNoToppings: Topping[] = [
  {
    id: 'wrap-no24',
    name: 'No Grilled Eggplant',
    price: 0.00,
  },
  {
    id: 'wrap-no25',
    name: 'No Grilled Zucchini',
    price: 0.00,
  },
  {
    id: 'wrap-no26',
    name: 'No Roasted Red Peppers',
    price: 0.00,
  },
];

const wrapSideToppings: Topping[] = [
  { id: 'wrap-side1', name: 'Side Shredded Lettuce', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w400' },
  { id: 'wrap-side2', name: 'Side Tomatoes', price: 0.55, image: 'https://images.unsplash.com/photo-1615486171815-2611a6e3cd02?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzbGljZWQlMjB0b21hdG98ZW58MXx8fHwxNzYzMTUzNDE3fDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
  { id: 'wrap-side3', name: 'Side Raw Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w400' },
  { id: 'wrap-side4', name: 'Side Grilled Onions', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w400' },
  { id: 'wrap-side5', name: 'Side Hot Cherry Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w400' },
  { id: 'wrap-side6', name: 'Side Grilled Mushrooms', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1e5p7Mpa83h-EonD4mue7gIBErHH01jGo&sz=w400' },
  { id: 'wrap-side7', name: 'Side Pickles', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w400' },
  { id: 'wrap-side8', name: 'Side Mix Sweet Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w400' },
  { id: 'wrap-side9', name: 'Side Roasted Red Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w400' },
  { id: 'wrap-side10', name: 'Side Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
];

// Traditional Dinners Toppings
const traditionalDinnersSides: Topping[] = [
  { id: 'td-side1', name: 'Baked Ziti', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1JvFSnnImV1DJHodwU77OH3xN6zr7ekB8&sz=w400' },
  { id: 'td-side2', name: 'Broccoli', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1K4Gzs-HYBa2bFz2MH75DyyxB5xm6Jf_A&sz=w400' },
  { id: 'td-side3', name: 'Capellini & Pomodoro Sauce', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1Fcq7TSl7D9-r_t-8zXrY-5YF37uL8Pn4&sz=w400' },
  { id: 'td-side4', name: 'Cauliflower Medley', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1YFMgKJs_daVrsP7FgvPIEP53TrEF11Y0&sz=w400' },
  { id: 'td-side6', name: 'Fettuccine', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1ZagYj8uRHWq6jyyU8sR46VqfQ69AH9TH&sz=w400' },
  { id: 'td-side7', name: 'Garden Rice', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1gYbFAsbcBCGsW4jXrTWvIf5Zc8y2JNeP&sz=w400' },
  { id: 'td-side8', name: 'Gnocchi', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1GihoRLyGIS0u2-WlFNBcX8PxtrkOG05g&sz=w400' },
  { id: 'td-side9', name: 'Linguine', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1iX-Ufur3xVFi3TBC33TxDnC8xnh-WQEK&sz=w400' },
  { id: 'td-side10', name: 'Mashed Potatoes', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1yVPvnVHqFjW2ni7YGl9RHpx6fRg--NcK&sz=w400' },
  { id: 'td-side11', name: 'Pasta Of The Day', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l4luVReHbR9r-fyAAEtbs10S06SyKpQT&sz=w400' },
  { id: 'td-side12', name: 'Penne', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1l4luVReHbR9r-fyAAEtbs10S06SyKpQT&sz=w400' },
  { id: 'td-side13', name: 'Roasted Marinara Potatoes', price: 0.00, image: 'https://drive.google.com/thumbnail?id=17MwPTMNGDiXEof86opqisehooBQf6Rvr&sz=w400' },
  { id: 'td-side14', name: 'Spaghetti', price: 1.00, image: 'https://drive.google.com/thumbnail?id=1dRIShq1iW1aVLKyBFremdlNa90Q_xFdY&sz=w400' },
  { id: 'td-side15', name: 'String Beans & Carrots', price: 0.00, image: 'https://drive.google.com/thumbnail?id=11ZH1BrZH9qdfh6yCUVnsIBDQbDWHZZMW&sz=w400' },
  { id: 'td-side5', name: 'Double Order', price: 0.00 },
];

const traditionalDinnersSoupsSalads: Topping[] = [
  { id: 'td-extra1', name: 'Extra Bread', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1IvFgnN1WG37YCyBNpDof1Exz5hcPJpeh&sz=w400' },
  { 
    id: 'td-extra2', 
    name: 'Side Garden Salad', 
    price: 7.99, 
    image: 'https://drive.google.com/thumbnail?id=1Q9mQoORhLlbG_bP7CeiOwktAkYr7hf6u&sz=w400',
    removableIngredients: [
      { id: 'sgs-tomatoes', name: 'Tomatoes' },
      { id: 'sgs-red-onions', name: 'Red Onions' },
      { id: 'sgs-carrots', name: 'Shredded Carrots' },
      { id: 'sgs-cucumbers', name: 'Cucumbers' },
      { id: 'sgs-green-peppers', name: 'Green Peppers' },
      { id: 'sgs-black-olives', name: 'Black Olives' },
    ]
  },
  { 
    id: 'td-extra3', 
    name: 'Side Caesar Salad', 
    price: 7.99, 
    image: 'https://drive.google.com/thumbnail?id=1J942Yn7FpSnBXzruFOr06uuk7m1Gyk0a&sz=w1000',
    removableIngredients: [
      { id: 'scs-parmesan', name: 'Shredded Parmesan Cheese' },
      { id: 'scs-croutons', name: 'Croutons' },
    ]
  },
  { id: 'td-extra4', name: '16oz Pasta Fagoli', price: 8.49, image: 'https://drive.google.com/thumbnail?id=15wBRDs037tG4neSd-IX-mdetvcIJ4w4M&sz=w400' },
  { id: 'td-extra5', name: '16oz Soup of the Day', price: 8.49, image: 'https://drive.google.com/thumbnail?id=1sG9VxC4eVV6sBHkEdzw1XhHvQou26X9J&sz=w400' },
];

const dessertItems: Product[] = [
  {
    id: 'd1',
    name: 'Chocolate Molten Lava Cake',
    description: 'Warm chocolate cake with molten center',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1M-6K4D_oD3g5Eq4PkR0E2aJEN_mSNRMA&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd2',
    name: 'Cookie Lava',
    description: 'Gooey chocolate chip cookie with molten center',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1oqXRQ5rDP2fivh3aQ_cfqpUTSaTieTXx&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd3',
    name: 'Dark Side of the Moon',
    description: 'Rich dark chocolate cake',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1cmpMOyZSS2XtPCNCzEPqXLikpWvTSNL3&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd4',
    name: 'Tiramisu',
    description: 'Classic Italian coffee-flavored dessert',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1XbNi8dJGuogG7qOG0Nm3xL6STeHpoNib&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd5',
    name: 'New York Cheesecake',
    description: 'Rich and creamy classic cheesecake',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1KWdGeUtxNNx9PM02MGy8wBEZQYRjZZlL&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd6',
    name: "Reese's Peanut Butter Pie",
    description: 'Creamy peanut butter pie with chocolate',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1sKk80VLKPOX8wOZ2EGGKpw8539xemTug&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd7',
    name: 'Carrot Cake',
    description: 'Moist carrot cake with cream cheese frosting',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1N06OqTGyNLg5yMGJ04Kn5dPEIRZDEZdg&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd8',
    name: 'Peanut Butter Bomb',
    description: 'Ultimate peanut butter dessert experience',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1McuANMiSmm18pgKKVokhlds5guzn3gV6&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd9',
    name: 'Limoncello Mascarpone',
    description: 'Light lemon mascarpone dessert',
    price: '$7.99',
    priceRange: '$7.99',
    image: 'https://drive.google.com/thumbnail?id=1v_NcMuPkcnrTXyBJX2_hZI5Jqm6NJBUN&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd10',
    name: 'Chocolate Overload Cake',
    description: 'Decadent chocolate layer cake',
    price: '$8.99',
    priceRange: '$8.99',
    image: 'https://drive.google.com/thumbnail?id=1-osIjijJl0auXYkiypXd4vOnz_XbUja5&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd11',
    name: 'Chocolate Pudding Brownie Cup',
    description: 'Brownie with chocolate pudding',
    price: '$6.49',
    priceRange: '$6.49',
    image: 'https://drive.google.com/thumbnail?id=1CmxoI_yZNkbQlwFnj1ugZadKIiooSSPy&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd12',
    name: 'Chocolate Shell Cannoli',
    description: 'Chocolate shell filled with sweet ricotta',
    price: '$5.49',
    priceRange: '$5.49',
    image: 'https://drive.google.com/thumbnail?id=1jNO4jodVWqx0sFIKK_OSSmWCaCbYVhmV&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd13',
    name: 'Plain Shell Cannoli',
    description: 'Traditional cannoli with sweet ricotta filling',
    price: '$4.99',
    priceRange: '$4.99',
    image: 'https://drive.google.com/thumbnail?id=1q1W4fx3rdo48cZ66b-sZlV20kXXZMHkM&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd14',
    name: 'Triple Chocolate Chip Cookie',
    description: 'Decadent cookie with triple chocolate',
    price: '$3.79',
    priceRange: '$3.79',
    image: 'https://drive.google.com/thumbnail?id=1KXgNjjUtdVMJxI58bevEkDfXH_a5sGDi&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd15',
    name: 'M&M Cookie',
    description: 'Soft cookie loaded with M&M candies',
    price: '$3.79',
    priceRange: '$3.79',
    image: 'https://drive.google.com/thumbnail?id=1sMJwxgMlZM2yLfS86SDw3QRHeFjy5Xex&sz=w1000',
    category: 'desserts',
  },
  {
    id: 'd16',
    name: 'Oatmeal Cookie',
    description: 'Classic oatmeal cookie with a soft texture',
    price: '$3.79',
    priceRange: '$3.79',
    image: 'https://drive.google.com/thumbnail?id=152EJJEqMd2bvXmfeTNdl906A1P_hWcZ1&sz=w1000',
    category: 'desserts',
  },
];

// Whole Cakes Items for Catering
const wholeCakesItems = [
  { id: 'ccake1', name: 'Chocolate Overload Cake', price: 69.99, image: 'https://drive.google.com/thumbnail?id=14926Br5zmumNvhnp9NZ_Aywjzc2BQYUd&sz=w1000' },
  { id: 'ccake2', name: 'Limoncello Mascarpone Tray', price: 59.99, image: 'https://drive.google.com/thumbnail?id=1qNMMfx4PMrvPEF-_NW4htO2SsiveojDt&sz=w1000' },
  { id: 'ccake3', name: 'Reese\'s Peanut Butter Pie Cake', price: 89.99, image: 'https://drive.google.com/thumbnail?id=1gOx3qiNpz2dvC9BlqwD5UE-i2RkVovH_&sz=w1000' },
  { id: 'ccake4', name: 'Tiramisu Tray', price: 59.99, image: 'https://drive.google.com/thumbnail?id=1MB2F8oWRsdJfgmtx3hVKuJP-1ijJd-P8&sz=w1000' }
];

// Party Cakes Items for Catering
const partyCakesItems = [
  { id: 'cptray1a', name: 'Handfilled Cannoli Plain Tray (10PCS)', price: 44.99, image: 'https://drive.google.com/thumbnail?id=1lPT2kqfPWyENq24WtfrMKx40xjlGVnwA&sz=w400' },
  { id: 'cptray2a', name: 'Handfilled Chocolate Shell Cannoli Tray (10PCS)', price: 49.99, image: 'https://drive.google.com/thumbnail?id=1CHX8P3uHdFNPREyh9XF-ELAHY65TRyE_&sz=w400' },
  { id: 'cptray3a', name: 'Mini Cannoli Tray (20PCS)', price: 29.99, image: 'https://drive.google.com/thumbnail?id=1Yo976kdvIWNuza0V7O3rMOqgrTF2DLNN&sz=w400' },
  { id: 'cptray4a', name: 'Triple Chocolate Chip Cookie Tray (10PCS)', price: 29.99, image: 'https://drive.google.com/thumbnail?id=17-yUFYxpvnARx4zfHMkyjxPZ-4G5FZE3&sz=w400' },
  { id: 'cptray5a', name: 'Brownie & Cookie Tray (10PCS)', price: 29.99, image: 'https://drive.google.com/thumbnail?id=1E04hZIDhViZgXKF0PvSSja6Mq3YsyMRT&sz=w400' },
  { id: 'cptray6a', name: 'Brownie Tray (10PCS)', price: 29.99, image: 'https://drive.google.com/thumbnail?id=1Lp9zx7u-P4dWdVwqv7TRiRmhnsEC-m8S&sz=w400' },
  { id: 'cptray1b', name: 'Handfilled Cannoli Plain Tray (20PCS)', price: 89.99, image: 'https://drive.google.com/thumbnail?id=1lPT2kqfPWyENq24WtfrMKx40xjlGVnwA&sz=w400' },
  { id: 'cptray2b', name: 'Handfilled Chocolate Shell Cannoli Tray (20PCS)', price: 99.99, image: 'https://drive.google.com/thumbnail?id=1CHX8P3uHdFNPREyh9XF-ELAHY65TRyE_&sz=w400' },
  { id: 'cptray3b', name: 'Mini Cannoli Tray (40PCS)', price: 59.99, image: 'https://drive.google.com/thumbnail?id=1Yo976kdvIWNuza0V7O3rMOqgrTF2DLNN&sz=w400' },
  { id: 'cptray4b', name: 'Triple Chocolate Chip Cookie Tray (20PCS)', price: 59.99, image: 'https://drive.google.com/thumbnail?id=17-yUFYxpvnARx4zfHMkyjxPZ-4G5FZE3&sz=w400' },
  { id: 'cptray5b', name: 'Brownie & Cookie Tray (20PCS)', price: 59.99, image: 'https://drive.google.com/thumbnail?id=1E04hZIDhViZgXKF0PvSSja6Mq3YsyMRT&sz=w400' },
  { id: 'cptray6b', name: 'Brownie Tray (20PCS)', price: 59.99, image: 'https://drive.google.com/thumbnail?id=1Lp9zx7u-P4dWdVwqv7TRiRmhnsEC-m8S&sz=w400' }
];

const sideToppingItems = [
  { id: 'st6', name: 'Side Mayo', price: 0.00 },
  { id: 'st5', name: 'Side Ketchup', price: 0.00 },
  { id: 'st3', name: 'Side Grilled Onions', price: 0.55 },
  { id: 'st1', name: 'Side Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
  { id: 'st4', name: 'Side Hot Cherry Peppers', price: 0.55 },
  { id: 'st7', name: 'Side Mix Sweet Peppers', price: 0.55 },
  { id: 'st2', name: 'Side Grilled Mushrooms', price: 0.55 },
  { id: 'st13', name: 'Side Grilled Pepperoni', price: 0.55, image: 'https://images.unsplash.com/photo-1558185348-2f967858bd7f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxncmlsbGVkJTIwcGVwcGVyb25pfGVufDF8fHx8MTc2NDg3NDk5NXww&ixlib=rb-4.1.0&q=80&w=1080' },
  { id: 'st10', name: 'Side Roasted Red Peppers', price: 0.55 },
  { id: 'st11', name: 'Side Shredded Lettuce', price: 0.55 },
  { id: 'st9', name: 'Side Raw Onions', price: 0.55 },
  { id: 'st12', name: 'Side Tomatoes', price: 0.55 },
  { id: 'st8', name: 'Side Pickles', price: 0.55 },
];

// Extra Sides for cheesesteaks
const extraSidesItems = [
  { id: 'es1', name: 'Add Wings (10)', price: 16.99, image: 'https://drive.google.com/thumbnail?id=1ujoCteMfDts1Tt-7WRf5dc6DYjbg_yoy&sz=w1000' },
  { id: 'es2', name: 'Add French Fries', price: 6.99, image: 'https://drive.google.com/thumbnail?id=1xz1mbhHg-7TJeZA0R-bgI8HqO1x8fEmP&sz=w1000?v=2' },
  { id: 'es3', name: 'Add Cheese FF', price: 8.49, image: 'https://drive.google.com/thumbnail?id=1SMkT74Ru2ZtYe62tK3slyVlx1GbLqhq2&sz=w1000' },
  { id: 'es4', name: 'Add Passariello Fries', price: 11.49, image: 'https://drive.google.com/thumbnail?id=1yEvT2uA7-8vynMXmCDhF55hi-4msjdzp&sz=w1000' },
  { id: 'es5', name: 'Add Mozzarella Sticks', price: 9.49, image: 'https://drive.google.com/thumbnail?id=1YysXjcJI-WRuuMOiCKasAEMYkyP-eEPS&sz=w1000' },
  { id: 'es6', name: 'Add Onion Rings', price: 7.99, image: 'https://drive.google.com/thumbnail?id=1YmMbZudkfZVNhXnkb9Yor9PMACEErYH9&sz=w1000' },
  { id: 'es7', name: 'Add Broccoli Cheddar Bites', price: 9.99, image: 'https://drive.google.com/thumbnail?id=1YQwDMyCE_VQZUMvTAb9OGhVbQElts9y1&sz=w1000' },
  { id: 'es8', name: 'Add Mac & Cheese Bites', price: 12.49, image: 'https://drive.google.com/thumbnail?id=1fBJdkpy8gqwTmdvrQoPevQ7Ypsrbb2CX&sz=w1000' },
];

// Add Toppings for regular cheesesteaks
const addToppingItems = [
  { id: 'at1', name: 'Add Mayo', price: 0.00 },
  { id: 'at2', name: 'Ketchup', price: 0.00 },
  { id: 'at3', name: 'Hot Cherry Peppers', price: 0.55 },
  { id: 'at4', name: 'Mix Sweet Peppers', price: 0.55 },
  { id: 'at5', name: 'Grilled Mushrooms', price: 0.55 },
  { id: 'at6', name: 'Pickles', price: 0.55 },
  { id: 'at7', name: 'Banana Peppers', price: 0.55, image: 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w400' },
  { id: 'at8', name: 'Pepperoni', price: 1.49 },
  { id: 'at9', name: 'Bacon', price: 1.49 },
];

// Lite Toppings for regular cheesesteaks
const liteToppingItems = [
  { id: 'lt1', name: 'Lite Cheese', price: 0.00 },
  { id: 'lt2', name: 'Lite Lettuce', price: 0.00 },
  { id: 'lt3', name: 'Lite Tomatoes', price: 0.00 },
  { id: 'lt4', name: 'Lite Mayo', price: 0.00 },
  { id: 'lt5', name: 'Lite Ketchup', price: 0.00 },
  { id: 'lt6', name: 'Lite Oil', price: 0.00 },
  { id: 'lt7', name: 'Lite Salt', price: 0.00 },
  { id: 'lt8', name: 'Lite Oregano', price: 0.00 },
  { id: 'lt9', name: 'Lite Black Pepper', price: 0.00 },
];

// No Toppings for regular cheesesteaks
const noToppingItems = [
  { id: 'nt1', name: 'No Cheese', price: 0.00 },
  { id: 'nt2', name: 'No Lettuce', price: 0.00 },
  { id: 'nt3', name: 'No Tomatoes', price: 0.00 },
  { id: 'nt4', name: 'No Raw Onions', price: 0.00 },
  { id: 'nt5', name: 'No Oregano', price: 0.00 },
  { id: 'nt6', name: 'No Oil', price: 0.00 },
  { id: 'nt7', name: 'No Salt', price: 0.00 },
  { id: 'nt8', name: 'No Black Pepper', price: 0.00 },
  { id: 'nt9', name: 'No Vinegar', price: 0.00 },
];

const beverageItems: Product[] = [
  {
    id: 'b1a',
    name: 'Pepsi 20oz',
    description: 'Classic cola',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1JpgdoknAMiCj8ygdZYA7c2vFcV6RZLbN&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1',
    name: 'Diet Pepsi 20oz',
    description: 'Refreshing diet cola',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1AHCaOFkOZtEaRaAEI5SIS6BPLDCF59nV&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1b',
    name: 'Cherry Pepsi 20oz',
    description: 'Cola with cherry flavor',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1GNrz-gtfDzVStuIfki1dEi-vZayFR_VW&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1g',
    name: 'Pepsi Zero 20oz',
    description: 'Zero sugar cola',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1ndgfndX10IWxUTLGed7avDT0dp_4IlsT&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1c',
    name: 'Mountain Dew 20oz',
    description: 'Citrus flavored soda',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1BccbrFdK-S9e-tFnx5uNfdihRF7HNzpw&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1d',
    name: 'Ginger Ale 20oz',
    description: 'Refreshing ginger soda',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1WLRyisDosWTQkAVJWGJ4Om2imiIDY0iq&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1e',
    name: 'Starry 20oz',
    description: 'Lemon-lime soda',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1O3pU2657SYzrUMoKLzrW84LvvX7kvq4E&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b1f',
    name: 'Brisk Iced Tea 20oz',
    description: 'Refreshing iced tea',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1wpQU7v96vnTYkUoVRkyY-3gK5yGzaXBH&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2',
    name: 'Starry 2L',
    description: 'Lemon-lime soda',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1Fku2fLf48jtCA0SFuAdV02N3VVNtsp9Q&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2a',
    name: 'Brisk Iced Tea 2L',
    description: 'Refreshing iced tea',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1gGmo4YB1IElJag6Ho4gQ1-qK0Dz9-86f&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2b',
    name: 'Ginger Ale 2L',
    description: 'Refreshing ginger soda',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1fMPwQU8-G84hMxRqS7qj589gRCNFBt7U&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2c',
    name: 'Mug Root Beer 2L',
    description: 'Classic root beer',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1G8I811J3nvvxoZ8XbuBiO3clcfXYHXgx&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2d',
    name: 'Mountain Dew 2L',
    description: 'Citrus flavored soda',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1XcE9vTHosX1BS82Cj4PNY1AkZt7LZ-yQ&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2e',
    name: 'Pepsi 2L',
    description: 'Classic cola',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1WzjWxgvbU9QaJxuwvUrOQ1_j4nILsZKS&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2f',
    name: 'Cherry Pepsi 2L',
    description: 'Cola with cherry flavor',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1GTQPhw1yK1HrYiGjGp2gfo1Hqbdk9GcN&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b2g',
    name: 'Diet Pepsi 2L',
    description: 'Refreshing diet cola',
    price: '$3.99',
    image: 'https://drive.google.com/thumbnail?id=1F3v0hCmak_vwjpmOhZbGXxkGVhJ50DfF&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b3',
    name: 'Passariello Spring Water',
    description: 'Premium bottled water',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1E3OQK-JYZSMqFXZQ-LvW5ILO5-BnaQnU&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b4',
    name: 'Passariello Sparkling Water',
    description: 'Refreshing sparkling water',
    price: '$2.99',
    image: 'https://drive.google.com/thumbnail?id=1ncvuDYrtVtl9jQp8aD0KzArQtKqhBlA0&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b5',
    name: 'Kids Chocolate Milk',
    description: 'Rich and creamy chocolate milk',
    price: '$1.79',
    image: 'https://drive.google.com/thumbnail?id=1GYr6taakeRulvuXAzkob3npvpnpwF6UN&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b6',
    name: 'Kids Apple Juice',
    description: '100% fruit juice',
    price: '$1.79',
    image: 'https://drive.google.com/thumbnail?id=107gnynzrSacPDOkMHjBaBEAAjzX_stzM&sz=w1000',
    category: 'beverages',
  },
  {
    id: 'b7',
    name: 'No thank you',
    description: 'Skip beverages',
    price: '$0.00',
    image: 'https://images.unsplash.com/photo-1586889123263-a1177c3f7e75?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxlbXB0eSUyMGNpcmNsZXxlbnwwfHx8fDE3NjI4Nzg2ODd8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral',
    category: 'beverages',
  },
];

// Special Instructions Options
const specialInstructionsOptions = [
  { id: 'si1', name: 'Lite Cheese', price: '$0.00' },
  { id: 'si2', name: 'Lite Sauce', price: '$0.00' },
  { id: 'si3', name: 'No Sauce', price: '$0.00' },
  { id: 'si4', name: 'Double Cut', price: '$0.00' },
  { id: 'si5', name: 'Well Done', price: '$0.00' },
  { id: 'si6', name: 'lightly cooked', price: '$0.00' },
  { id: 'si7', name: 'Extra Sauce', price: '$0.00' },
  { id: 'si8', name: 'No Cheese', price: '$0.00' },
];

// Extra Sauce Options - For Stromboli & Calzone
const extraSauceOptions = [
  { id: 'es1', name: 'Sauce Inside', price: 0.00 },
  { id: 'es2', name: 'Extra Sauce (4oz)', price: 1.35 },
  { id: 'es3', name: 'Extra Sauce (8oz)', price: 4.20 },
  { id: 'es4', name: 'Extra Sauce (16oz)', price: 8.40 },
];

// Substitute Sauce Options - For Chicken Tenders
const substituteSauceOptions = [
  { id: 'ss1', name: 'BBQ', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000' },
  { id: 'ss9', name: 'Buffalo', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000' },
  { id: 'ss2', name: 'Crazy Hot', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000' },
  { id: 'ss3', name: 'Garlic Parmesan', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000' },
  { id: 'ss4', name: 'Hot', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000' },
  { id: 'ss5', name: 'Mild', price: 0.00, image: 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000' },
  { id: 'ss6', name: 'Mild Honey', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'ss8', name: 'Sting Honey', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'ss7', name: 'No Sauce', price: 0.00 },
];

// French Fries Special Instructions Options
const friesInstructionsOptions = [
  { id: 'fi2', name: 'Salt', price: 0.00, image: 'https://images.unsplash.com/photo-1608039829572-78524f79c33f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'fi4', name: 'Side of Ketchup', price: 0.00, image: 'https://images.unsplash.com/photo-1628288935169-967ea32f3a5c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Garlic Stick Special Instructions Options
const garlicStickInstructionsOptions = [
  { id: 'gs3', name: 'No Pomodoro Sauce', price: 0.00, image: '' },
  { id: 'gs2', name: 'Extra Side of Pomodoro Sauce (4oz)', price: 1.35, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'gs4', name: 'Extra Side of Pomodoro Sauce (8oz)', price: 2.70, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'gs5', name: 'Extra Side of Pomodoro Sauce (16oz)', price: 5.40, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'gs1', name: 'Well Done', price: 0.00, image: 'https://images.unsplash.com/photo-1573140401552-3fab0b24306f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Garlic Bread Special Instructions Options
const garlicBreadInstructionsOptions = [
  { id: 'gb1', name: 'Well Done', price: 0.00, image: 'https://images.unsplash.com/photo-1573140401552-3fab0b24306f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Garlic Bread with Mozzarella Special Instructions Options
const garlicBreadMozzarellaInstructionsOptions = [
  { id: 'gbm1', name: 'Well Done', price: 0.00, image: 'https://images.unsplash.com/photo-1573140401552-3fab0b24306f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Mozzarella Sticks Special Instructions Options
const mozzarellaSticksInstructionsOptions = [
  { id: 'ms1', name: 'Extra Sauce', price: 1.35, image: 'https://images.unsplash.com/photo-1553798411-c1022f992f28?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Onion Rings Special Instructions Options
const onionRingsInstructionsOptions = [
  { id: 'or1', name: 'Well Done', price: 0.00, image: 'https://images.unsplash.com/photo-1639024471283-03518883512d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  // Reused from Mozzarella Sticks
  { id: 'mssi1', name: 'No Pomodoro Sauce', price: 0.00 },
  { id: 'mssi2', name: 'Extra Side of Pomodoro Sauce (4oz)', price: 1.35, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi3', name: 'Extra Side of Pomodoro Sauce (8oz)', price: 2.70, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi4', name: 'Extra Side of Pomodoro Sauce (16oz)', price: 5.40, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  // Ranch Options
  { id: 'onion-ranch-4oz', name: 'Extra Ranch 4oz', price: 2.49, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'onion-ranch-8oz', name: 'Extra Ranch 8oz', price: 4.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'onion-ranch-16oz', name: 'Extra Ranch 16oz', price: 8.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
];

// Mac & Cheese Bites Instructions Options
const macAndCheeseBitesInstructionsOptions = [
  // Reused from Mozzarella Sticks
  { id: 'mssi1', name: 'No Pomodoro Sauce', price: 0.00 },
  // Ranch Options
  { id: 'mac-ranch-4oz', name: 'Extra Ranch 4oz', price: 2.49, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'mac-ranch-8oz', name: 'Extra Ranch 8oz', price: 4.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'mac-ranch-16oz', name: 'Extra Ranch 16oz', price: 8.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'mssi2', name: 'Extra Side of Pomodoro Sauce (4oz)', price: 1.35, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi3', name: 'Extra Side of Pomodoro Sauce (8oz)', price: 2.70, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi4', name: 'Extra Side of Pomodoro Sauce (16oz)', price: 5.40, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
];

// Broccoli & Cheddar Bites Instructions Options
const broccoliCheddarBitesInstructionsOptions = [
  // Reused from Mozzarella Sticks
  { id: 'mssi1', name: 'No Pomodoro Sauce', price: 0.00 },
  { id: 'mssi2', name: 'Extra Side of Pomodoro Sauce (4oz)', price: 1.35, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi3', name: 'Extra Side of Pomodoro Sauce (8oz)', price: 2.70, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi4', name: 'Extra Side of Pomodoro Sauce (16oz)', price: 5.40, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  // Ranch Options
  { id: 'broccoli-ranch-4oz', name: 'Extra Ranch 4oz', price: 2.49, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'broccoli-ranch-8oz', name: 'Extra Ranch 8oz', price: 4.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'broccoli-ranch-16oz', name: 'Extra Ranch 16oz', price: 8.99, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
];

// Passariello Fries Special Instructions Options
const passarielloFriesInstructionsOptions = [
  { id: 'pf2', name: 'No Mozzarella Cheese', price: 0.00 },
  { id: 'pf3', name: 'Salt', price: 0.00 },
  { id: 'pf5', name: 'No Cheddar Cheese', price: 0.00 },
  { id: 'pf6', name: 'No Swiss Cheese', price: 0.00 },
  { id: 'pf7', name: 'No Ranch', price: 0.00 },
  { id: 'pf8', name: 'No Bacon', price: 0.00 },
];

// Cheddar Steak Fries Special Instructions Options
const cheddarSteakFriesInstructionsOptions = [
  { id: 'csf1', name: 'No Cheddar Cheese', price: 0.00 },
  { id: 'csf2', name: 'No Salt', price: 0.00 },
];



// Wings Quantity Options
const wingsQuantityOptions = [
  { id: '10pcs', name: '10 pcs', price: 16.99 },
  { id: '20pcs', name: '20 pcs', price: 33.99 },
  { id: '30pcs', name: '30 pcs', price: 50.99 },
  { id: '50pcs', name: '50 pcs', price: 84.99 },
];

// Chicken Tenders Quantity Options
const chickenTendersQuantityOptions = [
  { id: '4pcs', name: '4 pcs', price: 12.49 },
  { id: '8pcs', name: '8 pcs', price: 24.99 },
  { id: '16pcs', name: '16 pcs', price: 49.99 },
  { id: '32pcs', name: '32 pcs', price: 99.99 },
  { id: '64pcs', name: '64 pcs', price: 199.99 },
];

// Mozzarella Sticks Quantity Options
const mozzarellaSticksQuantityOptions = [
  { id: '6pcs', name: '6 pcs', price: 9.49 },
  { id: '12pcs', name: '12 pcs', price: 18.99 },
  { id: '24pcs', name: '24 pcs', price: 37.99 },
  { id: '48pcs', name: '48 pcs', price: 75.99 },
];

// Arancini Rice Ball Quantity Options (Catering - capp4)
const aranciniQuantityOptions = [
  { id: '10pcs', name: '10 pcs', price: 44.90 },
  { id: '20pcs', name: '20 pcs', price: 89.80 },
  { id: '30pcs', name: '30 pcs', price: 134.70 },
  { id: '50pcs', name: '50 pcs', price: 224.50 },
];

// Arancini Rice Ball Regular Menu Quantity Options (app8 only)
const aranciniRegularQuantityOptions = [
  { id: '1pc', name: '1 pc', price: 4.49 },
  { id: '2pcs', name: '2 pcs', price: 8.98 },
  { id: '4pcs', name: '4 pcs', price: 17.96 },
  { id: '8pcs', name: '8 pcs', price: 35.92 },
  { id: '16pcs', name: '16 pcs', price: 71.84 },
];

// Garlic Bread Size Options
const garlicBreadSizeOptions = [
  { id: '1pcs', name: 'Half Loaf', price: 4.25 },
  { id: '2pcs', name: 'Full Loaf', price: 8.49 },
];

// Garlic Bread with Mozzarella Size Options
const garlicBreadMozzarellaSizeOptions = [
  { id: '1pcs', name: 'Half Loaf', price: 4.75 },
  { id: '2pcs', name: 'Full Loaf', price: 9.49 },
];

// Wings Sauce Choice Options
const wingsSauceOptions = [
  { id: 'ws1', name: 'BBQ Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000' },
  { id: 'ws9', name: 'Buffalo Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000' },
  { id: 'ws2', name: 'Crazy Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000' },
  { id: 'ws3', name: 'Garlic Parmesan Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000' },
  { id: 'ws4', name: 'Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000' },
  { id: 'ws5', name: 'Mild Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000' },
  { id: 'ws6', name: 'Mild Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'ws8', name: 'Sting Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'ws7', name: 'No Sauce', price: 0.00 },
];

// Wings Special Instructions Options
const wingsSpecialInstructionsOptions = [
  { id: 'wsi2', name: 'Sauce Mixed In', price: 0.00 },
  { id: 'wsi3', name: 'Sauce On The Side', price: 0.00 },
  { id: 'wsi4', name: 'No Celery', price: 0.00 },
  { id: 'wsi5', name: 'No Bleu Cheese', price: 0.00 },
];

// Chicken Tenders Special Instructions Options
const chickenTendersSpecialInstructionsOptions = [
  { id: 'ctsi2', name: 'No Honey Mustard', price: 0.00 },
  { id: 'ctsi3', name: 'No French Fries', price: 0.00 },
];

// Mozzarella Sticks Special Instructions Options
const mozzarellaSticksSpecialInstructionsOptions = [
  { id: 'mssi1', name: 'No Pomodoro Sauce', price: 0.00, image: '' },
  { id: 'mssi2', name: 'Extra Side of Pomodoro Sauce (4oz)', price: 1.35, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi3', name: 'Extra Side of Pomodoro Sauce (8oz)', price: 2.70, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi4', name: 'Extra Side of Pomodoro Sauce (16oz)', price: 5.40, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'mssi5', name: 'Well Done', price: 0.00, image: 'https://images.unsplash.com/photo-1573140401552-3fab0b24306f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
];

// Arancini Rice Ball Special Instructions Options (Catering - capp4)
const aranciniSpecialInstructionsOptions = [
  { id: 'arsi1', name: 'No Pomodoro Sauce', price: 0.00 },
  { id: 'arsi2', name: 'Extra Side of Pomodoro Sauce (4oz)', price: 1.35, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'arsi3', name: 'Extra Side of Pomodoro Sauce (8oz)', price: 2.70, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'arsi4', name: 'Extra Side of Pomodoro Sauce (16oz)', price: 5.40, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
];

// Wings Extra Sauce Options
const wingsExtraSauceOptions = [
  { id: 'wes1', name: 'Extra Mild Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000' },
  { id: 'wes2', name: 'Extra BBQ Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000' },
  { id: 'wes3', name: 'Extra Crazy Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000' },
  { id: 'wes4', name: 'Extra Garlic Parmesan Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000' },
  { id: 'wes5', name: 'Extra Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000' },
  { id: 'wes6', name: 'Extra Mild Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'wes7', name: 'Extra Sting Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
];

// Chicken Tenders Extra Sauce Options
const chickenTendersExtraSauceOptions = [
  { id: 'wes1', name: 'Extra Mild Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000' },
  { id: 'wes2', name: 'Extra BBQ Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000' },
  { id: 'wes3', name: 'Extra Crazy Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000' },
  { id: 'wes4', name: 'Extra Garlic Parmesan Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000' },
  { id: 'wes5', name: 'Extra Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000' },
  { id: 'wes8', name: 'Extra Honey Mustard Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000' },
  { id: 'extra-cheese-sauce', name: 'Extra Cheese Sauce', price: 0.00, image: 'https://images.unsplash.com/photo-1734772257288-d53770c7707f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' },
  { id: 'wes6', name: 'Extra Mild Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'wes7', name: 'Extra Sting Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
];

// Chicken Tenders Sauce Choice Options
const chickenTendersSauceOptions = [
  { id: 'ws1', name: 'BBQ Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000' },
  { id: 'ws9', name: 'Buffalo Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1-EDW7ulTkm2Yb60gHkL2Sma5cy0_OhZi&sz=w1000' },
  { id: 'ws2', name: 'Crazy Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000' },
  { id: 'ws3', name: 'Garlic Parmesan Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000' },
  { id: 'ws4', name: 'Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000' },
  { id: 'ws8', name: 'Honey Mustard Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1l9ix4xEZLPiwjsIxYzXVNALwePILDiOB&sz=w1000' },
  { id: 'ws5', name: 'Mild Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000' },
  { id: 'ws6', name: 'Mild Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'ws7', name: 'Sting Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'ws10', name: 'No Sauce', price: 0.00 },
];

// Mozzarella Sticks Extra Sauce Options
const mozzarellaSticksExtraSauceOptions = [
  { id: 'wes1', name: 'Mild Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=16yXWXXUbsTyUNxrd-j_RMDqxRUurBWuu&sz=w1000' },
  { id: 'wes2', name: 'BBQ Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15gTOtiE45rp2lo3zJCXZ7c-a76xMOvOB&sz=w1000' },
  { id: 'wes3', name: 'Crazy Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=15cYhkEsAtiv8R8KVz2Lb_uh9UNfcy0_X&sz=w1000' },
  { id: 'wes4', name: 'Garlic Parmesan Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1z42hECiOpG6zRRwqLpVBgYR_7p9qsQRO&sz=w1000' },
  { id: 'wes5', name: 'Hot Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1eaHYz33jzMZIWqEgXmIQSEs5unQK6g87&sz=w1000' },
  { id: 'wes9', name: 'Pomodoro Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1qPUFm2DZTraEiDuC0h2DCNCQhAki1kx-&sz=w1000' },
  { id: 'wes6', name: 'Mild Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
  { id: 'wes7', name: 'Sting Honey Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1pTqzglr_HUbwisaVDvSvKu9C4SBj6YKg&sz=w1000' },
];

// Wings Extra Bleu Cheese/Ranch Options
const wingsExtraCheeseRanchOptions = [
  { id: 'wecr1', name: 'Extra Ranch Sauce', price: 0.00, image: 'https://drive.google.com/thumbnail?id=18IJxohQw6ZqTsHANKHJoMpK1YmvExnOs&sz=w1000' },
  { id: 'wecr2', name: 'Bleu Cheese', price: 0.00, image: 'https://drive.google.com/thumbnail?id=1IC2l-gLbo0QYFislwjItAp__I6DaajmN&sz=w1000' },
];

// Pizza Dippings Options
const pizzaDippingsOptions = [
  { id: 'dip1', name: 'Buttermilk Ranch', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1gg-seSYp4hX9UT15c7A9ZrGTM1TJ5yyn&sz=w1000' },
  { id: 'dip2', name: 'Honey Mustard', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1sV3UZuL6-qCasnXuPPD-AkEB3mJxMbWz&sz=w1000' },
  { id: 'dip3', name: 'Bleu Cheese', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1l7hbAOb2nRDIZhvXO-PiCHf11TT6ETHa&sz=w1000' },
  { id: 'dip4', name: 'Mike\'s Hot Honey', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1yGcjRyQUN69HbimNMhQrwelfnmreHQVt&sz=w1000' },
  { id: 'dip5', name: 'Mike\'s Extra Hot Honey', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1QVqzo165ww-zucP-8xRqPpTw4HToih-Q&sz=w1000' },
];

// Half Price Lookup Map by ID (for left/right circle selections on pizza toppings)
// IMPORTANT: Only include IDs that exist in the topping data arrays in this file.
const HALF_TOPPING_PRICE_BY_ID: Record<string, number> = {
  // Special half prices
  a16: 1.49, // Anchovies
  a1: 2.99,  // Cup n Char Pepperoni

  // Regular toppings ($1.99 half)
  a2: 1.99,  // Sausage
  a3: 1.99,  // Pepperoni
  a4: 1.99,  // Mushrooms
  a5: 1.99,  // Fresh Mozzarella
  a6: 1.99,  // Grilled Onions
  a7: 1.99,  // Sliced Black Olives
  a8: 1.99,  // Ham
  a9: 1.99,  // Bacon
  a10: 1.99, // Chopped Garlic
  a11: 1.99, // Zucchini
  a12: 1.99, // Sliced Hot Cherry Peppers
  a13: 1.99, // Mix Sweet Peppers
  a14: 1.99, // Roasted Peppers
  a15: 1.99, // Sun Dried Tomatoes
  a17: 1.99, // Spinach
  a18: 1.99, // Extra Cheese
  a19: 1.99, // Ricotta
  a20: 1.99, // Sliced Meatballs
  a21: 1.99, // Broccoli Florets
  a22: 1.99, // Eggplant
  a23: 1.99, // Artichokes
  a24: 1.99, // Pineapple
  a25: 1.99, // Chopped Tomato

  // Premium toppings ($5.99 half)
  a26: 5.99, // Chicken Steak
  a27: 5.99, // Grilled Chicken
  a28: 5.99, // Buffalo Chicken
  a29: 5.99, // Prosciutto
  a30: 5.99, // Beef Steak
};

// Salad Base Options
const saladBaseOptions = [
  { id: 'sb1', name: 'Iceberg', price: 0.00 },
  { id: 'sb2', name: 'Romaine', price: 0.00 },
  { id: 'sb3', name: 'Mix Romaine and Iceberg', price: 0.00 },
  { id: 'sb4', name: 'Spinach', price: 0.00 },
  { id: 'sb5', name: 'Spring Mix', price: 0.00 },
];

// Salad Dressing Options
const saladDressingOptions = [
  { id: 'sd2', name: 'Balsamic Vinaigrette', price: 0.00 },
  { id: 'sd3', name: 'Balsamic Vinegar & Oil', price: 0.00 },
  { id: 'sd4', name: 'Bleu Cheese', price: 0.00 },
  { id: 'sd5', name: 'Buffalo', price: 0.00 },
  { id: 'sd6', name: 'Caesar', price: 0.00 },
  { id: 'sd7', name: 'Chipotle Ranch', price: 0.00 },
  { id: 'sd8', name: 'Creamy Italian', price: 0.00 },
  { id: 'sd9', name: 'Fat Free Italian', price: 0.00 },
  { id: 'sd10', name: 'Fat Free Ranch', price: 0.00 },
  { id: 'sd11', name: 'French', price: 0.00 },
  { id: 'sd13', name: 'Honey Mustard', price: 0.00 },
  { id: 'sd14', name: 'Lemon Oil', price: 0.00 },
  { id: 'sd15', name: 'Lite Caesar', price: 0.00 },
  { id: 'sd17', name: 'Ranch', price: 0.00 },
  { id: 'sd18', name: 'Red Wine Vinegar & Oil', price: 0.00 },
  { id: 'sd19', name: 'Russian', price: 0.00 },
  { id: 'sd20', name: 'White Balsamic Vinegar & Oil', price: 0.00 },
  { id: 'sd21', name: 'Oil', price: 0.00 },
  { id: 'sd22', name: 'Lemon', price: 0.00 },
  { id: 'sd23', name: 'Red Vinegar', price: 0.00 },
  { id: 'sd24', name: 'Balsamic Vinegar', price: 0.00 },
  { id: 'sd16', name: 'No Dressing', price: 0.00 },
];

// Salad Toppings Options
const saladToppingsOptions = [
  { id: 'st1', name: 'Anchovies', price: 0.00 },
  { id: 'st2', name: 'Bacon', price: 0.00 },
  { id: 'st3', name: 'Beets', price: 0.00 },
  { id: 'st4', name: 'Black Olives', price: 0.00 },
  { id: 'st5', name: 'Calamari Mix', price: 0.00 },
  { id: 'st6', name: 'Caprese Mix', price: 0.00 },
  { id: 'st7', name: 'Carrots', price: 0.00 },
  { id: 'st8', name: 'Celery', price: 0.00 },
  { id: 'st9', name: 'Chic Peas', price: 0.00 },
  { id: 'st10', name: 'Chopped Tomatoes', price: 0.00 },
  { id: 'st11', name: 'Corn', price: 0.00 },
  { id: 'st12', name: 'Crispy Chicken', price: 0.00 },
  { id: 'st13', name: 'Croutons', price: 0.00 },
  { id: 'st14', name: 'Cucumbers', price: 0.00 },
  { id: 'st15', name: 'Dried Cranberries', price: 0.00 },
  { id: 'st16', name: 'Egg', price: 0.00 },
  { id: 'st17', name: 'Feta Cheese', price: 0.00 },
  { id: 'st18', name: 'Fresh Mozzarella', price: 0.00 },
  { id: 'st19', name: 'Green Olives', price: 0.00 },
  { id: 'st20', name: 'Green Peppers', price: 0.00 },
  { id: 'st21', name: 'Grilled Chicken', price: 0.00 },
  { id: 'st22', name: 'Ham', price: 0.00 },
  { id: 'st23', name: 'Mozzarella Cubed', price: 0.00 },
  { id: 'st24', name: 'Parmigiano', price: 0.00 },
  { id: 'st25', name: 'Pasta Mix', price: 0.00 },
  { id: 'st26', name: 'Pepperoni', price: 0.00 },
  { id: 'st27', name: 'Plain Pasta', price: 0.00 },
  { id: 'st28', name: 'Provolone', price: 0.00 },
  { id: 'st29', name: 'Raw Mushroom', price: 0.00 },
  { id: 'st30', name: 'Red Onions', price: 0.00 },
  { id: 'st31', name: 'Roasted Red Peppers', price: 0.00 },
  { id: 'st32', name: 'Shredded Cheddar', price: 0.00 },
  { id: 'st33', name: 'Shredded Mozzarella', price: 0.00 },
  { id: 'st34', name: 'Sun Dried Tomatoes', price: 0.00 },
  { id: 'st35', name: 'Sunflower Seeds', price: 0.00 },
  { id: 'st36', name: 'Swiss', price: 0.00 },
  { id: 'st37', name: 'Tortilla Strips', price: 0.00 },
  { id: 'st38', name: 'Tuna Mix', price: 0.00 },
  { id: 'st39', name: 'Turkey', price: 0.00 },
];

// Salad Dressing Instructions
const saladDressingInstructions = [
  { id: 'sdi1', name: 'Dressing Mixed In', price: 0.00 },
  { id: 'sdi2', name: 'Dressing On The Side', price: 0.00 },
];

// Salad Extra Dressing Options
const saladExtraDressingOptions = [
  { id: 'sed2', name: 'Balsamic Vinaigrette', price: 1.99 },
  { id: 'sed3', name: 'Balsamic Vinegar & Oil', price: 1.99 },
  { id: 'sed4', name: 'Bleu Cheese', price: 1.99 },
  { id: 'sed5', name: 'Buffalo', price: 1.99 },
  { id: 'sed6', name: 'Caesar', price: 1.99 },
  { id: 'sed7', name: 'Chipotle Ranch', price: 1.99 },
  { id: 'sed8', name: 'Creamy Italian', price: 1.99 },
  { id: 'sed9', name: 'Fat Free Italian', price: 1.99 },
  { id: 'sed10', name: 'Fat Free Ranch', price: 1.99 },
  { id: 'sed11', name: 'French', price: 1.99 },
  { id: 'sed13', name: 'Honey Mustard', price: 1.99 },
  { id: 'sed14', name: 'Lemon Oil', price: 1.99 },
  { id: 'sed15', name: 'Lite Caesar', price: 1.99 },
  { id: 'sed16', name: 'No Dressing', price: 1.99 },
  { id: 'sed17', name: 'Ranch', price: 1.99 },
  { id: 'sed18', name: 'Red Wine Vinegar & Oil', price: 1.99 },
  { id: 'sed19', name: 'Russian', price: 1.99 },
  { id: 'sed20', name: 'White Balsamic Vinegar & Oil', price: 1.99 },
  { id: 'sed21', name: 'Oil', price: 1.99 },
  { id: 'sed22', name: 'Lemon', price: 1.99 },
  { id: 'sed23', name: 'Red Vinegar', price: 1.99 },
  { id: 'sed24', name: 'Balsamic Vinegar', price: 1.99 },
];

// Salad Extra Toppings Options
const saladExtraToppingsOptions = [
  { id: 'set1', name: 'Anchovies', price: 0.69 },
  { id: 'set2', name: 'Egg', price: 0.69 },
  { id: 'set3', name: 'Feta Cheese', price: 0.69 },
  { id: 'set4', name: 'Shredded Cheddar', price: 0.69 },
  { id: 'set5', name: 'Mozzarella Shredded', price: 0.69 },
  { id: 'set6', name: 'Mozzarella Cubed', price: 0.69 },
  { id: 'set7', name: 'Provolone', price: 0.69 },
  { id: 'set8', name: 'Parmigiano', price: 0.69 },
  { id: 'set9', name: 'Swiss', price: 0.69 },
  { id: 'set10', name: 'Dried Cranberries', price: 0.69 },
  { id: 'set11', name: 'Croutons', price: 0.69 },
  { id: 'set12', name: 'Tortilla Strips', price: 0.69 },
  { id: 'set13', name: 'Sunflower Seeds', price: 0.69 },
  { id: 'set14', name: 'Chopped Tomatoes', price: 0.69 },
  { id: 'set15', name: 'Cucumbers', price: 0.69 },
  { id: 'set16', name: 'Red Onions', price: 0.69 },
  { id: 'set17', name: 'Green Peppers', price: 0.69 },
  { id: 'set18', name: 'Carrots', price: 0.69 },
  { id: 'set19', name: 'Broccoli', price: 0.69 },
  { id: 'set20', name: 'Raw Mushrooms', price: 0.69 },
  { id: 'set21', name: 'Black Olives', price: 0.69 },
  { id: 'set22', name: 'Marinated Vegetables', price: 0.69 },
  { id: 'set23', name: 'Beets', price: 0.69 },
  { id: 'set24', name: 'Corn', price: 0.69 },
  { id: 'set25', name: 'Roasted Red Peppers', price: 0.69 },
  { id: 'set26', name: 'Green Olives', price: 0.69 },
  { id: 'set27', name: 'Sun Dried Tomatoes', price: 0.69 },
  { id: 'set28', name: 'Chic Peas', price: 0.69 },
  { id: 'set29', name: 'Plain Pasta', price: 0.69 },
  { id: 'set30', name: 'Celery', price: 0.69 },
  { id: 'set31', name: 'Caprese Mix', price: 1.99 },
  { id: 'set32', name: 'Bacon', price: 1.99 },
  { id: 'set33', name: 'Crispy Chicken', price: 1.99 },
  { id: 'set34', name: 'Turkey', price: 1.99 },
  { id: 'set35', name: 'Tuna Mix', price: 1.99 },
  { id: 'set36', name: 'Grilled Chicken', price: 1.99 },
  { id: 'set37', name: 'Ham', price: 1.99 },
  { id: 'set38', name: 'Pepperoni', price: 1.99 },
  { id: 'set39', name: 'Calamari Mix', price: 1.99 },
  { id: 'set40', name: 'Fresh Mozzarella', price: 1.99 },
  { id: 'set41', name: 'Pasta Mix', price: 1.99 },
];

export function ProductDetailPage({ product, onBack, onAddToCart, allProducts, isEditMode = false, editingCartItem = null, deliveryMode, onDeliveryModeChange, onProductChange, currentLocation, scheduledTime, cartItemsCount = 0, onLocationClick, onCartClick, mode = 'regular', onModeChange, activeCategory, onCategoryChange }: ProductDetailPageProps) {
  const debugCartEnabled = typeof window !== 'undefined' && new URLSearchParams(window.location.search).get('debugCart') === '1';

  // --- NO SIZE PIZZA LOGIC (Global Flag) ---
  const isMinucci = product.category === 'minucci-pizzas';
  const isBrooklyn = product.category === 'brooklyn-pizza';
  
  const THICK_CRUST_IDS = ['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'];
  const isSpecialtyThickOrPan = (product.category === 'specialty-pizza' || product.category === 'specialty') && 
      THICK_CRUST_IDS.includes(product.id);
      
  const isNoSizePizza = isMinucci || isBrooklyn || isSpecialtyThickOrPan;

  // Randomize suggested appetizers
  const suggestedAppetizers = useMemo(() => {
    const shuffled = [...appetizersProducts].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 3);
  }, []);

  // REMOVED: Problematic MutationObserver that searched for non-existent DOM selectors
  // The layout now properly handles overflow without needing external DOM manipulation

  // BODY LOCK DEFINITIVO - Block body/html scroll in desktop (CRITICAL FIX)
  // NO position:fixed (breaks layout/width/sticky per HARD RULES)
  useLayoutEffect(() => {
    // Only apply on desktop (1024px+)
    const isDesktop = window.matchMedia('(min-width: 1024px)').matches;
    if (!isDesktop) {
      if (debugCartEnabled) console.log('[ProductDetailPage] Mobile detected, skipping body scroll lock');
      return;
    }

    if (debugCartEnabled) console.log('[ProductDetailPage] Desktop detected, applying DEFINITIVE body lock...');

    // Save previous styles
    const htmlElement = document.documentElement;
    const bodyElement = document.body;
    
    const previousHtmlOverflow = htmlElement.style.overflow;
    const previousBodyOverflow = bodyElement.style.overflow;
    const previousBodyHeight = bodyElement.style.height;
    const previousBodyMaxHeight = bodyElement.style.maxHeight;
    const previousBodyOverscroll = bodyElement.style.overscrollBehavior;

    // DEFINITIVE SCROLL LOCK (NO position:fixed)
    htmlElement.style.overflow = 'hidden';
    bodyElement.style.overflow = 'hidden';
    bodyElement.style.height = '100dvh';
    bodyElement.style.maxHeight = '100dvh';
    bodyElement.style.overscrollBehavior = 'none';

    // Validate lock immediately
    const bodyDelta = bodyElement.scrollHeight - bodyElement.clientHeight;
    if (debugCartEnabled) {
      console.log('[ProductDetailPage]  BODY LOCKED (mount)');
      console.log('  - body.overflowY:', getComputedStyle(bodyElement).overflowY);
      console.log('  - html.overflowY:', getComputedStyle(htmlElement).overflowY);
      console.log('  - body.height:', getComputedStyle(bodyElement).height);
      console.log('  - bodyDelta (scrollHeight - clientHeight):', bodyDelta);
    }

    if (bodyDelta > 10) {
      if (debugCartEnabled) console.warn(`[ProductDetailPage]  WARNING: bodyDelta is ${bodyDelta}px (expected ~0). Body has excess height.`);
    }

    // Cleanup: restore on unmount
    return () => {
      // Restore all styles
      htmlElement.style.overflow = previousHtmlOverflow;
      bodyElement.style.overflow = previousBodyOverflow;
      bodyElement.style.height = previousBodyHeight;
      bodyElement.style.maxHeight = previousBodyMaxHeight;
      bodyElement.style.overscrollBehavior = previousBodyOverscroll;
      
      if (debugCartEnabled) console.log('[ProductDetailPage]  BODY UNLOCKED (unmount)');
    };
  }, []); // Run once on mount

  // WHEEL PROXY - Redirect all scroll events to left container (desktop only)
  useEffect(() => {
    // Only apply on desktop (1024px+)
    const isDesktop = window.matchMedia('(min-width: 1024px)').matches;
    if (!isDesktop) {
      return;
    }

    const root = document.querySelector('[data-testid="product-detail-root"]');
    const leftContainer = document.querySelector('[data-testid="left-scroll-container"]');

    if (!root || !leftContainer) {
      console.warn('[ProductDetail] Wheel proxy: root or leftContainer not found');
      return;
    }

    const handleWheel = (e: WheelEvent) => {
      // Check if event target is inside left container - if yes, let native scroll work
      if (leftContainer.contains(e.target as Node)) {
        return; // Native scrolling works fine here
      }

      // Check if target is an interactive element that needs native scroll
      const target = e.target as HTMLElement;
      if (
        target.tagName === 'INPUT' ||
        target.tagName === 'TEXTAREA' ||
        target.tagName === 'SELECT' ||
        target.closest('[role="menu"]') ||
        target.closest('[role="listbox"]') ||
        target.closest('[role="combobox"]')
      ) {
        return; // Let interactive elements handle their own scroll
      }

      // Prevent default scroll behavior
      e.preventDefault();

      // Apply scroll delta to left container
      const scrollDelta = e.deltaY !== 0 ? e.deltaY : e.deltaX;
      (leftContainer as HTMLElement).scrollTop += scrollDelta;
    };

    // Add listener with non-passive to allow preventDefault
    root.addEventListener('wheel', handleWheel, { passive: false });

    if (debugCartEnabled) console.log('[ProductDetail] wheel proxy active');

    // Cleanup
    return () => {
      root.removeEventListener('wheel', handleWheel);
    };
  }, []); // Run once on mount

  const [isIncludedOpen, setIsIncludedOpen] = useState(true);
  const [isAdditionalOpen, setIsAdditionalOpen] = useState(true);
  const [extraSideSauces, setExtraSideSauces] = useState<Record<string, number>>({});
  const [isExtraDippingOpen, setIsExtraDippingOpen] = useState(true);
  const [isSoupOpen, setIsSoupOpen] = useState(true);
  const [isDessertOpen, setIsDessertOpen] = useState(true);
  const [isBeverageOpen, setIsBeverageOpen] = useState(true);
  const [isSideToppingsOpen, setIsSideToppingsOpen] = useState(true);
  const [isExtraSidesOpen, setIsExtraSidesOpen] = useState(true);
  const [isSpecialInstructionsOpen, setIsSpecialInstructionsOpen] = useState(true);
  const [isChickenTendersSauceOpen, setIsChickenTendersSauceOpen] = useState(true);
  const [isChickenTendersSpecialInstructionsOpen, setIsChickenTendersSpecialInstructionsOpen] = useState(true);
  const [isChickenTendersExtraSauceOpen, setIsChickenTendersExtraSauceOpen] = useState(true);
  const [isChickenTendersDippingsOpen, setIsChickenTendersDippingsOpen] = useState(true);
  const [isKidsBakedExtraOpen, setIsKidsBakedExtraOpen] = useState(true);
  const [isKidsBakedLiteOpen, setIsKidsBakedLiteOpen] = useState(true);
  const [isKidsBakedNoOpen, setIsKidsBakedNoOpen] = useState(true);
  const [isKidsPastaMeatballTypeOpen, setIsKidsPastaMeatballTypeOpen] = useState(true);
  const [isKidsPastaMeatballSpecialOpen, setIsKidsPastaMeatballSpecialOpen] = useState(true);
  const [isKidsPastaMeatballToppingsOpen, setIsKidsPastaMeatballToppingsOpen] = useState(true);
  const [isNoToppingsOpen, setIsNoToppingsOpen] = useState(true);
  const [quantity, setQuantity] = useState(1);
  const [itemName, setItemName] = useState('');
  const [selectedSize, setSelectedSize] = useState<'medium' | 'large' | 'jumbo' | '10' | '20' | '30' | '40' | '50' | null>(
    ((product.category === 'wings' || product.category === 'catering-appetizers' || product.id === 'app18') && product.id !== 'app6')
      ? '10' 
      : product.category === 'cold-hoagies' || product.category === 'hot-hoagies'
        ? 'large'
        : product.category === 'soups'
          ? 'medium'
        : (product.id === 'cp2' || product.id === 'cp5' || product.id === 'cp6' || product.id === 'cp11' || product.id === 'cp12')
          ? 'large'
          : product.category === 'catering-pasta'
            ? 'medium'
            : (product.id === 'cs3' || product.id === 'cs6' || product.id === 'cs7')
              ? 'large'
              : product.category === 'catering-seafood-pasta'
                ? 'medium'
                : (product.id === 'calzone-1' || product.id === 'calzone-2') 
                  ? 'medium'
                  : product.id.startsWith('stromboli-')
                    ? 'large'
                    : (product.id === 'cptray1' || product.id === 'cptray2' || product.id === 'cptray4' || product.id === 'cptray5' || product.id === 'cptray6')
                      ? '10'
                      : product.id === 'cptray3'
                        ? '20'
                        : (product.id === 'c3' || product.id === 'c6' || product.id === 'c7')
                          ? 'large'
                          : (product.id === 'csalad1' || product.id === 'csalad5' || product.id === 'csalad6')
                            ? 'large'
                            : product.category === 'pizzas'
                              ? 'large'
                              : product.category === 'specialty-pizza'
                                ? (isNoSizePizza ? null : 'large')
                                : isNoSizePizza
                                  ? null
                                  : null
  );
  const [selectedIncluded, setSelectedIncluded] = useState<string>('');
  const [selectedToppings, setSelectedToppings] = useState<string[]>([]);
  const [toppingDistribution, setToppingDistribution] = useState<Record<string, 'left' | 'whole' | 'right'>>({});
  
  // Desserts state - Changed to Record<string, number> for quantity support
  const [selectedDesserts, setSelectedDesserts] = useState<Record<string, number>>({});
  const [activeDessertItem, setActiveDessertItem] = useState<string | null>(null);

  // Beverages state - Changed to Record<string, number> for quantity support
  const [selectedBeverages, setSelectedBeverages] = useState<Record<string, number>>({});
  const [activeBeverageItem, setActiveBeverageItem] = useState<string | null>(null);

  const [selectedSpecialInstructions, setSelectedSpecialInstructions] = useState<string[]>([]);
  const [selectedExtraSauce, setSelectedExtraSauce] = useState<string[]>([]);
  const [selectedNoToppings, setSelectedNoToppings] = useState<string[]>([]);
  const [selectedBrooklynInstructions, setSelectedBrooklynInstructions] = useState<string[]>([]);
  const [selectedCheese, setSelectedCheese] = useState<string>('');
  const [selectedSideToppings, setSelectedSideToppings] = useState<string[]>([]);
  const [selectedExtraSides, setSelectedExtraSides] = useState<string[]>([]);
  const [selectedSaladBase, setSelectedSaladBase] = useState<string>('');
  const [selectedSaladDressing, setSelectedSaladDressing] = useState<string>('');
  const [selectedDressingInstruction, setSelectedDressingInstruction] = useState<string>('');
  const [selectedExtraDressings, setSelectedExtraDressings] = useState<string[]>([]);
  const [selectedSaladSpecialInstructions, setSelectedSaladSpecialInstructions] = useState<string[]>([]);
  const [selectedAddToppings, setSelectedAddToppings] = useState<string[]>([]);
  const [selectedLiteToppings, setSelectedLiteToppings] = useState<string[]>([]);
  const [selectedNoToppingsCheesesteak, setSelectedNoToppingsCheesesteak] = useState<string[]>([]);
  const [toastRoll, setToastRoll] = useState<'no-toast' | 'toast' | null>(null);
  const [toastOptionError, setToastOptionError] = useState(false);
  const toastOptionRef = useRef<HTMLDivElement>(null);
  const [substituteCheese, setSubstituteCheese] = useState<string | null>(null); // No default cheese selection
  const [cheeseOptionError, setCheeseOptionError] = useState(false);
  const cheeseOptionRef = useRef<HTMLDivElement>(null);
  const [burgerCheeseError, setBurgerCheeseError] = useState(false);
  const burgerCheeseRef = useRef<HTMLDivElement>(null);
  const [saladBaseError, setSaladBaseError] = useState(false);
  const saladBaseRef = useRef<HTMLDivElement>(null);
  const [saladDressingError, setSaladDressingError] = useState(false);
  const saladDressingRef = useRef<HTMLDivElement>(null);
  const [saladToppingsError, setSaladToppingsError] = useState(false);
  const saladToppingsRef = useRef<HTMLDivElement>(null);
  const [dippingError, setDippingError] = useState(false);
  const dippingErrorRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (dippingError) {
       const hasSelection = selectedExtraSauce.some(id => ['bc', 'br', 'none'].includes(id));
       if (hasSelection) {
         setDippingError(false);
       }
    }
  }, [selectedExtraSauce, dippingError]);
  
  // Catering Salads validation states
  const [cateringSaladBaseError, setCateringSaladBaseError] = useState(false);
  const cateringSaladBaseRef = useRef<HTMLDivElement>(null);
  const [cateringSaladDressingError, setCateringSaladDressingError] = useState(false);
  const cateringSaladDressingRef = useRef<HTMLDivElement>(null);
  
  const [pizzaSteakExtras, setPizzaSteakExtras] = useState<string | null>(null); // Extra sauce or extra cheese
  const [pizzaSteakSpecialInstructions, setPizzaSteakSpecialInstructions] = useState<string | null>(null); // No Sauce, Lite Sauce, or Lite Cheese
  
  // Hot Hoagies states
  const [selectedHotHoagieExtras, setSelectedHotHoagieExtras] = useState<string[]>([]);
  const [selectedHotHoagieSides, setSelectedHotHoagieSides] = useState<string[]>([]);
  const [selectedHotHoagieInstructions, setSelectedHotHoagieInstructions] = useState<string[]>([]);
  const [selectedGrilledChickenNoToppings, setSelectedGrilledChickenNoToppings] = useState<string[]>([]);
  const [selectedSausagePeppersOnionsNoToppings, setSelectedSausagePeppersOnionsNoToppings] = useState<string[]>([]);
  const [selectedCheeseBurgerDeluxeNoToppings, setSelectedCheeseBurgerDeluxeNoToppings] = useState<string[]>([]);
  const [selectedBriocheGrilledChickenNoToppings, setSelectedBriocheGrilledChickenNoToppings] = useState<string[]>([]);
  const [selectedHotHoagieCheese, setSelectedHotHoagieCheese] = useState<string>(
    product.name === 'Chicken Parm Sandwich' ? 'hh-cheese2' : 
    product.name === 'Eggplant Parm Sandwich' ? 'hh-cheese2' : 
    product.name === 'Meatball Parm Sandwich' ? 'hh-cheese2' : 
    product.name === 'Sausage Parm Sandwich' ? 'hh-cheese2' : 
    product.name === 'Sausage, Peppers & Onions' ? '' : // No preselection, but required
    product.name === 'Grilled Chicken Hoagie' ? '' : // No preselection
    '' // No default cheese for hot hoagies
  );
  const [hotHoagieCheeseError, setHotHoagieCheeseError] = useState(false);
  const hotHoagieCheeseRef = useRef<HTMLDivElement>(null);
  
  // Grilled Chicken Hoagie Side Toppings (Required) states
  const [selectedGrilledChickenSideToppingsRequired, setSelectedGrilledChickenSideToppingsRequired] = useState<string[]>([]);
  const [grilledChickenSideToppingsRequiredError, setGrilledChickenSideToppingsRequiredError] = useState(false);
  const grilledChickenSideToppingsRequiredRef = useRef<HTMLDivElement>(null);
  
  // Cheesesteak Side Toppings (Required) states for Chicken Cheesesteak Hoagie and Cheesesteak Hoagie
  const [selectedCheesesteakSideToppingsRequired, setSelectedCheesesteakSideToppingsRequired] = useState<string[]>([]);
  const [cheesesteakSideToppingsRequiredError, setCheesesteakSideToppingsRequiredError] = useState(false);
  const cheesesteakSideToppingsRequiredRef = useRef<HTMLDivElement>(null);
  
  // Traditional Dinners states
  const [selectedTraditionalDinnersSides, setSelectedTraditionalDinnersSides] = useState<string[]>([]);
  const [selectedTraditionalDinnersSoupsSalads, setSelectedTraditionalDinnersSoupsSalads] = useState<string[]>([]);
  const [extraBreadQuantity, setExtraBreadQuantity] = useState<number>(0);
  const [sideGardenSaladRemovedIngredients, setSideGardenSaladRemovedIngredients] = useState<string[]>([]);
  const [sideCaesarSaladRemovedIngredients, setSideCaesarSaladRemovedIngredients] = useState<string[]>([]);
  const [showSoupDialog, setShowSoupDialog] = useState<boolean>(false);
  const [showCallUsDialog, setShowCallUsDialog] = useState<boolean>(false);
  const [showBuildPastaSoupDialog, setShowBuildPastaSoupDialog] = useState<boolean>(false);
  const [traditionalDinnersSidesError, setTraditionalDinnersSidesError] = useState(false);
  const traditionalDinnersSidesRef = useRef<HTMLDivElement>(null);
  
  // Scroll to toast option when error is shown
  useEffect(() => {
    if (toastOptionError && toastOptionRef.current) {
      toastOptionRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [toastOptionError]);
  
  // Scroll to hot hoagie cheese option when error is shown
  useEffect(() => {
    if (hotHoagieCheeseError && hotHoagieCheeseRef.current) {
      hotHoagieCheeseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [hotHoagieCheeseError]);
  

  

  
  // Scroll to traditional dinners sides when error is shown
  useEffect(() => {
    if (traditionalDinnersSidesError && traditionalDinnersSidesRef.current) {
      traditionalDinnersSidesRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [traditionalDinnersSidesError]);
  
  // Reset traditional dinners error when exactly 2 sides are selected
  useEffect(() => {
    if (selectedTraditionalDinnersSides.length === 2 && traditionalDinnersSidesError) {
      setTraditionalDinnersSidesError(false);
    }
  }, [selectedTraditionalDinnersSides, traditionalDinnersSidesError]);
  
  // Auto-open collapsible when there's a traditional dinners sides error (for fish)
  useEffect(() => {
    if (traditionalDinnersSidesError && (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) {
      setIsAdditionalOpen(true);
    }
  }, [traditionalDinnersSidesError, product.category, product.id]);
  
  // RESTORE ALL SELECTIONS FROM EDITING CART ITEM
  useEffect(() => {
    if (isEditMode && editingCartItem) {
      // Restore quantity
      setQuantity(editingCartItem.quantity);

      const isCheesesteakProduct = (product.category || '').toLowerCase().includes('cheesesteak');
      if (isCheesesteakProduct) {
        const editSelections = Array.isArray(editingCartItem.selections) ? editingCartItem.selections : [];
        const uniqueIds = (ids: string[]) => Array.from(new Set(ids.filter(Boolean)));

        const toastIds = new Set(['toast', 'no-toast']);
        const cheeseIds = new Set((cheeseOptions || []).map((x: any) => String(x.id)));
        const baseToppingsIds = new Set([
          ...(createYourOwnCheesesteakToppings || []).map((x: any) => String(x.id)),
          ...(cheesesteakToppings || []).map((x: any) => String(x.id)),
        ]);
        const addToppingsIds = new Set((addToppingItems || []).map((x: any) => String(x.id)));
        const extraToppingsIds = new Set((extraToppings || []).map((x: any) => String(x.id)));
        const liteToppingsIds = new Set([
          ...(liteToppings || []).map((x: any) => String(x.id)),
          ...(liteToppingItems || []).map((x: any) => String(x.id)),
        ]);
        const noToppingsIds = new Set([
          ...(cheesesteakNoToppings || []).map((x: any) => String(x.id)),
          ...(noToppingItems || []).map((x: any) => String(x.id)),
        ]);
        const sideToppingsIds = new Set((sideToppingItems || []).map((x: any) => String(x.id)));
        const requiredSideToppingsIds = new Set((cheesesteakSideToppingsRequired || []).map((x: any) => String(x.id)));
        const extraSidesIds = new Set((extraSidesItems || []).map((x: any) => String(x.id)));
        const dessertIdsSet = new Set((dessertItems || []).map((x: any) => String(x.id)));
        const beverageIdsSet = new Set((beverageItems || []).map((x: any) => String(x.id)));

        const collect = (predicate: (sel: any) => boolean): string[] =>
          uniqueIds(
            editSelections
              .filter((sel: any) => predicate(sel))
              .map((sel: any) => String(sel?.id || '').trim())
          );

        const toastId =
          editSelections.find((sel: any) => {
            const id = String(sel?.id || '').trim();
            const gt = String(sel?.groupTitle || '').toLowerCase();
            return toastIds.has(id) || gt.includes('toast option');
          })?.id || null;

        const cheeseId =
          editSelections.find((sel: any) => {
            const id = String(sel?.id || '').trim();
            const gt = String(sel?.groupTitle || '').toLowerCase();
            const typ = String(sel?.type || '').toLowerCase();
            return cheeseIds.has(id) || gt === 'cheese' || typ === 'cheese';
          })?.id || '';

        const toppingsFromSection = collect((sel: any) => String(sel?.groupTitle || '').trim() === 'Toppings');
        const extraFromSection = collect((sel: any) => String(sel?.groupTitle || '').trim() === 'Extra Toppings');
        const liteFromSection = collect((sel: any) => String(sel?.groupTitle || '').trim() === 'Lite Toppings');
        const noFromSection = collect((sel: any) => String(sel?.groupTitle || '').trim() === 'No Toppings');
        const sideFromSection = collect((sel: any) => String(sel?.groupTitle || '').trim() === 'Side Toppings');
        const extraSidesFromSection = collect((sel: any) => String(sel?.groupTitle || '').toLowerCase().includes('add extra sides'));

        const selectedToppingsIds = uniqueIds([
          ...toppingsFromSection.filter((id) => baseToppingsIds.has(id) || extraToppingsIds.has(id) || liteToppingsIds.has(id) || noToppingsIds.has(id)),
          ...extraFromSection.filter((id) => extraToppingsIds.has(id)),
          ...liteFromSection.filter((id) => (liteToppings || []).some((x: any) => String(x.id) === id)),
          ...noFromSection.filter((id) => (cheesesteakNoToppings || []).some((x: any) => String(x.id) === id)),
        ]);

        const selectedAddToppingsIds = uniqueIds([
          ...extraFromSection.filter((id) => addToppingsIds.has(id)),
          ...toppingsFromSection.filter((id) => addToppingsIds.has(id)),
        ]);

        const selectedLiteToppingsIds = uniqueIds(liteFromSection.filter((id) => (liteToppingItems || []).some((x: any) => String(x.id) === id)));
        const selectedNoToppingsIds = uniqueIds(noFromSection.filter((id) => (noToppingItems || []).some((x: any) => String(x.id) === id)));

        const selectedRequiredSideIds = uniqueIds(
          sideFromSection.filter((id) => requiredSideToppingsIds.has(id))
        );
        const selectedRegularSideIds = uniqueIds(
          sideFromSection.filter((id) => sideToppingsIds.has(id))
        );
        const selectedExtraSideIds = uniqueIds(
          extraSidesFromSection.filter((id) => extraSidesIds.has(id))
        );

        const dessertCounts: Record<string, number> = {};
        editSelections.forEach((sel: any) => {
          const id = String(sel?.id || '').trim();
          const gt = String(sel?.groupTitle || '').toLowerCase();
          if (!id) return;
          if (gt === 'dessert' || gt === 'desserts' || dessertIdsSet.has(id)) {
            dessertCounts[id] = (dessertCounts[id] || 0) + 1;
          }
        });

        const beverageCounts: Record<string, number> = {};
        editSelections.forEach((sel: any) => {
          const id = String(sel?.id || '').trim();
          const gt = String(sel?.groupTitle || '').toLowerCase();
          if (!id) return;
          if (gt === 'beverage' || gt === 'beverages' || beverageIdsSet.has(id)) {
            beverageCounts[id] = (beverageCounts[id] || 0) + 1;
          }
        });

        setToastRoll(toastId === 'toast' || toastId === 'no-toast' ? (toastId as 'toast' | 'no-toast') : null);
        setSelectedCheese(String(cheeseId || ''));
        setSelectedToppings(selectedToppingsIds);
        setSelectedAddToppings(selectedAddToppingsIds);
        setSelectedLiteToppings(selectedLiteToppingsIds);
        setSelectedNoToppingsCheesesteak(selectedNoToppingsIds);
        setSelectedSideToppings(selectedRegularSideIds);
        setSelectedCheesesteakSideToppingsRequired(selectedRequiredSideIds);
        setSelectedExtraSides(selectedExtraSideIds);
        setSelectedDesserts(dessertCounts);
        setSelectedBeverages(beverageCounts);

        // Cheesesteaks use strict section-based mapping; avoid generic restoration that mixes categories.
        return;
      }
      
      // Helper function to extract IDs from customization items by matching names
      const findIdsByNames = (names: string[], possibleLists: any[][]): string[] => {
        const ids: string[] = [];
        names.forEach(name => {
          for (const list of possibleLists) {
            const item = list.find(t => t.name === name || name.includes(t.name));
            if (item) {
              ids.push(item.id);
              break;
            }
          }
        });
        return ids;
      };
      
      // Restore customizations
      if (editingCartItem.customizations) {
        editingCartItem.customizations.forEach(custom => {
          const category = custom.category;
          const items = custom.items;
          
          // Restore based on category
          switch (category) {
            case 'Side Soups, Salads, & Extra Bread':
               // Parse traditional dinners salads/bread
               if (product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) {
                 items.forEach(itemStr => {
                    // 1. Extra Bread xN
                    const breadMatch = itemStr.match(/Extra Bread x(\d+)/i);
                    if (breadMatch) {
                       setExtraBreadQuantity(parseInt(breadMatch[1], 10));
                    } else if (itemStr.toLowerCase().trim() === 'extra bread') {
                       setExtraBreadQuantity(1);
                    }
                    
                    // 2. Salads with removals: "Side Garden Salad (No Tomatoes, No Onions)"
                    // Regex: Name (No ...)
                    const saladMatch = itemStr.match(/^(.*?)\s*\((.*?)\)$/);
                    if (saladMatch) {
                       const saladName = saladMatch[1].trim();
                       const removalsStr = saladMatch[2]; // "No Tomatoes, No Onions"
                       
                       // Parse removals into ["Tomatoes", "Onions"]
                       const removalNames = removalsStr.split(',')
                           .map(s => s.trim())
                           .filter(s => s.toLowerCase().startsWith('no '))
                           .map(s => s.substring(3).trim()); // Remove "No " prefix
                       
                       // We need to map these Names back to IDs to populate state
                       // Since we don't have an easy ID lookup here without traversing all data, 
                       // and the state uses IDs... we have to find them.
                       // Fortunately, we can check traditionalDinnersSoupsSalads options.
                       
                       let saladId = '';
                       if (saladName === 'Side Garden Salad') saladId = 'td-extra2';
                       else if (saladName === 'Side Caesar Salad') saladId = 'td-extra3';
                       
                       if (saladId) {
                          const saladOption = traditionalDinnersSoupsSalads.find(o => o.id === saladId);
                          if (saladOption && saladOption.removableIngredients) {
                             const idsToRestore: string[] = [];
                             removalNames.forEach(rName => {
                                const found = saladOption.removableIngredients?.find(ri => ri.name.toLowerCase() === rName.toLowerCase());
                                if (found) idsToRestore.push(found.id);
                             });
                             
                             if (saladName === 'Side Garden Salad') {
                                setSideGardenSaladRemovedIngredients(prev => [...new Set([...prev, ...idsToRestore])]);
                             } else {
                                setSideCaesarSaladRemovedIngredients(prev => [...new Set([...prev, ...idsToRestore])]);
                             }

                             // Debug Log
                             console.log('[TD_EDIT_PARSE_SALAD]', { 
                                raw: itemStr, 
                                salad: saladName, 
                                removals: removalNames,
                                restoredIds: idsToRestore 
                             });
                          }
                       }
                    }
                 });
               }
               break;

            case 'Size':
              // Extract size from format like "Medium (14")"
              if (items[0]?.includes('Medium')) setSelectedSize('medium');
              else if (items[0]?.includes('Large')) setSelectedSize('large');
              else if (items[0]?.includes('Jumbo')) setSelectedSize('jumbo');
              else if (items[0]?.toLowerCase().includes('16oz')) setSelectedSize('medium');
              else if (items[0]?.toLowerCase().includes('32oz')) setSelectedSize('large');
              break;
            
            case 'Toppings':
              const toppingIds = findIdsByNames(items, [includedToppings, additionalToppings, specialtyToppings]);
              setSelectedToppings(prev => [...new Set([...prev, ...toppingIds])]);
              toppingIds.forEach(id => {
                setToppingDistribution(prev => ({ ...prev, [id]: 'whole' }));
              });
              break;
            
            case 'Half Toppings':
              items.forEach(item => {
                const isLeft = item.includes('(Left)');
                const isRight = item.includes('(Right)');
                const cleanName = item.replace(' (Left)', '').replace(' (Right)', '');
                const toppingIds = findIdsByNames([cleanName], [includedToppings, additionalToppings, specialtyToppings]);
                if (toppingIds[0]) {
                  setSelectedToppings(prev => [...new Set([...prev, toppingIds[0]])]);
                  setToppingDistribution(prev => ({ ...prev, [toppingIds[0]]: isLeft ? 'left' : 'right' }));
                }
              });
              break;
            
            case 'Special Instructions':
              const instructionIds = findIdsByNames(items, [bakedPastaSpecialInstructions, fishSpecialInstructions, specialInstructionsBrooklyn, wingsSpecialInstructionsOptions]);
              setSelectedSpecialInstructions(prev => [...new Set([...prev, ...instructionIds])]);
              
              // Also check for Wings Special Instructions
              const wingsInstructionIds = findIdsByNames(items, [wingsSpecialInstructionsOptions]);
              if (wingsInstructionIds.length > 0) {
                setSelectedWingsSpecialInstructions(wingsInstructionIds);
              }
              break;
            
            case 'Add Toppings':
              const addIds = findIdsByNames(items, [burgerAddToppings, coldHoagieAddToppings]);
              setSelectedAddToppings(prev => [...new Set([...prev, ...addIds])]);
              break;
            
            case 'Lite Toppings':
            case 'Lite':
              const liteIds = findIdsByNames(items, [liteToppings, burgerLiteToppings, coldHoagieLiteToppings]);
              setSelectedLiteToppings(prev => [...new Set([...prev, ...liteIds])]);
              break;
            
            case 'No Toppings':
              const noIds = findIdsByNames(items, [noToppings, cheesesteakNoToppings]);
              setSelectedNoToppings(prev => [...new Set([...prev, ...noIds])]);
              break;
            
            case 'Extra Sauce':
              const sauceIds = findIdsByNames(items, [pastaVegetables, pastaProteins, pastaCheesesExtras]);
              setSelectedExtraSauce(prev => [...new Set([...prev, ...sauceIds])]);
              break;
            
            case 'Side Toppings':
            case 'Sides':
              const sideIds = findIdsByNames(items, [burgerSideToppings, coldHoagieSideToppings, hotHoagieSides]);
              setSelectedSideToppings(prev => [...new Set([...prev, ...sideIds])]);
              break;
            
            case 'Cheese':
              const cheeseIds = findIdsByNames(items, [cheeseOptions]);
              if (cheeseIds[0]) setSelectedCheese(cheeseIds[0]);
              break;
            
            case 'Desserts':
              const dessertIds = items.map(name => {
                // Parse "Name xN" or just "Name"
                const match = name.match(/^(.*?)\s+x(\d+)$/i);
                const cleanName = match ? match[1] : name;
                const qty = match ? parseInt(match[2], 10) : 1;
                
                const dessert = dessertItems.find(d => d.name === cleanName) || 
                               wholeCakesItems.find(c => c.name === cleanName) ||
                               partyCakesItems.find(c => c.name === cleanName) ||
                               allProducts.find(p => p.name === cleanName);
                
                return dessert ? { id: dessert.id, qty } : null;
              }).filter(Boolean) as { id: string; qty: number }[];
              
              const dessertRecord: Record<string, number> = {};
              dessertIds.forEach(({ id, qty }) => {
                dessertRecord[id] = (dessertRecord[id] || 0) + qty;
              });
              setSelectedDesserts(dessertRecord);
              break;
            
            case 'Beverages':
              const beverageIds = items.map(name => {
                // Parse "Name xN" or just "Name"
                const match = name.match(/^(.*?)\s+x(\d+)$/i);
                const cleanName = match ? match[1] : name;
                const qty = match ? parseInt(match[2], 10) : 1;

                // First check beverageItems (local definition)
                let beverage = beverageItems.find(b => b.name === cleanName);
                // Fallback to allProducts
                if (!beverage) {
                   const product = allProducts.find(p => p.name === cleanName);
                   if (product) beverage = { id: product.id, name: product.name } as any;
                }
                
                return beverage ? { id: beverage.id, qty } : null;
              }).filter(Boolean) as { id: string; qty: number }[];
              
              const beverageRecord: Record<string, number> = {};
              beverageIds.forEach(({ id, qty }) => {
                beverageRecord[id] = (beverageRecord[id] || 0) + qty;
              });
              setSelectedBeverages(beverageRecord);
              break;
            
            case 'Pasta Type':
              const pastaTypeIds = findIdsByNames(items, [pastaTypes, babyClamPastaTypes, calamariPastaTypes, musselsPastaTypes, seafoodComboPastaTypes, shrimpMarinaraPastaTypes]);
              if (pastaTypeIds[0]) setSelectedPastaType(pastaTypeIds[0]);
              break;
            
            case 'Sauce':
              const sauceChoiceIds = findIdsByNames(items, [babyClamSauceChoices, musselsSauceChoices, seafoodComboSauceChoices]);
              if (sauceChoiceIds[0]) setSelectedBabyClamSauceChoice(sauceChoiceIds[0]);
              break;
            
            case 'Pasta Additions':
              const additionIds = findIdsByNames(items, [pastaAdditions]);
              setSelectedPastaAdditions(additionIds);
              break;
            
            case 'Extras':
              const extraIds = findIdsByNames(items, [hotHoagieExtraToppings, coldHoagieExtraToppings]);
              setSelectedHotHoagieExtras(prev => [...new Set([...prev, ...extraIds])]);
              break;
            
            case 'Soups & Salads':
              const soupSaladIds = findIdsByNames(items, [traditionalDinnersSoupsSalads]);
              setSelectedTraditionalDinnersSoupsSalads(soupSaladIds);
              break;
            
            case 'Salad Base':
              const baseIds = findIdsByNames(items, [antipastoSaladBases]);
              if (baseIds[0]) setSelectedSaladBase(baseIds[0]);
              break;
            
            case 'Dressing':
              const dressingIds = findIdsByNames(items, [antipastoSaladDressings]);
              if (dressingIds[0]) setSelectedSaladDressing(dressingIds[0]);
              break;
          }
        });
      }
    }
  }, [isEditMode, editingCartItem, allProducts]);

  // Reset cross-product add-on state when opening a new product in non-edit mode.
  // Without this, dessert/beverage quantities can leak between products (e.g. showing x3 unexpectedly).
  useEffect(() => {
    if (isEditMode) return;
    setSelectedDesserts({});
    setSelectedBeverages({});
    setActiveDessertItem(null);
    setActiveBeverageItem(null);
  }, [product.id, isEditMode]);

  // Soups should default to 16oz when opening product in non-edit mode.
  useEffect(() => {
    if (isEditMode) return;
    if (product.category === 'soups') {
      setSelectedSize('medium');
    }
  }, [product.id, product.category, isEditMode]);
  
  // Pre-select Mozzarella cheese for Pizza Steak
  useEffect(() => {
    if (product.name === 'Pizza Steak' && !isEditMode) {
      setSelectedCheese('cheese4'); // cheese4 is Mozzarella
    }
  }, [product.name, isEditMode]);
  
  // Pre-select Provolone cheese for Grilled Chicken Panini and Grilled Veggie Panini
  // Pre-select Mozzarella cheese for Prosciutto Mozzarella Panini
  useEffect(() => {
    if (!isEditMode) {
      if (product.name === 'Grilled Chicken Panini' || product.name === 'Grilled Veggie Panini') {
        setSelectedPaniniCheese('pn-cheese6'); // pn-cheese6 is Provolone
      }
      if (product.name === 'Prosciutto Mozzarella Panini') {
        setSelectedPaniniCheese('pn-cheese2'); // pn-cheese2 is Mozzarella
      }
    }
  }, [product.name, isEditMode]);
  
  // Clear Extra Cheese and Lite Cheese for Sausage, Peppers & Onions and Grilled Chicken Hoagie when no cheese is selected
  useEffect(() => {
    if (product.name === 'Sausage, Peppers & Onions' || product.name === 'Grilled Chicken Hoagie') {
      const hasCheeseSelected = selectedHotHoagieCheese && selectedHotHoagieCheese !== 'hh-cheese7';
      if (!hasCheeseSelected) {
        // Remove Extra Cheese (hh-extra2) from extras
        setSelectedHotHoagieExtras(prev => prev.filter(id => id !== 'hh-extra2'));
        // Remove Lite Cheese (hh-si3) from instructions
        setSelectedHotHoagieInstructions(prev => prev.filter(id => id !== 'hh-si3'));
      }
    }
  }, [product.name, selectedHotHoagieCheese]);
  
  // Clear Extra Cheese and Lite Cheese for cheesesteaks when "No Cheese" (cheese5) is selected
  useEffect(() => {
    if (selectedCheese === 'cheese5') {
      // Remove Extra Cheese (ext1) and Lite Cheese (lite2) from selectedToppings
      setSelectedToppings(prev => prev.filter(id => id !== 'ext1' && id !== 'lite2'));
      // Remove their distributions
      setToppingDistribution(dist => {
        const newDist = { ...dist };
        delete newDist['ext1'];
        delete newDist['lite2'];
        return newDist;
      });
    }
  }, [selectedCheese]);

  // Clean Specialty Toppings State when on Specialty Pizza
  // Ensures no "1st Half" / "2nd Half" toppings persist in state for these pizzas
  useEffect(() => {
    if (product.category === 'specialty-pizza' || (product.id && product.id.startsWith('sp-'))) {
      const specialtyIds = [
        ...specialtyToppings.map(t => t.id), 
        ...specialtyToppingsSecondHalf.map(t => t.id)
      ];
      
      setSelectedToppings(prev => {
        const hasSpecialty = prev.some(id => specialtyIds.includes(id));
        if (!hasSpecialty) return prev;
        return prev.filter(id => !specialtyIds.includes(id));
      });
      
      setToppingDistribution(dist => {
        const newDist = { ...dist };
        let changed = false;
        specialtyIds.forEach(id => {
          if (newDist[id]) {
            delete newDist[id];
            changed = true;
          }
        });
        return changed ? newDist : dist;
      });
    }
  }, [product.category, product.id]);
  
  // Minucci type state
  const [selectedMinucciType, setSelectedMinucciType] = useState<'1-topping' | '2-4-toppings'>('1-topping');

  // Pizza Sauce states
  const [isSauceOpen, setIsSauceOpen] = useState(true);
  const [selectedSauces, setSelectedSauces] = useState<string[]>(['sauce-pizza']); // Preselect Pizza Sauce
  const [sauceDistribution, setSauceDistribution] = useState<Record<string, 'left' | 'right' | 'whole'>>({ 'sauce-pizza': 'whole' });
  const [sauceError, setSauceError] = useState(false);
  const sauceErrorRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (sauceError && sauceErrorRef.current) {
      sauceErrorRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [sauceError]);

  // Pizza Sauce Options
  const isSpecialtySaucePizza = product.category === 'specialty-pizza' && ['sp-10', 'sp-12', 'sp-15'].includes(product.id);

  const sauceOptions = useMemo(() => {
    if (isSpecialtySaucePizza) {
      return [
        { id: 'sauce-pizza', name: 'Red Sauce', price: 0, image: 'https://images.unsplash.com/photo-1610913729746-9d5d752daf59?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwaXp6YSUyMHNhdWNlfGVufDF8fHx8MTc2OTgwNzM2OHww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
        { id: 'sauce-white', name: 'White Sauce', price: 0, image: 'https://images.unsplash.com/photo-1593560708920-63984d8d606e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=200' }
      ];
    }
    return [
      { id: 'sauce-pizza', name: 'Red Sauce', price: 0, image: 'https://images.unsplash.com/photo-1610913729746-9d5d752daf59?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwaXp6YSUyMHNhdWNlfGVufDF8fHx8MTc2OTgwNzM2OHww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' }
    ];
  }, [isSpecialtySaucePizza]);

  const handleSauceToggle = (sauceId: string) => {
    setSauceError(false);
    setSelectedSauces(prev => {
      // Logic for specialty pizzas (required selection, mutually exclusive)
      if (isSpecialtySaucePizza) {
        // Since it's radio-like, selecting one selects it and deselects others.
        // If clicking the already selected one, we keep it (it's required, so can't deselect to empty unless we allow that and validate later, 
        // but typically radio buttons don't deselect on click). 
        // Let's simple set to just this ID.
        setSauceDistribution(prevDist => {
            const newDist = { ...prevDist };
            // Clear other distributions if any (though we hide icons, state might linger)
            // Ideally we just set this one to whole.
            return { [sauceId]: 'whole' }; // Reset to just this one whole
        });
        return [sauceId];
      }

      const isSelected = prev.includes(sauceId);
      if (isSelected) {
        // Deselecting
        const newSelection = prev.filter(id => id !== sauceId);
        const newDist = { ...sauceDistribution };
        delete newDist[sauceId];
        setSauceDistribution(newDist);
        return newSelection;
      } else {
        // Selecting
        setSauceDistribution(prevDist => ({ ...prevDist, [sauceId]: 'whole' }));
        return [...prev, sauceId];
      }
    });
  };

  // Pre-select Red Sauce for these specialty pizzas if nothing selected yet?
  // User said "Required", but usually that implies user must choose.
  // However, existing logic preselects 'sauce-pizza' (Red Sauce).
  // If 'sauce-pizza' is Red Sauce, it's already pre-selected.
  // So validation might pass by default unless user unselects it (if possible).
  // But wait, my handleSauceToggle for specialty prevents empty selection effectively if they click one.
  // The initial state is `['sauce-pizza']`. So Red Sauce is default.
  // Is that desired? Usually yes. "Red or White" implies a choice, often defaulting to Red.
  // If I want to force an active choice, I should start with empty array for these.
  
  useEffect(() => {
    if (isSpecialtySaucePizza) {
       // Force explicit choice by clearing default selection initially
       // We only want to do this once on mount/product change, not on every render
       // But this effect runs when isSpecialtySaucePizza changes (e.g. product changes)
       // We should check if we already cleared it or if it's the default 'sauce-pizza'.
       // But wait, if they select Red Sauce, it matches default.
       // We can just clear it unconditionally on mount of this product state.
       setSelectedSauces([]); 
       setSauceDistribution({});
    }
  }, [isSpecialtySaucePizza]);

  const handleSauceDistributionChange = (sauceId: string, type: 'left' | 'right' | 'whole') => {
      setSauceDistribution(prev => ({ ...prev, [sauceId]: type }));
      if (!selectedSauces.includes(sauceId)) {
          setSelectedSauces(prev => [...prev, sauceId]);
      }
  };
  
  // Catering Pasta with Sauce states (cp7-cp11)
  const [selectedPastaType, setSelectedPastaType] = useState<string>('');
  const [selectedPastaAdditions, setSelectedPastaAdditions] = useState<string[]>([]);
  const [cateringPastaTypeError, setCateringPastaTypeError] = useState(false);
  const cateringPastaTypeRef = useRef<HTMLDivElement>(null);

  // Cold Hoagies states
  const [selectedColdHoagieCheese, setSelectedColdHoagieCheese] = useState<string>('');
  const [coldHoagieCheeseError, setColdHoagieCheeseError] = useState(false);
  const coldHoagieCheeseRef = useRef<HTMLDivElement>(null);
  const [selectedColdHoagieSideToppingsRequired, setSelectedColdHoagieSideToppingsRequired] = useState<string[]>([]);
  const [coldHoagieSideToppingsRequiredError, setColdHoagieSideToppingsRequiredError] = useState(false);
  const coldHoagieSideToppingsRequiredRef = useRef<HTMLDivElement>(null);
  const [selectedColdHoagieToppings, setSelectedColdHoagieToppings] = useState<string[]>([]);
  const [selectedColdHoagieExtras, setSelectedColdHoagieExtras] = useState<string[]>([]);
  const [selectedColdHoagieLite, setSelectedColdHoagieLite] = useState<string[]>([]);
  const [selectedColdHoagieNo, setSelectedColdHoagieNo] = useState<string[]>([]);
  const [selectedColdHoagieSides, setSelectedColdHoagieSides] = useState<string[]>([]);
  const [selectedColdHoagieExtraSides, setSelectedColdHoagieExtraSides] = useState<string[]>([]);
  const [chipsQuantity, setChipsQuantity] = useState<number>(0);

  // Cold Hoagies: Clear Extra Cheese and Lite Cheese when No Cheese is selected
  useEffect(() => {
    if (product.category === 'cold-hoagies' && selectedColdHoagieCheese === 'ch-cheese7') {
      // Clear Extra Cheese (ch-extra3) and Lite Cheese (ch-lite1)
      setSelectedColdHoagieExtras(prev => prev.filter(id => id !== 'ch-extra3'));
      setSelectedColdHoagieLite(prev => prev.filter(id => id !== 'ch-lite1'));
    }
  }, [selectedColdHoagieCheese, product.category]);

  // Burger states
  const [selectedBurgerAdd, setSelectedBurgerAdd] = useState<string[]>([]);
  const [selectedBurgerExtra, setSelectedBurgerExtra] = useState<string[]>([]);
  
  // Chicken Tenders state
  const [selectedChickenTendersQuantity, setSelectedChickenTendersQuantity] = useState<string>('4pcs');
  const [selectedChickenTendersSauce, setSelectedChickenTendersSauce] = useState<string>('');
  const [selectedChickenTendersSpecialInstructions, setSelectedChickenTendersSpecialInstructions] = useState<string[]>([]);
  const [selectedChickenTendersExtraSauce, setSelectedChickenTendersExtraSauce] = useState<Record<string, string>>({});
  const [selectedChickenTendersExtraCheeseRanch, setSelectedChickenTendersExtraCheeseRanch] = useState<Record<string, string>>({});
  const [chickenTendersSauceError, setChickenTendersSauceError] = useState(false);
  const chickenTendersSauceRef = useRef<HTMLDivElement>(null);
  const [chickenTendersSpecialInstructionsError, setChickenTendersSpecialInstructionsError] = useState(false);
  const chickenTendersSpecialInstructionsRef = useRef<HTMLDivElement>(null);
  const [selectedSubstituteSauce, setSelectedSubstituteSauce] = useState<string>('');
  
  // Mozzarella Sticks state (app4 and wing4 - uses same structure as Chicken Tenders)
  const [selectedMozzarellaSticksSpecialInstructions, setSelectedMozzarellaSticksSpecialInstructions] = useState<string[]>([]);
  
  // Arancini Rice Ball state (Catering - capp4)
  const [selectedAranciniQuantity, setSelectedAranciniQuantity] = useState<string>('10pcs');
  const [selectedAranciniInstructions, setSelectedAranciniInstructions] = useState<string[]>([]);
  
  // Arancini Rice Ball Regular Menu state (app8)
  const [selectedAranciniRegularQuantity, setSelectedAranciniRegularQuantity] = useState<string>('1pc');
  const [selectedAranciniRegularInstructions, setSelectedAranciniRegularInstructions] = useState<string[]>([]);
  
  // French Fries state
  const [selectedFriesInstructions, setSelectedFriesInstructions] = useState<string[]>([]);
  
  // Garlic Stick state
  const [selectedGarlicStickInstructions, setSelectedGarlicStickInstructions] = useState<string[]>([]);
  
  // Garlic Bread state
  const [selectedGarlicBreadInstructions, setSelectedGarlicBreadInstructions] = useState<string[]>([]);
  
  // Garlic Bread with Mozzarella state
  const [selectedGarlicBreadMozzarellaInstructions, setSelectedGarlicBreadMozzarellaInstructions] = useState<string[]>([]);
  
  // Mozzarella Sticks state
  const [selectedMozzarellaSticksQuantity, setSelectedMozzarellaSticksQuantity] = useState<string>('6pcs');
  const [selectedMozzarellaSticksInstructions, setSelectedMozzarellaSticksInstructions] = useState<string[]>([]);
  
  // Helper function to get dynamic Mozzarella Sticks description
  const getMozzarellaSticksDescription = () => {
    if (product.id !== 'app4' && product.id !== 'wing4' && product.id !== 'capp3') {
      return product.description;
    }
    
    let sauceSize = '4oz';
    if (selectedMozzarellaSticksQuantity === '12pcs') {
      sauceSize = '8oz';
    } else if (selectedMozzarellaSticksQuantity === '24pcs') {
      sauceSize = '16oz';
    } else if (selectedMozzarellaSticksQuantity === '48pcs') {
      sauceSize = '32oz';
    }
    
    return `Creamy mozzarella breaded, deep fried, served with a side of <span class="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">(${sauceSize})</span> Pomodoro sauce.`;
  };
  
  // Helper function to get dynamic Chicken Tenders description
  const getChickenTendersDescription = () => {
    if (product.id !== 'wing3' && product.id !== 'app6' && product.id !== 'capp2') {
      return product.description;
    }
    
    let sauceSize = '2oz';
    if (selectedChickenTendersQuantity === '4pcs') {
      sauceSize = '2oz';
    } else if (selectedChickenTendersQuantity === '8pcs') {
      sauceSize = '4oz';
    } else if (selectedChickenTendersQuantity === '16pcs') {
      sauceSize = '8oz';
    } else if (selectedChickenTendersQuantity === '32pcs') {
      sauceSize = '16oz';
    } else if (selectedChickenTendersQuantity === '64pcs') {
      sauceSize = '32oz';
    }
    
    return (
      <span>
        Crispy breaded tenders served with french fries and <span className="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">({sauceSize})</span> Honey Mustard.
      </span>
    );
  };
  
  // Helper function to get dynamic Arancini Rice Ball description
  const getAranciniRiceBallDescription = () => {
    if (product.id !== 'app8' && product.id !== 'capp4') {
      return product.description;
    }
    
    let sauceSize = '4oz';
    
    // For catering arancini (capp4)
    if (product.id === 'capp4') {
      if (selectedAranciniQuantity === '10pcs') {
        sauceSize = '4oz';
      } else if (selectedAranciniQuantity === '20pcs') {
        sauceSize = '8oz';
      } else if (selectedAranciniQuantity === '30pcs') {
        sauceSize = '16oz';
      } else if (selectedAranciniQuantity === '50pcs') {
        sauceSize = '32oz';
      }
    } 
    // For regular arancini (app8)
    else {
      // Calculate sauce size: 1pc = 4oz, others = quantity * 4oz
      const quantity = parseInt(selectedAranciniRegularQuantity.replace(/[^0-9]/g, ''));
      if (!isNaN(quantity)) {
        sauceSize = `${quantity * 4}oz`;
      }
    }
    
    return `Rice, ground beef, mozzarella and peas, served with a side of <span class="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">${sauceSize}</span> Pomodoro sauce.`;
  };
  
  // Helper function to get dynamic Wings description
  const getWingsDescription = () => {
    // Check if this is a wings product (app18 uses selectedWingsQuantity, others use selectedSize)
    const isWingsProduct = product.id === 'app18' || 
                          (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') || 
                          (product.category === 'catering-appetizers' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4');
    
    if (!isWingsProduct) {
      return product.description;
    }
    
    let bleuCheeseSize = '2oz';
    let sauceSize = '4oz';
    
    // For app18, use selectedWingsQuantity (format: '10pcs', '20pcs', etc.)
    if (product.id === 'app18') {
      if (selectedWingsQuantity === '10pcs') {
        bleuCheeseSize = '2oz';
        sauceSize = '4oz';
      } else if (selectedWingsQuantity === '20pcs') {
        bleuCheeseSize = '4oz';
        sauceSize = '8oz';
      } else if (selectedWingsQuantity === '30pcs') {
        bleuCheeseSize = '8oz';
        sauceSize = '16oz';
      } else if (selectedWingsQuantity === '50pcs') {
        bleuCheeseSize = '16oz';
        sauceSize = '32oz';
      }
    } else {
      // For wings category and catering-appetizers, use selectedSize (format: '10', '20', etc.)
      if (selectedSize === '10') {
        bleuCheeseSize = '2oz';
        sauceSize = '4oz';
      } else if (selectedSize === '20') {
        bleuCheeseSize = '4oz';
        sauceSize = '8oz';
      } else if (selectedSize === '30') {
        bleuCheeseSize = '8oz';
        sauceSize = '16oz';
      } else if (selectedSize === '50') {
        bleuCheeseSize = '16oz';
        sauceSize = '32oz';
      }
    }
    
    return (
      <span>
        Breaded with seasoned flour. Served with celery, <span className="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">{bleuCheeseSize}</span> bleu cheese and <span className="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">{sauceSize}</span> Sauce.
      </span>
    );
  };
  
  // Salad states (additional)
  const [selectedSaladToppings, setSelectedSaladToppings] = useState<string[]>([]);
  const [selectedDressingInstructions, setSelectedDressingInstructions] = useState<string>('');
  const [selectedExtraDressing, setSelectedExtraDressing] = useState<string[]>([]);
  const [selectedExtraToppings, setSelectedExtraToppings] = useState<string[]>([]);
  
  // Onion Rings state
  const [selectedOnionRingsInstructions, setSelectedOnionRingsInstructions] = useState<string[]>([]);
  
  // Mac & Cheese Bites state
  const [selectedMacAndCheeseBitesInstructions, setSelectedMacAndCheeseBitesInstructions] = useState<string[]>([]);
  
  // Broccoli & Cheddar Bites state
  const [selectedBroccoliCheddarBitesInstructions, setSelectedBroccoliCheddarBitesInstructions] = useState<string[]>([]);
  
  // Passariello Fries state
  const [selectedPassarielloFriesInstructions, setSelectedPassarielloFriesInstructions] = useState<string[]>([]);
  
  // Cheddar Steak Fries state
  const [selectedCheddarSteakFriesInstructions, setSelectedCheddarSteakFriesInstructions] = useState<string[]>([]);
  
  // Calamari state
  const [selectedCalamariSubSauce, setSelectedCalamariSubSauce] = useState<string>('');
  
  // Mussels state
  const [selectedMusselsSauce, setSelectedMusselsSauce] = useState<string>('');
  
  // Unified Seafood Sauce State (User Request)
  const [selectedSeafoodSauceId, setSelectedSeafoodSauceId] = useState<string>('');
  
  // Seafood Combo state
  const [selectedSeafoodComboSauce, setSelectedSeafoodComboSauce] = useState<string>('');
  
  // Shrimp Marinara state
  const [selectedShrimpMarinaraSubSauce, setSelectedShrimpMarinaraSubSauce] = useState<string>('');
  
  // Calamari & Shrimp Marinara Appetizer Sauce Choice states (sf-2, app17)
  const [selectedMarinaraAppetizerSauce, setSelectedMarinaraAppetizerSauce] = useState<string>('');
  
  // Pasta e Fagioli Substitute state
  const [selectedPastaFagioliSubstitute, setSelectedPastaFagioliSubstitute] = useState<string>('');
  const [pastaFagioliSubstituteError, setPastaFagioliSubstituteError] = useState(false);
  const pastaFagioliSubstituteRef = useRef<HTMLDivElement>(null);
  
  // Seafood Appetizer Sauce Errors and Refs (sf-2, sf-3, sf-4, sf-5)
  const [calamariSauceError, setCalamariSauceError] = useState(false);
  const calamariSauceRef = useRef<HTMLDivElement>(null);
  const [musselsSauceAppetizerError, setMusselsSauceAppetizerError] = useState(false);
  const musselsSauceAppetizerRef = useRef<HTMLDivElement>(null);
  const [seafoodComboSauceAppetizerError, setSeafoodComboSauceAppetizerError] = useState(false);
  const seafoodComboSauceAppetizerRef = useRef<HTMLDivElement>(null);
  const [shrimpSauceError, setShrimpSauceError] = useState(false);
  const shrimpSauceRef = useRef<HTMLDivElement>(null);
  
  // Seafood Appetizer Sauce Errors and Refs for app14
  const [calamariAppetizerSauceError, setCalamariAppetizerSauceError] = useState(false);
  const calamariAppetizerSauceRef = useRef<HTMLDivElement>(null);
  
  // Seafood Appetizer Sauce Errors and Refs for app15 and app16
  const [musselsAppetizerSauceError, setMusselsAppetizerSauceError] = useState(false);
  const musselsAppetizerSauceRef = useRef<HTMLDivElement>(null);
  const [seafoodComboAppetizerSauceError, setSeafoodComboAppetizerSauceError] = useState(false);
  const seafoodComboAppetizerSauceRef = useRef<HTMLDivElement>(null);
  
  // Seafood Appetizer Sauce Errors and Refs for app17
  const [shrimpAppetizerSauceError, setShrimpAppetizerSauceError] = useState(false);
  const shrimpAppetizerSauceRef = useRef<HTMLDivElement>(null);
  
  // Shrimp Marinara Substitute Sauce Error and Ref
  const [shrimpMarinaraSubSauceError, setShrimpMarinaraSubSauceError] = useState(false);
  const shrimpMarinaraSubSauceRef = useRef<HTMLDivElement>(null);
  
  // Seafood Pasta Type states (sf-6, sf-7, sf-8, sf-9, sf-10)
  const [selectedSeafoodPastaType, setSelectedSeafoodPastaType] = useState<string>('');
  const [seafoodPastaTypeError, setSeafoodPastaTypeError] = useState(false);
  const seafoodPastaTypeRef = useRef<HTMLDivElement>(null);
  
  // Wings state
  const [selectedWingsQuantity, setSelectedWingsQuantity] = useState<string>('10pcs');
  const [selectedWingsSauce, setSelectedWingsSauce] = useState<string>('');
  const [selectedWingsSpecialInstructions, setSelectedWingsSpecialInstructions] = useState<string[]>([]);
  const [selectedWingsExtraSauce, setSelectedWingsExtraSauce] = useState<Record<string, string>>({});
  const [selectedWingsExtraCheeseRanch, setSelectedWingsExtraCheeseRanch] = useState<Record<string, string>>({});
  const [wingsSauceError, setWingsSauceError] = useState(false);
  const wingsSauceRef = useRef<HTMLDivElement>(null);
  const [wingsSpecialInstructionsError, setWingsSpecialInstructionsError] = useState(false);
  const wingsSpecialInstructionsRef = useRef<HTMLDivElement>(null);
  
  // Garlic Bread state
  const [selectedGarlicBreadSize, setSelectedGarlicBreadSize] = useState<string>('1pcs');
  const [selectedGarlicBreadMozzarellaSize, setSelectedGarlicBreadMozzarellaSize] = useState<string>('1pcs');
  
  // Pizza Dippings state
  const [selectedPizzaDippings, setSelectedPizzaDippings] = useState<Record<string, number>>({});
  const [activeDippingItem, setActiveDippingItem] = useState<string | null>(null);
  
  const [selectedBurgerLite, setSelectedBurgerLite] = useState<string[]>([]);
  const [selectedBurgerSide, setSelectedBurgerSide] = useState<string[]>([]);
  const [selectedBurgerCheese, setSelectedBurgerCheese] = useState<string[]>(
    product.name === 'Hamburger' ? [] :
    product.name === 'Pizza Burger' ? ['bsc4'] : 
    ['bsc1']
  );

  // Brioche states
  const [selectedBriocheAddCheese, setSelectedBriocheAddCheese] = useState<string>(product.name === 'Brioche Mozzarella Grilled Chicken' ? 'brc4' : '');
  const [selectedBriocheExtraCheese, setSelectedBriocheExtraCheese] = useState<string[]>([]);
  const [selectedBriocheNo, setSelectedBriocheNo] = useState<string[]>([]);
  const [selectedBriocheSide, setSelectedBriocheSide] = useState<string[]>([]);

  // Panini states
  const [selectedPaniniType, setSelectedPaniniType] = useState<string>('');
  const [selectedPaniniExtraCheese, setSelectedPaniniExtraCheese] = useState<string[]>([]);
  const [selectedPaniniLite, setSelectedPaniniLite] = useState<string[]>([]);
  const [selectedPaniniNo, setSelectedPaniniNo] = useState<string[]>([]);
  const [selectedPaniniSides, setSelectedPaniniSides] = useState<string[]>([]);
  const [selectedPaniniCheese, setSelectedPaniniCheese] = useState<string>('');
  const [paniniTypeError, setPaniniTypeError] = useState(false);
  const paniniTypeRef = useRef<HTMLDivElement>(null);

  // Wrap states
  const [selectedWrapType, setSelectedWrapType] = useState<string>('');
  const [wrapTypeError, setWrapTypeError] = useState(false);
  const wrapTypeRef = useRef<HTMLDivElement>(null);
  const [selectedWrapCheese, setSelectedWrapCheese] = useState<string>(
    product.name === 'Buffalo Chicken Cheesesteak Wrap' || 
    product.name === 'Cheesesteak Wrap' || 
    product.name === 'Chicken Cheesesteak Wrap' ? 'wrap-cheese6' : 
    product.name === 'Grilled Chicken Wrap' || 
    product.name === 'Italian Wrap' || 
    product.name === 'Veggie Wrap' ? 'wrap-cheese3' : 
    product.name === 'Chicken Caesar Wrap' ? 'wrap-cheese8' : ''
  );
  const [wrapCheeseError, setWrapCheeseError] = useState(false);
  const wrapCheeseRef = useRef<HTMLDivElement>(null);
  const [selectedWrapAddToppings, setSelectedWrapAddToppings] = useState<string[]>([]);
  const [selectedWrapExtraCheese, setSelectedWrapExtraCheese] = useState<string[]>([]);
  const [selectedWrapLite, setSelectedWrapLite] = useState<string[]>([]);
  const [selectedWrapNo, setSelectedWrapNo] = useState<string[]>([]);
  const [selectedWrapSide, setSelectedWrapSide] = useState<string[]>([]);
  const [wrapChipsQuantity, setWrapChipsQuantity] = useState<number>(0);

  // Pasta Fagioli Soup states
  const [selectedPastaFagioliSpecialInstructions, setSelectedPastaFagioliSpecialInstructions] = useState<string[]>([]);
  const [selectedPastaFagioliSubstituteCracker, setSelectedPastaFagioliSubstituteCracker] = useState<string[]>([]);

  // Kids Pasta states
  const [selectedKidsPastaType, setSelectedKidsPastaType] = useState<string>('');
  const [selectedKidsPastaSauce, setSelectedKidsPastaSauce] = useState<string>('');
  const [selectedKidsPastaToppings, setSelectedKidsPastaToppings] = useState<string[]>([]);
  const [selectedKidsPastaSpecialInstructions, setSelectedKidsPastaSpecialInstructions] = useState<string[]>([]);
  const [kidsPastaTypeError, setKidsPastaTypeError] = useState(false);
  const kidsPastaTypeRef = useRef<HTMLDivElement>(null);
  const [kidsPastaSauceError, setKidsPastaSauceError] = useState(false);
  const kidsPastaSauceRef = useRef<HTMLDivElement>(null);

  // Build Your Own Pasta (cp-1) states
  const [selectedBuildPastaType, setSelectedBuildPastaType] = useState<string>('');
  const [selectedBuildPastaSauce, setSelectedBuildPastaSauce] = useState<string>('');
  const [selectedBuildPastaToppings, setSelectedBuildPastaToppings] = useState<string[]>([]);
  const [selectedBuildPastaSoup, setSelectedBuildPastaSoup] = useState<string[]>([]);
  const [buildPastaTypeError, setBuildPastaTypeError] = useState(false);
  const buildPastaTypeRef = useRef<HTMLDivElement>(null);
  const [buildPastaSauceError, setBuildPastaSauceError] = useState(false);
  const buildPastaSauceRef = useRef<HTMLDivElement>(null);

  // Kids Baked items (k2, k3, k4) states
  const [selectedKidsBakedExtraToppings, setSelectedKidsBakedExtraToppings] = useState<string[]>([]);
  const [selectedKidsBakedLiteToppings, setSelectedKidsBakedLiteToppings] = useState<string[]>([]);
  const [selectedKidsBakedNoToppings, setSelectedKidsBakedNoToppings] = useState<string[]>([]);

  // Kids Pasta and Meatball (k6) states
  const [selectedKidsPastaMeatballType, setSelectedKidsPastaMeatballType] = useState<string>('');
  const [selectedKidsPastaMeatballSpecialInstructions, setSelectedKidsPastaMeatballSpecialInstructions] = useState<string[]>([]);
  const [selectedKidsPastaMeatballToppings, setSelectedKidsPastaMeatballToppings] = useState<string[]>([]);
  const [kidsPastaMeatballTypeError, setKidsPastaMeatballTypeError] = useState(false);
  const kidsPastaMeatballTypeRef = useRef<HTMLDivElement>(null);

  // Antipasto Salad Bowl states
  const [selectedAntipastoBase, setSelectedAntipastoBase] = useState<string>('');
  const [selectedAntipastoDressings, setSelectedAntipastoDressings] = useState<string[]>([]);
  const [selectedAntipastoSpecialInstructions, setSelectedAntipastoSpecialInstructions] = useState<string[]>([]);

  // Caesar Salad Bowl states
  const [selectedCaesarBase, setSelectedCaesarBase] = useState<string>('');
  const [selectedCaesarDressings, setSelectedCaesarDressings] = useState<string[]>([]);
  const [selectedCaesarSpecialInstructions, setSelectedCaesarSpecialInstructions] = useState<string[]>([]);

  // Chicken Caesar Salad Bowl states
  const [selectedChickenCaesarBase, setSelectedChickenCaesarBase] = useState<string>('');
  const [selectedChickenCaesarDressings, setSelectedChickenCaesarDressings] = useState<string[]>([]);
  const [selectedChickenCaesarSpecialInstructions, setSelectedChickenCaesarSpecialInstructions] = useState<string[]>([]);

  // Garden Salad Bowl states
  const [selectedGardenBase, setSelectedGardenBase] = useState<string>('');
  const [selectedGardenDressings, setSelectedGardenDressings] = useState<string[]>([]);
  const [selectedGardenSpecialInstructions, setSelectedGardenSpecialInstructions] = useState<string[]>([]);

  // Roasted Red Pepper Salad Bowl states
  const [selectedRoastedRedPepperBase, setSelectedRoastedRedPepperBase] = useState<string>('');
  const [selectedRoastedRedPepperDressings, setSelectedRoastedRedPepperDressings] = useState<string[]>([]);

  // Three Cheese Salad Bowl states
  const [selectedThreeCheeseBase, setSelectedThreeCheeseBase] = useState<string>('');
  const [selectedThreeCheeseDressings, setSelectedThreeCheeseDressings] = useState<string[]>([]);
  const [selectedThreeCheeseSpecialInstructions, setSelectedThreeCheeseSpecialInstructions] = useState<string[]>([]);

  // Traditional Chef Salad Bowl states
  const [selectedTraditionalChefBase, setSelectedTraditionalChefBase] = useState<string>('');
  const [selectedTraditionalChefDressings, setSelectedTraditionalChefDressings] = useState<string[]>([]);
  const [selectedTraditionalChefSpecialInstructions, setSelectedTraditionalChefSpecialInstructions] = useState<string[]>([]);

  // Regular Salads - Special Instructions states
  const [selectedCalamariSpecialInstructions, setSelectedCalamariSpecialInstructions] = useState<string[]>([]);
  const [selectedCapreseSpecialInstructions, setSelectedCapreseSpecialInstructions] = useState<string[]>([]);
  const [selectedFarfallePastaSpecialInstructions, setSelectedFarfallePastaSpecialInstructions] = useState<string[]>([]);
  const [selectedItalianChoppedSpecialInstructions, setSelectedItalianChoppedSpecialInstructions] = useState<string[]>([]);
  const [selectedRoastedRedPeppersSpecialInstructions, setSelectedRoastedRedPeppersSpecialInstructions] = useState<string[]>([]);
  const [selectedTunaSpecialInstructions, setSelectedTunaSpecialInstructions] = useState<string[]>([]);

  // Hoagie Platter states
  const [selectedHoagiePlatterOptions, setSelectedHoagiePlatterOptions] = useState<{[key: string]: number}>({});
  const [selectedHoagiePlatterCut, setSelectedHoagiePlatterCut] = useState<string>('');
  const [selectedHoagiePlatterSideToppings, setSelectedHoagiePlatterSideToppings] = useState<{[key: string]: number}>({});
  const [hoagiePlatterError, setHoagiePlatterError] = useState(false);
  const hoagiePlatterRef = useRef<HTMLDivElement>(null);

  // Wrap Platter states
  const [selectedWrapPlatterOptions, setSelectedWrapPlatterOptions] = useState<{[key: string]: number}>({});
  const [selectedWrapPlatterWrapType, setSelectedWrapPlatterWrapType] = useState<string>('');
  const [selectedWrapPlatterSideToppings, setSelectedWrapPlatterSideToppings] = useState<{[key: string]: number}>({});
  const [wrapPlatterError, setWrapPlatterError] = useState(false);
  const [wrapPlatterWrapTypeError, setWrapPlatterWrapTypeError] = useState(false);
  const wrapPlatterRef = useRef<HTMLDivElement>(null);
  const wrapPlatterWrapTypeRef = useRef<HTMLDivElement>(null);

  // Hot Sandwich Platter states
  const [selectedHotSandwichPlatterOptions, setSelectedHotSandwichPlatterOptions] = useState<{[key: string]: number}>({});
  const [selectedHotSandwichPlatterCut, setSelectedHotSandwichPlatterCut] = useState<string>('');
  const [selectedHotSandwichPlatterSideToppings, setSelectedHotSandwichPlatterSideToppings] = useState<{[key: string]: number}>({});
  const [hotSandwichPlatterError, setHotSandwichPlatterError] = useState(false);
  const hotSandwichPlatterRef = useRef<HTMLDivElement>(null);

  // Baby Clam Sauce Tray states
  const [selectedBabyClamPastaType, setSelectedBabyClamPastaType] = useState<string>('');
  const [selectedBabyClamSauceChoice, setSelectedBabyClamSauceChoice] = useState<string>('');

  // Calamari Marinara Tray states
  const [selectedCalamariPastaType, setSelectedCalamariPastaType] = useState<string>('');
  const [selectedCalamariSubstituteSauce, setSelectedCalamariSubstituteSauce] = useState<string>('');

  // Mussels Tray states
  const [selectedMusselsPastaType, setSelectedMusselsPastaType] = useState<string>('');
  const [selectedMusselsSauceChoice, setSelectedMusselsSauceChoice] = useState<string>('');

  // Seafood Combo Tray states
  const [selectedSeafoodComboPastaType, setSelectedSeafoodComboPastaType] = useState<string>('');
  const [selectedSeafoodComboSauceChoice, setSelectedSeafoodComboSauceChoice] = useState<string>('');

  // Shrimp Marinara Tray states
  const [selectedShrimpMarinaraPastaType, setSelectedShrimpMarinaraPastaType] = useState<string>('');
  const [selectedShrimpMarinaraSubstituteSauce, setSelectedShrimpMarinaraSubstituteSauce] = useState<string>('');

  // Seafood Pasta Type Errors and Refs (cs1, cs2, cs4, cs5, cs6)
  const [babyClamPastaTypeError, setBabyClamPastaTypeError] = useState(false);
  const babyClamPastaTypeRef = useRef<HTMLDivElement>(null);
  const [babyClamSauceError, setBabyClamSauceError] = useState(false);
  const babyClamSauceRef = useRef<HTMLDivElement>(null);
  const [calamariPastaTypeError, setCalamariPastaTypeError] = useState(false);
  const calamariPastaTypeRef = useRef<HTMLDivElement>(null);
  const [musselsPastaTypeError, setMusselsPastaTypeError] = useState(false);
  const musselsPastaTypeRef = useRef<HTMLDivElement>(null);
  const [musselsSauceError, setMusselsSauceError] = useState(false);
  const musselsSauceRef = useRef<HTMLDivElement>(null);
  const [seafoodComboPastaTypeError, setSeafoodComboPastaTypeError] = useState(false);
  const seafoodComboPastaTypeRef = useRef<HTMLDivElement>(null);
  const [seafoodComboSauceError, setSeafoodComboSauceError] = useState(false);
  const seafoodComboSauceRef = useRef<HTMLDivElement>(null);
  const [shrimpMarinaraPastaTypeError, setShrimpMarinaraPastaTypeError] = useState(false);
  const shrimpMarinaraPastaTypeRef = useRef<HTMLDivElement>(null);
  const [shrimpMarinaraSauceError, setShrimpMarinaraSauceError] = useState(false);
  const shrimpMarinaraSauceRef = useRef<HTMLDivElement>(null);

  // Cannoli states
  const [selectedCannoliSpecialInstruction, setSelectedCannoliSpecialInstruction] = useState<boolean>(false);

  // Dessert Tray states
  const [selectedDessertTraySpecialInstruction, setSelectedDessertTraySpecialInstruction] = useState<boolean>(false);

  // Auto-open and scroll for seafood appetizer sauce errors
  useEffect(() => {
    if (calamariSauceError && calamariSauceRef.current) {
      setIsAdditionalOpen(true);
      calamariSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [calamariSauceError]);
  
  useEffect(() => {
    if (musselsSauceAppetizerError && musselsSauceAppetizerRef.current) {
      setIsAdditionalOpen(true);
      musselsSauceAppetizerRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [musselsSauceAppetizerError]);
  
  useEffect(() => {
    if (seafoodComboSauceAppetizerError && seafoodComboSauceAppetizerRef.current) {
      setIsAdditionalOpen(true);
      seafoodComboSauceAppetizerRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [seafoodComboSauceAppetizerError]);
  
  useEffect(() => {
    if (shrimpSauceError && shrimpSauceRef.current) {
      setIsAdditionalOpen(true);
      shrimpSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [shrimpSauceError]);
  
  useEffect(() => {
    if (calamariAppetizerSauceError && calamariAppetizerSauceRef.current) {
      setIsAdditionalOpen(true);
      calamariAppetizerSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [calamariAppetizerSauceError]);
  
  useEffect(() => {
    if (musselsAppetizerSauceError && musselsAppetizerSauceRef.current) {
      setIsAdditionalOpen(true);
      musselsAppetizerSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [musselsAppetizerSauceError]);
  
  useEffect(() => {
    if (seafoodComboAppetizerSauceError && seafoodComboAppetizerSauceRef.current) {
      setIsAdditionalOpen(true);
      seafoodComboAppetizerSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [seafoodComboAppetizerSauceError]);
  
  useEffect(() => {
    if (shrimpAppetizerSauceError && shrimpAppetizerSauceRef.current) {
      setIsAdditionalOpen(true);
      shrimpAppetizerSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [shrimpAppetizerSauceError]);
  
  useEffect(() => {
    if (shrimpMarinaraSubSauceError && shrimpMarinaraSubSauceRef.current) {
      setIsAdditionalOpen(true);
      shrimpMarinaraSubSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [shrimpMarinaraSubSauceError]);
  
  useEffect(() => {
    if (cateringPastaTypeError && cateringPastaTypeRef.current) {
      setIsAdditionalOpen(true);
      cateringPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [cateringPastaTypeError]);

  // Clear Extra Cheese for Brioche when "No Cheese" is selected in Add Cheese section
  useEffect(() => {
    if (selectedBriocheAddCheese === 'brc7') {
      // Clear Extra Cheese selections
      setSelectedBriocheExtraCheese([]);
    }
  }, [selectedBriocheAddCheese, selectedBriocheNo]);

  // Paninis: Clear Extra Cheese and Lite Cheese when No Cheese is selected
  useEffect(() => {
    if (product.category === 'paninis' && selectedPaniniCheese === 'pn-cheese7') {
      // Clear Extra Cheese (pn-extra1) and Lite Cheese (pn-lite1)
      setSelectedPaniniExtraCheese(prev => prev.filter(id => id !== 'pn-extra1'));
      setSelectedPaniniLite(prev => prev.filter(id => id !== 'pn-lite1'));
    }
  }, [product.category, selectedPaniniCheese]);

  // Wraps: Clear Extra Cheese and Lite Cheese when No Cheese is selected
  useEffect(() => {
    if (product.category === 'wraps' && selectedWrapCheese === 'wrap-cheese7') {
      // Clear Extra Cheese (wrap-extra1) and Lite Cheese (wrap-lite1)
      setSelectedWrapExtraCheese(prev => prev.filter(id => id !== 'wrap-extra1'));
      setSelectedWrapLite(prev => prev.filter(id => id !== 'wrap-lite1'));
    }
  }, [product.category, selectedWrapCheese]);

  // Calculate price based on selected size
  const getSizePrice = () => {
    // For hoagies, return fixed price (no size selection)
    if (product.category === 'cold-hoagies' || product.category === 'hot-hoagies') {
      return parseFloat(product.price?.replace('$', '') || '13.49');
    }
    
    // For soups, calculate based on size (16oz or 32oz)
    if (product.category === 'soups') {
      if (product.priceRange) {
        const prices = product.priceRange.split(' - ').map(p => parseFloat(p.replace('$', '').trim()));
        switch (selectedSize) {
          case 'medium': // 16oz
            return prices[0] || 8.49;
          case 'large': // 32oz
            return prices[1] || 12.99;
          default:
            return prices[0] || 8.49;
        }
      }
      return parseFloat(product.price?.replace('$', '') || '8.49');
    }
    
    // For by-the-slice and other single-price categories, return fixed price
    if (product.category === 'by-the-slice' || 
        product.category === 'brooklyn-pizza' ||
        product.category === 'cheesesteaks' ||
        product.category === 'appetizers' ||
        product.category === 'salads' ||
        product.category === 'seafood' ||
        product.category === 'sides' ||
        product.category === 'catering-beverages' ||
        product.category === 'catering-hoagies-wraps' ||
        product.category === 'burgers' ||
        product.category === 'brioche' ||
        product.category === 'paninis' ||
        product.category === 'wraps' ||
        product.category === 'traditional-dinners' ||
        product.category === 'pasta' ||
        product.category === 'baked-pasta' ||
        product.category === 'create-salad' ||
        product.category === 'create-pasta' ||
        product.category === 'kids' ||
        product.category === 'minucci-pizzas' ||
        product.category === 'desserts' ||
        product.category === 'pizzelle' ||
        product.category === 'gelati' ||
        product.category === 'entrees' ||
        product.category === 'beverages' ||
        product.id === 'stromboli-8') {
      return parseFloat(product.price?.replace('$', '') || '0');
    }
    
    // For Gluten Free and Cauliflower pizzas, return fixed price (no size selection)
    if (product.id === 'cyo-gf12' || product.id === 'cyo-cauliflower') {
      return parseFloat(product.price?.replace('$', '') || '0');
    }
    
    // For catering whole cakes, return fixed price (no size selection)
    if (product.category === 'catering-whole-cakes') {
      return parseFloat(product.price?.replace('$', '') || '0');
    }
    
    // For wings and catering appetizers, calculate based on quantity (10, 20, 30, 50)
    if ((product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4') {
      const basePrice = parseFloat(product.price?.replace('$', '') || '11.99');
      switch (selectedSize) {
        case '10':
          return basePrice;
        case '20':
          return basePrice * 2;
        case '30':
          return basePrice * 3;
        case '50':
          return basePrice * 5;
        default:
          return basePrice;
      }
    }
    
    // For Party Trays with 10 PCS and 20 PCS
    if (product.id === 'cptray1' || product.id === 'cptray2' || product.id === 'cptray4' || product.id === 'cptray5' || product.id === 'cptray6') {
      if (product.priceRange) {
        const prices = product.priceRange.split(' - ').map(p => parseFloat(p.replace('$', '').trim()));
        switch (selectedSize) {
          case '10':
            return prices[0] || 29.99;
          case '20':
            return prices[1] || 59.99;
          default:
            return prices[0] || 29.99;
        }
      }
    }
    
    // For Mini Cannoli Tray with 20 PCS and 40 PCS
    if (product.id === 'cptray3') {
      if (product.priceRange) {
        const prices = product.priceRange.split(' - ').map(p => parseFloat(p.replace('$', '').trim()));
        switch (selectedSize) {
          case '20':
            return prices[0] || 29.99;
          case '40':
            return prices[1] || 59.99;
          default:
            return prices[0] || 29.99;
        }
      }
    }
    
    // For Minucci, price is based on selected pricing option
    if (product.id === 'cyo-minucci') {
      // Using selectedSize to determine price: 'medium' = 1 topping, 'large' = 2-4 toppings
      if (selectedSize === 'medium') {
        return 9.99; // 1 Topping
      } else if (selectedSize === 'large') {
        return 12.99; // 2-4 Toppings
      }
      // Default to base price
      return 9.99;
    }
    
    // For products with priceRange, extract prices
    if (product.priceRange) {
      const prices = product.priceRange.split(' - ').map(p => parseFloat(p.replace('$', '').trim()));
      
      // If priceRange contains only one price, return it (for Brooklyn pizzas, Minucci, etc.)
      if (prices.length === 1) {
        return prices[0];
      }
      
      // For products with multiple prices, use size selection
      switch (selectedSize) {
        case 'medium':
          return prices[0] || 17.99;
        case 'large':
          return prices[1] || 18.99;
        case 'jumbo':
          return prices[2] || 20.99;
        default:
          return prices[0] || 17.99;
      }
    }
    
    // Fallback to hardcoded prices if no priceRange
    switch (selectedSize) {
      case 'medium':
        return 17.99;
      case 'large':
        return 18.99;
      case 'jumbo':
        return 20.99;
      default:
        return 17.99;
    }
  };

  const handleIncludedSelect = (includedId: string) => {
    setSelectedIncluded(includedId);
  };

  const handleToppingToggle = (toppingId: string) => {
    setSelectedToppings(prev => {
      const isRemoving = prev.includes(toppingId);
      if (isRemoving) {
        // Remove distribution when topping is deselected
        setToppingDistribution(dist => {
          const newDist = { ...dist };
          delete newDist[toppingId];
          return newDist;
        });
        return prev.filter(id => id !== toppingId);
      } else {
        // Set default distribution to 'whole' when topping is selected
        setToppingDistribution(dist => ({ ...dist, [toppingId]: 'whole' }));
        
        // Handle mutual exclusivity for Extra/Lite pairs
        let updatedPrev = [...prev];
        
        // Extra Cheese (ext1) and Lite Cheese (lite2)
        if (toppingId === 'ext1') {
          updatedPrev = updatedPrev.filter(id => id !== 'lite2');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['lite2'];
            return newDist;
          });
          // Also clear "No Cheese" from selectedCheese if it's selected
          if (selectedCheese === 'cheese5') {
            setSelectedCheese('');
          }
        } else if (toppingId === 'lite2') {
          updatedPrev = updatedPrev.filter(id => id !== 'ext1');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['ext1'];
            return newDist;
          });
          // Also clear "No Cheese" from selectedCheese if it's selected
          if (selectedCheese === 'cheese5') {
            setSelectedCheese('');
          }
        }
        
        // Extra Ketchup (ext2) and Lite Ketchup (lite3)
        if (toppingId === 'ext2') {
          updatedPrev = updatedPrev.filter(id => id !== 'lite3');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['lite3'];
            return newDist;
          });
        } else if (toppingId === 'lite3') {
          updatedPrev = updatedPrev.filter(id => id !== 'ext2');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['ext2'];
            return newDist;
          });
        }
        
        // Extra Mayo (ext3) and Lite Mayo (lite4)
        if (toppingId === 'ext3') {
          updatedPrev = updatedPrev.filter(id => id !== 'lite4');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['lite4'];
            return newDist;
          });
        } else if (toppingId === 'lite4') {
          updatedPrev = updatedPrev.filter(id => id !== 'ext3');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['ext3'];
            return newDist;
          });
        }
        
        // Lite Black Pepper (lite1) and No Black Pepper (csno1)
        if (toppingId === 'lite1') {
          updatedPrev = updatedPrev.filter(id => id !== 'csno1');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['csno1'];
            return newDist;
          });
        } else if (toppingId === 'csno1') {
          updatedPrev = updatedPrev.filter(id => id !== 'lite1');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['lite1'];
            return newDist;
          });
        }
        
        // Lite Salt (lite5) and No Salt (csno2)
        if (toppingId === 'lite5') {
          updatedPrev = updatedPrev.filter(id => id !== 'csno2');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['csno2'];
            return newDist;
          });
        } else if (toppingId === 'csno2') {
          updatedPrev = updatedPrev.filter(id => id !== 'lite5');
          setToppingDistribution(dist => {
            const newDist = { ...dist };
            delete newDist['lite5'];
            return newDist;
          });
        }
        
        return [...updatedPrev, toppingId];
      }
    });
  };

  // Handle specialty toppings (only one can be selected at a time from the same section)
  const handleSpecialtyToppingToggle = (toppingId: string, section: 'first' | 'second') => {
    const sectionToppings = section === 'first' 
      ? specialtyToppings.map(t => t.id)
      : specialtyToppingsSecondHalf.map(t => t.id);
    
    setSelectedToppings(prev => {
      const isRemoving = prev.includes(toppingId);
      if (isRemoving) {
        return prev.filter(id => id !== toppingId);
      } else {
        // Remove any other topping from this section before adding the new one
        const withoutSectionToppings = prev.filter(id => !sectionToppings.includes(id));
        return [...withoutSectionToppings, toppingId];
      }
    });
  };

  const handleDistributionChange = (toppingId: string, distribution: 'left' | 'whole' | 'right') => {
    setToppingDistribution(prev => ({ ...prev, [toppingId]: distribution }));
  };

  const handleDessertToggle = (dessertId: string) => {
    setSelectedDesserts(prev => {
      const current = prev[dessertId] || 0;
      const newMap = { ...prev };
      if (current > 0) {
        delete newMap[dessertId];
      } else {
        newMap[dessertId] = 1;
      }
      return newMap;
    });
  };

  const handleDessertIncrement = (id: string) => {
    setSelectedDesserts(prev => ({
      ...prev,
      [id]: (prev[id] || 0) + 1
    }));
  };

  const handleDessertDecrement = (id: string) => {
    setSelectedDesserts(prev => {
      const current = prev[id] || 0;
      if (current <= 1) {
        const { [id]: _, ...rest } = prev;
        return rest;
      }
      return { ...prev, [id]: current - 1 };
    });
  };

  const handleBeverageToggle = (beverageId: string) => {
    setSelectedBeverages(prev => {
      const current = prev[beverageId] || 0;
      const newMap = { ...prev };
      if (current > 0) {
        delete newMap[beverageId];
      } else {
        newMap[beverageId] = 1;
      }
      return newMap;
    });
  };

  const handleBeverageIncrement = (id: string) => {
    setSelectedBeverages(prev => ({
      ...prev,
      [id]: (prev[id] || 0) + 1
    }));
  };

  const handleBeverageDecrement = (id: string) => {
    setSelectedBeverages(prev => {
      const current = prev[id] || 0;
      if (current <= 1) {
        const { [id]: _, ...rest } = prev;
        return rest;
      }
      return { ...prev, [id]: current - 1 };
    });
  };

  const handleSaladToppingToggle = (toppingId: string) => {
    setSelectedSaladToppings(prev => {
      const isSelected = prev.includes(toppingId);
      if (isSelected) return prev.filter(id => id !== toppingId);
      if (prev.length >= 5) return prev;
      return [...prev, toppingId];
    });
  };

  const handleSideToppingToggle = (sideToppingId: string) => {
    setSelectedSideToppings(prev =>
      prev.includes(sideToppingId)
        ? prev.filter(id => id !== sideToppingId)
        : [...prev, sideToppingId]
    );
  };

  const handleExtraSideToggle = (extraSideId: string) => {
    setSelectedExtraSides(prev =>
      prev.includes(extraSideId)
        ? prev.filter(id => id !== extraSideId)
        : [...prev, extraSideId]
    );
  };

  const handleAddToppingToggle = (toppingId: string) => {
    setSelectedAddToppings(prev =>
      prev.includes(toppingId)
        ? prev.filter(id => id !== toppingId)
        : [...prev, toppingId]
    );
  };

  const handleLiteToppingToggle = (toppingId: string) => {
    setSelectedLiteToppings(prev =>
      prev.includes(toppingId)
        ? prev.filter(id => id !== toppingId)
        : [...prev, toppingId]
    );
  };

  const handleNoToppingCheesesteakToggle = (toppingId: string) => {
    setSelectedNoToppingsCheesesteak(prev =>
      prev.includes(toppingId)
        ? prev.filter(id => id !== toppingId)
        : [...prev, toppingId]
    );
  };

  const handleToastRollToggle = (option: 'toast' | 'no-toast') => {
    setToastRoll(option);
    setToastOptionError(false);
  };

  const handleSubstituteCheeseToggle = (cheeseType: string) => {
    // If clicking on already selected cheese, deselect it
    if (substituteCheese === cheeseType) {
      setSubstituteCheese(null);
    } else {
      setSubstituteCheese(cheeseType);
      setCheeseOptionError(false); // Clear error when cheese is selected
    }
  };

  const handlePizzaSteakExtrasToggle = (extraType: string) => {
    // If clicking on already selected extra, deselect it
    if (pizzaSteakExtras === extraType) {
      setPizzaSteakExtras(null);
    } else {
      setPizzaSteakExtras(extraType);
    }
  };

  const handlePizzaSteakSpecialInstructionsToggle = (instructionType: string) => {
    // If clicking on already selected instruction, deselect it
    if (pizzaSteakSpecialInstructions === instructionType) {
      setPizzaSteakSpecialInstructions(null);
    } else {
      setPizzaSteakSpecialInstructions(instructionType);
    }
  };

  const handleSpecialInstructionToggle = (instructionId: string) => {
    setSelectedSpecialInstructions(prev => {
      // If already selected, deselect it
      if (prev.includes(instructionId)) {
        return prev.filter(id => id !== instructionId);
      }
      
      // Define mutually exclusive groups
      const cheeseGroup = ['si1', 'si8']; // Lite Cheese, No Cheese
      const sauceGroup = ['si2', 'si3', 'si7']; // Lite Sauce, No Sauce, Extra Sauce
      const cookingGroup = ['si5', 'si6']; // Well Done, lightly cooked
      
      let newSelection = [...prev];
      
      // If selecting from cheese group, remove other cheese options
      if (cheeseGroup.includes(instructionId)) {
        newSelection = newSelection.filter(id => !cheeseGroup.includes(id));
      }
      
      // If selecting from sauce group, remove other sauce options
      if (sauceGroup.includes(instructionId)) {
        newSelection = newSelection.filter(id => !sauceGroup.includes(id));
      }
      
      // If selecting from cooking group, remove other cooking options
      if (cookingGroup.includes(instructionId)) {
        newSelection = newSelection.filter(id => !cookingGroup.includes(id));
      }
      
      // Add the new selection
      return [...newSelection, instructionId];
    });
  };

  const handleExtraSauceToggle = (sauceId: string) => {
    setSelectedExtraSauce(prev =>
      prev.includes(sauceId)
        ? prev.filter(id => id !== sauceId)
        : [...prev, sauceId]
    );
  };

  const handleNoToppingToggle = (noToppingId: string) => {
    setSelectedNoToppings(prev =>
      prev.includes(noToppingId)
        ? prev.filter(id => id !== noToppingId)
        : [...prev, noToppingId]
    );
  };

  const handleBrooklynInstructionToggle = (instructionId: string) => {
    setSelectedBrooklynInstructions(prev =>
      prev.includes(instructionId)
        ? prev.filter(id => id !== instructionId)
        : [...prev, instructionId]
    );
  };

  // Scroll to Pasta e Fagioli Substitute when error is shown
  useEffect(() => {
    if (pastaFagioliSubstituteError && pastaFagioliSubstituteRef.current) {
      pastaFagioliSubstituteRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [pastaFagioliSubstituteError]);

  // Helper function to get topping price based on category and distribution
  const getToppingPrice = (topping: Topping, distribution?: 'left' | 'right' | 'whole'): number => {
    // For "by the slice" category, use special pricing
    if (product.category === 'by-the-slice') {
      // Premium toppings for slices
      if (['a1', 'a27', 'a28', 'a29'].includes(topping.id)) {
        // Cup n Char Pepperoni, Grilled Chicken, Beef Steak, Chicken Steak
        return 1.49;
      }
      // Regular toppings for slices
      return 0.65;
    }

    // For pizzas, specialty-pizza, and brooklyn-pizza with left/right distribution, use half pricing
    if ((product.category === 'pizzas' || product.category === 'specialty-pizza' || product.category === 'brooklyn-pizza') &&
        (distribution === 'left' || distribution === 'right')) {
      const halfPrice = HALF_TOPPING_PRICE_BY_ID[topping.id];
      if (halfPrice !== undefined) {
        return halfPrice;
      }
      // Fallback: half of full price rounded to 2 decimals
      return Math.round(((topping.price || 0) / 2) * 100) / 100;
    }
    
    // Otherwise use full price
    return topping.price || 0;
  };

  // Filter out selections that should not be captured for the current product (prevents "ghost selections")
  const filterSelectionsByProduct = (sels: any[], currentProduct: any): any[] => {
    const cleaned = (Array.isArray(sels) ? sels : []).filter((s) => {
      if (!s) return false;
      const id = String(s.id ?? '').trim();
      const label = String(s.label ?? '').trim();
      if (!id) return false;
      // active-only: ignore empty labels
      if (!label) return false;
      return true;
    });

    const isPizza =
      currentProduct?.category === 'pizzas' ||
      currentProduct?.category === 'specialty-pizza' ||
      currentProduct?.category === 'brooklyn-pizza' ||
      currentProduct?.category === 'minucci-pizzas' ||
      currentProduct?.category === 'by-the-slice' ||
      currentProduct?.category === 'stromboli-calzone';

    if (!isPizza) return cleaned;

    const ghostIds = new Set(['4pcs', '6pcs', '10pcs', '1pc', '1pcs']);
    return cleaned.filter((s) => {
      const id = String(s.id ?? '').trim();
      if (ghostIds.has(id)) return false;

      const gt = String(s.groupTitle ?? '').toLowerCase();
      if (
        gt.includes('chicken tenders') ||
        gt.includes('mozzarella sticks') ||
        gt.includes('wings') ||
        gt.includes('arancini') ||
        gt.includes('garlic bread')
      ) {
        return false;
      }
      return true;
    });
  };

  const sanitizeCheesesteakSelections = (sels: any[]): any[] => {
    const toastIds = new Set(["toast", "no-toast"]);
    const cheeseIds = new Set((cheeseOptions || []).map((x: any) => String(x.id)));
    const toppingsIds = new Set([
      ...(createYourOwnCheesesteakToppings || []).map((x: any) => String(x.id)),
      ...(cheesesteakToppings || []).map((x: any) => String(x.id)),
      ...(addToppingItems || []).map((x: any) => String(x.id)),
    ]);
    const extraToppingsIds = new Set((extraToppings || []).map((x: any) => String(x.id)));
    const liteToppingsIds = new Set([
      ...(liteToppings || []).map((x: any) => String(x.id)),
      ...(liteToppingItems || []).map((x: any) => String(x.id)),
    ]);
    const noToppingsIds = new Set([
      ...(cheesesteakNoToppings || []).map((x: any) => String(x.id)),
      ...(noToppingItems || []).map((x: any) => String(x.id)),
      ...((selectedNoToppingsCheesesteak || []).map((x: any) => String(x))),
    ]);
    const onTheSideToppingsIds = new Set([
      ...(cheesesteakSideToppingsRequired || []).map((x: any) => String(x.id)),
      ...((selectedCheesesteakSideToppingsRequired || []).map((x: any) => String(x))),
    ]);
    const sideToppingsIds = new Set([
      ...(sideToppingItems || []).map((x: any) => String(x.id)),
      ...((selectedSideToppings || []).map((x: any) => String(x))),
    ]);
    const extraSidesIds = new Set([
      ...(extraSidesItems || []).map((x: any) => String(x.id)),
      ...((selectedExtraSides || []).map((x: any) => String(x))),
    ]);

    const dessertIds = new Set<string>();
    Object.entries(selectedDesserts || {}).forEach(([id, qty]) => {
      if ((qty as number) > 0) dessertIds.add(String(id));
    });
    const beverageIds = new Set<string>();
    Object.entries(selectedBeverages || {}).forEach(([id, qty]) => {
      if ((qty as number) > 0) beverageIds.add(String(id));
    });

    const classify = (id: string): string | null => {
      if (toastIds.has(id)) return "Toast Option";
      if (cheeseIds.has(id)) return "Cheese";
      if (extraToppingsIds.has(id)) return "Extra Toppings";
      if (liteToppingsIds.has(id)) return "Lite Toppings";
      if (noToppingsIds.has(id)) return "No Toppings";
      if (onTheSideToppingsIds.has(id)) return "On The Side Toppings";
      if (sideToppingsIds.has(id)) return "Side Toppings";
      if (extraSidesIds.has(id)) return "Would You Like To Add Extra Sides";
      if (dessertIds.has(id)) return "Dessert";
      if (beverageIds.has(id)) return "Beverages";
      if (toppingsIds.has(id)) return "Toppings";
      return null;
    };

    const mapById = (arr: any[]) => {
      const m = new Map<string, string>();
      (arr || []).forEach((x: any) => {
        const id = String(x?.id || "").trim();
        const name = String(x?.name || "").trim();
        if (id && name) m.set(id, name);
      });
      return m;
    };

    const toastNameById = new Map<string, string>([
      ["toast", "Toast Roll"],
      ["no-toast", "Don't Toast Roll"],
    ]);
    const cheeseNameById = mapById(cheeseOptions);
    const toppingsNameById = mapById([
      ...(createYourOwnCheesesteakToppings || []),
      ...(cheesesteakToppings || []),
      ...(addToppingItems || []),
    ]);
    const extraToppingsNameById = mapById(extraToppings);
    const liteToppingsNameById = mapById([...(liteToppings || []), ...(liteToppingItems || [])]);
    const noToppingsNameById = mapById([...(cheesesteakNoToppings || []), ...(noToppingItems || [])]);
    const onTheSideToppingsNameById = mapById([...(cheesesteakSideToppingsRequired || [])]);
    const sideToppingsNameById = mapById([...(sideToppingItems || [])]);
    const extraSidesNameById = mapById(extraSidesItems);
    const dessertsNameById = mapById(dessertItems);
    const beveragesNameById = mapById(beverageItems);

    const unique = new Map<string, any>();
    (Array.isArray(sels) ? sels : []).forEach((sel) => {
      const id = String(sel?.id ?? "").trim();
      if (!id) return;
      const section = classify(id);
      if (!section) return;

      const normalized = { ...sel };
      if (section === "Toast Option") {
        normalized.type = "required_option";
        normalized.groupId = "toast_option";
        normalized.groupTitle = "Toast Option (Required)";
        normalized.label = toastNameById.get(id) || normalized.label;
      } else if (section === "Cheese") {
        normalized.type = "cheese";
        normalized.groupId = "cheese";
        normalized.groupTitle = "Cheese";
        normalized.label = cheeseNameById.get(id) || normalized.label;
      } else if (section === "Toppings") {
        normalized.type = "topping";
        normalized.groupId = normalized.groupId || "create_cheesesteak";
        normalized.groupTitle = "Toppings";
        normalized.label = toppingsNameById.get(id) || normalized.label;
      } else if (section === "Extra Toppings") {
        normalized.type = "extra_topping";
        normalized.groupId = "extra_toppings";
        normalized.groupTitle = "Extra Toppings";
        normalized.label = extraToppingsNameById.get(id) || normalized.label;
      } else if (section === "Lite Toppings") {
        normalized.type = "topping";
        normalized.groupId = "lite_toppings";
        normalized.groupTitle = "Lite Toppings";
        normalized.label = liteToppingsNameById.get(id) || normalized.label;
      } else if (section === "No Toppings") {
        normalized.type = "no_topping";
        normalized.groupId = "cheesesteak_no";
        normalized.groupTitle = "No Toppings";
        normalized.label = noToppingsNameById.get(id) || normalized.label;
      } else if (section === "On The Side Toppings") {
        normalized.type = "side";
        normalized.groupId = "cheesesteak_on_the_side_toppings";
        normalized.groupTitle = "On The Side Toppings";
        normalized.label = onTheSideToppingsNameById.get(id) || normalized.label;
      } else if (section === "Side Toppings") {
        normalized.type = "side";
        normalized.groupId = "cheesesteak_side_toppings";
        normalized.groupTitle = "Side Toppings";
        normalized.label = sideToppingsNameById.get(id) || normalized.label;
      } else if (section === "Would You Like To Add Extra Sides") {
        normalized.type = "side";
        normalized.groupId = "extra_sides";
        normalized.groupTitle = "Would You Like To Add Extra Sides";
        normalized.label = extraSidesNameById.get(id) || normalized.label;
      } else if (section === "Dessert") {
        normalized.type = "dessert";
        normalized.groupId = "desserts";
        normalized.groupTitle = "Dessert";
        normalized.label = dessertsNameById.get(id) || normalized.label;
      } else if (section === "Beverages") {
        normalized.type = "beverage";
        normalized.groupId = "beverages";
        normalized.groupTitle = "Beverages";
        normalized.label = beveragesNameById.get(id) || normalized.label;
      }

      const key = `${normalized.id}::${normalized.groupTitle || ""}`;
      if (!unique.has(key)) unique.set(key, normalized);
    });

    return Array.from(unique.values());
  };

  const sanitizeCheesesteakCustomizations = (selectionsInput: any[]): any[] => {
    const sectionOrder = [
      "Toast Option",
      "Cheese",
      "Toppings",
      "Extra Toppings",
      "Lite Toppings",
      "No Toppings",
      "Side Toppings",
      "Would You Like To Add Extra Sides",
      "Dessert",
      "Beverages",
    ];

    const bucket: Record<string, string[]> = {};
    sectionOrder.forEach((section) => {
      bucket[section] = [];
    });

    const pushUnique = (section: string, label: string) => {
      if (!label || !section || !bucket[section]) return;
      if (!bucket[section].includes(label)) bucket[section].push(label);
    };

    (Array.isArray(selectionsInput) ? selectionsInput : []).forEach((sel) => {
      const groupTitle = String(sel?.groupTitle || "").trim();
      const label = String(sel?.label || "").trim();
      if (!label) return;

      if (groupTitle.includes("Toast Option")) pushUnique("Toast Option", label);
      else if (groupTitle === "Cheese") pushUnique("Cheese", label);
      else if (groupTitle === "Toppings") pushUnique("Toppings", label);
      else if (groupTitle === "Extra Toppings") pushUnique("Extra Toppings", label);
      else if (groupTitle === "Lite Toppings") pushUnique("Lite Toppings", label);
      else if (groupTitle === "No Toppings") pushUnique("No Toppings", label);
      else if (groupTitle === "Side Toppings") pushUnique("Side Toppings", label);
      else if (groupTitle === "Would You Like To Add Extra Sides") pushUnique("Would You Like To Add Extra Sides", label);
      else if (groupTitle === "Dessert") pushUnique("Dessert", label);
      else if (groupTitle === "Beverages") pushUnique("Beverages", label);
    });

    return sectionOrder
      .filter((section) => bucket[section].length > 0)
      .map((section) => ({
        category: section,
        items: bucket[section],
      }));
  };

  const calculateUnitPrice = () => {
    // For Wings, use the selected quantity price instead of base price
    let basePrice = parseFloat(product.price.replace('$', ''));
    if (product.id === 'app18') {
      const selectedWingOption = wingsQuantityOptions.find(opt => opt.id === selectedWingsQuantity);
      basePrice = selectedWingOption?.price || basePrice;
    } else if (product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') {
      // For Chicken Tenders, use the selected quantity price
      const selectedTendersOption = chickenTendersQuantityOptions.find(opt => opt.id === selectedChickenTendersQuantity);
      basePrice = selectedTendersOption?.price || basePrice;
    } else if (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') {
      // For Mozzarella Sticks, use the selected quantity price
      const selectedSticksOption = mozzarellaSticksQuantityOptions.find(opt => opt.id === selectedMozzarellaSticksQuantity);
      basePrice = selectedSticksOption?.price || basePrice;
    } else if (product.id === 'app8') {
      // For Arancini Rice Ball Regular Menu, use the selected quantity price
      const selectedAranciniOption = aranciniRegularQuantityOptions.find(opt => opt.id === selectedAranciniRegularQuantity);
      basePrice = selectedAranciniOption?.price || basePrice;
    } else if (product.id === 'capp4') {
      // For Arancini Rice Ball Catering, use the selected quantity price
      const selectedAranciniOption = aranciniQuantityOptions.find(opt => opt.id === selectedAranciniQuantity);
      basePrice = selectedAranciniOption?.price || basePrice;
    } else if (product.id === 'app1') {
      // For Garlic Bread, use the selected size price
      const selectedSizeOption = garlicBreadSizeOptions.find(opt => opt.id === selectedGarlicBreadSize);
      basePrice = selectedSizeOption?.price || basePrice;
    } else if (product.id === 'app2') {
      // For Garlic Bread with Mozzarella, use the selected size price
      const selectedSizeOption = garlicBreadMozzarellaSizeOptions.find(opt => opt.id === selectedGarlicBreadMozzarellaSize);
      basePrice = selectedSizeOption?.price || basePrice;
    } else {
      // Use getSizePrice() to get the correct price based on selected size
      basePrice = getSizePrice();
    }
    
    const toppingsPrice = selectedToppings.reduce((total, toppingId) => {
      const topping = additionalToppings.find(t => t.id === toppingId);
      if (topping) {
        const distribution = toppingDistribution[toppingId] || 'whole';
        return total + getToppingPrice(topping, distribution);
      }
      const specialtyTopping = specialtyToppings.find(t => t.id === toppingId);
      if (specialtyTopping) {
        return total + (specialtyTopping.price || 0);
      }
      const specialtyToppingSecondHalf = specialtyToppingsSecondHalf.find(t => t.id === toppingId);
      if (specialtyToppingSecondHalf) {
        return total + (specialtyToppingSecondHalf.price || 0);
      }
      // Check for cheesesteak toppings
      const cheesesteakTopping = cheesesteakToppings.find(t => t.id === toppingId);
      if (cheesesteakTopping) {
        return total + (cheesesteakTopping.price || 0);
      }
      // Check for Create Your Own Cheesesteak toppings
      const createYourOwnTopping = createYourOwnCheesesteakToppings.find(t => t.id === toppingId);
      if (createYourOwnTopping) {
        return total + (createYourOwnTopping.price || 0);
      }
      // Check for extra toppings (cheesesteaks)
      const extraTopping = extraToppings.find(t => t.id === toppingId);
      if (extraTopping) {
        return total + (extraTopping.price || 0);
      }
      return total;
    }, 0);
    
    const dessertsPrice = Object.entries(selectedDesserts).reduce((total, [dessertId, qty]) => {
      const dessert = dessertItems.find(d => d.id === dessertId);
      let price = 0;
      if (dessert) {
        price = parseFloat(dessert.price.replace('$', ''));
      } else {
        // Check in Whole Cakes
        const wholeCake = wholeCakesItems.find(c => c.id === dessertId);
        if (wholeCake) {
          price = wholeCake.price;
        } else {
          // Check in Party Cakes
          const partyCake = partyCakesItems.find(c => c.id === dessertId);
          if (partyCake) {
            price = partyCake.price;
          }
        }
      }
      return total + (price * qty);
    }, 0);
    
    const beveragesPrice = Object.entries(selectedBeverages).reduce((total, [beverageId, qty]) => {
      const beverage = beverageItems.find(b => b.id === beverageId);
      const price = beverage ? parseFloat(beverage.price.replace('$', '')) : 0;
      return total + (price * qty);
    }, 0);
    
    const extraSaucePrice = selectedExtraSauce.reduce((total, sauceId) => {
      // Check in pizza extra sauce options first
      const sauce = extraSauceOptions.find(s => s.id === sauceId);
      if (sauce) return total + (sauce?.price || 0);
      
      // Check in pasta vegetables
      const vegetable = pastaVegetables.find(v => v.id === sauceId);
      if (vegetable) return total + (vegetable?.price || 0);
      
      // Check in pasta proteins
      const protein = pastaProteins.find(p => p.id === sauceId);
      if (protein) return total + (protein?.price || 0);
      
      // Check in pasta cheeses & extras
      const cheeseExtra = pastaCheesesExtras.find(c => c.id === sauceId);
      if (cheeseExtra) return total + (cheeseExtra?.price || 0);
      
      // Check in baked pasta sides
      const bakedSide = bakedPastaSides.find(b => b.id === sauceId);
      if (bakedSide) return total + (bakedSide?.price || 0);
      
      // Check in baked pasta special instructions
      const bakedInstruction = bakedPastaSpecialInstructions.find(i => i.id === sauceId);
      if (bakedInstruction) return total + (bakedInstruction?.price || 0);
      
      return total;
    }, 0);
    
    const sideToppingsPrice = selectedSideToppings.reduce((total, sideToppingId) => {
      const sideTopping = sideToppingItems.find(st => st.id === sideToppingId);
      return total + (sideTopping?.price || 0);
    }, 0);
    
    const extraSidesPrice = selectedExtraSides.reduce((total, extraSideId) => {
      const extraSide = extraSidesItems.find(es => es.id === extraSideId);
      return total + (extraSide?.price || 0);
    }, 0);
    
    const addToppingsPrice = selectedAddToppings.reduce((total, toppingId) => {
      const topping = addToppingItems.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const liteToppingsPrice = selectedLiteToppings.reduce((total, toppingId) => {
      const topping = liteToppingItems.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const noToppingsCheesesteakPrice = selectedNoToppingsCheesesteak.reduce((total, toppingId) => {
      const topping = noToppingItems.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const burgerAddPrice = selectedBurgerAdd.reduce((total, toppingId) => {
      const topping = burgerAddToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const burgerExtraPrice = selectedBurgerExtra.reduce((total, toppingId) => {
      const topping = burgerExtraToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const burgerLitePrice = selectedBurgerLite.reduce((total, toppingId) => {
      const topping = burgerLiteToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const burgerSidePrice = selectedBurgerSide.reduce((total, toppingId) => {
      const topping = burgerSideToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const briocheAddCheesePrice = selectedBriocheAddCheese ? (briocheAddCheese.find(t => t.id === selectedBriocheAddCheese)?.price || 0) : 0;
    
    const briocheExtraCheesePrice = selectedBriocheExtraCheese.reduce((total, toppingId) => {
      const topping = briocheExtraCheese.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const briocheNoPrice = selectedBriocheNo.reduce((total, toppingId) => {
      const topping = briocheNoToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const briocheSidePrice = selectedBriocheSide.reduce((total, toppingId) => {
      const topping = briocheSideToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    // Panini prices
    const paniniExtraCheesePrice = selectedPaniniExtraCheese.reduce((total, toppingId) => {
      const topping = paniniExtraCheese.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const paniniSidesPrice = selectedPaniniSides.reduce((total, toppingId) => {
      const topping = paniniSideToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const wrapAddToppingsPrice = selectedWrapAddToppings.reduce((total, toppingId) => {
      const topping = wrapAddToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const wrapExtraCheesePrice = selectedWrapExtraCheese.reduce((total, toppingId) => {
      const topping = wrapExtraCheese.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const wrapLitePrice = selectedWrapLite.reduce((total, toppingId) => {
      const topping = wrapLiteToppings
        .concat(cheesesteakWrapLiteToppings)
        .concat(grilledChickenWrapLiteToppings)
        .concat(italianWrapLiteToppings)
        .concat(tunaWrapLiteToppings)
        .concat(turkeyWrapLiteToppings)
        .concat(veggieWrapLiteToppings)
        .find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const wrapNoPrice = selectedWrapNo.reduce((total, toppingId) => {
      const topping = wrapNoToppings
        .concat(cheesesteakWrapNoToppings)
        .concat(grilledChickenWrapNoToppings)
        .concat(italianWrapNoToppings)
        .concat(tunaWrapNoToppings)
        .concat(turkeyWrapNoToppings)
        .concat(veggieWrapNoToppings)
        .find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const wrapSidePrice = selectedWrapSide.reduce((total, toppingId) => {
      const topping = wrapSideToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const wrapChipsPrice = wrapChipsQuantity * 1.00;
    
    const kidsPastaTypePrice = selectedKidsPastaType ? (kidsPastaTypes.find(t => t.id === selectedKidsPastaType)?.price || 0) : 0;
    
    const kidsPastaToppingsPrice = selectedKidsPastaToppings.reduce((total, toppingId) => {
      const topping = kidsPastaToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const buildPastaTypePrice = selectedBuildPastaType ? (kidsPastaTypes.find(t => t.id === selectedBuildPastaType)?.price || 0) : 0;
    
    const buildPastaSaucePrice = selectedBuildPastaSauce ? (buildPastaSauces.find(s => s.id === selectedBuildPastaSauce)?.price || 0) : 0;
    
    const buildPastaToppingsPrice = selectedBuildPastaToppings.reduce((total, toppingId) => {
      const topping = buildPastaToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const buildPastaSoupPrice = selectedBuildPastaSoup.reduce((total, soupId) => {
      const soup = buildPastaSoups.find(s => s.id === soupId);
      return total + (soup?.price || 0);
    }, 0);
    
    const pastaTypePrice = selectedPastaType ? (pastaTypes.find(t => t.id === selectedPastaType)?.price || 0) : 0;
    
    const pastaAdditionsPrice = selectedPastaAdditions.reduce((total, additionId) => {
      const addition = pastaAdditions.find(a => a.id === additionId);
      const price = selectedSize === 'large' && addition?.largPrice ? addition.largPrice : (addition?.price || 0);
      return total + price;
    }, 0);
    
    // Hoagie Platter Options - Calculate total based on quantity of each option
    const hoagiePlatterOptionsPrice = Object.entries(selectedHoagiePlatterOptions).reduce((total, [optionId, count]) => {
      const option = hoagiePlatterOptions.find(o => o.id === optionId);
      return total + ((option?.price || 0) * (count as number));
    }, 0);
    
    // Hoagie Platter Side Toppings - Calculate total based on quantity of each topping
    const hoagiePlatterSideToppingsPrice = Object.entries(selectedHoagiePlatterSideToppings).reduce((total, [toppingId, count]) => {
      const topping = hoagiePlatterSideToppings.find(t => t.id === toppingId);
      return total + ((topping?.price || 0) * (count as number));
    }, 0);
    
    // Wrap Platter Options - Calculate total based on quantity of each option
    const wrapPlatterOptionsPrice = Object.entries(selectedWrapPlatterOptions).reduce((total, [optionId, count]) => {
      const option = wrapPlatterOptions.find(o => o.id === optionId);
      return total + ((option?.price || 0) * (count as number));
    }, 0);
    
    // Wrap Platter Side Toppings - Calculate total based on quantity of each topping
    const wrapPlatterSideToppingsPrice = Object.entries(selectedWrapPlatterSideToppings).reduce((total, [toppingId, count]) => {
      const topping = wrapPlatterSideToppings.find(t => t.id === toppingId);
      return total + ((topping?.price || 0) * (count as number));
    }, 0);
    
    // Hot Sandwich Platter Options - Calculate total based on quantity of each option
    const hotSandwichPlatterOptionsPrice = Object.entries(selectedHotSandwichPlatterOptions).reduce((total, [optionId, count]) => {
      const option = hotSandwichPlatterOptions.find(o => o.id === optionId);
      return total + ((option?.price || 0) * (count as number));
    }, 0);
    
    // Hot Sandwich Platter Side Toppings - Calculate total based on quantity of each topping
    const hotSandwichPlatterSideToppingsPrice = Object.entries(selectedHotSandwichPlatterSideToppings).reduce((total, [toppingId, count]) => {
      const topping = hotSandwichPlatterSideToppings.find(t => t.id === toppingId);
      return total + ((topping?.price || 0) * (count as number));
    }, 0);
    
    // Hot Hoagie Sides - Calculate total for selected extra sides
    const hotHoagieSidesPrice = selectedHotHoagieSides.reduce((total, sideId) => {
      const side = hotHoagieExtraSides.find(s => s.id === sideId);
      return total + (side?.price || 0);
    }, 0);
    
    // Hot Hoagie Extras - Calculate total for extra toppings
    const hotHoagieExtrasPrice = selectedHotHoagieExtras.reduce((total, extraId) => {
      const extra = hotHoagieExtraToppings.find(e => e.id === extraId);
      return total + (extra?.price || 0);
    }, 0);
    
    // Hot Hoagie Cheese - Calculate cheese price
    const hotHoagieCheesePrice = selectedHotHoagieCheese ? (() => {
      const selectedCheese = hotHoagieSubstituteCheese.find(c => c.id === selectedHotHoagieCheese);
      if (!selectedCheese) return 0;
      
      // For Grilled Chicken Hoagie and Sausage, Peppers & Onions, charge $0.99 for any cheese except "No Cheese"
      if ((product.name === 'Grilled Chicken Hoagie' || product.name === 'Sausage, Peppers & Onions') && selectedCheese.name !== 'No Cheese') {
        return 0.99;
      }
      
      return selectedCheese.price || 0;
    })() : 0;
    
    // Cold Hoagie Cheese - Calculate cheese price
    const coldHoagieCheesePrice = selectedColdHoagieCheese ? (() => {
      const selectedCheese = coldHoagieAddCheese.find(c => c.id === selectedColdHoagieCheese);
      if (!selectedCheese) return 0;
      
      // For Tuna Hoagie and Turkey Hoagie, charge $0.99 for any cheese except "No Cheese"
      if (product.name === 'Tuna Hoagie' || product.name === 'Turkey Hoagie') {
        return selectedCheese.name === 'No Cheese' ? 0 : 0.99;
      }
      
      return selectedCheese.price || 0;
    })() : 0;
    
    // Cold Hoagie Toppings - Calculate toppings price
    const coldHoagieToppingsPrice = selectedColdHoagieToppings.reduce((total, toppingId) => {
      const topping = coldHoagieAddToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    // Cold Hoagie Extras - Calculate extra toppings price
    const coldHoagieExtrasPrice = selectedColdHoagieExtras.reduce((total, extraId) => {
      const extra = coldHoagieExtraToppings.find(e => e.id === extraId);
      return total + (extra?.price || 0);
    }, 0);
    
    // Cold Hoagie Lite - Calculate lite options price
    const coldHoagieLitePrice = selectedColdHoagieLite.reduce((total, liteId) => {
      const lite = coldHoagieLiteToppings.find(l => l.id === liteId);
      return total + (lite?.price || 0);
    }, 0);
    
    // Cold Hoagie No - Calculate no options price
    const coldHoagieNoPrice = selectedColdHoagieNo.reduce((total, noId) => {
      const no = coldHoagieNoToppings.find(n => n.id === noId);
      return total + (no?.price || 0);
    }, 0);
    
    // Cold Hoagie Sides - Calculate side toppings price
    const coldHoagieSidesPrice = selectedColdHoagieSides.reduce((total, sideId) => {
      const side = coldHoagieSideToppings.find(s => s.id === sideId);
      return total + (side?.price || 0);
    }, 0);
    
    // Cold Hoagie Extra Sides - Calculate extra sides price
    const coldHoagieExtraSidesPrice = selectedColdHoagieExtraSides.reduce((total, sideId) => {
      const side = hotHoagieExtraSides.find(s => s.id === sideId);
      return total + (side?.price || 0);
    }, 0);
    
    // Chips Quantity - Calculate chips price (1.00 per chip)
    const chipsPrice = chipsQuantity * 1.00;
    
    // Create Your Own Salad - Calculate extra dressing price
    const saladExtraDressingPrice = selectedExtraDressing.reduce((total, dressingId) => {
      const dressing = saladExtraDressingOptions.find(d => d.id === dressingId);
      return total + (dressing?.price || 0);
    }, 0);
    
    // Create Your Own Salad - Calculate extra toppings price
    const saladExtraToppingsPrice = selectedExtraToppings.reduce((total, toppingId) => {
      const topping = saladExtraToppingsOptions.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    // Cheesesteak Cheese - Calculate cheese price for Create Your Own Cheesesteaks
    const cheesesteakCheesePrice = selectedCheese ? (
      (product.name === 'Chicken Cheesesteak Hoagie' || product.name === 'Cheesesteak Hoagie' || product.name === 'Cooper Passiesteak' || product.name === 'Buffalo Chicken Cheesesteak' || product.name === "Passariello's Cheesesteak" || product.name === 'Pizza Steak') 
        ? 0 
        : (cheeseOptions.find(c => c.id === selectedCheese)?.price || 0)
    ) : 0;
    
    // Appetizers Instructions prices
    const friesInstructionsPrice = selectedFriesInstructions.reduce((total, instructionId) => {
      const instruction = friesInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const garlicStickInstructionsPrice = selectedGarlicStickInstructions.reduce((total, instructionId) => {
      const instruction = garlicStickInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const garlicBreadInstructionsPrice = selectedGarlicBreadInstructions.reduce((total, instructionId) => {
      const instruction = garlicBreadInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const garlicBreadMozzarellaInstructionsPrice = selectedGarlicBreadMozzarellaInstructions.reduce((total, instructionId) => {
      const instruction = garlicBreadMozzarellaInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const mozzarellaSticksInstructionsPrice = selectedMozzarellaSticksInstructions.reduce((total, instructionId) => {
      const instruction = mozzarellaSticksInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const onionRingsInstructionsPrice = selectedOnionRingsInstructions.reduce((total, instructionId) => {
      const instruction = onionRingsInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);

    const macAndCheeseBitesInstructionsPrice = selectedMacAndCheeseBitesInstructions.reduce((total, instructionId) => {
      const instruction = macAndCheeseBitesInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);

    const broccoliCheddarBitesInstructionsPrice = selectedBroccoliCheddarBitesInstructions.reduce((total, instructionId) => {
      const instruction = broccoliCheddarBitesInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const passarielloFriesInstructionsPrice = selectedPassarielloFriesInstructions.reduce((total, instructionId) => {
      const instruction = passarielloFriesInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const cheddarSteakFriesInstructionsPrice = selectedCheddarSteakFriesInstructions.reduce((total, instructionId) => {
      const instruction = cheddarSteakFriesInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    // Wings prices
    const wingsSpecialInstructionsPrice = selectedWingsSpecialInstructions.reduce((total, instructionId) => {
      const instruction = wingsSpecialInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    const wingsExtraSaucePrice = Object.values(selectedWingsExtraSauce).reduce((total, size) => {
      if (size === '4oz') return total + 2.49;
      if (size === '8oz') return total + 4.99;
      if (size === '16oz') return total + 8.99;
      return total;
    }, 0);
    
    const wingsExtraCheeseRanchPrice = Object.values(selectedWingsExtraCheeseRanch).reduce((total, size) => {
      if (size === '4oz') return total + 2.49;
      if (size === '8oz') return total + 4.99;
      if (size === '16oz') return total + 8.99;
      return total;
    }, 0);
    
    // Chicken Tenders prices
    const chickenTendersSpecialInstructionsPrice = selectedChickenTendersSpecialInstructions.reduce((total, instructionId) => {
      const instruction = chickenTendersSpecialInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    // Mozzarella Sticks prices (app6)
    const mozzarellaSticksSpecialInstructionsPrice = selectedMozzarellaSticksSpecialInstructions.reduce((total, instructionId) => {
      const instruction = mozzarellaSticksSpecialInstructionsOptions.find(i => i.id === instructionId);
      return total + (instruction?.price || 0);
    }, 0);
    
    
    const chickenTendersExtraSaucePrice = Object.values(selectedChickenTendersExtraSauce).reduce((total, size) => {
      if (size === '4oz') return total + 2.49;
      if (size === '8oz') return total + 4.99;
      if (size === '16oz') return total + 8.99;
      return total;
    }, 0);
    
    const chickenTendersExtraCheeseRanchPrice = Object.values(selectedChickenTendersExtraCheeseRanch).reduce((total, size) => {
      if (size === '4oz') return total + 2.49;
      if (size === '8oz') return total + 4.99;
      if (size === '16oz') return total + 8.99;
      return total;
    }, 0);
    
    // Traditional Dinners prices
    const traditionalDinnersSidesPrice = selectedTraditionalDinnersSides.reduce((total, sideId) => {
      const side = traditionalDinnersSides.find(s => s.id === sideId);
      return total + (side?.price || 0);
    }, 0);
    
    const traditionalDinnersSoupsSaladsPrice = selectedTraditionalDinnersSoupsSalads.reduce((total, itemId) => {
      const item = traditionalDinnersSoupsSalads.find(i => i.id === itemId);
      return total + (item?.price || 0);
    }, 0);
    
    const extraBreadPrice = extraBreadQuantity * 0.55;
    
    // Kids Pasta and Meatball (k6) prices
    const kidsPastaMeatballTypePrice = selectedKidsPastaMeatballType ? (kidsPastaTypes.find(t => t.id === selectedKidsPastaMeatballType)?.price || 0) : 0;
    
    const kidsPastaMeatballToppingsPrice = selectedKidsPastaMeatballToppings.reduce((total, toppingId) => {
      const topping = kidsPastaMeatballToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    // Kids Baked items (k2, k3, k4) prices
    const kidsBakedExtraPrice = selectedKidsBakedExtraToppings.reduce((total, toppingId) => {
      const topping = kidsBakedExtraToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const kidsBakedLitePrice = selectedKidsBakedLiteToppings.reduce((total, toppingId) => {
      const topping = kidsBakedLiteToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    const kidsBakedNoPrice = selectedKidsBakedNoToppings.reduce((total, toppingId) => {
      const topping = kidsBakedNoToppings.find(t => t.id === toppingId);
      return total + (topping?.price || 0);
    }, 0);
    
    // Seafood prices (sf-6, sf-7, sf-8, sf-9, sf-10)
    const seafoodPastaTypePrice = selectedSeafoodPastaType ? (seafoodPastaTypes.find(t => t.id === selectedSeafoodPastaType)?.price || 0) : 0;
    
    // Calamari Marinara Tray prices
    const calamariPastaTypePrice = selectedCalamariPastaType ? (calamariMarinaraPastaTypes.find(t => t.id === selectedCalamariPastaType)?.price || 0) : 0;
    
    // Mussels Tray prices
    const musselsPastaTypePrice = selectedMusselsPastaType ? (musselsPastaTypes.find(t => t.id === selectedMusselsPastaType)?.price || 0) : 0;
    
    // Seafood Combo Tray prices
    const seafoodComboPastaTypePrice = selectedSeafoodComboPastaType ? (seafoodComboPastaTypes.find(t => t.id === selectedSeafoodComboPastaType)?.price || 0) : 0;
    
    // Shrimp Marinara Tray prices
    const shrimpMarinaraPastaTypePrice = selectedShrimpMarinaraPastaType ? (shrimpMarinaraPastaTypes.find(t => t.id === selectedShrimpMarinaraPastaType)?.price || 0) : 0;
    
    // Pizza Steak Extras price
    const pizzaSteakExtrasPrice = pizzaSteakExtras === 'extra-cheese' ? 0.99 : 0;
    
    // Pizza Dippings price
    const pizzaDippingsPrice = Object.entries(selectedPizzaDippings).reduce((total, [dippingId, qty]) => {
      const dipping = pizzaDippingsOptions.find(d => d.id === dippingId);
      return total + ((dipping?.price || 0) * qty);
    }, 0);

    const extraSideSaucesPrice = (product.name === 'Buffalo Chicken Stromboli') ? Object.entries(extraSideSauces).reduce((total, [id, qty]) => {
       return total + (qty * 0.99);
    }, 0) : 0;
    
    return (basePrice + toppingsPrice + dessertsPrice + beveragesPrice + extraSaucePrice + sideToppingsPrice + extraSidesPrice + addToppingsPrice + liteToppingsPrice + noToppingsCheesesteakPrice + burgerAddPrice + burgerExtraPrice + burgerLitePrice + burgerSidePrice + briocheAddCheesePrice + briocheExtraCheesePrice + briocheNoPrice + briocheSidePrice + paniniExtraCheesePrice + paniniSidesPrice + wrapAddToppingsPrice + wrapExtraCheesePrice + wrapLitePrice + wrapNoPrice + wrapSidePrice + wrapChipsPrice + kidsPastaTypePrice + kidsPastaToppingsPrice + buildPastaTypePrice + buildPastaSaucePrice + buildPastaToppingsPrice + buildPastaSoupPrice + pastaTypePrice + pastaAdditionsPrice + hoagiePlatterOptionsPrice + hoagiePlatterSideToppingsPrice + wrapPlatterOptionsPrice + wrapPlatterSideToppingsPrice + hotSandwichPlatterOptionsPrice + hotSandwichPlatterSideToppingsPrice + hotHoagieSidesPrice + hotHoagieExtrasPrice + hotHoagieCheesePrice + coldHoagieCheesePrice + coldHoagieToppingsPrice + coldHoagieExtrasPrice + coldHoagieLitePrice + coldHoagieNoPrice + coldHoagieSidesPrice + coldHoagieExtraSidesPrice + chipsPrice + saladExtraDressingPrice + saladExtraToppingsPrice + cheesesteakCheesePrice + friesInstructionsPrice + garlicStickInstructionsPrice + garlicBreadInstructionsPrice + garlicBreadMozzarellaInstructionsPrice + mozzarellaSticksInstructionsPrice + onionRingsInstructionsPrice + macAndCheeseBitesInstructionsPrice + broccoliCheddarBitesInstructionsPrice + passarielloFriesInstructionsPrice + cheddarSteakFriesInstructionsPrice + wingsSpecialInstructionsPrice + wingsExtraSaucePrice + wingsExtraCheeseRanchPrice + chickenTendersSpecialInstructionsPrice + chickenTendersExtraSaucePrice + chickenTendersExtraCheeseRanchPrice + mozzarellaSticksSpecialInstructionsPrice + traditionalDinnersSidesPrice + traditionalDinnersSoupsSaladsPrice + extraBreadPrice + kidsPastaMeatballTypePrice + kidsPastaMeatballToppingsPrice + kidsBakedExtraPrice + kidsBakedLitePrice + kidsBakedNoPrice + seafoodPastaTypePrice + calamariPastaTypePrice + musselsPastaTypePrice + seafoodComboPastaTypePrice + shrimpMarinaraPastaTypePrice + pizzaSteakExtrasPrice + pizzaDippingsPrice + extraSideSaucesPrice).toFixed(2);
  };

  // Helper to strip size selections
  const stripSizeSelections = (selections: any[]) => {
    return selections.filter(s => {
      if (s.type === 'size') return false;
      if (s.groupTitle === 'Size') return false;
      if (s.type === 'required_option') {
          if (/Medium|Large|Jumbo/i.test(s.label || '')) return false;
          if (s.label && (s.label.includes('16"') || s.label.includes('14"') || s.label.includes('12"'))) return false;
      }
      return true;
    });
  };

  const calculateTotal = () => {
    return (parseFloat(calculateUnitPrice()) * quantity).toFixed(2);
  };

  // ============================================================
  // FILTER SELECTION SOURCES BY PRODUCT - PREVENTS "PHANTOM" SELECTIONS
  // ============================================================
  const filterSelectionSourcesByProduct = (
    allSources: Record<string, RawSelectionShape>,
    currentProduct: Product
  ): Record<string, RawSelectionShape> => {
    const filtered: Record<string, RawSelectionShape> = {};
    
    // ALWAYS include these base states for ALL products
    const alwaysInclude = [
      'selectedDesserts',
      'selectedBeverages',
      'selectedSpecialInstructions',
      'toastRoll'
    ];
    alwaysInclude.forEach(key => {
      if (allSources[key]) filtered[key] = allSources[key];
    });
    
    // PIZZA-specific states
    if (currentProduct.category === 'pizzas' || currentProduct.category === 'specialty-pizza' || 
        currentProduct.category === 'brooklyn-pizza' || currentProduct.category === 'minucci-pizzas') {
      const pizzaKeys = [
        'selectedSize', 'selectedCheese', 'selectedToppings', 'selectedExtraSauce',
        'selectedNoToppings', 'selectedBrooklynInstructions', 'selectedPizzaDippings',
        'selectedSauces'
      ];
      pizzaKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // BY-THE-SLICE specific
    if (currentProduct.category === 'by-the-slice') {
      const sliceKeys = ['selectedSize', 'selectedToppings'];
      sliceKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // STROMBOLI/CALZONE specific
    if (currentProduct.category === 'stromboli-calzone') {
      const strombKeys = ['selectedSize', 'selectedToppings', 'selectedIncluded'];
      strombKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }

    // CHEESESTEAKS specific
    if (currentProduct.category === 'cheesesteaks') {
      const cheesesteakKeys = [
        'toastRoll',
        'selectedCheese',
        'selectedToppings',
        'selectedNoToppingsCheesesteak',
        'selectedSideToppings',
        'selectedExtraSides',
        'selectedCheesesteakSideToppingsRequired'
      ];
      cheesesteakKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // WINGS specific (app18 or category 'wings')
    if (currentProduct.id === 'app18' || currentProduct.category === 'wings') {
      const wingsKeys = [
        'selectedWingsQuantity', 'selectedWingsSauce', 'selectedWingsSpecialInstructions',
        'selectedWingsExtraCheeseRanch'
      ];
      wingsKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // CHICKEN TENDERS specific (app6, wing3, capp2)
    if (currentProduct.id === 'app6' || currentProduct.id === 'wing3' || currentProduct.id === 'capp2') {
      const tendersKeys = [
        'selectedChickenTendersQuantity', 'selectedChickenTendersSauce',
        'selectedChickenTendersSpecialInstructions',
        'selectedChickenTendersExtraCheeseRanch', 'selectedSubstituteSauce'
      ];
      tendersKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // MOZZARELLA STICKS specific (app4, wing4, capp3)
    if (currentProduct.id === 'app4' || currentProduct.id === 'wing4' || currentProduct.id === 'capp3') {
      const sticksKeys = [
        'selectedMozzarellaSticksQuantity', 'selectedMozzarellaSticksSpecialInstructions',
        'selectedMozzarellaSticksInstructions'
      ];
      sticksKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // ARANCINI specific (app8, capp4)
    if (currentProduct.id === 'app8') {
      const aranciniKeys = ['selectedAranciniRegularQuantity', 'selectedAranciniRegularInstructions', 'selectedMozzarellaSticksSpecialInstructions'];
      aranciniKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    if (currentProduct.id === 'capp4') {
      const aranciniKeys = ['selectedAranciniQuantity', 'selectedAranciniInstructions'];
      aranciniKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // GARLIC BREAD specific (app1, app2)
    if (currentProduct.id === 'app1') {
      const garlicKeys = ['selectedGarlicBreadSize', 'selectedGarlicBreadInstructions'];
      garlicKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    if (currentProduct.id === 'app2') {
      const garlicKeys = ['selectedGarlicBreadMozzarellaSize', 'selectedGarlicBreadMozzarellaInstructions'];
      garlicKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }

    // ONION RINGS specific (app5)
    if (currentProduct.id === 'app5') {
      const onionKeys = ['selectedOnionRingsInstructions'];
      onionKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }

    // MAC & CHEESE BITES specific (app13)
    if (currentProduct.id === 'app13') {
      const macKeys = ['selectedMacAndCheeseBitesInstructions'];
      macKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }

    // BROCCOLI & CHEDDAR BITES specific (app7)
    if (currentProduct.id === 'app7') {
      const broccoliKeys = ['selectedBroccoliCheddarBitesInstructions'];
      broccoliKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }

    // FRIES specific (app9, app10, app11, app12)
    if (['app9', 'app10', 'app11', 'app12'].includes(currentProduct.id)) {
      const friesKeys = [
        'selectedFriesInstructions',
        'selectedPassarielloFriesInstructions',
        'selectedCheddarSteakFriesInstructions'
      ];
      friesKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }

    // GARLIC STICK specific (app3)
    if (currentProduct.id === 'app3') {
       const keys = ['selectedGarlicStickInstructions'];
       keys.forEach(key => {
         if (allSources[key]) filtered[key] = allSources[key];
       });
    }
    
    // SALADS specific
    if (currentProduct.category === 'salads' || currentProduct.category === 'salad-bowl') {
      const saladKeys = [
        'selectedSaladBase', 'selectedSaladDressing', 'selectedDressingInstruction',
        'selectedExtraDressings', 'selectedSaladSpecialInstructions', 'selectedAddToppings',
        'selectedSaladToppings', 'selectedDressingInstructions', 'selectedExtraDressing',
        'selectedExtraToppings', 'selectedLiteToppings'
      ];
      saladKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // HOAGIES (hot) specific
    if (currentProduct.category === 'hot-hoagies') {
      const hoagieKeys = [
        'selectedHotHoagieCheese', 'selectedHotHoagieExtras', 'selectedHotHoagieSides',
        'selectedHotHoagieInstructions', 'selectedGrilledChickenNoToppings',
        'selectedSausagePeppersOnionsNoToppings', 'selectedCheeseBurgerDeluxeNoToppings',
        'selectedBriocheGrilledChickenNoToppings', 'selectedGrilledChickenSideToppingsRequired',
        'selectedCheesesteakSideToppingsRequired', 'selectedNoToppingsCheesesteak',
        'selectedSideToppings', 'selectedAddToppings', 'toastRoll'
      ];
      hoagieKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // HOAGIES (cold) specific
    if (currentProduct.category === 'cold-hoagies') {
      const coldKeys = [
        'selectedColdHoagieCheese', 'selectedColdHoagieSideToppingsRequired',
        'selectedColdHoagieToppings', 'selectedColdHoagieExtras', 'selectedColdHoagieLite',
        'selectedColdHoagieNo', 'selectedColdHoagieSides', 'selectedColdHoagieExtraSides'
      ];
      coldKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // BURGERS specific
    if (currentProduct.category === 'burgers') {
      const burgerKeys = [
        'selectedBurgerAdd', 'selectedBurgerExtra', 'selectedBurgerLite',
        'selectedBurgerSide', 'selectedBurgerCheese', 'toastRoll'
      ];
      burgerKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // BRIOCHE specific
    if (currentProduct.category === 'brioche') {
      const briocheKeys = [
        'selectedBriocheAddCheese', 'selectedBriocheExtraCheese',
        'selectedBriocheNo', 'selectedBriocheSide', 'toastRoll'
      ];
      briocheKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // PANINI specific
    if (currentProduct.category === 'panini') {
      const paniniKeys = [
        'selectedPaniniType', 'selectedPaniniExtraCheese', 'selectedPaniniLite',
        'selectedPaniniNo', 'selectedPaniniSides', 'selectedPaniniCheese'
      ];
      paniniKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // WRAPS specific
    if (currentProduct.category === 'wraps') {
      const wrapKeys = [
        'selectedWrapType', 'selectedWrapCheese', 'selectedWrapAddToppings',
        'selectedWrapExtraCheese', 'selectedWrapLite', 'selectedWrapNo', 'selectedWrapSide'
      ];
      wrapKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // PASTA specific
    if (currentProduct.category === 'baked-pasta-dinners' || currentProduct.category === 'traditional-dinners') {
      const pastaKeys = [
        'selectedPastaType', 'selectedPastaAdditions', 'selectedTraditionalDinnersSides',
        'selectedTraditionalDinnersSoupsSalads'
      ];
      pastaKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // KIDS MENU specific
    if (currentProduct.category === 'kids-menu') {
      const kidsKeys = [
        'selectedKidsPastaType', 'selectedKidsPastaSauce', 'selectedKidsPastaToppings',
        'selectedKidsPastaSpecialInstructions', 'selectedBuildPastaType', 'selectedBuildPastaSauce',
        'selectedBuildPastaToppings', 'selectedBuildPastaSoup', 'selectedKidsBakedExtraToppings',
        'selectedKidsBakedLiteToppings', 'selectedKidsBakedNoToppings', 'selectedKidsPastaMeatballType',
        'selectedKidsPastaMeatballSpecialInstructions', 'selectedKidsPastaMeatballToppings'
      ];
      kidsKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // CATERING specific
    if (currentProduct.category?.startsWith('catering-')) {
      const cateringKeys = [
        'selectedPastaType', 'selectedSeafoodPastaType', 'selectedHoagiePlatterOptions',
        'selectedHoagiePlatterCut', 'selectedHoagiePlatterSideToppings', 'selectedWrapPlatterOptions',
        'selectedWrapPlatterWrapType', 'selectedWrapPlatterSideToppings', 'selectedHotSandwichPlatterOptions',
        'selectedHotSandwichPlatterCut', 'selectedHotSandwichPlatterSideToppings'
      ];
      cateringKeys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // Additional product-specific filters
    // Marinara appetizers
    if (['app7', 'app19'].includes(currentProduct.id)) {
      if (allSources['selectedMarinaraAppetizerSauce']) {
        filtered['selectedMarinaraAppetizerSauce'] = allSources['selectedMarinaraAppetizerSauce'];
      }
    }
    
    // Pasta e Fagioli
    if (currentProduct.id === 'a1') {
      const keys = ['selectedPastaFagioliSubstitute', 'selectedPastaFagioliSpecialInstructions', 'selectedPastaFagioliSubstituteCracker'];
      keys.forEach(key => {
        if (allSources[key]) filtered[key] = allSources[key];
      });
    }
    
    // Seafood items
    if (currentProduct.id === 'app14') {
      if (allSources['selectedCalamariSubSauce']) filtered['selectedCalamariSubSauce'] = allSources['selectedCalamariSubSauce'];
    }
    if (currentProduct.id === 'app15') {
      if (allSources['selectedMusselsSauce']) filtered['selectedMusselsSauce'] = allSources['selectedMusselsSauce'];
    }
    if (currentProduct.id === 'app16') {
      if (allSources['selectedSeafoodComboSauce']) filtered['selectedSeafoodComboSauce'] = allSources['selectedSeafoodComboSauce'];
    }
    if (currentProduct.id === 'app17') {
      if (allSources['selectedShrimpMarinaraSubSauce']) filtered['selectedShrimpMarinaraSubSauce'] = allSources['selectedShrimpMarinaraSubSauce'];
    }
    
    // Only include non-empty values
    const finalFiltered: Record<string, RawSelectionShape> = {};
    Object.entries(filtered).forEach(([key, value]) => {
      // Skip empty arrays/strings/records
      if (value.kind === 'stringArray' && value.value.length === 0) return;
      if (value.kind === 'singleString' && value.value === '') return;
      if (value.kind === 'stringRecord' && Object.keys(value.value).length === 0) return;
      if (value.kind === 'numberRecord' && Object.keys(value.value).length === 0) return;
      if (value.kind === 'booleanRecord' && Object.keys(value.value).length === 0) return;
      finalFiltered[key] = value;
    });
    
    return finalFiltered;
  };

  // Calculate display price (reuses the same logic as the cart for base price)
  const displayPrice = useMemo(() => {
    let basePrice = parseFloat(product.price.replace('$', ''));
    
    if (product.id === 'app18') {
      const selectedWingOption = wingsQuantityOptions.find(opt => opt.id === selectedWingsQuantity);
      basePrice = selectedWingOption?.price || basePrice;
    } else if (product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') {
      const selectedTendersOption = chickenTendersQuantityOptions.find(opt => opt.id === selectedChickenTendersQuantity);
      basePrice = selectedTendersOption?.price || basePrice;
    } else if (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') {
      const selectedSticksOption = mozzarellaSticksQuantityOptions.find(opt => opt.id === selectedMozzarellaSticksQuantity);
      basePrice = selectedSticksOption?.price || basePrice;
    } else if (product.id === 'app8') {
      const selectedAranciniOption = aranciniRegularQuantityOptions.find(opt => opt.id === selectedAranciniRegularQuantity);
      basePrice = selectedAranciniOption?.price || basePrice;
    } else if (product.id === 'capp4') {
      const selectedAranciniOption = aranciniQuantityOptions.find(opt => opt.id === selectedAranciniQuantity);
      basePrice = selectedAranciniOption?.price || basePrice;
    } else if (product.id === 'app1') {
      const selectedSizeOption = garlicBreadSizeOptions.find(opt => opt.id === selectedGarlicBreadSize);
      basePrice = selectedSizeOption?.price || basePrice;
    } else if (product.id === 'app2') {
      const selectedSizeOption = garlicBreadMozzarellaSizeOptions.find(opt => opt.id === selectedGarlicBreadMozzarellaSize);
      basePrice = selectedSizeOption?.price || basePrice;
    } else {
      basePrice = getSizePrice();
    }
    
    return `$${basePrice.toFixed(2)}`;
  }, [
    product.id,
    product.price,
    selectedSize,
    selectedWingsQuantity,
    selectedChickenTendersQuantity,
    selectedMozzarellaSticksQuantity,
    selectedAranciniRegularQuantity,
    selectedAranciniQuantity,
    selectedGarlicBreadSize,
    selectedGarlicBreadMozzarellaSize
  ]);

  // Get suggested items - mix of same category and complementary items
  const getSuggestedItems = () => {
    // Show specific items: Onion rings, mozzarella sticks and wings
    const specificItems = ['onion rings', 'mozzarella sticks', 'wings'];
    
    const pairingItems = allProducts.filter(p => 
      specificItems.some(item => p.name.toLowerCase().includes(item))
    ).slice(0, 3);
    
    // If we found the specific items, return them
    if (pairingItems.length >= 3) {
      return pairingItems;
    }
    
    // Fallback: Same category items
    const sameCategoryItems = allProducts
      .filter(p => p.category === product.category && p.id !== product.id)
      .slice(0, 2);
    
    // Complementary items from different categories
    const complementaryCategories: { [key: string]: string[] } = {
      'pizzas': ['appetizers', 'salads', 'desserts', 'beverages'],
      'appetizers': ['pizzas', 'wings', 'sides'],
      'entrees': ['salads', 'sides', 'desserts'],
      'cheesesteaks': ['sides', 'beverages', 'appetizers'],
      'wings': ['sides', 'beverages', 'appetizers'],
      'salads': ['entrees', 'sides', 'beverages'],
      'seafood': ['salads', 'sides', 'desserts'],
      'wraps': ['sides', 'salads', 'beverages'],
      'hot-hoagies': ['sides', 'salads', 'beverages'],
      'cold-hoagies': ['sides', 'salads', 'beverages'],
      'brioche': ['sides', 'salads', 'beverages'],
      'paninis': ['sides', 'salads', 'beverages'],
      'burgers': ['sides', 'beverages', 'appetizers'],
      'sides': ['pizzas', 'burgers', 'wings'],
      'soups': ['salads', 'sides', 'beverages'],
      'kids': ['sides', 'beverages', 'desserts'],
      'desserts': ['beverages'],
      'beverages': ['desserts', 'appetizers', 'sides'],
    };
    
    const categories = complementaryCategories[product.category] || ['pizzas', 'appetizers', 'desserts'];
    const complementaryItems = allProducts
      .filter(p => categories.includes(p.category))
      .slice(0, 1);
    
    return [...sameCategoryItems, ...complementaryItems].slice(0, 3);
  };

  const suggestedItems = getSuggestedItems();

  return (
    <div 
      data-testid="product-detail-root"
      className="product-detail-root product-detail-page bg-white flex flex-col min-h-0 box-border overflow-x-hidden lg:fixed lg:left-0 lg:right-0 lg:bottom-0 lg:min-h-0 lg:w-screen lg:overflow-hidden"
      style={{
        top: 'var(--appHeaderH, 0px)',
        height: 'calc(100dvh - var(--appHeaderH, 0px))',
        maxHeight: 'calc(100dvh - var(--appHeaderH, 0px))',
      }}
    >
      {/* Mobile Header - Only on Mobile */}
      <div className="lg:hidden flex-shrink-0">
        <MobileHeader
          deliveryMode={deliveryMode}
          currentLocation={currentLocation}
          scheduledTime={scheduledTime}
          cartItemsCount={cartItemsCount}
          onLocationClick={onLocationClick}
          onCartClick={onCartClick}
          mode={mode}
          onModeChange={onModeChange || (() => {})}
          activeCategory={activeCategory}
          onCategoryChange={onCategoryChange}
        />
      </div>

      {/* Back Button Section */}
      <div className="sticky top-0 z-50 bg-white border-b px-4 lg:px-8 py-4 lg:py-0 flex-shrink-0 lg:h-[52px] lg:flex lg:items-center box-border">
        <div className="flex items-center gap-3">
          <Button
            onClick={onBack}
            className="lg:flex hidden bg-[#8B734B] hover:bg-[#6d5a3c] text-white gap-2"
          >
            BACK TO MENU
            <ChevronRight className="w-4 h-4" />
          </Button>
          {/* Mobile Back Button */}
          <Button
            onClick={onBack}
            className="lg:hidden bg-[#8B734B] hover:bg-[#6d5a3c] text-white flex items-center gap-2"
          >
            <ChevronRight className="w-5 h-5 rotate-180" />
            <span>Back to Menu</span>
          </Button>
          
          {/* Category breadcrumb */}
          {product.category && (
            <div className="hidden lg:flex items-center gap-2 text-sm">
              <ChevronRight className="w-4 h-4 text-gray-400" />
              <span className="uppercase font-medium text-gray-700">
                {(() => {
                  const categoryMap: { [key: string]: string } = {
                    'pizzas': 'Pizza',
                    'specialty-pizza': 'Specialty Pizza',
                    'brooklyn-pizza': 'Brooklyn Style Pizza',
                    'stromboli-calzone': 'Stromboli/Calzone & Turnover',
                    'by-the-slice': 'By The Slice',
                    'cheesesteaks': 'Cheesesteaks',
                    'hot-hoagies': 'Hot Hoagies',
                    'cold-hoagies': 'Cold Hoagies',
                    'burgers': 'Burgers',
                    'brioche': 'Brioche',
                    'paninis': 'Panini',
                    'appetizers': 'Appetizers',
                    'wings': 'Wings/Tenders/Mozzarella Sticks',
                    'wraps': 'Wraps',
                    'traditional-dinners': 'Traditional Dinners',
                    'create-pasta': 'Create Your Own Pasta',
                    'pasta': 'Pasta / Baked Pasta / Gnocchi',
                    'sides': 'Sides',
                    'seafood': 'Seafood',
                    'create-salad': 'Create Your Own Salad',
                    'salads-soups': 'Specialty Salad & Soup',
                    'kids': "Kid's Menu",
                    'desserts': 'Dessert / Pizzelle / Gelati',
                    'beverages': 'Beverage',
                    'catering': 'Catering',
                    'catering-appetizers': 'Catering Appetizers',
                    'catering-entrees': 'Entrees',
                    'catering-pasta': 'Pasta & Baked Pasta',
                    'catering-seafood-pasta': 'Seafood Pasta',
                    'catering-sides': 'Catering Sides',
                    'catering-salad-soups': 'Salad/Soups',
                    'catering-hoagies-wraps': 'Hoagies/Wraps Platters',
                    'catering-whole-cakes': 'Whole Cakes',
                    'catering-party-trays': 'Party Trays',
                    'catering-desserts': 'Desserts',
                    'catering-beverages': 'Beverages',
                  };
                  return categoryMap[product.category] || product.category;
                })()}
              </span>
            </div>
          )}
        </div>
      </div>

      {/* Product Hero Section - Mobile Only (Desktop uses 2-column layout below) */}
      <div className="w-full bg-[#f3f4ea] lg:hidden">
        <div className="max-w-[1380px] mx-auto">
          {/* Product Image */}
          <div className="aspect-[3/2] sm:aspect-[4/3] bg-[#F5F3EB] overflow-hidden w-full relative">
            <ImageWithFallback               src={product.image}
              alt={product.name}
              className="absolute inset-0 w-full h-full object-contain md:object-cover object-center"
              style={{ 
                imageRendering: 'crisp-edges',
                WebkitBackfaceVisibility: 'hidden',
                backfaceVisibility: 'hidden',
                transform: 'translateZ(0)'
              }}
            />
          </div>
        </div>
          
          {/* Product Info - Full Width */}
          <div className="w-full bg-white">
            <div className="max-w-[1380px] mx-auto px-4 py-6">
              {/* Product Name */}
              <h1 className="text-2xl font-bold text-gray-900 mb-3">
                {product.name.toLowerCase().includes('chicken tenders') ? 'Chicken Tenders W/FF' : product.name}
              </h1>
              
              {/* Choice of two sides - Only for traditional dinners and fish */}
              {(product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) && (
                <p className="text-gray-900 italic mb-3">(Choice of two sides)</p>
              )}
              
              {/* Price */}
              <p className="text-xl text-gray-900 mb-3 xl:mb-4">
                {product.category === 'catering-hoagies-wraps' ? '$0.00' : displayPrice}
              </p>

              {/* Description */}
              <p 
                className="text-gray-600 mb-4 xl:mb-5"
                dangerouslySetInnerHTML={{
                  __html: (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3')
                    ? getMozzarellaSticksDescription() 
                    : (product.id === 'wing3' || product.id === 'app6' || product.id === 'capp2')
                      ? getChickenTendersDescription()
                      : (product.id === 'app8' || product.id === 'capp4')
                        ? getAranciniRiceBallDescription()
                        : (product.id === 'app18' || (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') || (product.category === 'catering-appetizers' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4'))
                          ? getWingsDescription()
                          : product.description
                }}
              />

              {/* Garlic Bread Size Selection - Mobile - Only for app1 */}
              {product.id === 'app1' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select size</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedGarlicBreadSize('1pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadSize === '1pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 PCS
                    </button>
                    <button
                      onClick={() => setSelectedGarlicBreadSize('2pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadSize === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Garlic Bread with Mozzarella Size Selection - Mobile - Only for app2 */}
              {product.id === 'app2' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select size</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedGarlicBreadMozzarellaSize('1pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadMozzarellaSize === '1pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 PCS
                    </button>
                    <button
                      onClick={() => setSelectedGarlicBreadMozzarellaSize('2pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadMozzarellaSize === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 PCS
                    </button>
                  </div>
                </div>
              )}

              {/* Size Selection - Mobile */}
              {((!product.name.includes('Sicilian') && !product.name.includes('Pan Pizza') && !product.name.includes('Gluten Free') && product.category !== 'brooklyn-pizza' && product.category !== 'cheesesteaks' && product.category !== 'wings' && product.category !== 'hot-hoagies' && product.category !== 'cold-hoagies' && product.category !== 'by-the-slice' && product.category !== 'burgers' && product.category !== 'brioche' && product.category !== 'paninis' && product.category !== 'wraps' && product.category !== 'appetizers' && product.category !== 'traditional-dinners' && product.category !== 'pasta' && product.category !== 'baked-pasta' && product.category !== 'create-salad' && product.category !== 'salads' && product.category !== 'soups' && product.category !== 'kids' && product.category !== 'beverages' && product.category !== 'desserts' && product.category !== 'catering-desserts' && product.category !== 'pizzelle' && product.category !== 'gelati' && product.id !== 'cp-1' && product.id !== 'k1' && product.id !== 'stromboli-8' && product.id !== 'cptray1' && product.id !== 'cptray2' && product.id !== 'cptray3' && product.id !== 'cptray4' && product.id !== 'cptray5' && product.id !== 'cptray6') || product.category === 'catering-salad-soups' || product.id === 'cyo-minucci') && (
                <div className="mb-6">
                  {/* Size selection label - hide for Whole Cakes, Beverages, Hoagies Wraps, Sides, Seafood, Appetizers, Catering Appetizers, Minucci Pizzas, and Thick Crust Specialty Pizzas */}
                  {product.category !== 'catering-whole-cakes' && product.category !== 'catering-beverages' && product.category !== 'catering-hoagies-wraps' && product.category !== 'catering-appetizers' && product.category !== 'sides' && product.category !== 'seafood' && product.category !== 'appetizers' && product.category !== 'desserts' && product.category !== 'catering-desserts' && product.category !== 'minucci-pizzas' && !['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'].includes(product.id) && (
                    <p className="text-gray-600 mb-3">{product.id === 'cyo-minucci' ? 'Select your pricing option' : 'Select your preferred size'}</p>
                  )}
                  
                  {/* Minucci special pricing buttons */}
                  {product.id === 'cyo-minucci' && (
                    <div className="flex gap-3">
                      <button
                        onClick={() => setSelectedSize('medium')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'medium'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        1 Topping
                      </button>
                      <button
                        onClick={() => setSelectedSize('large')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'large'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        2-4 Toppings
                      </button>
                    </div>
                  )}
                  
                  {/* Hide size selection for Brioche, Minucci, Seafood, Whole Cakes, Beverages, Hoagies Wraps, Sides, Catering Appetizers, and Thick Crust Specialty Pizzas */}
                  {!product.id.startsWith('brioche-') && product.id !== 'cyo-minucci' && product.category !== 'minucci-pizzas' && product.category !== 'seafood' && product.category !== 'catering-whole-cakes' && product.category !== 'catering-beverages' && product.category !== 'catering-hoagies-wraps' && product.category !== 'catering-appetizers' && product.category !== 'sides' && product.category !== 'desserts' && product.category !== 'catering-desserts' && !['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'].includes(product.id) && (
                    <div className="flex gap-3">
                      <button
                        onClick={() => setSelectedSize('medium')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'medium'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        {product.category === 'catering-pasta' || product.category === 'catering-entrees' || product.category === 'catering-salad-soups' || product.name.includes('Tray') ? 'Medium' : product.category === 'pasta' ? 'Medium' : product.id.startsWith('stromboli-') ? '10" Medium' : (product.id === 'calzone-1' || product.id === 'calzone-2') ? '8" Medium' : '14" Medium'}
                      </button>
                      <button
                        onClick={() => setSelectedSize('large')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'large'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        {product.category === 'catering-pasta' || product.category === 'catering-entrees' || product.category === 'catering-salad-soups' || product.name.includes('Tray') ? 'Large' : product.category === 'pasta' ? 'Large' : (product.id === 'calzone-1' || product.id === 'calzone-2') ? '14" Large' : '16" Large'}
                      </button>
                      {/* Hide Jumbo for Calzone, Turnover, Stromboli, Catering Trays and Catering Salad/Soups */}
                      {product.id !== 'calzone-1' && product.id !== 'calzone-2' && !product.id.startsWith('stromboli-') && product.category !== 'catering-pasta' && product.category !== 'catering-appetizers' && product.category !== 'catering-entrees' && product.category !== 'catering-salad-soups' && !product.name.includes('Tray') && (
                        <button
                          onClick={() => setSelectedSize('jumbo')}
                          className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                            selectedSize === 'jumbo'
                              ? 'border-[#A72020] bg-[#A72020] text-white'
                              : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                          }`}
                        >
                          {product.category === 'pasta' ? 'Jumbo' : '18" Jumbo'}
                        </button>
                      )}
                    </div>
                  )}
                </div>
              )}
              
              {/* Soups Size Selection - Only 16oz and 32oz - Mobile */}
              {product.category === 'soups' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select your preferred size</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('medium')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === 'medium'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16oz
                    </button>
                    <button
                      onClick={() => setSelectedSize('large')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === 'large'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      32oz
                    </button>
                  </div>
                </div>
              )}
              
              {/* Wings Size Selection - Mobile (excluding Chicken Tenders and Mozzarella Sticks) */}
              {(product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select your quantity</p>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setSelectedSize('10')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '10'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('30')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '30'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('50')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '50'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Party Trays Size Selection - Mobile - Only for specific trays (10PCS and 20PCS) */}
              {(product.id === 'cptray1' || product.id === 'cptray2' || product.id === 'cptray4' || product.id === 'cptray5' || product.id === 'cptray6') && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('10')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '10'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Mini Cannoli Tray Size Selection - Mobile - Only for cptray3 (20PCS and 40PCS) */}
              {product.id === 'cptray3' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('40')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '40'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      40 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Chicken Tenders Quantity Selection - Mobile - For wing3, app6, and capp2 */}
              {(product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select quantity</p>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('4pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '4pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      4 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('8pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '8pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      8 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('16pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '16pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('32pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '32pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      32 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('64pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '64pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      64 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Mozzarella Sticks Quantity Selection - Mobile - For app4, wing4, and capp3 */}
              {(product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select quantity</p>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('6pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '6pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      6 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('12pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '12pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      12 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('24pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '24pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      24 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('48pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '48pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      48 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Arancini Rice Ball Regular Menu Quantity Selection - Mobile - For app8 */}
              {product.id === 'app8' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select quantity</p>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('1pc')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '1pc'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 pc
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('2pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('4pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '4pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      4 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('8pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '8pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      8 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('16pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '16pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Arancini Rice Ball Catering Quantity Selection - Mobile - For capp4 */}
              {product.id === 'capp4' && (
                <div className="mb-6">
                  <p className="text-gray-600 mb-3">Select quantity</p>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setSelectedAranciniQuantity('10pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '10pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('20pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '20pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('30pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '30pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('50pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '50pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 pcs
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Desktop: Side-by-side with full-width info stripe - HIDDEN FOR NEW LAYOUT */}
        <div className="hidden relative min-h-[320px] xl:min-h-[400px] 2xl:min-h-[500px]">
          {/* Left spacing for large screens + Product Image */}
          <div className="w-1/2 flex-shrink-0 flex justify-end xl:pr-0 relative z-10 bg-[#f3f4ea]">
            <div className="w-full xl:w-[80%] 2xl:w-[75%] bg-[#f3f4ea] h-full">
              <div className="h-full bg-white overflow-hidden w-full lg:-ml-[30px]">
                <ImageWithFallback                   src={product.image}
                  alt={product.name}
                  className="w-full h-full object-contain object-center"
                />
              </div>
            </div>
          </div>

          {/* Product Info - Full Width Stripe extending to right */}
          <div className="flex-1 flex items-start relative z-10 bg-[#f3f4ea]">
            <div className="w-full px-8 xl:px-12 2xl:px-16 py-8 xl:py-10 2xl:py-12 bg-[#f3f4ea]">
              <h1 className="text-2xl xl:text-3xl 2xl:text-4xl font-bold text-gray-900 mb-2 xl:mb-3">
                {product.id === 'cyo-white' 
                  ? 'White Pizza' 
                  : product.id === 'cyo-gf12' 
                    ? 'Gluten Free Crust Pizza 12"' 
                    : product.id === 'cyo-cauliflower' 
                      ? 'Cauliflower Crust Pizza 10"' 
                      : product.name.toLowerCase().includes('chicken tenders')
                        ? 'Chicken Tenders W/FF'
                        : (product.id === 'csalad1' || product.id === 'csalad2' || product.id === 'csalad3' || product.id === 'csalad4' || product.id === 'csalad5' || product.id === 'csalad6' || product.id === 'csalad7')
                        ? `${product.name} ${selectedSize === 'medium' ? '(Serves 8-10)' : selectedSize === 'large' ? '(Serves 18-20)' : ''}`
                        : (product.id === 'cp7' || product.id === 'cp8' || product.id === 'cp9' || product.id === 'cp10' || product.id === 'cp11')
                          ? `${product.name} ${selectedSize === 'medium' ? '(Serves 8-10)' : selectedSize === 'large' ? '(Serves 18-20)' : ''}`
                          : (product.id === 'cp1' || product.id === 'cp3' || product.id === 'cp4')
                            ? `${product.name} ${selectedSize === 'medium' ? '(Serves 8-10)' : selectedSize === 'large' ? '(Serves 18-20)' : ''}`
                            : (product.id === 'cp2' || product.id === 'cp12')
                              ? `${product.name} ${selectedSize === 'medium' ? '(20PCS)' : selectedSize === 'large' ? '(40PCS)' : ''}`
                              : (product.category === 'catering-entrees' || product.category === 'catering-seafood-pasta')
                                ? product.id === 'cp6'
                                  ? `${product.name} ${selectedSize === 'medium' ? '(20PCS)' : selectedSize === 'large' ? '(40PCS)' : ''}`
                                  : (product.id === 'c6' || product.id === 'c3' || product.id === 'c7' || product.id === 'cs7')
                                    ? `${product.name} ${selectedSize === 'medium' ? '(10PCS)' : selectedSize === 'large' ? '(20PCS)' : ''}`
                                    : (product.id === 'c8' || product.id === 'c9' || product.id === 'cs3')
                                      ? `${product.name} ${selectedSize === 'medium' ? '(20PCS)' : selectedSize === 'large' ? '(40PCS)' : ''}`
                                      : `${product.name} ${selectedSize === 'medium' ? '(Serves 8-10)' : selectedSize === 'large' ? '(Serves 18-20)' : ''}`
                                : product.name}
              </h1>
              
              {/* Choice of two sides - Only for traditional dinners and fish */}
              {(product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) && (
                <p className="text-black mb-3 xl:mb-4 xl:text-lg">Choice of two sides</p>
              )}
              
              <p className="text-black mb-3 xl:mb-4 xl:text-lg" key={`mobile-price-${selectedChickenTendersQuantity}`}>
                {product.category === 'catering-hoagies-wraps'
                  ? '$0.00'
                  : product.id === 'cyo-minucci'
                    ? `$${getSizePrice().toFixed(2)}`
                    : product.id === 'app18'
                      ? `$${wingsQuantityOptions.find(opt => opt.id === selectedWingsQuantity)?.price.toFixed(2)}`
                      : product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2'
                        ? `$${(chickenTendersQuantityOptions.find(opt => opt.id === selectedChickenTendersQuantity)?.price ?? 12.49).toFixed(2)}`
                        : product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3'
                            ? `$${(mozzarellaSticksQuantityOptions.find(opt => opt.id === selectedMozzarellaSticksQuantity)?.price ?? 9.49).toFixed(2)}`
                            : product.id === 'app8'
                            ? `$${aranciniRegularQuantityOptions.find(opt => opt.id === selectedAranciniRegularQuantity)?.price.toFixed(2)}`
                            : product.id === 'capp4'
                            ? `$${aranciniQuantityOptions.find(opt => opt.id === selectedAranciniQuantity)?.price.toFixed(2)}`
                            : product.id === 'app1'
                            ? `$${garlicBreadSizeOptions.find(opt => opt.id === selectedGarlicBreadSize)?.price.toFixed(2)}`
                            : product.id === 'app2'
                            ? `$${garlicBreadMozzarellaSizeOptions.find(opt => opt.id === selectedGarlicBreadMozzarellaSize)?.price.toFixed(2)}`
                            : !product.name.includes('Sicilian') && !product.name.includes('Pan Pizza') && !product.name.includes('Gluten Free') && !product.name.includes('Minucci') && product.category !== 'brooklyn-pizza' && product.category !== 'cheesesteaks' && product.category !== 'wings' && product.category !== 'catering-appetizers' && product.category !== 'by-the-slice' && product.category !== 'cold-hoagies' && product.category !== 'hot-hoagies' && product.category !== 'burgers' && product.category !== 'brioche' && product.category !== 'paninis' && product.category !== 'wraps' && product.category !== 'appetizers' && product.category !== 'traditional-dinners' && product.category !== 'pasta' && product.category !== 'baked-pasta' && product.category !== 'create-salad' && product.category !== 'salads' && product.category !== 'soups' && product.category !== 'kids' && product.category !== 'minucci-pizzas' && product.category !== 'beverages'
                  ? `$${getSizePrice().toFixed(2)}` 
                  : (product.category === 'wings' || product.category === 'catering-appetizers')
                    ? `$${getSizePrice().toFixed(2)}`
                    : product.category === 'soups'
                      ? `$${getSizePrice().toFixed(2)}`
                      : product.category === 'cold-hoagies' || product.category === 'hot-hoagies'
                        ? product.price
                        : product.price}
              </p>
              <p 
                className="text-gray-600 mb-4 xl:mb-6 xl:text-lg leading-relaxed"
                dangerouslySetInnerHTML={{
                  __html: product.id === 'cyo-sicilian' 
                    ? '12 Slices. Thick, square & pan baked.' 
                    : product.id === 'cyo-pan' 
                    ? '(8 Slices). Thick, round & pan baked.' 
                    : product.id === 'cyo-gf12'
                    ? '(6 Slices)'
                    : product.id === 'cyo-cauliflower'
                    ? '(4 Slices)'
                    : product.id === 'cyo-minucci'
                    ? '(4 Slices). Whole wheat, thin, & round'
                    : (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3')
                      ? getMozzarellaSticksDescription()
                      : (product.id === 'wing3' || product.id === 'app6' || product.id === 'capp2')
                        ? getChickenTendersDescription()
                        : (product.id === 'app8' || product.id === 'capp4')
                          ? getAranciniRiceBallDescription()
                          : (product.id === 'app18' || (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') || (product.category === 'catering-appetizers' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4'))
                            ? getWingsDescription()
                            : product.description
                }}
              />

              {/* Call Us Button - Only for Soup of the Day */}
              {(product.id === 'td-extra5' || product.id === 'bps5' || product.id === 'soup2') && (
                <button
                  onClick={() => setShowCallUsDialog(true)}
                  className="mb-6 px-6 py-2.5 bg-[#A72020] text-white font-semibold rounded-lg hover:bg-[#8b1919] transition-colors"
                >
                  Call Us
                </button>
              )}

              {/* Size Selection - Hidden for Sicilian, Pan Pizza, Gluten Free, Brooklyn, Cheesesteaks, Hoagies, Slices, Burgers, Brioche, Paninis, Wraps, Appetizers, Traditional Dinners, Pasta, Baked Pasta, Salads, Soups, Build Your Own Pasta, Create Your Own Kids Pasta, Kids, Dessert and Beverages - Except Catering Salad/Soups and Minucci (has custom buttons) */}
              {((!product.name.includes('Sicilian') && !product.name.includes('Pan Pizza') && !product.name.includes('Gluten Free') && product.category !== 'brooklyn-pizza' && product.category !== 'cheesesteaks' && product.category !== 'wings' && product.category !== 'hot-hoagies' && product.category !== 'cold-hoagies' && product.category !== 'by-the-slice' && product.category !== 'burgers' && product.category !== 'brioche' && product.category !== 'paninis' && product.category !== 'wraps' && product.category !== 'appetizers' && product.category !== 'traditional-dinners' && product.category !== 'pasta' && product.category !== 'baked-pasta' && product.category !== 'create-salad' && product.category !== 'salads' && product.category !== 'soups' && product.category !== 'kids' && product.category !== 'beverages' && product.category !== 'desserts' && product.category !== 'catering-desserts' && product.category !== 'pizzelle' && product.category !== 'gelati' && product.id !== 'cp-1' && product.id !== 'k1' && product.id !== 'stromboli-8' && product.id !== 'cptray1' && product.id !== 'cptray2' && product.id !== 'cptray3' && product.id !== 'cptray4' && product.id !== 'cptray5' && product.id !== 'cptray6') || product.category === 'catering-salad-soups' || product.id === 'cyo-minucci') && (
                <div className="mt-3 mb-4 xl:mb-5">
                  {/* Size selection label - hide for Whole Cakes, Beverages, Hoagies Wraps, Sides, Seafood, Appetizers, Catering Appetizers, Minucci Pizzas, and Thick Crust Specialty Pizzas */}
                  {product.category !== 'catering-whole-cakes' && product.category !== 'catering-beverages' && product.category !== 'catering-hoagies-wraps' && product.category !== 'catering-appetizers' && product.category !== 'sides' && product.category !== 'seafood' && product.category !== 'appetizers' && product.category !== 'desserts' && product.category !== 'catering-desserts' && product.category !== 'minucci-pizzas' && !['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'].includes(product.id) && (
                    <p className="text-gray-600 mb-2">{product.id === 'cyo-minucci' ? 'Select your pricing option' : 'Select your preferred size'}</p>
                  )}
                  
                  {/* Minucci special pricing buttons */}
                  {product.id === 'cyo-minucci' && (
                    <div className="flex gap-3">
                      <button
                        onClick={() => setSelectedSize('medium')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'medium'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        1 Topping
                      </button>
                      <button
                        onClick={() => setSelectedSize('large')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'large'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        2-4 Toppings
                      </button>
                    </div>
                  )}
                  
                  {/* Hide size selection for Brioche, Minucci, Seafood, Whole Cakes, Beverages, Hoagies Wraps, Sides, Catering Appetizers, and Thick Crust Specialty Pizzas */}
                  {!product.id.startsWith('brioche-') && product.id !== 'cyo-minucci' && product.category !== 'minucci-pizzas' && product.category !== 'seafood' && product.category !== 'catering-whole-cakes' && product.category !== 'catering-beverages' && product.category !== 'catering-hoagies-wraps' && product.category !== 'catering-appetizers' && product.category !== 'sides' && product.category !== 'desserts' && product.category !== 'catering-desserts' && !['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'].includes(product.id) && (
                    <div className="flex gap-3">
                      <button
                        onClick={() => setSelectedSize('medium')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'medium'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        {product.category === 'catering-pasta' || product.category === 'catering-entrees' || product.category === 'catering-salad-soups' || product.name.includes('Tray') ? 'Medium' : product.category === 'pasta' ? 'Medium' : product.id.startsWith('stromboli-') ? '10" Medium' : (product.id === 'calzone-1' || product.id === 'calzone-2') ? '8" Medium' : '14" Medium'}
                      </button>
                      <button
                        onClick={() => setSelectedSize('large')}
                        className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'large'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        {product.category === 'catering-pasta' || product.category === 'catering-entrees' || product.category === 'catering-salad-soups' || product.name.includes('Tray') ? 'Large' : product.category === 'pasta' ? 'Large' : (product.id === 'calzone-1' || product.id === 'calzone-2') ? '14" Large' : '16" Large'}
                      </button>
                      {/* Hide Jumbo for Calzone, Turnover, Stromboli, Catering Trays and Catering Salad/Soups */}
                      {product.id !== 'calzone-1' && product.id !== 'calzone-2' && !product.id.startsWith('stromboli-') && product.category !== 'catering-pasta' && product.category !== 'catering-appetizers' && product.category !== 'catering-entrees' && product.category !== 'catering-salad-soups' && !product.name.includes('Tray') && (
                        <button
                          onClick={() => setSelectedSize('jumbo')}
                          className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                            selectedSize === 'jumbo'
                              ? 'border-[#A72020] bg-[#A72020] text-white'
                              : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                          }`}
                        >
                          {product.category === 'pasta' ? 'Jumbo' : '18" Jumbo'}
                        </button>
                      )}
                    </div>
                  )}
                </div>
              )}
              

              
              {/* Soups Size Selection - Only 16oz and 32oz */}
              {product.category === 'soups' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select your preferred size</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('medium')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === 'medium'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16oz
                    </button>
                    <button
                      onClick={() => setSelectedSize('large')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === 'large'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      32oz
                    </button>
                  </div>
                </div>
              )}
              
              {/* Wings Size Selection - Only for wings (excluding Chicken Tenders, Mozzarella Sticks, and Arancini Rice Ball) */}
              {(product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('10')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '10'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 pcs
                    </button>
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 pcs
                    </button>
                    <button
                      onClick={() => setSelectedSize('30')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '30'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 pcs
                    </button>
                    <button
                      onClick={() => setSelectedSize('50')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '50'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Wings Appetizers Quantity Selection - Only for app18 */}
              {product.id === 'app18' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedWingsQuantity('10pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedWingsQuantity === '10pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 pcs
                    </button>
                    <button
                      onClick={() => setSelectedWingsQuantity('20pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedWingsQuantity === '20pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 pcs
                    </button>
                    <button
                      onClick={() => setSelectedWingsQuantity('30pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedWingsQuantity === '30pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 pcs
                    </button>
                    <button
                      onClick={() => setSelectedWingsQuantity('50pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedWingsQuantity === '50pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Chicken Tenders Quantity Selection - For wing3, app6, and capp2 */}
              {(product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('4pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '4pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      4 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('8pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '8pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      8 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('16pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '16pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('32pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '32pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      32 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('64pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedChickenTendersQuantity === '64pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      64 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Mozzarella Sticks Quantity Selection - For app4, wing4, and capp3 */}
              {(product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('6pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '6pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      6 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('12pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '12pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      12 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('24pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '24pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      24 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('48pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedMozzarellaSticksQuantity === '48pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      48 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Arancini Rice Ball Regular Menu Quantity Selection - For app8 */}
              {product.id === 'app8' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex flex-wrap gap-3">
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('1pc')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '1pc'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 pc
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('2pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('4pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '4pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      4 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('8pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '8pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      8 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('16pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniRegularQuantity === '16pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Arancini Rice Ball Catering Quantity Selection - For capp4 */}
              {product.id === 'capp4' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedAranciniQuantity('10pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '10pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('20pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '20pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('30pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '30pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('50pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedAranciniQuantity === '50pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Garlic Bread Size Selection - Only for app1 */}
              {product.id === 'app1' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select size</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedGarlicBreadSize('1pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadSize === '1pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 PCS
                    </button>
                    <button
                      onClick={() => setSelectedGarlicBreadSize('2pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadSize === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Garlic Bread with Mozzarella Size Selection - Only for app2 */}
              {product.id === 'app2' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select size</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedGarlicBreadMozzarellaSize('1pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadMozzarellaSize === '1pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 PCS
                    </button>
                    <button
                      onClick={() => setSelectedGarlicBreadMozzarellaSize('2pcs')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedGarlicBreadMozzarellaSize === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Party Trays Size Selection - Only for specific trays (10PCS and 20PCS) */}
              {(product.id === 'cptray1' || product.id === 'cptray2' || product.id === 'cptray4' || product.id === 'cptray5' || product.id === 'cptray6') && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('10')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '10'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Mini Cannoli Tray Size Selection - Only for cptray3 (20PCS and 40PCS) */}
              {product.id === 'cptray3' && (
                <div className="mt-3 mb-4 xl:mb-5">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('40')}
                      className={`px-5 py-2.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '40'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      40 PCS
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
      </div>

      {/* Desktop: 2-Column Layout Wrapper (hidden in mobile, grid in desktop) */}
      <div className="flex-1 min-h-0 overflow-y-auto lg:h-full lg:max-h-full lg:overflow-hidden lg:grid lg:grid-cols-[60%_40%] lg:grid-rows-[1fr_auto] lg:min-h-0">
        
        {/* LEFT COLUMN WRAPPER */}
        <div className="bg-white lg:col-start-1 lg:row-start-1 lg:flex lg:flex-col lg:min-h-0 lg:overflow-hidden">
          {/* Customization Sections - Scrollable content */}
          <div 
            data-testid="left-scroll-container"
            className="px-4 lg:px-8 pt-4 lg:pt-6 pb-4 lg:pb-6 lg:flex-1 lg:overflow-y-auto lg:min-h-0 lg:overscroll-contain custom-scrollbar"
          >
          <div className="max-w-[1440px] lg:max-w-none mx-auto space-y-2">
          {/* Add Toppings for Regular Pasta dishes */}
          {product.category === 'pasta' && !product.name.toLowerCase().includes('baked') && (
            <>
              {/* Pasta Type Selection */}
              <div ref={buildPastaTypeRef}>
                <Collapsible open={isIncludedOpen} onOpenChange={setIsIncludedOpen}>
                  <CollapsibleTrigger asChild>
                    <button className="toppings-section-header w-full p-5 rounded-lg flex items-center justify-between">
                      <div className="flex flex-col items-start gap-1">
                        <div className="flex items-center gap-2">
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose a Pasta</span>
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>(Required)</span>
                        </div>
                      </div>
                      {isIncludedOpen ? (
                        <ChevronUp className="w-6 h-6" />
                      ) : (
                        <ChevronDown className="w-6 h-6" />
                      )}
                    </button>
                  </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaTypes.map((pastaType) => {
                        const isSelected = selectedBuildPastaType === pastaType.id;
                        return (
                          <div
                            key={pastaType.id}
                            onClick={() => setSelectedBuildPastaType(pastaType.id)}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_TYPE_IMAGES[pastaType.id]}
                                alt={pastaType.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{pastaType.name}</span>
                              <span className="text-sm text-gray-900">{pastaType.price > 0 ? '+' : ''}${pastaType.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {buildPastaTypeError && (
                      <div 
                        className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <p className="font-semibold">Please select a pasta type before adding to cart</p>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
              </div>

              {/* Add Toppings */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button className="toppings-section-header w-full p-5 rounded-lg flex items-center justify-between mt-2">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Add Toppings (Optional)</span>
                      </div>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {buildPastaToppings.filter(topping => {
                        // For Alfredo Sauce (pasta-1), exclude Two Meatballs and Two Italian Sausage
                        if (product.id === 'pasta-1' && (topping.id === 'bpt3' || topping.id === 'bpt4')) {
                          return false;
                        }
                        // For Bolognese Sauce (pasta-2), exclude Grilled Chicken, Shrimp, and Broccoli
                        if (product.id === 'pasta-2' && (topping.id === 'bpt1' || topping.id === 'bpt2' || topping.id === 'bpt5')) {
                          return false;
                        }
                        // For Garlic & Oil (pasta-3), exclude Two Meatballs and Two Italian Sausage
                        if (product.id === 'pasta-3' && (topping.id === 'bpt3' || topping.id === 'bpt4')) {
                          return false;
                        }
                        // For Gnocchi Alla Sorrentina (pasta-4), exclude Grilled Chicken, Shrimp, and Broccoli
                        if (product.id === 'pasta-4' && (topping.id === 'bpt1' || topping.id === 'bpt2' || topping.id === 'bpt5')) {
                          return false;
                        }
                        // For Pasta with Meatballs (pasta-7), exclude Shrimp and Grilled Chicken
                        if (product.id === 'pasta-7' && (topping.id === 'bpt1' || topping.id === 'bpt2')) {
                          return false;
                        }
                        // For Pomodoro Sauce with Sausage (pasta-9), exclude Shrimp and Grilled Chicken
                        if (product.id === 'pasta-9' && (topping.id === 'bpt1' || topping.id === 'bpt2')) {
                          return false;
                        }
                        // For Sausage & Roasted Peppers (pasta-10), exclude Shrimp and Grilled Chicken
                        if (product.id === 'pasta-10' && (topping.id === 'bpt1' || topping.id === 'bpt2')) {
                          return false;
                        }
                        // For Vodka Sauce (pasta-11), exclude Two Meatballs and Two Italian Sausage
                        if (product.id === 'pasta-11' && (topping.id === 'bpt3' || topping.id === 'bpt4')) {
                          return false;
                        }
                        // For Pasta Alla Passariello (pasta-12), exclude Shrimp and Grilled Chicken
                        if (product.id === 'pasta-12' && (topping.id === 'bpt1' || topping.id === 'bpt2')) {
                          return false;
                        }
                        return true;
                      }).map((topping) => {
                        const isSelected = selectedBuildPastaToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedBuildPastaToppings(selectedBuildPastaToppings.filter(id => id !== topping.id));
                              } else {
                                setSelectedBuildPastaToppings([...selectedBuildPastaToppings, topping.id]);
                              }
                            }}
                            className={`flex items-center gap-0 bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative bg-gray-50 border-r border-gray-100">
                              <ImageWithFallback
                                src={BUILD_PASTA_TOPPING_IMAGES[topping.id]}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2 text-left">{topping.name}</span>
                              <span className="text-gray-900 font-bold text-sm whitespace-nowrap ml-2">${topping.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Choose Soup Section */}
              <Collapsible open={isSoupOpen} onOpenChange={setIsSoupOpen}>
                <CollapsibleTrigger asChild>
                  <button className="toppings-section-header w-full p-5 rounded-lg flex items-center justify-between mt-2">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Choose Soup or Salad (Optional)</span>
                      </div>
                    </div>
                    {isSoupOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {buildPastaSoups.map((soup) => {
                        const isSelected = selectedBuildPastaSoup.includes(soup.id);
                        return (
                          <div
                            key={soup.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedBuildPastaSoup(selectedBuildPastaSoup.filter(id => id !== soup.id));
                              } else {
                                setSelectedBuildPastaSoup([...selectedBuildPastaSoup, soup.id]);
                              }
                            }}
                            className={`flex items-center gap-0 bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative bg-gray-50 border-r border-gray-100">
                              <ImageWithFallback
                                src={BUILD_PASTA_SOUP_IMAGES[soup.id] || soup.image || ''}
                                alt={soup.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2 text-left">{soup.name}</span>
                              <div className="flex items-center gap-2">
                                <span className="text-gray-900 font-bold text-sm whitespace-nowrap">${soup.price?.toFixed(2)}</span>
                                {soup.id === 'bps2' && (
                                  <div 
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      setShowBuildPastaSoupDialog(true);
                                    }}
                                    className="p-1 cursor-pointer"
                                  >
                                    <MoreVertical className="w-[21px] h-[21px] text-gray-900" />
                                  </div>
                                )}
                                {soup.removableIngredients && (
                                  <Popover>
                                    <PopoverTrigger asChild>
                                      <div 
                                        onClick={(e) => e.stopPropagation()}
                                        className="p-1 cursor-pointer hover:bg-gray-200 rounded-lg transition-colors"
                                      >
                                        <MoreVertical className="w-[21px] h-[21px] text-gray-900" />
                                      </div>
                                    </PopoverTrigger>
                                    <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                      <div className="bg-[#A72020] text-white px-4 py-3 flex items-center justify-between">
                                        <span className="font-semibold">Uncheck to Remove From Salad</span>
                                      </div>
                                      <div className="p-4 max-h-64 overflow-y-auto">
                                        <div className={`grid ${soup.id === 'bps4' ? 'grid-cols-2' : 'grid-cols-3'} gap-3`}>
                                          {soup.removableIngredients.map((ingredient) => {
                                            const isSideGarden = soup.id === 'bps3';
                                            const removedIngredients = isSideGarden ? sideGardenSaladRemovedIngredients : sideCaesarSaladRemovedIngredients;
                                            const setRemovedIngredients = isSideGarden ? setSideGardenSaladRemovedIngredients : setSideCaesarSaladRemovedIngredients;
                                            const isRemoved = removedIngredients.includes(ingredient.id);
                                            
                                            return (
                                              <button
                                                key={ingredient.id}
                                                onClick={(e) => {
                                                  e.stopPropagation();
                                                  if (isRemoved) {
                                                    setRemovedIngredients(
                                                      removedIngredients.filter(id => id !== ingredient.id)
                                                    );
                                                  } else {
                                                    setRemovedIngredients([
                                                      ...removedIngredients,
                                                      ingredient.id
                                                    ]);
                                                  }
                                                }}
                                                className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                  isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                                }`}
                                              >
                                                {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                                <span className="text-center leading-tight">{ingredient.name}</span>
                                              </button>
                                            );
                                          })}
                                        </div>
                                      </div>
                                    </PopoverContent>
                                  </Popover>
                                )}
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Add Toppings for Baked Pasta dishes */}
          {product.category === 'pasta' && product.name.toLowerCase().includes('baked') && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="toppings-section-header w-full p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Side Soups, Salads, & Extra Bread</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {bakedPastaSides.map((topping) => {
                      const isSelected = selectedExtraSauce.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraSauce(selectedExtraSauce.filter(id => id !== topping.id));
                            } else {
                              setSelectedExtraSauce([...selectedExtraSauce, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {topping.image && (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={topping.image} 
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 h-14">
                            <p className="text-gray-900">{topping.name}</p>
                            <div className="flex items-center gap-2">
                              <span className="text-sm text-gray-900">${topping.price?.toFixed(2)}</span>
                              {topping.id === 'bps2' && topping.removableIngredients && (
                                <Popover>
                                  <PopoverTrigger asChild>
                                    <button
                                      onClick={(e) => e.stopPropagation()}
                                      className="p-1 hover:bg-gray-100 rounded transition-colors"
                                    >
                                      <MoreVertical className="w-4 h-4 text-gray-600" />
                                    </button>
                                  </PopoverTrigger>
                                  <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 flex items-center justify-between">
                                      <span className="font-semibold">Uncheck to Remove From Salad</span>
                                    </div>
                                    <div className="p-4 max-h-64 overflow-y-auto">
                                      <div className="grid grid-cols-3 gap-3">
                                        {topping.removableIngredients.map((ingredient) => {
                                          const isRemoved = sideGardenSaladRemovedIngredients.includes(ingredient.id);
                                          return (
                                            <button
                                              key={ingredient.id}
                                              onClick={(e) => {
                                                e.stopPropagation();
                                                if (isRemoved) {
                                                  setSideGardenSaladRemovedIngredients(
                                                    sideGardenSaladRemovedIngredients.filter(id => id !== ingredient.id)
                                                  );
                                                } else {
                                                  setSideGardenSaladRemovedIngredients([
                                                    ...sideGardenSaladRemovedIngredients,
                                                    ingredient.id
                                                  ]);
                                                }
                                              }}
                                              className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                              }`}
                                            >
                                              {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                              <span className="text-center leading-tight">{ingredient.name}</span>
                                            </button>
                                          );
                                        })}
                                      </div>
                                    </div>
                                  </PopoverContent>
                                </Popover>
                              )}
                              {topping.id === 'bps3' && topping.removableIngredients && (
                                <Popover>
                                  <PopoverTrigger asChild>
                                    <button
                                      onClick={(e) => e.stopPropagation()}
                                      className="p-1 hover:bg-gray-100 rounded transition-colors"
                                    >
                                      <MoreVertical className="w-4 h-4 text-gray-600" />
                                    </button>
                                  </PopoverTrigger>
                                  <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 flex items-center justify-between">
                                      <span className="font-semibold">Uncheck to Remove From Salad</span>
                                    </div>
                                    <div className="p-4 max-h-64 overflow-y-auto">
                                      <div className="grid grid-cols-2 gap-3">
                                        {topping.removableIngredients.map((ingredient) => {
                                          const isRemoved = sideCaesarSaladRemovedIngredients.includes(ingredient.id);
                                          return (
                                            <button
                                              key={ingredient.id}
                                              onClick={(e) => {
                                                e.stopPropagation();
                                                if (isRemoved) {
                                                  setSideCaesarSaladRemovedIngredients(
                                                    sideCaesarSaladRemovedIngredients.filter(id => id !== ingredient.id)
                                                  );
                                                } else {
                                                  setSideCaesarSaladRemovedIngredients([
                                                    ...sideCaesarSaladRemovedIngredients,
                                                    ingredient.id
                                                  ]);
                                                }
                                              }}
                                              className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                              }`}
                                            >
                                              {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                              <span className="text-center leading-tight">{ingredient.name}</span>
                                            </button>
                                          );
                                        })}
                                      </div>
                                    </div>
                                  </PopoverContent>
                                </Popover>
                              )}
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {bakedPastaSpecialInstructions.map((topping) => {
                      const isSelected = selectedExtraSauce.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraSauce(selectedExtraSauce.filter(id => id !== topping.id));
                            } else {
                              setSelectedExtraSauce([...selectedExtraSauce, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <div className="flex items-center gap-3">
                              <Circle 
                                className={`w-5 h-5 flex-shrink-0 ${
                                  isSelected 
                                    ? 'fill-[#A72020] text-[#A72020]' 
                                    : 'text-gray-300'
                                }`}
                              />
                              <p className="text-gray-900">{topping.name}</p>
                            </div>
                            <span className="text-sm text-gray-900">${topping.price?.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Special Instructions for Catering Chicken & Meat Entree Trays (c3-c9) */}
          {(product.id === 'c3' || product.id === 'c4' || product.id === 'c5' || product.id === 'c6' || product.id === 'c7' || product.id === 'c8' || product.id === 'c9') && (
            <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
              <CollapsibleTrigger asChild>
                <button className="toppings-section-header w-full p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instruction (Optional)</span>
                  </div>
                  {isSpecialInstructionsOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {cateringEntreeSpecialInstructions.map((instruction) => {
                      const isSelected = selectedExtraSauce.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraSauce(selectedExtraSauce.filter(id => id !== instruction.id));
                            } else {
                              setSelectedExtraSauce([...selectedExtraSauce, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <div className="flex items-center gap-3">
                              <div className="w-5 h-5 flex-shrink-0">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                              <p className="text-gray-900">{instruction.name}</p>
                            </div>
                            <span className="text-sm text-gray-900">$0.00</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Pasta Customization for Catering Pasta with Sauce Trays (cp7-cp11) */}
          {(product.id === 'cp7' || product.id === 'cp8' || product.id === 'cp9' || product.id === 'cp10' || product.id === 'cp11') && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button 
                  ref={cateringPastaTypeRef}
                  className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                    cateringPastaTypeError ? 'ring-4 ring-red-500' : ''
                  }`}
                >
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose A Pasta (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  {/* Pasta Type Section */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {pastaTypes.map((pastaType) => {
                      const isSelected = selectedPastaType === pastaType.id;
                      return (
                        <div
                          key={pastaType.id}
                          onClick={() => {
                            setSelectedPastaType(pastaType.id);
                            setCateringPastaTypeError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={pastaType.image || ''}
                              alt={pastaType.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 px-4 py-3 flex items-center justify-between">
                            <span className="text-gray-900">{pastaType.name}</span>
                            {pastaType.price > 0 && (
                              <span className="text-sm text-gray-900">${pastaType.price.toFixed(2)}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {cateringPastaTypeError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a pasta type to continue</span>
                    </div>
                  )}

                  {/* Additions Section - Exclude cp8 (Bolognese) */}
                  {product.id !== 'cp8' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center mt-6">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Toppings (Optional)</span>
                      </div>
                  <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-8 gap-4">
                    {pastaAdditions.map((addition) => {
                      const isSelected = selectedPastaAdditions.includes(addition.id);
                      return (
                        <div
                          key={addition.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedPastaAdditions(selectedPastaAdditions.filter(id => id !== addition.id));
                            } else {
                              setSelectedPastaAdditions([...selectedPastaAdditions, addition.id]);
                            }
                          }}
                          className={`flex flex-col h-full min-h-[184px] bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                            isSelected ? 'ring-2 ring-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="h-20 w-full relative bg-gray-50 border-b border-gray-100 flex-shrink-0">
                            {addition.image && (
                              <ImageWithFallback
                                src={addition.image}
                                alt={addition.name}
                                className="w-full h-full object-contain p-1"
                              />
                            )}
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                <div className="bg-white rounded-full p-1">
                                  <Check className="w-5 h-5 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="p-2 flex flex-col items-center justify-center flex-grow text-center gap-1">
                            <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2">{addition.name}</span>
                            <span className="text-gray-900 font-bold text-sm">
                              {(() => {
                                const displayPrice = selectedSize === 'large' && addition.largPrice ? addition.largPrice : (addition.price || 0);
                                return displayPrice > 0 ? `$${displayPrice.toFixed(2)}` : 'Free';
                              })()}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                      </div>
                    </>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Antipasto Salad Bowl Customization (csalad1) */}
          {product.id === 'csalad1' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedAntipastoBase === base.id;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedAntipastoBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={base.image}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Antipasto Salad Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-white/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedAntipastoDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedAntipastoDressings(selectedAntipastoDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedAntipastoDressings.length < 3) {
                                  setSelectedAntipastoDressings([...selectedAntipastoDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Antipasto Salad Bowl Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladSpecialInstructions.map((instruction) => {
                        const isSelected = selectedAntipastoSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedAntipastoSpecialInstructions(selectedAntipastoSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedAntipastoSpecialInstructions([...selectedAntipastoSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{instruction.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Caesar Salad Bowl Customization (csalad2) */}
          {product.id === 'csalad2' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedCaesarBase === base.id;
                        const imageUrl = SALAD_BASE_IMAGES[base.id] || base.image;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedCaesarBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={imageUrl}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Caesar Salad Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedCaesarDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedCaesarDressings(selectedCaesarDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedCaesarDressings.length < 3) {
                                  setSelectedCaesarDressings([...selectedCaesarDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Caesar Salad Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {caesarSaladSpecialInstructions.map((instruction) => {
                        const isSelected = selectedCaesarSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedCaesarSpecialInstructions(selectedCaesarSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedCaesarSpecialInstructions([...selectedCaesarSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{instruction.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Chicken Caesar Salad Bowl Customization (csalad3) */}
          {product.id === 'csalad3' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedChickenCaesarBase === base.id;
                        const imageUrl = SALAD_BASE_IMAGES[base.id] || base.image;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedChickenCaesarBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={imageUrl}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Chicken Caesar Salad Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedChickenCaesarDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedChickenCaesarDressings(selectedChickenCaesarDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedChickenCaesarDressings.length < 3) {
                                  setSelectedChickenCaesarDressings([...selectedChickenCaesarDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Chicken Caesar Salad Bowl Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {caesarSaladSpecialInstructions.map((instruction) => {
                        const isSelected = selectedChickenCaesarSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedChickenCaesarSpecialInstructions(selectedChickenCaesarSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedChickenCaesarSpecialInstructions([...selectedChickenCaesarSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{instruction.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Chicken Caesar Salad Dressing Error Message */}
              {cateringSaladDressingError && (
                <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                  <AlertCircle className="w-5 h-5 flex-shrink-0" />
                  <span className="font-semibold">Please select at least 1 dressing to continue</span>
                </div>
              )}
            </>
          )}

          {/* Garden Salad Bowl Customization (csalad4) */}
          {product.id === 'csalad4' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedGardenBase === base.id;
                        const imageUrl = SALAD_BASE_IMAGES[base.id] || base.image;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedGardenBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={imageUrl}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Garden Salad Bowl Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-white/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedGardenDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedGardenDressings(selectedGardenDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedGardenDressings.length < 3) {
                                  setSelectedGardenDressings([...selectedGardenDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Garden Salad Bowl Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* No toppings (Special Instructions) */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>No toppings</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {gardenSaladSpecialInstructions.map((instruction) => {
                        const isSelected = selectedGardenSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedGardenSpecialInstructions(selectedGardenSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedGardenSpecialInstructions([...selectedGardenSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{instruction.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Roasted Red Pepper Salad Bowl Customization (csalad5) */}
          {product.id === 'csalad5' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedRoastedRedPepperBase === base.id;
                        const imageUrl = SALAD_BASE_IMAGES[base.id] || base.image;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedRoastedRedPepperBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={imageUrl}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Roasted Red Pepper Salad Bowl Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedRoastedRedPepperDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedRoastedRedPepperDressings(selectedRoastedRedPepperDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedRoastedRedPepperDressings.length < 3) {
                                  setSelectedRoastedRedPepperDressings([...selectedRoastedRedPepperDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Roasted Red Pepper Salad Bowl Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Three Cheese Salad Bowl Customization (csalad6) */}
          {product.id === 'csalad6' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedThreeCheeseBase === base.id;
                        const imageUrl = SALAD_BASE_IMAGES[base.id] || base.image;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedThreeCheeseBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={imageUrl}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Three Cheese Salad Bowl Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedThreeCheeseDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedThreeCheeseDressings(selectedThreeCheeseDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedThreeCheeseDressings.length < 3) {
                                  setSelectedThreeCheeseDressings([...selectedThreeCheeseDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Three Cheese Salad Bowl Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {threeCheeseSaladSpecialInstructions.map((instruction) => {
                        const isSelected = selectedThreeCheeseSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedThreeCheeseSpecialInstructions(selectedThreeCheeseSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedThreeCheeseSpecialInstructions([...selectedThreeCheeseSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{instruction.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

            </>
          )}

          {/* Traditional Chef Salad Bowl Customization (csalad7) */}
          {product.id === 'csalad7' && (
            <>
              {/* Choose Your Base */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladBaseRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladBaseError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {antipastoSaladBases.map((base) => {
                        const isSelected = selectedTraditionalChefBase === base.id;
                        const imageUrl = SALAD_BASE_IMAGES[base.id] || base.image;
                        return (
                          <div
                            key={base.id}
                            onClick={() => {
                              setSelectedTraditionalChefBase(base.id);
                              setCateringSaladBaseError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback 
                                src={imageUrl}
                                alt={base.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{base.name}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Traditional Chef Salad Bowl Base Error Message */}
                    {cateringSaladBaseError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a base to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Dressing Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={cateringSaladDressingRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      cateringSaladDressingError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Choice (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 1, up to 3</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...antipastoSaladDressings].sort((a, b) => a.name === 'No Dressing' ? 1 : b.name === 'No Dressing' ? -1 : 0).map((dressing) => {
                        const isSelected = selectedTraditionalChefDressings.includes(dressing.id);
                        const imageUrl = SALAD_DRESSING_IMAGES[dressing.id] || dressing.image;
                        return (
                          <div
                            key={dressing.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedTraditionalChefDressings(selectedTraditionalChefDressings.filter(id => id !== dressing.id));
                              } else {
                                if (selectedTraditionalChefDressings.length < 3) {
                                  setSelectedTraditionalChefDressings([...selectedTraditionalChefDressings, dressing.id]);
                                  setCateringSaladDressingError(false);
                                }
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {dressing.name === 'No Dressing' ? (
                                <div className="w-full h-full flex items-center justify-center">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1">
                                      <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              ) : (
                                <>
                                  <ImageWithFallback 
                                    src={imageUrl}
                                    alt={dressing.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{dressing.name}</span>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Traditional Chef Salad Bowl Dressing Error Message */}
                    {cateringSaladDressingError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 1 dressing to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {traditionalChefSaladSpecialInstructions.map((instruction) => {
                        const isSelected = selectedTraditionalChefSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedTraditionalChefSpecialInstructions(selectedTraditionalChefSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedTraditionalChefSpecialInstructions([...selectedTraditionalChefSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{instruction.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">$0.00</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Hoagie Platter Customization (c13) */}
          {product.id === 'c13' && (
            <>
              {/* Build Your Platter */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={hoagiePlatterRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      hoagiePlatterError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Build Your Platter (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 4</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {hoagiePlatterOptions.map((option) => {
                        const currentCount = selectedHoagiePlatterOptions[option.id] || 0;
                        return (
                          <div
                            key={option.id}
                            className="flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] border border-gray-200"
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex flex-col gap-1">
                                <p className="text-gray-900">{option.name}</p>
                                <span className="text-sm text-gray-600">${option.price.toFixed(2)}</span>
                              </div>
                              <div className="flex items-center gap-3">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    if (currentCount > 0) {
                                      setSelectedHoagiePlatterOptions({
                                        ...selectedHoagiePlatterOptions,
                                        [option.id]: currentCount - 1
                                      });
                                    }
                                  }}
                                  className="w-8 h-8 flex items-center justify-center bg-gray-200 rounded hover:bg-gray-300 transition-colors"
                                >
                                  <Minus className="w-4 h-4" />
                                </button>
                                <span className="w-8 text-center font-medium">{currentCount}</span>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setSelectedHoagiePlatterOptions({
                                      ...selectedHoagiePlatterOptions,
                                      [option.id]: currentCount + 1
                                    });
                                    setHoagiePlatterError(false);
                                  }}
                                  className="w-8 h-8 flex items-center justify-center bg-gray-200 rounded hover:bg-gray-300 transition-colors"
                                >
                                  <Plus className="w-4 h-4" />
                                </button>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    
                    {/* Hoagie Platter Error Message */}
                    {hoagiePlatterError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 4 items to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Cut Options */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Cut Options (Optional)</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {hoagiePlatterCutOptions.map((option) => {
                        const isSelected = selectedHoagiePlatterCut === option.id;
                        return (
                          <div
                            key={option.id}
                            onClick={() => setSelectedHoagiePlatterCut(option.id)}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{option.name}</p>
                              <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Side Toppings */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Side Toppings (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4">
                      {hoagiePlatterSideToppings.map((topping) => {
                        const isSelected = (selectedHoagiePlatterSideToppings[topping.id] || 0) > 0;
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                const newSelected = { ...selectedHoagiePlatterSideToppings };
                                delete newSelected[topping.id];
                                setSelectedHoagiePlatterSideToppings(newSelected);
                              } else {
                                setSelectedHoagiePlatterSideToppings({
                                  ...selectedHoagiePlatterSideToppings,
                                  [topping.id]: 1
                                });
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="relative w-14 h-14 md:w-16 md:h-16 flex-shrink-0">
                              <ImageWithFallback
                                src={topping.image}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 bg-[#A72020] bg-opacity-40 flex items-center justify-center">
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5 md:w-6 md:h-6">
                                    <Check className="w-3 h-3 md:w-4 md:h-4 text-white" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between px-3 py-1 md:px-4 md:py-3">
                              <p className="text-sm md:text-base text-gray-900">{topping.name}</p>
                              <span className="text-xs md:text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Wrap Platter Customization (c14) */}
          {product.id === 'c14' && (
            <>
              {/* Build Your Platter */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={wrapPlatterRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      wrapPlatterError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Build Your Platter (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 4</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wrapPlatterOptions.map((option) => {
                        const currentCount = selectedWrapPlatterOptions[option.id] || 0;
                        return (
                          <div
                            key={option.id}
                            className="flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] border border-gray-200"
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex flex-col gap-1">
                                <p className="text-gray-900">{option.name}</p>
                                <span className="text-sm text-gray-600">${option.price.toFixed(2)}</span>
                              </div>
                              <div className="flex items-center gap-3">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    if (currentCount > 0) {
                                      setSelectedWrapPlatterOptions({
                                        ...selectedWrapPlatterOptions,
                                        [option.id]: currentCount - 1
                                      });
                                    }
                                  }}
                                  className="w-8 h-8 flex items-center justify-center bg-gray-200 rounded hover:bg-gray-300 transition-colors"
                                >
                                  -
                                </button>
                                <span className="w-8 text-center font-medium">{currentCount}</span>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setSelectedWrapPlatterOptions({
                                      ...selectedWrapPlatterOptions,
                                      [option.id]: currentCount + 1
                                    });
                                    setWrapPlatterError(false);
                                  }}
                                  className="w-8 h-8 flex items-center justify-center bg-gray-200 rounded hover:bg-gray-300 transition-colors"
                                >
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Wrap Platter Error Message */}
                    {wrapPlatterError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 4 items to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Wrap Type */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={wrapPlatterWrapTypeRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      wrapPlatterWrapTypeError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Wrap Type (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wrapPlatterWrapTypes.map((type) => {
                        const isSelected = selectedWrapPlatterWrapType === type.id;
                        return (
                          <div
                            key={type.id}
                            onClick={() => {
                              setSelectedWrapPlatterWrapType(type.id);
                              setWrapPlatterWrapTypeError(false);
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{type.name}</p>
                              <span className="text-sm text-gray-900">${type.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {/* Wrap Type Error Message */}
                    {wrapPlatterWrapTypeError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a wrap type.</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Side Toppings */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Side Toppings (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4">
                      {wrapPlatterSideToppings.map((topping) => {
                        const isSelected = (selectedWrapPlatterSideToppings[topping.id] || 0) > 0;
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                const newSelected = { ...selectedWrapPlatterSideToppings };
                                delete newSelected[topping.id];
                                setSelectedWrapPlatterSideToppings(newSelected);
                              } else {
                                setSelectedWrapPlatterSideToppings({
                                  ...selectedWrapPlatterSideToppings,
                                  [topping.id]: 1
                                });
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="relative w-14 h-14 md:w-16 md:h-16 flex-shrink-0">
                              <ImageWithFallback
                                src={topping.image}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 bg-[#A72020] bg-opacity-40 flex items-center justify-center">
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5 md:w-6 md:h-6">
                                    <Check className="w-3 h-3 md:w-4 md:h-4 text-white" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between px-3 py-1 md:px-4 md:py-3">
                              <p className="text-sm md:text-base text-gray-900">{topping.name}</p>
                              <span className="text-xs md:text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Hot Sandwich Platter Customization (c15) */}
          {product.id === 'c15' && (
            <>
              {/* Build Your Platter */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={hotSandwichPlatterRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      hotSandwichPlatterError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Build Your Platter (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose at least 4</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {hotSandwichPlatterOptions.map((option) => {
                        const currentCount = selectedHotSandwichPlatterOptions[option.id] || 0;
                        return (
                          <div
                            key={option.id}
                            className="flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] border border-gray-200"
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex flex-col gap-1">
                                <p className="text-gray-900">{option.name}</p>
                                <span className="text-sm text-gray-600">${option.price.toFixed(2)}</span>
                              </div>
                              <div className="flex items-center gap-3">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    if (currentCount > 0) {
                                      setSelectedHotSandwichPlatterOptions({
                                        ...selectedHotSandwichPlatterOptions,
                                        [option.id]: currentCount - 1
                                      });
                                    }
                                  }}
                                  className="w-8 h-8 flex items-center justify-center bg-gray-200 rounded hover:bg-gray-300 transition-colors"
                                >
                                  -
                                </button>
                                <span className="w-8 text-center font-medium">{currentCount}</span>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setSelectedHotSandwichPlatterOptions({
                                      ...selectedHotSandwichPlatterOptions,
                                      [option.id]: currentCount + 1
                                    });
                                    setHotSandwichPlatterError(false);
                                  }}
                                  className="w-8 h-8 flex items-center justify-center bg-gray-200 rounded hover:bg-gray-300 transition-colors"
                                >
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    
                    {/* Hot Sandwich Platter Error Message */}
                    {hotSandwichPlatterError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select at least 4 items to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Cut Options */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Cut Options (Optional)</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {hotSandwichPlatterCutOptions.map((option) => {
                        const isSelected = selectedHotSandwichPlatterCut === option.id;
                        return (
                          <div
                            key={option.id}
                            onClick={() => setSelectedHotSandwichPlatterCut(option.id)}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{option.name}</p>
                              <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Side Toppings */}
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Side Toppings (Optional)</span>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4">
                      {hotSandwichPlatterSideToppings.map((topping) => {
                        const isSelected = (selectedHotSandwichPlatterSideToppings[topping.id] || 0) > 0;
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                const newSelected = { ...selectedHotSandwichPlatterSideToppings };
                                delete newSelected[topping.id];
                                setSelectedHotSandwichPlatterSideToppings(newSelected);
                              } else {
                                setSelectedHotSandwichPlatterSideToppings({
                                  ...selectedHotSandwichPlatterSideToppings,
                                  [topping.id]: 1
                                });
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="relative w-14 h-14 md:w-16 md:h-16 flex-shrink-0">
                              <ImageWithFallback
                                src={topping.image}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 bg-[#A72020] bg-opacity-40 flex items-center justify-center">
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5 md:w-6 md:h-6">
                                    <Check className="w-3 h-3 md:w-4 md:h-4 text-white" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between px-3 py-1 md:px-4 md:py-3">
                              <p className="text-sm md:text-base text-gray-900">{topping.name}</p>
                              <span className="text-xs md:text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Baby Clam Sauce Tray Customization (cs1) */}
          {product.id === 'cs1' && (
            <>
              {/* Pasta Type */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={babyClamPastaTypeRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      babyClamPastaTypeError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Pasta Type (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {babyClamPastaTypes.map((type) => {
                        const isSelected = selectedBabyClamPastaType === type.id;
                        return (
                          <div
                            key={type.id}
                            onClick={() => {
                              setSelectedBabyClamPastaType(type.id);
                              setBabyClamPastaTypeError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={type.image}
                                alt={type.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{type.name}</span>
                              <span className="text-sm text-gray-900">${type.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {babyClamPastaTypeError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a pasta type to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Sauce Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={babyClamSauceRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      babyClamSauceError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Sauce (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {babyClamSauceChoices.map((sauce) => {
                        const isSelected = selectedBabyClamSauceChoice === sauce.id;
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedBabyClamSauceChoice(sauce.id);
                              setBabyClamSauceError(false);
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{sauce.name}</p>
                              <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {babyClamSauceError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a sauce choice to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Calamari Marinara Tray Customization (cs2) */}
          {product.id === 'cs2' && (
            <>
              {/* Pasta Type */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={calamariPastaTypeRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      calamariPastaTypeError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Pasta Type (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {calamariPastaTypes.map((type) => {
                        const isSelected = selectedCalamariPastaType === type.id;
                        return (
                          <div
                            key={type.id}
                            onClick={() => {
                              setSelectedCalamariPastaType(type.id);
                              setCalamariPastaTypeError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={type.image}
                                alt={type.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{type.name}</span>
                              <span className="text-sm text-gray-900">${type.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {calamariPastaTypeError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a pasta type to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Sauce Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={calamariSauceRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      calamariSauceError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Choose Your Sauce (Required)</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...calamariSubstituteSauce, { id: 'cmss-no', name: 'No Sauce', price: 0 }].map((sauce) => {
                        const isSelected = selectedCalamariSubstituteSauce === sauce.id;
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedCalamariSubstituteSauce(sauce.id);
                              setCalamariSauceError(false);
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{sauce.name}</p>
                              <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {calamariSauceError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a sauce choice to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Mussels Tray Customization (cs4) */}
          {product.id === 'cs4' && (
            <>
              {/* Pasta Type */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={musselsPastaTypeRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      musselsPastaTypeError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Pasta Type (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {musselsPastaTypes.map((type) => {
                        const isSelected = selectedMusselsPastaType === type.id;
                        return (
                          <div
                            key={type.id}
                            onClick={() => {
                              setSelectedMusselsPastaType(type.id);
                              setMusselsPastaTypeError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={type.image}
                                alt={type.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{type.name}</span>
                              <span className="text-sm text-gray-900">${type.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {musselsPastaTypeError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a pasta type to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Sauce Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={musselsSauceRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      musselsSauceError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Sauce (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...musselsSauceChoices, { id: 'msc-no', name: 'No Sauce', price: 0 }].map((sauce) => {
                        const isSelected = selectedMusselsSauceChoice === sauce.id;
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedMusselsSauceChoice(sauce.id);
                              setMusselsSauceError(false);
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{sauce.name}</p>
                              <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {musselsSauceError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a sauce choice to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Seafood Combo Tray Customization (cs5) */}
          {product.id === 'cs5' && (
            <>
              {/* Pasta Type */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={seafoodComboPastaTypeRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      seafoodComboPastaTypeError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Pasta Type (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {seafoodComboPastaTypes.map((type) => {
                        const isSelected = selectedSeafoodComboPastaType === type.id;
                        return (
                          <div
                            key={type.id}
                            onClick={() => {
                              setSelectedSeafoodComboPastaType(type.id);
                              setSeafoodComboPastaTypeError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={type.image}
                                alt={type.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{type.name}</span>
                              <span className="text-sm text-gray-900">${type.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {seafoodComboPastaTypeError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a pasta type to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Sauce Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={seafoodComboSauceRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      seafoodComboSauceError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Sauce (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...seafoodComboSauceChoices, { id: 'scsc-no', name: 'No Sauce', price: 0 }].map((sauce) => {
                        const isSelected = selectedSeafoodComboSauceChoice === sauce.id;
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedSeafoodComboSauceChoice(sauce.id);
                              setSeafoodComboSauceError(false);
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{sauce.name}</p>
                              <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {seafoodComboSauceError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a sauce choice to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Shrimp Marinara Tray Customization (cs6) */}
          {product.id === 'cs6' && (
            <>
              {/* Pasta Type */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={shrimpMarinaraPastaTypeRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      shrimpMarinaraPastaTypeError ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Pasta Type (Required)</span>
                      <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {shrimpMarinaraPastaTypes.map((type) => {
                        const isSelected = selectedShrimpMarinaraPastaType === type.id;
                        return (
                          <div
                            key={type.id}
                            onClick={() => {
                              setSelectedShrimpMarinaraPastaType(type.id);
                              setShrimpMarinaraPastaTypeError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative bg-gray-100">
                              <ImageWithFallback                                 src={type.image}
                                alt={type.name}
                                className="w-full h-full object-cover"
                                onError={(e) => {
                                  const target = e.target as HTMLImageElement;
                                  target.style.display = 'none';
                                }}
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{type.name}</span>
                              <span className="text-sm text-gray-900">${type.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {shrimpMarinaraPastaTypeError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a pasta type to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Sauce Choice */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button 
                    ref={shrimpMarinaraSauceRef}
                    className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${
                      shrimpMarinaraSauceRef ? 'ring-4 ring-red-500' : ''
                    }`}
                  >
                    <div className="flex flex-col items-start gap-1">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Choose Your Sauce (Required)</span>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...shrimpMarinaraSubstituteSauce, { id: 'smss-no', name: 'No Sauce', price: 0 }].map((sauce) => {
                        const isSelected = selectedShrimpMarinaraSubstituteSauce === sauce.id;
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedShrimpMarinaraSubstituteSauce(sauce.id);
                              setShrimpMarinaraSauceError(false);
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                              isSelected ? 'border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                              )}
                            </div>
                            <div className="flex items-center justify-between flex-1">
                              <p className="text-gray-900">{sauce.name}</p>
                              <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {shrimpMarinaraSauceError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        <span className="font-semibold">Please select a sauce choice to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Cannoli Customization (cptray1 and cptray2) */}
          {(product.id === 'cptray1' || product.id === 'cptray2') && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instruction (Optional)</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {cannoliSpecialInstruction.map((instruction) => {
                      const isSelected = selectedCannoliSpecialInstruction;
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => setSelectedCannoliSpecialInstruction(!selectedCannoliSpecialInstruction)}
                          className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                            isSelected ? 'border-[#A72020] bg-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <svg className="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                              </svg>
                            )}
                          </div>
                          <div className="flex items-center justify-between flex-1">
                            <p className="text-gray-900">{instruction.name}</p>
                            <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Dessert Tray Customization (ccake2 and ccake4) */}
          {(product.id === 'ccake2' || product.id === 'ccake4') && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instruction (Optional)</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {dessertTraySpecialInstruction.map((instruction) => {
                      const isSelected = selectedDessertTraySpecialInstruction;
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => setSelectedDessertTraySpecialInstruction(!selectedDessertTraySpecialInstruction)}
                          className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                            isSelected ? 'border-[#A72020] bg-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <svg className="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                              </svg>
                            )}
                          </div>
                          <div className="flex items-center justify-between flex-1">
                            <p className="text-gray-900">{instruction.name}</p>
                            <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Salad Customization for Specialty Fresh Salad & Soups */}
          {product.category === 'salads' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Choose Your Base Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center" ref={saladBaseRef}>
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladBaseOptions.map((option) => {
                      const isSelected = selectedSaladBase === option.id;
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            setSelectedSaladBase(option.id);
                            setSaladBaseError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SALAD_BASE_IMAGES[option.id]}
                              alt={option.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {saladBaseError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a salad base before adding to cart</span>
                    </div>
                  )}

                  {/* Choose Your Dressing Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6 flex items-center" ref={saladDressingRef}>
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Dressing (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 items-stretch">
                    {saladDressingOptions.map((option) => {
                      const isSelected = selectedSaladDressing === option.id;
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            setSelectedSaladDressing(option.id);
                            setSaladDressingError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative overflow-hidden bg-gray-100">
                            {option.name === 'No Dressing' ? (
                              <div className="w-full h-full flex items-center justify-center">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-1">
                                    <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                )}
                              </div>
                            ) : (
                              <>
                                <ImageWithFallback
                                  src={SALAD_DRESSING_IMAGES[option.id]}
                                  alt={option.name}
                                  className="w-full h-full object-cover object-center scale-110"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {saladDressingError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a dressing before adding to cart</span>
                    </div>
                  )}

                  {/* Choose Your Toppings Section (up to 5 free) */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6 flex items-center" ref={saladToppingsRef}>
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladToppingsOptions.map((topping) => {
                      const isSelected = selectedSaladToppings.includes(topping.id);
                      const canSelect = selectedSaladToppings.length < 5 || isSelected;
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (!canSelect && !isSelected) return;
                            handleSaladToppingToggle(topping.id);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          } ${!canSelect && !isSelected ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SALAD_TOPPING_IMAGES[topping.id]}
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Dressing Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Preference (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladDressingInstructions.map((instruction) => {
                      const isSelected = selectedDressingInstruction === instruction.id;
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => setSelectedDressingInstruction(isSelected ? '' : instruction.id)}
                          className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <div className="w-3 h-3 rounded-full bg-[#A72020]" />
                            )}
                          </div>
                          <p className="text-gray-900">{instruction.name}</p>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Dressings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Dressing (4oz Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladExtraDressingOptions.map((dressing) => {
                      const isSelected = selectedExtraDressing.includes(dressing.id);
                      return (
                        <div
                          key={dressing.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraDressing(selectedExtraDressing.filter(id => id !== dressing.id));
                            } else {
                              setSelectedExtraDressing([...selectedExtraDressing, dressing.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative overflow-hidden bg-gray-100">
                            <ImageWithFallback
                              src={SALAD_EXTRA_DRESSING_IMAGES[dressing.id]}
                              alt={dressing.name}
                              className="w-full h-full object-cover object-center scale-110"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{dressing.name}</p>
                            <span className="text-sm text-gray-900">${dressing.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Special Instructions Section */}
                  {(product.name === 'Antipasto Salad' || 
                    product.name === 'Caesar Salad' || 
                    product.name === 'Calamari Salad' ||
                    product.name === 'Caprese Salad' ||
                    product.name === 'Farfalle Pasta Salad' ||
                    product.name === 'Garden Salad' ||
                    product.name === 'Grilled Chicken Caesar Salad' ||
                    product.name === 'Italian Chopped' ||
                    product.name === 'Roasted Red Peppers Salad' ||
                    product.name === 'Traditional Chef Salad' ||
                    product.name === 'Tuna Salad') && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6 flex items-center">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {(product.name === 'Antipasto Salad' ? antipastoSaladSpecialInstructions :
                          product.name === 'Caesar Salad' ? caesarSaladSpecialInstructions :
                          product.name === 'Calamari Salad' ? calamariSaladSpecialInstructions :
                          product.name === 'Caprese Salad' ? capreseSaladSpecialInstructions :
                          product.name === 'Farfalle Pasta Salad' ? farfallePastaSaladSpecialInstructions :
                          product.name === 'Garden Salad' ? gardenSaladSpecialInstructions :
                          product.name === 'Grilled Chicken Caesar Salad' ? caesarSaladSpecialInstructions :
                          product.name === 'Italian Chopped' ? italianChoppedSpecialInstructions :
                          product.name === 'Roasted Red Peppers Salad' ? roastedRedPeppersSaladSpecialInstructions :
                          product.name === 'Traditional Chef Salad' ? traditionalChefSaladSpecialInstructions :
                          product.name === 'Tuna Salad' ? tunaSaladSpecialInstructions :
                          []).map((instruction) => {
                          const isSelected = (
                            product.name === 'Antipasto Salad' ? selectedAntipastoSpecialInstructions.includes(instruction.id) :
                            product.name === 'Caesar Salad' ? selectedCaesarSpecialInstructions.includes(instruction.id) :
                            product.name === 'Calamari Salad' ? selectedCalamariSpecialInstructions.includes(instruction.id) :
                            product.name === 'Caprese Salad' ? selectedCapreseSpecialInstructions.includes(instruction.id) :
                            product.name === 'Farfalle Pasta Salad' ? selectedFarfallePastaSpecialInstructions.includes(instruction.id) :
                            product.name === 'Garden Salad' ? selectedGardenSpecialInstructions.includes(instruction.id) :
                            product.name === 'Grilled Chicken Caesar Salad' ? selectedChickenCaesarSpecialInstructions.includes(instruction.id) :
                            product.name === 'Italian Chopped' ? selectedItalianChoppedSpecialInstructions.includes(instruction.id) :
                            product.name === 'Roasted Red Peppers Salad' ? selectedRoastedRedPeppersSpecialInstructions.includes(instruction.id) :
                            product.name === 'Traditional Chef Salad' ? selectedTraditionalChefSpecialInstructions.includes(instruction.id) :
                            product.name === 'Tuna Salad' ? selectedTunaSpecialInstructions.includes(instruction.id) :
                            false
                          );
                          return (
                            <div
                              key={instruction.id}
                              onClick={() => {
                                if (product.name === 'Antipasto Salad') {
                                  if (isSelected) {
                                    setSelectedAntipastoSpecialInstructions(selectedAntipastoSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedAntipastoSpecialInstructions([...selectedAntipastoSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Caesar Salad') {
                                  if (isSelected) {
                                    setSelectedCaesarSpecialInstructions(selectedCaesarSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedCaesarSpecialInstructions([...selectedCaesarSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Calamari Salad') {
                                  if (isSelected) {
                                    setSelectedCalamariSpecialInstructions(selectedCalamariSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedCalamariSpecialInstructions([...selectedCalamariSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Caprese Salad') {
                                  if (isSelected) {
                                    setSelectedCapreseSpecialInstructions(selectedCapreseSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedCapreseSpecialInstructions([...selectedCapreseSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Farfalle Pasta Salad') {
                                  if (isSelected) {
                                    setSelectedFarfallePastaSpecialInstructions(selectedFarfallePastaSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedFarfallePastaSpecialInstructions([...selectedFarfallePastaSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Garden Salad') {
                                  if (isSelected) {
                                    setSelectedGardenSpecialInstructions(selectedGardenSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedGardenSpecialInstructions([...selectedGardenSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Grilled Chicken Caesar Salad') {
                                  if (isSelected) {
                                    setSelectedChickenCaesarSpecialInstructions(selectedChickenCaesarSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedChickenCaesarSpecialInstructions([...selectedChickenCaesarSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Italian Chopped') {
                                  if (isSelected) {
                                    setSelectedItalianChoppedSpecialInstructions(selectedItalianChoppedSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedItalianChoppedSpecialInstructions([...selectedItalianChoppedSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Roasted Red Peppers Salad') {
                                  if (isSelected) {
                                    setSelectedRoastedRedPeppersSpecialInstructions(selectedRoastedRedPeppersSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedRoastedRedPeppersSpecialInstructions([...selectedRoastedRedPeppersSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Traditional Chef Salad') {
                                  if (isSelected) {
                                    setSelectedTraditionalChefSpecialInstructions(selectedTraditionalChefSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedTraditionalChefSpecialInstructions([...selectedTraditionalChefSpecialInstructions, instruction.id]);
                                  }
                                } else if (product.name === 'Tuna Salad') {
                                  if (isSelected) {
                                    setSelectedTunaSpecialInstructions(selectedTunaSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedTunaSpecialInstructions([...selectedTunaSpecialInstructions, instruction.id]);
                                  }
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <div className="flex items-center gap-3">
                                  <div className="w-5 h-5 flex-shrink-0">
                                    {isSelected ? (
                                      <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                        <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                    )}
                                  </div>
                                  <p className="text-gray-900">{instruction.name}</p>
                                </div>
                                <span className="text-sm text-gray-900">$0.00</span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}

                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Mashed Potatoes only */}
          {product.id === 'side-4' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                    <span className="text-sm text-[#1F2937]/90">Choose exactly 1</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instruction (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {mashedPotatoesToppings.map((topping) => {
                      const isSelected = selectedExtraSauce.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraSauce([]);
                            } else {
                              setSelectedExtraSauce([topping.id]);
                            }
                          }}
                          className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <p className="text-gray-900">{topping.name}</p>
                          <span className="text-sm text-gray-900">${topping.price?.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Meatballs and Sausage only */}
          {(product.id === 'side-5' || product.id === 'side-7') && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {meatballsSausageSauceToppings.map((topping) => {
                      const isSelected = selectedExtraSauce.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraSauce([]);
                            } else {
                              setSelectedExtraSauce([topping.id]);
                            }
                          }}
                          className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <p className="text-gray-900">{topping.name}</p>
                          <span className="text-sm text-gray-900">${topping.price?.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Pasta Fagioli Soup only */}
          {product.id === 'soup1' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-4">
                  {/* Substitute Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Substitute (Required)</span>
                  </div>
                  <div ref={pastaFagioliSubstituteRef}>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {pastaFagioliSubstituteOptions.map((option) => {
                        const isSelected = selectedPastaFagioliSubstitute === option.id;
                        return (
                          <div
                            key={option.id}
                            onClick={() => {
                              setSelectedPastaFagioliSubstitute(isSelected ? '' : option.id);
                              setPastaFagioliSubstituteError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                          {option.showCircle ? (
                            <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                              {isSelected ? (
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              ) : (
                                <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                              )}
                            </div>
                          ) : option.image ? (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback src={option.image} alt={option.name} className="w-full h-full object-contain object-center" />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : (
                            <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                              {isSelected && (
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price?.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                    </div>
                    {pastaFagioliSubstituteError && (
                      <div 
                        className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mt-5 rounded-r-lg flex items-center gap-3"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <p className="font-semibold">Please select a substitute option before adding to cart</p>
                      </div>
                    )}
                  </div>

                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {pastaFagioliSpecialInstructions.map((instruction) => {
                      const isSelected = selectedPastaFagioliSpecialInstructions.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedPastaFagioliSpecialInstructions([]);
                            } else {
                              setSelectedPastaFagioliSpecialInstructions([instruction.id]);
                            }
                          }}
                          className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <p className="text-gray-900">{instruction.name}</p>
                          <span className="text-sm text-gray-900">${instruction.price?.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Chicken Tenders Options - app6, wing3, and capp2 */}
          {(product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') && (
            <>
              <Collapsible open={isChickenTendersSauceOpen} onOpenChange={setIsChickenTendersSauceOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{ fontSize: 'calc(1em + 3px)' }}>1. Substitute Your Sauce</span>
                        <span className="font-bold opacity-90" style={{fontSize: 'calc(1em + 3px)'}}>(Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersSauceOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wingsSauceOptions.map((sauce) => {
                        const isSelected = selectedChickenTendersSauce === sauce.id;
                        const isNoSauce = sauce.name.toLowerCase().includes('no sauce');
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedChickenTendersSauce(selectedChickenTendersSauce === sauce.id ? '' : sauce.id);
                              setChickenTendersSauceError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            {!isNoSauce && (
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(sauce.name)} 
                                  alt={sauce.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}
                            <div className={`flex-1 flex items-center justify-between px-4 py-3 ${isNoSauce ? 'pl-4' : ''}`}>
                              <div className="flex items-center gap-3">
                                {isNoSauce && (
                                  isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-5 h-5 text-gray-300" />
                                  )
                                )}
                                <p className="text-gray-900">{sauce.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">
                                ${sauce.price.toFixed(2)}
                              </span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              <Collapsible open={isChickenTendersExtraSauceOpen} onOpenChange={setIsChickenTendersExtraSauceOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Extra Sauce (Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersExtraSauceOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {(() => {
                        // Logic for sorting extras (prioritize Honey Mustard for Chicken Tenders)
                        const extras = chickenTendersExtraSauceOptions;
                        const productName = product.name || '';
                        
                        if (!productName.toLowerCase().includes('chicken tenders')) {
                          return extras;
                        }
                        
                        const honeyMustard = extras.filter(item => item.name.toLowerCase().includes('honey mustard'));
                        
                        // "Extra Cheese Sauce" is now in the main list, so we can filter it out like others
                        // But we want to ensure it appears right after Honey Mustard
                        const cheeseSauce = extras.filter(item => item.id === 'extra-cheese-sauce');
                        
                        // Exclude Honey Mustard AND Cheese Sauce from "others"
                        const others = extras.filter(item => 
                          !item.name.toLowerCase().includes('honey mustard') && 
                          item.id !== 'extra-cheese-sauce'
                        );
                        
                        return [...honeyMustard, ...cheeseSauce, ...others];
                      })().flatMap((sauce) => 
                        [
                          { size: '4oz', price: 2.49 },
                          { size: '8oz', price: 4.99 },
                          { size: '16oz', price: 8.99 }
                        ].map((option) => {
                          const itemId = `${sauce.id}-${option.size}`;
                          const isSelected = selectedChickenTendersExtraSauce[sauce.id] === option.size;
                          
                          // Display name logic: remove "Extra" prefix if present to avoid "Extra Extra"
                          // Then prepend "Extra" once.
                          const displayName = sauce.name.replace(/^Extra\s+/i, '');
                          
                          return (
                            <div
                              key={itemId}
                              onClick={() => {
                                setSelectedChickenTendersExtraSauce(prev => ({
                                  ...prev,
                                  [sauce.id]: isSelected ? '' : option.size
                                }));
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={sauce.image || getSauceImage(sauce.name)} 
                                  alt={sauce.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">Extra {displayName} {option.size}</p>
                                <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              <Collapsible open={isChickenTendersDippingsOpen} onOpenChange={setIsChickenTendersDippingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Dippings (Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersDippingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wingsExtraCheeseRanchOptions.flatMap((option) => 
                        [
                          { size: '4oz', price: 2.49 },
                          { size: '8oz', price: 4.99 },
                          { size: '16oz', price: 8.99 }
                        ].map((sizeOption) => {
                          const itemId = `${option.id}-${sizeOption.size}`;
                          const isSelected = selectedChickenTendersExtraCheeseRanch[option.id] === sizeOption.size;
                          const displayName = option.name.startsWith('Extra ') ? option.name : `Extra ${option.name}`;

                          return (
                            <div
                              key={itemId}
                              onClick={() => {
                                setSelectedChickenTendersExtraCheeseRanch(prev => ({
                                  ...prev,
                                  [option.id]: isSelected ? '' : sizeOption.size
                                }));
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(option.name)} 
                                  alt={option.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{displayName} {sizeOption.size}</p>
                                <span className="text-sm text-gray-900">${sizeOption.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Add Toppings for Broccoli & Cheddar Bites only */}
          {product.id === 'app7' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Extra Sauce</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {broccoliCheddarBitesInstructionsOptions
                      .filter(instruction => instruction.name !== 'Well Done' && instruction.name !== 'No Pomodoro Sauce')
                      .map((instruction) => {
                      const isSelected = selectedBroccoliCheddarBitesInstructions.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedBroccoliCheddarBitesInstructions(selectedBroccoliCheddarBitesInstructions.filter(id => id !== instruction.id));
                            } else {
                              setSelectedBroccoliCheddarBitesInstructions([...selectedBroccoliCheddarBitesInstructions, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={instruction.image} 
                              alt={instruction.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <span className="text-gray-900 font-medium">{instruction.name}</span>
                            <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  <div className="space-y-3">
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                      <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No toppings</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {mozzarellaSticksSpecialInstructionsOptions
                        .filter(instruction => instruction.name === 'No Pomodoro Sauce')
                        .map((instruction) => {
                        const isSelected = selectedBroccoliCheddarBitesInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedBroccoliCheddarBitesInstructions(selectedBroccoliCheddarBitesInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedBroccoliCheddarBitesInstructions([...selectedBroccoliCheddarBitesInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3 pl-4">
                              <div className="flex items-center gap-3">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-5 h-5 text-gray-300" />
                                )}
                                <span className="text-gray-900 font-medium">{instruction.name}</span>
                              </div>
                              <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Build Your Own Pasta Customization - Only for cp-1 */}
          {product.id === 'cp-1' && (
            <>
              {/* Pasta Type Selection */}
              <div ref={buildPastaTypeRef}>
                <Collapsible open={isIncludedOpen} onOpenChange={setIsIncludedOpen}>
                  <CollapsibleTrigger asChild>
                    <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                      <div className="flex flex-col items-start gap-1">
                        <div className="flex items-center gap-2">
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose a Pasta</span>
                          <span className="text-[#1F2937] font-bold" style={{fontSize: 'calc(1em + 3px)'}}>(Required)</span>
                        </div>
                      </div>
                      {isIncludedOpen ? (
                        <ChevronUp className="w-6 h-6" />
                      ) : (
                        <ChevronDown className="w-6 h-6" />
                      )}
                    </button>
                  </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaTypes.map((pastaType) => {
                        const isSelected = selectedBuildPastaType === pastaType.id;
                        return (
                          <div
                            key={pastaType.id}
                            onClick={() => setSelectedBuildPastaType(pastaType.id)}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_TYPE_IMAGES[pastaType.id]}
                                alt={pastaType.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{pastaType.name}</span>
                              <span className="text-sm text-gray-900">{pastaType.price > 0 ? '+' : ''}${pastaType.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {buildPastaTypeError && (
                      <div 
                        className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <p className="font-semibold">Please select a pasta type before adding to cart</p>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
              </div>

              {/* Select Your Preferred Type (Sauce) */}
              <div ref={buildPastaSauceRef}>
                <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                  <CollapsibleTrigger asChild>
                    <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-2">
                      <div className="flex flex-col items-start gap-1">
                        <div className="flex items-center gap-2">
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Choose a Sauce</span>
                          <span className="text-[#1F2937] font-bold" style={{fontSize: 'calc(1em + 3px)'}}>(Required)</span>
                        </div>
                      </div>
                      {isSideToppingsOpen ? (
                        <ChevronUp className="w-6 h-6" />
                      ) : (
                        <ChevronDown className="w-6 h-6" />
                      )}
                    </button>
                  </CollapsibleTrigger>
                  <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                    <div 
                      className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                      style={{ 
                        backgroundImage: `url(${backgroundTexture})`,
                        backgroundSize: 'cover',
                        backgroundPosition: 'center'
                      }}
                    />
                    <div className="relative z-10 space-y-4">
                      <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                        {buildPastaSauces.map((sauce) => {
                        const isSelected = selectedBuildPastaSauce === sauce.id;
                        const hasImage = BUILD_PASTA_SAUCE_IMAGES[sauce.id] && BUILD_PASTA_SAUCE_IMAGES[sauce.id] !== '';
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => setSelectedBuildPastaSauce(sauce.id)}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              {hasImage ? (
                                <>
                                  <ImageWithFallback
                                    src={BUILD_PASTA_SAUCE_IMAGES[sauce.id]}
                                    alt={sauce.name}
                                    className="w-full h-full object-cover"
                                  />
                                  {isSelected && (
                                    <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    </div>
                                  )}
                                </>
                              ) : (
                                <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                  {isSelected ? (
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{sauce.name}</span>
                              <span className="text-sm text-gray-900">
                                {sauce.price > 0 ? `$${sauce.price.toFixed(2)}` : '$0.00'}
                              </span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {buildPastaSauceError && (
                      <div 
                        className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <p className="font-semibold">Please select your preferred sauce type before adding to cart</p>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
              </div>

              {/* Add Toppings */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Add Toppings (Optional)</span>
                      </div>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-4">
                      {buildPastaToppings.map((topping) => {
                        const isSelected = selectedBuildPastaToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedBuildPastaToppings(selectedBuildPastaToppings.filter(id => id !== topping.id));
                              } else {
                                setSelectedBuildPastaToppings([...selectedBuildPastaToppings, topping.id]);
                              }
                            }}
                            className={`flex flex-col h-[200px] bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                              isSelected ? 'ring-2 ring-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="h-[60%] w-full relative bg-gray-50 border-b border-gray-100 flex-shrink-0">
                              <ImageWithFallback
                                src={BUILD_PASTA_TOPPING_IMAGES[topping.id]}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                  <div className="bg-white rounded-full p-1">
                                    <Check className="w-5 h-5 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="h-[40%] px-3 py-2 flex flex-col items-center justify-center text-center gap-1 bg-[#F6F6F6]">
                              <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2">{topping.name}</span>
                              <span className="text-gray-900 font-bold text-sm">${topping.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Choose Soup Section */}
              <Collapsible open={isSoupOpen} onOpenChange={setIsSoupOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>4. Choose Soup or Salad (Optional)</span>
                      </div>
                    </div>
                    {isSoupOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      {buildPastaSoups.map((soup) => {
                        const isSelected = selectedBuildPastaSoup.includes(soup.id);
                        return (
                          <div
                            key={soup.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedBuildPastaSoup(selectedBuildPastaSoup.filter(id => id !== soup.id));
                              } else {
                                setSelectedBuildPastaSoup([...selectedBuildPastaSoup, soup.id]);
                              }
                            }}
                            className={`flex flex-col h-[200px] bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                              isSelected ? 'ring-2 ring-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="h-[60%] w-full relative bg-gray-50 border-b border-gray-100 flex-shrink-0">
                              <ImageWithFallback
                                src={BUILD_PASTA_SOUP_IMAGES[soup.id] || soup.image || ''}
                                alt={soup.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                  <div className="bg-white rounded-full p-1">
                                    <Check className="w-5 h-5 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                              {soup.id === 'bps2' && (
                                <div 
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setShowBuildPastaSoupDialog(true);
                                  }}
                                  className="absolute top-1 right-1 z-20 p-1 bg-white/90 rounded-full shadow-sm hover:bg-white transition-colors"
                                >
                                  <MoreVertical className="w-5 h-5 text-gray-900" />
                                </div>
                              )}
                              {soup.removableIngredients && (
                                <Popover>
                                  <PopoverTrigger asChild>
                                    <div 
                                      onClick={(e) => e.stopPropagation()}
                                      className="absolute top-1 right-1 z-20 p-1 bg-white/90 rounded-full shadow-sm hover:bg-white transition-colors cursor-pointer"
                                    >
                                      <MoreVertical className="w-5 h-5 text-gray-900" />
                                    </div>
                                  </PopoverTrigger>
                                  <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                    <div className="bg-[#A72020] text-white px-4 py-3 flex items-center justify-between">
                                      <span className="font-semibold">Uncheck to Remove From Salad</span>
                                    </div>
                                    <div className="p-4 max-h-64 overflow-y-auto">
                                      <div className={`grid ${soup.id === 'bps4' ? 'grid-cols-2' : 'grid-cols-3'} gap-3`}>
                                        {soup.removableIngredients.map((ingredient) => {
                                          const isSideGarden = soup.id === 'bps3';
                                          const removedIngredients = isSideGarden ? sideGardenSaladRemovedIngredients : sideCaesarSaladRemovedIngredients;
                                          const setRemovedIngredients = isSideGarden ? setSideGardenSaladRemovedIngredients : setSideCaesarSaladRemovedIngredients;
                                          const isRemoved = removedIngredients.includes(ingredient.id);
                                          
                                          return (
                                            <button
                                              key={ingredient.id}
                                              onClick={(e) => {
                                                e.stopPropagation();
                                                if (isRemoved) {
                                                  setRemovedIngredients(
                                                    removedIngredients.filter(id => id !== ingredient.id)
                                                  );
                                                } else {
                                                  setRemovedIngredients([
                                                    ...removedIngredients,
                                                    ingredient.id
                                                  ]);
                                                }
                                              }}
                                              className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                              }`}
                                            >
                                              {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                              <span className="text-center leading-tight">{ingredient.name}</span>
                                            </button>
                                          );
                                        })}
                                      </div>
                                    </div>
                                  </PopoverContent>
                                </Popover>
                              )}
                            </div>
                            <div className="h-[40%] px-3 py-2 flex flex-col items-center justify-center text-center gap-1 bg-[#F6F6F6]">
                              <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2">{soup.name}</span>
                              <span className="text-gray-900 font-bold text-sm">${soup.price?.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Create Your Own Kids Pasta Customization - Only for k1 */}
          {product.id === 'k1' && (
            <>
              {/* Pasta Type Selection */}
              <div ref={kidsPastaTypeRef}>
              <Collapsible open={isIncludedOpen} onOpenChange={setIsIncludedOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose A Pasta</span>
                        <span className="text-[#1F2937] font-bold" style={{fontSize: 'calc(1em + 3px)'}}>(Required)</span>
                      </div>
                    </div>
                    {isIncludedOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaTypes.map((pastaType) => {
                        const isSelected = selectedKidsPastaType === pastaType.id;
                        return (
                          <div
                            key={pastaType.id}
                            onClick={() => setSelectedKidsPastaType(pastaType.id)}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_TYPE_IMAGES[pastaType.id]}
                                alt={pastaType.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{pastaType.name}</span>
                              {pastaType.price > 0 && (
                                <span className="text-sm text-gray-900">${pastaType.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>

                  {kidsPastaTypeError && (
                    <div 
                      className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4"
                      role="alert"
                    >
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <span>Please select a pasta type to continue</span>
                    </div>
                  )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
              </div>

              {/* Select Your Preferred Type (Sauce) */}
              <div ref={kidsPastaSauceRef}>
              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Choose A Sauce</span>
                        <span className="text-[#1F2937] font-bold" style={{fontSize: 'calc(1em + 3px)'}}>(Required)</span>
                      </div>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                      {kidsPastaSauces.map((sauce) => {
                        const isSelected = selectedKidsPastaSauce === sauce.id;
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => setSelectedKidsPastaSauce(sauce.id)}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_SAUCE_IMAGES[sauce.id]}
                                alt={sauce.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{sauce.name}</span>
                              {sauce.price > 0 && (
                                <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>

                  {kidsPastaSauceError && (
                    <div 
                      className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4"
                      role="alert"
                    >
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <span>Please select a sauce to continue</span>
                    </div>
                  )}
                  </div>
                </CollapsibleContent>
              </Collapsible>
              </div>

              {/* Add Toppings */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Add Toppings (Optional)</span>
                      </div>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaToppings.map((topping) => {
                        const isSelected = selectedKidsPastaToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsPastaToppings(selectedKidsPastaToppings.filter(id => id !== topping.id));
                              } else {
                                setSelectedKidsPastaToppings([...selectedKidsPastaToppings, topping.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_TOPPING_IMAGES[topping.id]}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{topping.name}</span>
                              <span className="text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>4. Special Instructions (Optional)</span>
                      </div>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaSpecialInstructions.map((instruction) => {
                        const isSelected = selectedKidsPastaSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsPastaSpecialInstructions(selectedKidsPastaSpecialInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedKidsPastaSpecialInstructions([...selectedKidsPastaSpecialInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex items-center gap-3">
                              <div className="flex-shrink-0">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-5 h-5 text-gray-300" strokeWidth={2} />
                                )}
                              </div>
                              <p className="text-gray-900">{instruction.name}</p>
                            </div>
                            {instruction.price > 0 && (
                              <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Kids Baked Items Customization - Only for k2, k3, k4 */}
          {(product.id === 'k2' || product.id === 'k3' || product.id === 'k4') && (
            <>
              {/* Extra Toppings */}
              <Collapsible open={isKidsBakedExtraOpen} onOpenChange={setIsKidsBakedExtraOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Toppings (Optional)</span>
                      </div>
                    </div>
                    {isKidsBakedExtraOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsBakedExtraToppings.map((topping) => {
                        const isSelected = selectedKidsBakedExtraToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsBakedExtraToppings(selectedKidsBakedExtraToppings.filter(id => id !== topping.id));
                              } else {
                                // Handle mutually exclusive options
                                if (topping.id === 'kbt1') { // Extra Sauce
                                  // Deselect Lite Sauce
                                  setSelectedKidsBakedLiteToppings(selectedKidsBakedLiteToppings.filter(id => id !== 'kbt3'));
                                } else if (topping.id === 'kbt2') { // Extra Cheese
                                  // Deselect No Mozzarella Cheese on top
                                  setSelectedKidsBakedNoToppings(selectedKidsBakedNoToppings.filter(id => id !== 'kbt5'));
                                }
                                setSelectedKidsBakedExtraToppings([...selectedKidsBakedExtraToppings, topping.id]);
                              }
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-white" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between">
                              <span className="text-gray-900">{topping.name}</span>
                              {topping.price > 0 && (
                                <span className="text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Lite Toppings */}
              <Collapsible open={isKidsBakedLiteOpen} onOpenChange={setIsKidsBakedLiteOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Lite Toppings (Optional)</span>
                      </div>
                    </div>
                    {isKidsBakedLiteOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsBakedLiteToppings.map((topping) => {
                        const isSelected = selectedKidsBakedLiteToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsBakedLiteToppings(selectedKidsBakedLiteToppings.filter(id => id !== topping.id));
                              } else {
                                // Handle mutually exclusive options
                                if (topping.id === 'kbt3') { // Lite Sauce
                                  // Deselect Extra Sauce
                                  setSelectedKidsBakedExtraToppings(selectedKidsBakedExtraToppings.filter(id => id !== 'kbt1'));
                                }
                                setSelectedKidsBakedLiteToppings([...selectedKidsBakedLiteToppings, topping.id]);
                              }
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-white" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between">
                              <span className="text-gray-900">{topping.name}</span>
                              {topping.price > 0 && (
                                <span className="text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* No Toppings */}
              <Collapsible open={isKidsBakedNoOpen} onOpenChange={setIsKidsBakedNoOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                      </div>
                    </div>
                    {isKidsBakedNoOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsBakedNoToppings.map((topping) => {
                        const isSelected = selectedKidsBakedNoToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsBakedNoToppings(selectedKidsBakedNoToppings.filter(id => id !== topping.id));
                              } else {
                                // Handle mutually exclusive options
                                if (topping.id === 'kbt5') { // No Mozzarella Cheese on top
                                  // Deselect Extra Cheese
                                  setSelectedKidsBakedExtraToppings(selectedKidsBakedExtraToppings.filter(id => id !== 'kbt2'));
                                }
                                setSelectedKidsBakedNoToppings([...selectedKidsBakedNoToppings, topping.id]);
                              }
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-white" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between">
                              <span className="text-gray-900">{topping.name}</span>
                              {topping.price > 0 && (
                                <span className="text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Kids Pasta and Meatball Customization - Only for k6 */}
          {product.id === 'k6' && (
            <>
              {/* Pasta Type Selection */}
              <Collapsible open={isKidsPastaMeatballTypeOpen} onOpenChange={setIsKidsPastaMeatballTypeOpen}>
                <CollapsibleTrigger asChild>
                  <button ref={kidsPastaMeatballTypeRef} className={`w-full bg-[#F5F3EB] text-gray-900 p-5 rounded-lg flex items-center justify-between ${kidsPastaMeatballTypeError ? 'ring-4 ring-red-500' : ''}`}>
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose A Pasta (Required)</span>
                      </div>
                    </div>
                    {isKidsPastaMeatballTypeOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaTypes.map((pastaType) => {
                        const isSelected = selectedKidsPastaMeatballType === pastaType.id;
                        return (
                          <div
                            key={pastaType.id}
                            onClick={() => {
                              setSelectedKidsPastaMeatballType(pastaType.id);
                              setKidsPastaMeatballTypeError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_TYPE_IMAGES[pastaType.id]}
                                alt={pastaType.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{pastaType.name}</span>
                              {pastaType.price > 0 && (
                                <span className="text-sm text-gray-900">${pastaType.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    {kidsPastaMeatballTypeError && (
                      <div 
                        className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <span>Please select a pasta type to continue</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Special Instructions */}
              <Collapsible open={isKidsPastaMeatballSpecialOpen} onOpenChange={setIsKidsPastaMeatballSpecialOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                      </div>
                    </div>
                    {isKidsPastaMeatballSpecialOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaMeatballSpecialInstructions.map((instruction) => {
                        const isSelected = selectedKidsPastaMeatballSpecialInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsPastaMeatballSpecialInstructions([]);
                              } else {
                                setSelectedKidsPastaMeatballSpecialInstructions([instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-white" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between">
                              <span className="text-gray-900">{instruction.name}</span>
                              {instruction.price > 0 && (
                                <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {/* Add Toppings */}
              <Collapsible open={isKidsPastaMeatballToppingsOpen} onOpenChange={setIsKidsPastaMeatballToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mt-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Add Toppings (Optional)</span>
                      </div>
                    </div>
                    {isKidsPastaMeatballToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10 space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {kidsPastaMeatballToppings.map((topping) => {
                        const isSelected = selectedKidsPastaMeatballToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedKidsPastaMeatballToppings(selectedKidsPastaMeatballToppings.filter(id => id !== topping.id));
                              } else {
                                setSelectedKidsPastaMeatballToppings([...selectedKidsPastaMeatballToppings, topping.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback
                                src={KIDS_PASTA_MEATBALL_TOPPING_IMAGES[topping.id]}
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 px-4 py-3 flex items-center justify-between">
                              <span className="text-gray-900">{topping.name}</span>
                              {topping.price > 0 && (
                                <span className="text-sm text-gray-900">${topping.price.toFixed(2)}</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Salad Customization - Only for create-salad category */}
          {product.category === 'create-salad' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Choose Your Base Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center" ref={saladBaseRef}>
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Base (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladBaseOptions.map((option) => {
                      const isSelected = selectedSaladBase === option.id;
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            setSelectedSaladBase(option.id);
                            setSaladBaseError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SALAD_BASE_IMAGES[option.id]}
                              alt={option.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {saladBaseError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a salad base before adding to cart</span>
                    </div>
                  )}

                  {/* Choose Your Dressing Section */}
                  <div ref={saladDressingRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-3 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Choose your Dressing (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 items-stretch">
                    {saladDressingOptions.map((option) => {
                      const isSelected = selectedSaladDressing === option.id;
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            setSelectedSaladDressing(option.id);
                            setSaladDressingError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative overflow-hidden bg-gray-100">
                            {option.name === 'No Dressing' ? (
                              <div className="w-full h-full flex items-center justify-center">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-1">
                                    <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-6 h-6 text-gray-400" strokeWidth={2} />
                                )}
                              </div>
                            ) : (
                              <>
                                <ImageWithFallback
                                  src={SALAD_DRESSING_IMAGES[option.id]}
                                  alt={option.name}
                                  className="w-full h-full object-cover object-center scale-110"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {saladDressingError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a dressing before adding to cart</span>
                    </div>
                  )}

                  {/* Choose Your Toppings Section */}
                  <div ref={saladToppingsRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-3 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Toppings (Choose at least 1, up to 5)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladToppingsOptions.map((option) => {
                      const isSelected = selectedSaladToppings.includes(option.id);
                      const canSelect = selectedSaladToppings.length < 5 || isSelected;
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            if (!canSelect && !isSelected) return;
                            handleSaladToppingToggle(option.id);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          } ${!canSelect && !isSelected ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SALAD_TOPPING_IMAGES[option.id]}
                              alt={option.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Dressing Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-3 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Dressing Instructions (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladDressingInstructions.map((option) => {
                      const isSelected = selectedDressingInstructions === option.id;
                      return (
                        <div
                          key={option.id}
                          onClick={() => setSelectedDressingInstructions(option.id)}
                          className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <p className="text-gray-900">{option.name}</p>
                          <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Dressing Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-3 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Dressing (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladExtraDressingOptions.map((option) => {
                      const isSelected = selectedExtraDressing.includes(option.id);
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraDressing(selectedExtraDressing.filter(id => id !== option.id));
                            } else {
                              setSelectedExtraDressing([...selectedExtraDressing, option.id]);
                            }
                          }}
                          className={`flex items-stretch gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] h-14 ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 aspect-square flex-shrink-0 relative bg-[#F6F6F6]">
                            <ImageWithFallback
                              src={SALAD_EXTRA_DRESSING_IMAGES[option.id]}
                              alt={option.name}
                              className="w-full h-full object-cover object-center"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-2">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-3 flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {saladExtraToppingsOptions.map((option) => {
                      const isSelected = selectedExtraToppings.includes(option.id);
                      return (
                        <div
                          key={option.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraToppings(selectedExtraToppings.filter(id => id !== option.id));
                            } else {
                              setSelectedExtraToppings([...selectedExtraToppings, option.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SALAD_EXTRA_TOPPING_IMAGES[option.id]}
                              alt={option.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{option.name}</p>
                            <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for French Fries only */}
          {product.id === 'app9' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {friesInstructionsOptions.map((instruction) => (
                      <div
                        key={instruction.id}
                        onClick={() => {
                          if (selectedFriesInstructions.includes(instruction.id)) {
                            setSelectedFriesInstructions(selectedFriesInstructions.filter(id => id !== instruction.id));
                          } else {
                            setSelectedFriesInstructions([...selectedFriesInstructions, instruction.id]);
                          }
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedFriesInstructions.includes(instruction.id) ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedFriesInstructions.includes(instruction.id) ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedFriesInstructions.includes(instruction.id) && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{instruction.name}</span>
                        <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Garlic Bread only */}
          {product.id === 'app1' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {garlicBreadInstructionsOptions.map((instruction) => (
                      <div
                        key={instruction.id}
                        onClick={() => {
                          if (selectedGarlicBreadInstructions.includes(instruction.id)) {
                            setSelectedGarlicBreadInstructions(selectedGarlicBreadInstructions.filter(id => id !== instruction.id));
                          } else {
                            setSelectedGarlicBreadInstructions([...selectedGarlicBreadInstructions, instruction.id]);
                          }
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedGarlicBreadInstructions.includes(instruction.id) ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedGarlicBreadInstructions.includes(instruction.id) ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedGarlicBreadInstructions.includes(instruction.id) && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{instruction.name}</span>
                        <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Garlic Bread with Mozzarella only */}
          {product.id === 'app2' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {garlicBreadMozzarellaInstructionsOptions.map((instruction) => (
                      <div
                        key={instruction.id}
                        onClick={() => {
                          if (selectedGarlicBreadMozzarellaInstructions.includes(instruction.id)) {
                            setSelectedGarlicBreadMozzarellaInstructions(selectedGarlicBreadMozzarellaInstructions.filter(id => id !== instruction.id));
                          } else {
                            setSelectedGarlicBreadMozzarellaInstructions([...selectedGarlicBreadMozzarellaInstructions, instruction.id]);
                          }
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedGarlicBreadMozzarellaInstructions.includes(instruction.id) ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedGarlicBreadMozzarellaInstructions.includes(instruction.id) ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedGarlicBreadMozzarellaInstructions.includes(instruction.id) && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{instruction.name}</span>
                        <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Garlic Stick only */}
          {product.id === 'app3' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Extra Sauce</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {garlicStickInstructionsOptions
                      .filter(instruction => instruction.name !== 'Well Done' && instruction.name !== 'No Pomodoro Sauce')
                      .map((instruction) => {
                      const isSelected = selectedGarlicStickInstructions.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedGarlicStickInstructions(selectedGarlicStickInstructions.filter(id => id !== instruction.id));
                            } else {
                              setSelectedGarlicStickInstructions([...selectedGarlicStickInstructions, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={instruction.image} 
                              alt={instruction.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <span className="text-gray-900 font-medium">{instruction.name}</span>
                            <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No toppings</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {garlicStickInstructionsOptions
                      .filter(instruction => instruction.name === 'No Pomodoro Sauce')
                      .map((instruction) => {
                      const isSelected = selectedGarlicStickInstructions.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedGarlicStickInstructions(selectedGarlicStickInstructions.filter(id => id !== instruction.id));
                            } else {
                              setSelectedGarlicStickInstructions([...selectedGarlicStickInstructions, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3 pl-4">
                            <div className="flex items-center gap-3">
                              {isSelected ? (
                                <div className="bg-[#A72020] rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                </div>
                              ) : (
                                <Circle className="w-5 h-5 text-gray-300" />
                              )}
                              <span className="text-gray-900 font-medium">{instruction.name}</span>
                            </div>
                            <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Mozzarella Sticks Options - app4, wing4, and capp3 | Arancini Rice Ball (Regular Menu) - app8 | Arancini Rice Ball (Catering) - capp4 */}
          {(product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3' || product.id === 'app8' || product.id === 'capp4') && (
            <>
              {product.id !== 'app4' && product.id !== 'wing4' && product.id !== 'capp3' && product.id !== 'app8' && product.id !== 'capp4' && (
              <Collapsible open={isChickenTendersSauceOpen} onOpenChange={setIsChickenTendersSauceOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{ fontSize: 'calc(1em + 3px)' }}>1. Substitute Your Sauce</span>
                        <span className="font-bold opacity-90" style={{fontSize: 'calc(1em + 3px)'}}>(Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersSauceOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wingsSauceOptions.map((sauce) => {
                        const isSelected = selectedChickenTendersSauce === sauce.id;
                        const isNoSauce = sauce.name.toLowerCase().includes('no sauce');
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              setSelectedChickenTendersSauce(selectedChickenTendersSauce === sauce.id ? '' : sauce.id);
                              setChickenTendersSauceError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            {!isNoSauce && (
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(sauce.name)} 
                                  alt={sauce.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}
                            <div className={`flex-1 flex items-center justify-between px-4 py-3 ${isNoSauce ? 'pl-4' : ''}`}>
                              <div className="flex items-center gap-3">
                                {isNoSauce && (
                                  isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-5 h-5 text-gray-300" />
                                  )
                                )}
                                <p className="text-gray-900">{sauce.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">
                                ${sauce.price.toFixed(2)}
                              </span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
              )}

              <Collapsible open={isChickenTendersSpecialInstructionsOpen} onOpenChange={setIsChickenTendersSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button ref={chickenTendersSpecialInstructionsRef} className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Extra Sauce</span>
                        <span className="font-bold opacity-90" style={{fontSize: 'calc(1em + 3px)'}}>(Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="space-y-6">
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {mozzarellaSticksSpecialInstructionsOptions
                          .filter(instruction => instruction.name !== 'Well Done' && instruction.name !== 'No Pomodoro Sauce')
                          .map((instruction) => {
                          const isSelected = selectedMozzarellaSticksSpecialInstructions.includes(instruction.id);
                          return (
                            <div
                              key={instruction.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedMozzarellaSticksSpecialInstructions(selectedMozzarellaSticksSpecialInstructions.filter(id => id !== instruction.id));
                                } else {
                                  setSelectedMozzarellaSticksSpecialInstructions([...selectedMozzarellaSticksSpecialInstructions, instruction.id]);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={instruction.image} 
                                  alt={instruction.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <span className="text-gray-900 font-medium">{instruction.name}</span>
                                <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      <div className="space-y-3">
                        <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                          <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No toppings</span>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          {mozzarellaSticksSpecialInstructionsOptions
                            .filter(instruction => instruction.name === 'No Pomodoro Sauce')
                            .map((instruction) => {
                            const isSelected = selectedMozzarellaSticksSpecialInstructions.includes(instruction.id);
                            return (
                              <div
                                key={instruction.id}
                                onClick={() => {
                                  if (isSelected) {
                                    setSelectedMozzarellaSticksSpecialInstructions(selectedMozzarellaSticksSpecialInstructions.filter(id => id !== instruction.id));
                                  } else {
                                    setSelectedMozzarellaSticksSpecialInstructions([...selectedMozzarellaSticksSpecialInstructions, instruction.id]);
                                  }
                                }}
                                className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                                  isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                                }`}
                              >
                                <div className="flex-1 flex items-center justify-between px-4 py-3 pl-4">
                                  <div className="flex items-center gap-3">
                                    {isSelected ? (
                                      <div className="bg-[#A72020] rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <Circle className="w-5 h-5 text-gray-300" />
                                    )}
                                    <span className="text-gray-900 font-medium">{instruction.name}</span>
                                  </div>
                                  <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              {product.id !== 'app4' && product.id !== 'wing4' && product.id !== 'capp3' && product.id !== 'app8' && product.id !== 'capp4' && (
              <>
              <Collapsible open={isChickenTendersExtraSauceOpen} onOpenChange={setIsChickenTendersExtraSauceOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Extra Sauce (Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersExtraSauceOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {mozzarellaSticksExtraSauceOptions.flatMap((sauce) => 
                        [
                          { size: '4oz', price: 2.49 },
                          { size: '8oz', price: 4.99 },
                          { size: '16oz', price: 8.99 }
                        ].map((option) => {
                          const itemId = `${sauce.id}-${option.size}`;
                          const isSelected = selectedChickenTendersExtraSauce[sauce.id] === option.size;
                          return (
                            <div
                              key={itemId}
                              onClick={() => {
                                setSelectedChickenTendersExtraSauce(prev => ({
                                  ...prev,
                                  [sauce.id]: isSelected ? '' : option.size
                                }));
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(sauce.name)} 
                                  alt={sauce.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{sauce.name} {option.size}</p>
                                <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              <Collapsible open={isChickenTendersDippingsOpen} onOpenChange={setIsChickenTendersDippingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>4. Dippings (Optional)</span>
                      </div>
                    </div>
                    {isChickenTendersDippingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wingsExtraCheeseRanchOptions.flatMap((option) => 
                        [
                          { size: '4oz', price: 2.49 },
                          { size: '8oz', price: 4.99 },
                          { size: '16oz', price: 8.99 }
                        ].map((sizeOption) => {
                          const itemId = `${option.id}-${sizeOption.size}`;
                          const isSelected = selectedChickenTendersExtraCheeseRanch[option.id] === sizeOption.size;
                          return (
                            <div
                              key={itemId}
                              onClick={() => {
                                setSelectedChickenTendersExtraCheeseRanch(prev => ({
                                  ...prev,
                                  [option.id]: isSelected ? '' : sizeOption.size
                                }));
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(option.name)} 
                                  alt={option.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">Extra {option.name} {sizeOption.size}</p>
                                <span className="text-sm text-gray-900">${sizeOption.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
              </>
              )}
            </>
          )}

          {/* Add Toppings for Onion Rings only */}
          {product.id === 'app5' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Extra Sauce</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {onionRingsInstructionsOptions
                      .filter(instruction => instruction.name !== 'Well Done' && instruction.name !== 'No Pomodoro Sauce')
                      .map((instruction) => {
                      const isSelected = selectedOnionRingsInstructions.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedOnionRingsInstructions(selectedOnionRingsInstructions.filter(id => id !== instruction.id));
                            } else {
                              setSelectedOnionRingsInstructions([...selectedOnionRingsInstructions, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={instruction.image} 
                              alt={instruction.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <span className="text-gray-900 font-medium">{instruction.name}</span>
                            <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  <div className="space-y-3">
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                      <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No toppings</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {mozzarellaSticksSpecialInstructionsOptions
                        .filter(instruction => instruction.name === 'No Pomodoro Sauce')
                        .map((instruction) => {
                        const isSelected = selectedOnionRingsInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedOnionRingsInstructions(selectedOnionRingsInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedOnionRingsInstructions([...selectedOnionRingsInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3 pl-4">
                              <div className="flex items-center gap-3">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-5 h-5 text-gray-300" />
                                )}
                                <span className="text-gray-900 font-medium">{instruction.name}</span>
                              </div>
                              <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}





          {/* Add Toppings for Mac & Cheese Bites only */}
          {product.id === 'app13' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Extra Sauce</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {macAndCheeseBitesInstructionsOptions
                      .filter(instruction => instruction.name !== 'Well Done' && instruction.name !== 'No Pomodoro Sauce')
                      .map((instruction) => {
                      const isSelected = selectedMacAndCheeseBitesInstructions.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedMacAndCheeseBitesInstructions(selectedMacAndCheeseBitesInstructions.filter(id => id !== instruction.id));
                            } else {
                              setSelectedMacAndCheeseBitesInstructions([...selectedMacAndCheeseBitesInstructions, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={instruction.image} 
                              alt={instruction.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <span className="text-gray-900 font-medium">{instruction.name}</span>
                            <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  <div className="space-y-3">
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                      <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No toppings</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {macAndCheeseBitesInstructionsOptions
                        .filter(instruction => instruction.name === 'No Pomodoro Sauce')
                        .map((instruction) => {
                        const isSelected = selectedMacAndCheeseBitesInstructions.includes(instruction.id);
                        return (
                          <div
                            key={instruction.id}
                            onClick={() => {
                              if (isSelected) {
                                setSelectedMacAndCheeseBitesInstructions(selectedMacAndCheeseBitesInstructions.filter(id => id !== instruction.id));
                              } else {
                                setSelectedMacAndCheeseBitesInstructions([...selectedMacAndCheeseBitesInstructions, instruction.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] border ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border-gray-200 hover:border-gray-300'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3 pl-4">
                              <div className="flex items-center gap-3">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-5 h-5 text-gray-300" />
                                )}
                                <span className="text-gray-900 font-medium">{instruction.name}</span>
                              </div>
                              <span className="text-sm text-gray-900 font-semibold">${instruction.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Passariello Fries only */}
          {product.id === 'app11' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {passarielloFriesInstructionsOptions.map((instruction) => (
                      <div
                        key={instruction.id}
                        onClick={() => {
                          if (selectedPassarielloFriesInstructions.includes(instruction.id)) {
                            setSelectedPassarielloFriesInstructions(selectedPassarielloFriesInstructions.filter(id => id !== instruction.id));
                          } else {
                            setSelectedPassarielloFriesInstructions([...selectedPassarielloFriesInstructions, instruction.id]);
                          }
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedPassarielloFriesInstructions.includes(instruction.id) ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedPassarielloFriesInstructions.includes(instruction.id) ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedPassarielloFriesInstructions.includes(instruction.id) && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{instruction.name}</span>
                        <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Cheddar Steak Fries only */}
          {product.id === 'app12' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {cheddarSteakFriesInstructionsOptions.map((instruction) => (
                      <div
                        key={instruction.id}
                        onClick={() => {
                          if (selectedCheddarSteakFriesInstructions.includes(instruction.id)) {
                            setSelectedCheddarSteakFriesInstructions(selectedCheddarSteakFriesInstructions.filter(id => id !== instruction.id));
                          } else {
                            setSelectedCheddarSteakFriesInstructions([...selectedCheddarSteakFriesInstructions, instruction.id]);
                          }
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedCheddarSteakFriesInstructions.includes(instruction.id) ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedCheddarSteakFriesInstructions.includes(instruction.id) ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedCheddarSteakFriesInstructions.includes(instruction.id) && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{instruction.name}</span>
                        <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Calamari only */}
          {product.id === 'app14' && (
            <div ref={calamariAppetizerSauceRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {calamariSubSauceOptions.map((sauce) => {
                      const isSelected = selectedCalamariSubSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedCalamariSubSauce(sauce.id);
                            setCalamariAppetizerSauceError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {calamariAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Mussels Appetizer (app15) */}
          {product.id === 'app15' && (
            <div ref={musselsAppetizerSauceRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {musselsSauceOptions.map((sauce) => {
                      const isSelected = selectedMusselsSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedMusselsSauce(sauce.id);
                            setMusselsAppetizerSauceError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {musselsAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Seafood Combo Appetizer (app16) */}
          {product.id === 'app16' && (
            <div ref={seafoodComboAppetizerSauceRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {seafoodComboSauceOptions.map((sauce) => {
                      const isSelected = selectedSeafoodComboSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedSeafoodComboSauce(sauce.id);
                            setSeafoodComboAppetizerSauceError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodComboAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Mussels only */}
          {product.id === 'sf-3' && (
            <div ref={musselsSauceAppetizerRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {musselsSauceOptions.map((sauce) => {
                      const isSelected = selectedMusselsSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedMusselsSauce(sauce.id);
                            setSelectedSeafoodSauceId(sauce.id);
                            setMusselsSauceAppetizerError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {musselsSauceAppetizerError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Seafood Combo only */}
          {product.id === 'sf-4' && (
            <div ref={seafoodComboSauceAppetizerRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {seafoodComboSauceOptions.map((sauce) => {
                      const isSelected = selectedSeafoodComboSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedSeafoodComboSauce(sauce.id);
                            setSelectedSeafoodSauceId(sauce.id);
                            setSeafoodComboSauceAppetizerError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodComboSauceAppetizerError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Calamari Marinara Appetizer (sf-2) */}
          {product.id === 'sf-2' && (
            <div ref={calamariSauceRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {seafoodSauceOptions.map((sauce) => (
                      <div
                        key={sauce.id}
                        onClick={() => {
                          if (debugCartEnabled) {
                            console.log(`[SEAFOOD] sauce click -> ${sauce.id} ${sauce.label}`);
                          }
                          setSelectedSeafoodSauceId(sauce.id);
                          setCalamariSauceError(false);
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedSeafoodSauceId === sauce.id ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedSeafoodSauceId === sauce.id ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedSeafoodSauceId === sauce.id && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{sauce.label}</span>
                      </div>
                    ))}
                  </div>
                  {calamariSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Shrimp Marinara Appetizer (sf-5) */}
          {product.id === 'sf-5' && (
            <div ref={shrimpSauceRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Your Sauce (Required)</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {seafoodSauceOptions.map((sauce) => (
                      <div
                        key={sauce.id}
                        onClick={() => {
                          if (debugCartEnabled) {
                            console.log(`[SEAFOOD] sauce click -> ${sauce.id} ${sauce.label}`);
                          }
                          setSelectedSeafoodSauceId(sauce.id);
                          setShrimpSauceError(false);
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedSeafoodSauceId === sauce.id ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedSeafoodSauceId === sauce.id ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedSeafoodSauceId === sauce.id && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{sauce.label}</span>
                      </div>
                    ))}
                  </div>
                  {shrimpSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Shrimp Marinara Appetizer (app17) */}
          {product.id === 'app17' && (
            <div ref={shrimpAppetizerSauceRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sauce Choice Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {marinaraAppetizerSauceOptions.map((sauce) => (
                      <div
                        key={sauce.id}
                        onClick={() => {
                          setSelectedShrimpMarinaraSubSauce(selectedShrimpMarinaraSubSauce === sauce.id ? '' : sauce.id);
                          setShrimpAppetizerSauceError(false);
                        }}
                        className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedShrimpMarinaraSubSauce === sauce.id ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                          selectedShrimpMarinaraSubSauce === sauce.id ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                        }`}>
                          {selectedShrimpMarinaraSubSauce === sauce.id && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                        </div>
                        <span className="text-gray-900 flex-1">{sauce.name}</span>
                        <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                  {shrimpAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Add Toppings for Calamari Marinara (sf-6) */}
          {product.id === 'sf-6' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Your Choice of Pasta */}
                  <div ref={seafoodPastaTypeRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Your Choice of Pasta (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {seafoodPastaTypes.map((pastaType) => {
                      const isSelected = selectedSeafoodPastaType === pastaType.id;
                      return (
                        <div
                          key={pastaType.id}
                          onClick={() => {
                            setSelectedSeafoodPastaType(pastaType.id);
                            setSeafoodPastaTypeError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SEAFOOD_PASTA_TYPE_IMAGES[pastaType.id]}
                              alt={pastaType.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 px-4 py-3 flex items-center justify-between">
                            <span className="text-gray-900">{pastaType.name}</span>
                            {pastaType.price > 0 && (
                              <span className="text-sm text-gray-900">${pastaType.price.toFixed(2)}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodPastaTypeError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a pasta type before adding to cart</span>
                    </div>
                  )}

                  {/* Substitute Sauce Section */}
                  <div ref={calamariAppetizerSauceRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {calamariSubSauceOptions.map((sauce) => {
                      const isSelected = selectedCalamariSubSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedCalamariSubSauce(selectedCalamariSubSauce === sauce.id ? '' : sauce.id);
                            setSelectedSeafoodSauceId(selectedCalamariSubSauce === sauce.id ? '' : sauce.id);
                            setCalamariAppetizerSauceError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {calamariAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Clam Sauce (sf-7) */}
          {product.id === 'sf-7' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Your Choice of Pasta */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Your Choice of Pasta (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {seafoodPastaTypes.map((pastaType) => {
                      const isSelected = selectedSeafoodPastaType === pastaType.id;
                      return (
                        <div
                          key={pastaType.id}
                          onClick={() => {
                            setSelectedSeafoodPastaType(pastaType.id);
                            setSeafoodPastaTypeError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SEAFOOD_PASTA_TYPE_IMAGES[pastaType.id]}
                              alt={pastaType.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 px-4 py-3 flex items-center justify-between">
                            <span className="text-gray-900">{pastaType.name}</span>
                            {pastaType.price > 0 && (
                              <span className="text-sm text-gray-900">${pastaType.price.toFixed(2)}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodPastaTypeError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a pasta type before adding to cart</span>
                    </div>
                  )}

                  {/* Sauce Choice Section */}
                  <div ref={babyClamSauceRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex flex-col gap-3">
                    <div className="flex items-start gap-2">
                      <span className="font-semibold">Choose Your Sauce (Required)</span>
                    </div>
                    {babyClamSauceError && (
                      <div className="bg-red-50 border border-red-200 text-[#8B0000] px-3 py-2 rounded-md flex items-center gap-2 text-sm">
                        <AlertCircle className="w-4 h-4 flex-shrink-0" />
                        <span className="font-semibold">Please select a sauce option before adding to cart</span>
                      </div>
                    )}
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {babyClamSauceChoices.map((sauce) => (
                      <div
                        key={sauce.id}
                        onClick={() => {
                          setSelectedBabyClamSauceChoice(sauce.id);
                          setSelectedSeafoodSauceId(sauce.id);
                          setBabyClamSauceError(false);
                        }}
                        className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedBabyClamSauceChoice === sauce.id ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="flex items-center gap-3">
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            selectedBabyClamSauceChoice === sauce.id ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {selectedBabyClamSauceChoice === sauce.id && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-700">{sauce.name}</span>
                        </div>
                        <span className="text-gray-600">${sauce.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                  {babyClamSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Mussels (sf-8) */}
          {product.id === 'sf-8' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Your Choice of Pasta */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Your Choice of Pasta (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {seafoodPastaTypes.map((pastaType) => {
                      const isSelected = selectedSeafoodPastaType === pastaType.id;
                      return (
                        <div
                          key={pastaType.id}
                          onClick={() => {
                            setSelectedSeafoodPastaType(pastaType.id);
                            setSeafoodPastaTypeError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SEAFOOD_PASTA_TYPE_IMAGES[pastaType.id]}
                              alt={pastaType.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 px-4 py-3 flex items-center justify-between">
                            <span className="text-gray-900">{pastaType.name}</span>
                            {pastaType.price > 0 && (
                              <span className="text-sm text-gray-900">+${pastaType.price.toFixed(2)}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodPastaTypeError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a pasta type before adding to cart</span>
                    </div>
                  )}

                  {/* Sauce Choice Section */}
                  <div ref={musselsAppetizerSauceRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {musselsSauceOptions.map((sauce) => {
                      const isSelected = selectedMusselsSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedMusselsSauce(sauce.id);
                            setSelectedSeafoodSauceId(sauce.id);
                            setMusselsAppetizerSauceError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {musselsAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Seafood Combo (sf-9) */}
          {product.id === 'sf-9' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Sauce Choice:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Your Choice of Pasta */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Your Choice of Pasta (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {seafoodPastaTypes.map((pastaType) => {
                      const isSelected = selectedSeafoodPastaType === pastaType.id;
                      return (
                        <div
                          key={pastaType.id}
                          onClick={() => {
                            setSelectedSeafoodPastaType(pastaType.id);
                            setSeafoodPastaTypeError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SEAFOOD_PASTA_TYPE_IMAGES[pastaType.id]}
                              alt={pastaType.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 px-4 py-3 flex items-center justify-between">
                            <span className="text-gray-900">{pastaType.name}</span>
                            {pastaType.price > 0 && (
                              <span className="text-sm text-gray-900">+${pastaType.price.toFixed(2)}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodPastaTypeError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a pasta type before adding to cart</span>
                    </div>
                  )}

                  {/* Sauce Choice Section */}
                  <div ref={seafoodComboAppetizerSauceRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {seafoodComboSauceOptions.map((sauce) => {
                      const isSelected = selectedSeafoodComboSauce === sauce.id;

                      return (
                        <div
                          key={sauce.id}
                          onClick={() => {
                            setSelectedSeafoodComboSauce(sauce.id);
                            setSelectedSeafoodSauceId(sauce.id);
                            setSeafoodComboAppetizerSauceError(false);
                          }}
                          className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                            isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-900 flex-1">{sauce.name}</span>
                          <span className="text-sm text-gray-900">${sauce.price.toFixed(2)}</span>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodComboAppetizerSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Shrimp Marinara (sf-10) */}
          {product.id === 'sf-10' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings:</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Your Choice of Pasta */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Your Choice of Pasta (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {seafoodPastaTypes.map((pastaType) => {
                      const isSelected = selectedSeafoodPastaType === pastaType.id;
                      return (
                        <div
                          key={pastaType.id}
                          onClick={() => {
                            setSelectedSeafoodPastaType(pastaType.id);
                            setSeafoodPastaTypeError(false);
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback
                              src={SEAFOOD_PASTA_TYPE_IMAGES[pastaType.id]}
                              alt={pastaType.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 px-4 py-3 flex items-center justify-between">
                            <span className="text-gray-900">{pastaType.name}</span>
                            {pastaType.price > 0 && (
                              <span className="text-sm text-gray-900">+${pastaType.price.toFixed(2)}</span>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {seafoodPastaTypeError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a pasta type before adding to cart</span>
                    </div>
                  )}

                  {/* Substitute Sauce Section */}
                  <div ref={shrimpMarinaraSubSauceRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Your Sauce (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {[
                      { id: 'marinara', name: 'Marinara Sauce', price: 0.00 },
                      { id: 'white', name: 'White wine garlic sauce', price: 0.00 }
                    ].map((sauce) => (
                      <div
                        key={sauce.id}
                        onClick={() => {
                          setSelectedShrimpMarinaraSubSauce(selectedShrimpMarinaraSubSauce === sauce.id ? '' : sauce.id);
                          setSelectedSeafoodSauceId(selectedShrimpMarinaraSubSauce === sauce.id ? '' : sauce.id);
                          setShrimpMarinaraSubSauceError(false);
                        }}
                        className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                          selectedShrimpMarinaraSubSauce === sauce.id ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="flex items-center gap-3">
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                            selectedShrimpMarinaraSubSauce === sauce.id ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                          }`}>
                            {selectedShrimpMarinaraSubSauce === sauce.id && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                          </div>
                          <span className="text-gray-700">{sauce.name}</span>
                        </div>
                        <span className="text-gray-600">${sauce.price.toFixed(2)}</span>
                      </div>
                    ))}
                  </div>
                  {shrimpMarinaraSubSauceError && (
                    <div className="bg-red-50 border border-red-200 text-[#8B0000] px-4 py-3 rounded-lg flex items-center gap-3">
                      <AlertCircle className="w-5 h-5 flex-shrink-0" />
                      <span className="font-semibold">Please select a sauce option before adding to cart</span>
                    </div>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Add Toppings for Wings (both app18 and category wings, excluding Chicken Tenders and Mozzarella Sticks) */}
          {(product.id === 'app18' || ((product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) && (
            <>
              <Collapsible open={isIncludedOpen} onOpenChange={setIsIncludedOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        {product.id === 'wing3' ? (
                          <>
                            <span className="font-bold" style={{ fontSize: 'calc(1em + 3px)' }}>1. Substitute Your Sauce</span>
                            <span className="font-bold opacity-90" style={{fontSize: 'calc(1em + 3px)'}}>(Optional)</span>
                          </>
                        ) : (
                          <>
                            <span className="font-bold" style={{ fontSize: 'calc(1em + 3px)' }}>1. Choose Your Sauce</span>
                            <span className="font-bold opacity-90" style={{fontSize: 'calc(1em + 3px)'}}>(Required)</span>
                          </>
                        )}
                      </div>
                    </div>
                    {isIncludedOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {[...wingsSauceOptions].sort((a, b) => {
                        const order = [
                          'mild sauce', 
                          'hot sauce', 
                          'crazy hot sauce', 
                          'sting honey sauce', 
                          'garlic parmesan sauce', 
                          'bbq sauce', 
                          'mild honey sauce', 
                          'buffalo sauce', 
                          'no sauce'
                        ];
                        const ia = order.indexOf(a.name.toLowerCase());
                        const ib = order.indexOf(b.name.toLowerCase());
                        return (ia === -1 ? 999 : ia) - (ib === -1 ? 999 : ib);
                      }).map((sauce) => {
                        const isSelected = selectedWingsSauce === sauce.id;
                        const isNoSauce = sauce.name.toLowerCase().includes('no sauce');
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              if (debugCartEnabled) {
                                console.log('[DEBUG] Selected Wings Sauce:', {
                                    id: sauce.id,
                                    label: sauce.name
                                });
                              }
                              if (product.id === 'wing3') {
                                setSelectedWingsSauce(selectedWingsSauce === sauce.id ? '' : sauce.id);
                              } else {
                                setSelectedWingsSauce(sauce.id);
                              }
                              setWingsSauceError(false);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            {!isNoSauce && (
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(sauce.name)} 
                                  alt={sauce.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}
                            <div className={`flex-1 flex items-center justify-between px-4 py-3 ${isNoSauce ? 'pl-4' : ''}`}>
                              <div className="flex items-center gap-3">
                                {isNoSauce && (
                                  isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-5 h-5 text-gray-300" />
                                  )
                                )}
                                <p className="text-gray-900">{sauce.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">
                                ${sauce.price.toFixed(2)}
                              </span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    
                    {/* Wings Sauce Error Message */}
                    {wingsSauceError && (
                      <div 
                        ref={wingsSauceRef}
                        className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mt-5 rounded-r-lg flex items-center gap-3"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <span className="font-semibold">Please select a sauce choice to continue.</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button ref={wingsSpecialInstructionsRef} className={`w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between ${product.id === 'wing3' ? '' : (wingsSpecialInstructionsError ? 'ring-4 ring-red-500' : '')}`}>
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        {product.id === 'wing3' ? (
                          <>
                            <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Special Instructions</span>
                            <span className="font-bold opacity-90" style={{fontSize: 'calc(1em + 3px)'}}>(Optional)</span>
                          </>
                        ) : (
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Special Instructions (Required)</span>
                        )}
                      </div>
                      {wingsSpecialInstructionsError && product.id !== 'wing3' && (
                        <span className="text-sm text-red-200">Please select at least one option</span>
                      )}
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    {/* Chicken Tenders (wing3) usa opciones diferentes */}
                    {product.id === 'wing3' ? (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {chickenTendersSpecialInstructionsOptions.map((instruction) => {
                          const isSelected = selectedWingsSpecialInstructions.includes(instruction.id);
                          return (
                            <div
                              key={instruction.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedWingsSpecialInstructions(selectedWingsSpecialInstructions.filter(id => id !== instruction.id));
                                } else {
                                  setSelectedWingsSpecialInstructions([...selectedWingsSpecialInstructions, instruction.id]);
                                }
                              }}
                              className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                                isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                              }`}
                            >
                              <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                              }`}>
                                {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                              </div>
                              <span className="text-gray-900 flex-1">{instruction.name}</span>
                              <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                            </div>
                          );
                        })}
                      </div>
                    ) : (
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {wingsSpecialInstructionsOptions.map((instruction) => {
                          const isSelected = selectedWingsSpecialInstructions.includes(instruction.id);
                          return (
                            <div
                              key={instruction.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedWingsSpecialInstructions(selectedWingsSpecialInstructions.filter(id => id !== instruction.id));
                                } else {
                                  // Sauce Mixed In y Sauce On The Side son mutuamente excluyentes
                                  let newSelections = [...selectedWingsSpecialInstructions, instruction.id];
                                  if (instruction.id === 'wsi2') {
                                    // Si selecciona Sauce Mixed In, quitar Sauce On The Side
                                    newSelections = newSelections.filter(id => id !== 'wsi3');
                                  } else if (instruction.id === 'wsi3') {
                                    // Si selecciona Sauce On The Side, quitar Sauce Mixed In
                                    newSelections = newSelections.filter(id => id !== 'wsi2');
                                  }
                                  setSelectedWingsSpecialInstructions(newSelections);
                                  setWingsSpecialInstructionsError(false);
                                }
                              }}
                              className={`flex items-center gap-3 p-4 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                                isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                              }`}
                            >
                              <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                              }`}>
                                {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                              </div>
                              <span className="text-gray-900 flex-1">{instruction.name}</span>
                              <span className="text-sm text-gray-900">${instruction.price.toFixed(2)}</span>
                            </div>
                          );
                        })}
                      </div>
                    )}
                    {wingsSpecialInstructionsError && product.id !== 'wing3' && (
                      <div 
                        className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mt-5 rounded-r-lg flex items-center gap-3"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <span className="font-semibold">Please select at least one option to continue.</span>
                      </div>
                    )}
                  </div>
                </CollapsibleContent>
              </Collapsible>

              <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        {product.id === 'wing3' ? (
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Extra Tenders Sauce (Optional)</span>
                        ) : (
                          <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Extra Sauce (Optional)</span>
                        )}
                      </div>
                    </div>
                    {isSideToppingsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {(product.id === 'wing3' ? chickenTendersExtraSauceOptions : wingsExtraSauceOptions).flatMap((sauce) => 
                        [
                          { size: '4oz', price: 2.49 },
                          { size: '8oz', price: 4.99 },
                          { size: '16oz', price: 8.99 }
                        ].map((option) => {
                          const itemId = `${sauce.id}-${option.size}`;
                          const isSelected = selectedWingsExtraSauce[sauce.id] === option.size;
                          return (
                            <div
                              key={itemId}
                              onClick={() => {
                                if (debugCartEnabled) {
                                  console.log('[DEBUG] Selected Wings Extra Sauce:', {
                                    id: sauce.id,
                                    label: sauce.name,
                                    size: option.size
                                  });
                                }
                                setSelectedWingsExtraSauce(prev => ({
                                  ...prev,
                                  [sauce.id]: isSelected ? '' : option.size
                                }));
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(sauce.name)} 
                                  alt={sauce.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{sauce.name} {option.size}</p>
                                <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>

              <Collapsible open={isSpecialInstructionsOpen} onOpenChange={setIsSpecialInstructionsOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>4. Dippings (Optional)</span>
                      </div>
                    </div>
                    {isSpecialInstructionsOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  <div className="relative z-10">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {wingsExtraCheeseRanchOptions.flatMap((option) => 
                        [
                          { size: '4oz', price: 2.49 },
                          { size: '8oz', price: 4.99 },
                          { size: '16oz', price: 8.99 }
                        ].map((sizeOption) => {
                          const itemId = `${option.id}-${sizeOption.size}`;
                          const isSelected = selectedWingsExtraCheeseRanch[option.id] === sizeOption.size;
                          const displayName = option.name.startsWith('Extra') ? option.name : `Extra ${option.name}`;

                          return (
                            <div
                              key={itemId}
                              onClick={() => {
                                setSelectedWingsExtraCheeseRanch(prev => ({
                                  ...prev,
                                  [option.id]: isSelected ? '' : sizeOption.size
                                }));
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={getSauceImage(option.name)} 
                                  alt={displayName}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{displayName} {sizeOption.size}</p>
                                <span className="text-sm text-gray-900">${sizeOption.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}


          
          {/* Special Instructions only for Minucci Pizzas */}
          {product.category === 'minucci-pizzas' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <div className="flex items-center gap-2">
                      <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Special Instructions (Optional):</span>
                    </div>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Special Instructions Section */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {specialInstructionsOptions.map((item) => {
                      const isSelected = selectedSpecialInstructions.includes(item.id);
                      return (
                        <div
                          key={item.id}
                          onClick={() => handleSpecialInstructionToggle(item.id)}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <div className="flex items-center gap-3">
                              <div className="w-5 h-5 flex-shrink-0">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                              <p className="text-gray-900">{item.name}</p>
                            </div>
                            <span className="text-sm text-gray-900">{item.price}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}



          {/* Choose Toppings for Cheesesteaks */}
          {product.category === 'cheesesteaks' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                {/* Background texture with opacity */}
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Toast Option Section - Only for "Create Your Own Cheesesteak" - NOW FIRST */}
                  {product.category === 'cheesesteaks' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">Toast Option (Required)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        <div
                          onClick={() => handleToastRollToggle('toast')}
                          className={`flex items-center gap-3 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] px-5 py-5 ${
                            toastRoll === 'toast' ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${toastRoll === 'toast' ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                            {toastRoll === 'toast' && (
                              <Check className="w-3 h-3 text-white" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{(product.category === 'burgers' || product.category === 'brioche') ? 'Toast Bun' : 'Toast Roll'}</p>
                            <p className="text-gray-900">$0.00</p>
                          </div>
                        </div>
                        <div
                          onClick={() => handleToastRollToggle('no-toast')}
                          className={`flex items-center gap-3 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] px-5 py-5 ${
                            toastRoll === 'no-toast' ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${toastRoll === 'no-toast' ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                            {toastRoll === 'no-toast' && (
                              <Check className="w-3 h-3 text-white" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{(product.category === 'burgers' || product.category === 'brioche') ? "Don't Toast Bun" : "Don't Toast Roll"}</p>
                            <p className="text-gray-900">$0.00</p>
                          </div>
                        </div>
                      </div>
                      
                      {/* Toast Option Error Message */}
                      {toastOptionError && (
                        <div 
                          ref={toastOptionRef}
                          className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mb-5 rounded-r-lg flex items-center gap-3"
                          role="alert"
                        >
                          <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                          </svg>
                          <p className="font-semibold">Please select a toast option before adding to cart</p>
                        </div>
                      )}
                    </>
                  )}

                  {/* Cheese Section - For all cheesesteaks */}
                  {product.category === 'cheesesteaks' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                        <span className="font-semibold">{product.name === 'Pizza Steak' ? 'Substitute Cheese (Optional)' : product.name === 'Cooper Passiesteak' || product.name === 'Chicken Cheesesteak Hoagie' || product.name === 'Cheesesteak Hoagie' || product.name === 'Buffalo Chicken Cheesesteak' || product.name === "Passariello's Cheesesteak" ? 'Cheese (Optional)' : 'Cheese (Required)'}</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {cheeseOptions
                          .filter(cheese => {
                            // Hide Cheddar Cheese Sauce only for Pizza Steak
                            if (product.name === 'Pizza Steak' && cheese.name === 'Cheddar Cheese Sauce') {
                              return false;
                            }
                            return true;
                          })
                          .map((cheese) => {
                          const isSelected = selectedCheese === cheese.id;
                          // Disable No Cheese (cheese5) when Extra Cheese (ext1) or Lite Cheese (lite2) is selected
                          const isDisabled = cheese.id === 'cheese5' && (selectedToppings.includes('ext1') || selectedToppings.includes('lite2'));
                          return (
                            <div
                              key={cheese.id}
                              onClick={() => {
                                if (!isDisabled) {
                                  setSelectedCheese(cheese.id);
                                  setCheeseOptionError(false); // Clear error when cheese is selected
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] ${
                                isDisabled 
                                  ? 'opacity-40 cursor-not-allowed border border-gray-200' 
                                  : isSelected 
                                    ? 'border-2 border-[#A72020] cursor-pointer' 
                                    : 'border border-gray-200 cursor-pointer'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                {cheese.name === 'No Cheese' ? (
                                  <div className="w-full h-full flex items-center justify-center bg-[#F6F6F6]">
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  </div>
                                ) : (
                                  <ImageWithFallback                                     src={cheese.image || 'https://via.placeholder.com/56'} 
                                    alt={cheese.name}
                                    className="w-full h-full object-cover"
                                  />
                                )}
                                {isSelected && !isDisabled && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <div className="w-3 h-3 bg-[#A72020] rounded-full"></div>
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{cheese.name}</p>
                                <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                                  +${(product.name === 'Chicken Cheesesteak Hoagie' || product.name === 'Cheesesteak Hoagie' || product.name === 'Cooper Passiesteak' || product.name === 'Buffalo Chicken Cheesesteak' || product.name === "Passariello's Cheesesteak" || product.name === 'Pizza Steak') ? '0.00' : cheese.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                      
                      {/* Cheese Option Error Message for Create Your Own */}
                      {cheeseOptionError && (
                        <div 
                          ref={cheeseOptionRef}
                          className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mt-5 rounded-r-lg flex items-center gap-3"
                          role="alert"
                        >
                          <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                          </svg>
                          <p className="font-semibold">Please select a cheese option before adding to cart</p>
                        </div>
                      )}
                    </>
                  )}

                  {/* Side Toppings (Required) Section - Only for Chicken Cheesesteak Hoagie and Cheesesteak Hoagie */}
                  {(product.name === 'Chicken Cheesesteak Hoagie' || product.name === 'Cheesesteak Hoagie') && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                        <span className="font-semibold">On The Side Toppings (Optional)</span>
                      </div>
                      <div ref={cheesesteakSideToppingsRequiredRef}>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          {cheesesteakSideToppingsRequired.map((topping) => {
                            const isSelected = selectedCheesesteakSideToppingsRequired.includes(topping.id);
                            return (
                              <div
                                key={topping.id}
                                onClick={() => {
                                  if (isSelected) {
                                    // Deselect this option
                                    setSelectedCheesesteakSideToppingsRequired(prev => prev.filter(id => id !== topping.id));
                                  } else {
                                    // Select this option
                                    setSelectedCheesesteakSideToppingsRequired(prev => [...prev, topping.id]);
                                  }
                                }}
                                className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                  isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                                }`}
                              >
                                {topping.showCircle ? (
                                  <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                                    {isSelected ? (
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                    )}
                                  </div>
                                ) : topping.image ? (
                                  <div className="w-14 h-14 flex-shrink-0 relative">
                                    <ImageWithFallback src={topping.image} alt={topping.name} className="w-full h-full object-cover" />
                                    {isSelected && (
                                      <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                        <div className="bg-white rounded-full p-0.5">
                                          <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                        </div>
                                      </div>
                                    )}
                                  </div>
                                ) : (
                                  <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-[#F6F6F6]">
                                    {isSelected && (
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    )}
                                  </div>
                                )}
                                <div className="flex-1 flex items-center justify-between px-4 py-3">
                                  <p className="text-gray-900">{topping.name}</p>
                                  <span className="text-sm text-gray-900">${topping.price?.toFixed(2) || '0.00'}</span>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    </>
                  )}

                  {/* Toppings Section - Only for Cheesesteaks */}
                  {product.category === 'cheesesteaks' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center">
                        <span className="font-semibold">Toppings (Optional)</span>
                      </div>
                      <div className={`grid grid-cols-1 md:grid-cols-3 gap-4 ${(product.name === 'Pizza Steak' || product.name === 'Chicken Cheesesteak Hoagie' || product.name === 'Cheesesteak Hoagie' || product.name === "Passariello's Cheesesteak") ? '' : 'md:grid-flow-col md:grid-rows-5'}`}>
                        {createYourOwnCheesesteakToppings
                          .filter((topping) => {
                            // Hide Mayo, Ketchup, Shredded Lettuce, Tomatoes, Pickles, Raw Onions for Pizza Steak only
                            if (product.name === 'Pizza Steak') {
                              const hiddenIds = ['cs7', 'cs6', 'cs13', 'cs14', 'cs10', 'cs11'];
                              return !hiddenIds.includes(topping.id);
                            }
                            // Hide Shredded Lettuce, Tomatoes, Raw Onions for Chicken Cheesesteak Hoagie and Cheesesteak Hoagie
                            if (product.name === 'Chicken Cheesesteak Hoagie' || product.name === 'Cheesesteak Hoagie') {
                              const hiddenIds = ['cs13', 'cs14', 'cs11'];
                              return !hiddenIds.includes(topping.id);
                            }
                            // Hide Grilled Onions, Grilled Mix Sweet Peppers, Grilled Mushrooms for Passariello's Cheesesteak
                            if (product.name === "Passariello's Cheesesteak") {
                              const hiddenIds = ['cs4', 'cs8', 'cs3'];
                              return !hiddenIds.includes(topping.id);
                            }
                            return true;
                          })
                          .map((topping) => {
                          const isSelected = selectedToppings.includes(topping.id);
                          return (
                            <div
                          key={topping.id}
                          onClick={() => handleToppingToggle(topping.id)}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={topping.image || 'https://via.placeholder.com/56'} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                      </div>
                    </>
                  )}

                  {/* Extra Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {extraToppings
                      .filter((topping) => {
                        // Hide Extra Mayo and Extra Ketchup for Pizza Steak only
                        if (product.name === 'Pizza Steak') {
                          const hiddenIds = ['ext3', 'ext2'];
                          return !hiddenIds.includes(topping.id);
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedToppings.includes(topping.id);
                      
                      // Check for conflicting Lite options
                      const hasLiteCheese = selectedToppings.includes('lite2');
                      const hasLiteKetchup = selectedToppings.includes('lite3');
                      const hasLiteMayo = selectedToppings.includes('lite4');
                      const isNoCheese = selectedCheese === 'cheese5';
                      
                      let isDisabled = false;
                      if (topping.id === 'ext1') isDisabled = isNoCheese || hasLiteCheese; // Extra Cheese
                      if (topping.id === 'ext2') isDisabled = hasLiteKetchup; // Extra Ketchup
                      if (topping.id === 'ext3') isDisabled = hasLiteMayo; // Extra Mayo
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => !isDisabled && handleToppingToggle(topping.id)}
                          className={`flex items-center gap-3 rounded-lg px-4 py-3 transition-colors bg-[#F6F6F6] ${
                            isDisabled 
                              ? 'opacity-50 cursor-not-allowed border border-gray-200' 
                              : isSelected 
                                ? 'border-2 border-[#A72020] cursor-pointer' 
                                : 'border border-gray-200 cursor-pointer'
                          }`}
                        >
                          <div className="w-5 h-5 flex-shrink-0 flex items-center justify-center">
                            {isSelected && !isDisabled ? (
                              <Check className="w-5 h-5 text-[#A72020]" strokeWidth={3} />
                            ) : (
                              <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Lite Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Lite Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {liteToppings
                      .filter((topping) => {
                        // Hide Lite Mayo and Lite Ketchup for Pizza Steak only
                        if (product.name === 'Pizza Steak') {
                          const hiddenIds = ['lite4', 'lite3'];
                          return !hiddenIds.includes(topping.id);
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedToppings.includes(topping.id);
                      
                      // Check for conflicting Extra and No options
                      const hasExtraCheese = selectedToppings.includes('ext1');
                      const hasExtraKetchup = selectedToppings.includes('ext2');
                      const hasExtraMayo = selectedToppings.includes('ext3');
                      const isNoCheese = selectedCheese === 'cheese5';
                      const hasNoBlackPepper = selectedToppings.includes('csno1');
                      const hasNoSalt = selectedToppings.includes('csno2');
                      
                      let isDisabled = false;
                      if (topping.id === 'lite1') isDisabled = hasNoBlackPepper; // Lite Black Pepper
                      if (topping.id === 'lite2') isDisabled = isNoCheese || hasExtraCheese; // Lite Cheese
                      if (topping.id === 'lite3') isDisabled = hasExtraKetchup; // Lite Ketchup
                      if (topping.id === 'lite4') isDisabled = hasExtraMayo; // Lite Mayo
                      if (topping.id === 'lite5') isDisabled = hasNoSalt; // Lite Salt
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => !isDisabled && handleToppingToggle(topping.id)}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] ${
                            isDisabled 
                              ? 'opacity-50 cursor-not-allowed border border-gray-200' 
                              : isSelected 
                                ? 'border-2 border-[#A72020] cursor-pointer' 
                                : 'border border-gray-200 cursor-pointer'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <div className="flex items-center gap-3">
                              <div className="w-5 h-5 flex-shrink-0">
                                {isSelected && !isDisabled ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                              <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            </div>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">No Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {cheesesteakNoToppings
                      .filter((topping) => {
                        // Hide specific "No" options for Pizza Steak
                        if (product.name === 'Pizza Steak') {
                          const hiddenOptions = ['No Lettuce', 'No Tomatoes', 'No Raw Onions', 'No Mushrooms', 'No Mix Sweet Peppers', 'No Grilled Onions', 'No Oregano', 'No Olive Oil'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide specific "No" options for Create Your Own Cheesesteak variations
                        if (product.name === 'Create Your Own Cheesesteak' || product.name === 'Create Your Own Chicken Cheesesteak') {
                          const hiddenOptions = ['No Lettuce', 'No Mushrooms', 'No Tomatoes', 'No Raw Onions', 'No Mix Sweet Peppers', 'No Grilled Onions', 'No Oregano', 'No Olive Oil'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide No Mushrooms, No Mix Sweet Peppers, and No Grilled Onions for Grilled Cheesesteak Hoagie
                        if (product.name === 'Grilled Cheesesteak Hoagie') {
                          const hiddenOptions = ['No Mushrooms', 'No Mix Sweet Peppers', 'No Grilled Onions'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide specific "No" options for Cooper Passiesteak
                        if (product.name === 'Cooper Passiesteak') {
                          const hiddenOptions = ['No Lettuce', 'No Tomatoes', 'No Raw Onions', 'No Mushrooms', 'No Mix Sweet Peppers', 'No Grilled Onions', 'No Oregano', 'No Olive Oil'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide No Mushrooms, No Mix Sweet Peppers, and No Grilled Onions for Chicken Cheesesteak Hoagie
                        if (product.name === 'Chicken Cheesesteak Hoagie') {
                          const hiddenOptions = ['No Mushrooms', 'No Mix Sweet Peppers', 'No Grilled Onions'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide specific "No" options for Buffalo Chicken Cheesesteak
                        if (product.name === 'Buffalo Chicken Cheesesteak') {
                          const hiddenOptions = ['No Lettuce', 'No Tomatoes', 'No Raw Onions', 'No Mushrooms', 'No Mix Sweet Peppers', 'No Grilled Onions', 'No Oregano', 'No Olive Oil'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide No Mushrooms, No Mix Sweet Peppers, and No Grilled Onions for Cheesesteak Hoagie
                        if (product.name === 'Cheesesteak Hoagie') {
                          const hiddenOptions = ['No Mushrooms', 'No Mix Sweet Peppers', 'No Grilled Onions'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        // Hide No Lettuce, No Tomatoes, and No Raw Onions for Passariello's Cheesesteak
                        if (product.name === "Passariello's Cheesesteak") {
                          const hiddenOptions = ['No Lettuce', 'No Tomatoes', 'No Raw Onions', 'No Oregano', 'No Olive Oil'];
                          return !hiddenOptions.includes(topping.name);
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedToppings.includes(topping.id);
                      
                      // Check if conflicting Lite options are selected
                      const hasLiteBlackPepper = selectedToppings.includes('lite1');
                      const hasLiteSalt = selectedToppings.includes('lite5');
                      
                      let isDisabled = false;
                      if (topping.id === 'csno1') isDisabled = hasLiteBlackPepper; // No Black Pepper
                      if (topping.id === 'csno2') isDisabled = hasLiteSalt; // No Salt
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => !isDisabled && handleToppingToggle(topping.id)}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] ${
                            isDisabled 
                              ? 'opacity-50 cursor-not-allowed border border-gray-200' 
                              : isSelected 
                                ? 'border-2 border-[#A72020] cursor-pointer' 
                                : 'border border-gray-200 cursor-pointer'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <div className="flex items-center gap-3">
                              <div className="w-5 h-5 flex-shrink-0">
                                {isSelected && !isDisabled ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                              <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            </div>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Hot Hoagies, Burgers, and Brioche Customization */}
          {(product.category === 'hot-hoagies' || product.category === 'burgers' || product.category === 'brioche') && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Choose Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Toast Option Section - NOW FIRST for Hot Hoagies, Burgers, and Brioche */}
                  <div>
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                      <span className="font-semibold">Toast Option (Required)</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                      <div
                        onClick={() => handleToastRollToggle('toast')}
                        className={`flex items-center gap-3 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] px-5 py-5 ${
                          toastRoll === 'toast' ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                        }`}
                      >
                        <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${toastRoll === 'toast' ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                          {toastRoll === 'toast' && (
                            <Check className="w-3 h-3 text-white" strokeWidth={3} />
                          )}
                        </div>
                        <div className="flex-1 flex items-center justify-between">
                          <p className="text-gray-900">{(product.category === 'burgers' || product.category === 'brioche') ? 'Toast Bun' : 'Toast Roll'}</p>
                          <p className="text-gray-900">$0.00</p>
                        </div>
                      </div>
                      <div
                        onClick={() => handleToastRollToggle('no-toast')}
                        className={`flex items-center gap-3 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] px-5 py-5 ${
                          toastRoll === 'no-toast' ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                        }`}
                      >
                        <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${toastRoll === 'no-toast' ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                          {toastRoll === 'no-toast' && (
                            <Check className="w-3 h-3 text-white" strokeWidth={3} />
                          )}
                        </div>
                        <div className="flex-1 flex items-center justify-between">
                          <p className="text-gray-900">{(product.category === 'burgers' || product.category === 'brioche') ? "Don't Toast Bun" : "Don't Toast Roll"}</p>
                          <p className="text-gray-900">$0.00</p>
                        </div>
                      </div>
                    </div>
                    
                    {/* Toast Option Error Message */}
                    {toastOptionError && (
                      <div 
                        ref={toastOptionRef}
                        className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mb-5 rounded-r-lg flex items-center gap-3"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <p className="font-semibold">Please select a toast option before adding to cart</p>
                      </div>
                    )}
                  </div>
                  
                  {/* Render content specific to each category */}
                  {product.category === 'hot-hoagies' && (
                    <>
                      {/* Substitute Cheese Section for Hot Hoagies */}
                      <div ref={hotHoagieCheeseRef}>
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                      <span className="font-semibold">
                        {product.name === 'Sausage, Peppers & Onions' ? 'Add Cheese (Optional)' : 
                         product.name === 'Grilled Chicken Hoagie' ? 'Add Cheese (Optional)' :
                         product.name === 'Eggplant Parm Sandwich' ? 'Substitute Cheese (Optional)' :
                         product.name === 'Chicken Parm Sandwich' ? 'Substitute Cheese (Optional)' :
                         product.name === 'Meatball Parm Sandwich' ? 'Substitute Cheese (Optional)' :
                         product.name === 'Sausage Parm Sandwich' ? 'Substitute Cheese (Optional)' : 'Substitute Cheese'}
                      </span>
                    </div>
                    {hotHoagieCheeseError && (
                      <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-2 rounded-lg mt-2 text-sm">
                        Please select a cheese option to continue
                      </div>
                    )}
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {hotHoagieSubstituteCheese
                      .filter(cheese => {
                        // Remove Cheddar Cheese Sauce for Chicken Parm Sandwich, Eggplant Parm Sandwich, Meatball Parm Sandwich, Sausage Parm Sandwich, and Sausage, Peppers & Onions
                        if ((product.name === 'Chicken Parm Sandwich' || product.name === 'Eggplant Parm Sandwich' || product.name === 'Meatball Parm Sandwich' || product.name === 'Sausage Parm Sandwich' || product.name === 'Sausage, Peppers & Onions') && cheese.name === 'Cheddar Cheese Sauce') {
                          return false;
                        }
                        return true;
                      })
                      .sort((a, b) => {
                        // Define order: put substitute cheeses first, then No Cheese last
                        const order = ['Provolone', 'Mozzarella', 'American', 'Swiss', 'Cheddar Cheese Sauce', 'Cooper Sharp American', 'No Cheese'];
                        return order.indexOf(a.name) - order.indexOf(b.name);
                      })
                      .map((cheese) => {
                      const isSelected = selectedHotHoagieCheese === cheese.id;
                      
                      // Map cheese names to Google Drive images
                      const cheeseImages: { [key: string]: string } = {
                        'Provolone': 'https://drive.google.com/thumbnail?id=1c9V5G4-t8_2r37a6J23s7rScig5X0Z84&sz=w400',
                        'Mozzarella': 'https://drive.google.com/thumbnail?id=1hjESaf3LCvUQ4lWBOZifQrEXnKBMCRd8&sz=w400',
                        'Swiss': 'https://drive.google.com/thumbnail?id=14H49IFlGeekjAE7WQeN2BdqXnTj0ohqa&sz=w400',
                        'Cheddar Cheese Sauce': 'https://drive.google.com/thumbnail?id=1Cx_gx11RUx8j5NIv-xYhbeOEEaoUC0Pj&sz=w400',
                        'Cooper Sharp American': 'https://drive.google.com/thumbnail?id=1aaY9AUGYlPDRXX5owRcdGAoEK4nbZa2T&sz=w400'
                      };
                      const cheeseImage = cheese.image || cheeseImages[cheese.name] || 'https://via.placeholder.com/56';
                      const isNoCheese = cheese.name === 'No Cheese';
                      
                      // Calculate cheese price for Grilled Chicken Hoagie and Sausage, Peppers & Onions
                      const displayPrice = (product.name === 'Grilled Chicken Hoagie' || product.name === 'Sausage, Peppers & Onions') && !isNoCheese ? 0.99 : cheese.price;
                      
                      return (
                        <div
                          key={cheese.id}
                          onClick={() => {
                            setSelectedHotHoagieCheese(cheese.id);
                            setHotHoagieCheeseError(false);
                          }}
                          className={`flex items-center ${isNoCheese ? 'gap-3 px-4 py-3' : 'gap-0 overflow-hidden'} rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {isNoCheese ? (
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                              )}
                            </div>
                          ) : (
                            <div className={`w-14 h-14 flex-shrink-0 relative ${isSelected ? 'ring-2 ring-[#A72020] ring-inset' : ''}`}>
                              <ImageWithFallback                                 src={cheeseImage} 
                                alt={cheese.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center">
                                  <div className="w-6 h-6 rounded-full bg-[#A72020] flex items-center justify-center">
                                    <Check className="w-4 h-4 text-white" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{cheese.name}</p>
                            <span className="text-sm text-gray-900">
                              ${displayPrice?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side Toppings Required Section (Only for Grilled Chicken Hoagie) */}
                  {product.name === 'Grilled Chicken Hoagie' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                        <span className="font-semibold">On The Side Toppings (Optional)</span>
                      </div>
                      <div ref={grilledChickenSideToppingsRequiredRef}>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          {coldHoagieSideToppingsRequired.map((topping) => {
                            const isSelected = selectedGrilledChickenSideToppingsRequired.includes(topping.id);
                            return (
                              <div
                                key={topping.id}
                                onClick={() => {
                                  if (isSelected) {
                                    // Deselect this option
                                    setSelectedGrilledChickenSideToppingsRequired(prev => prev.filter(id => id !== topping.id));
                                  } else {
                                    // Select this option
                                    setSelectedGrilledChickenSideToppingsRequired(prev => [...prev, topping.id]);
                                  }
                                }}
                                className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                  isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                                }`}
                              >
                                {topping.showCircle ? (
                                  <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                                    {isSelected ? (
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                    )}
                                  </div>
                                ) : topping.image ? (
                                  <div className="w-14 h-14 flex-shrink-0 relative">
                                    <ImageWithFallback src={topping.image} alt={topping.name} className="w-full h-full object-cover" />
                                    {isSelected && (
                                      <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                        <div className="bg-white rounded-full p-0.5">
                                          <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                        </div>
                                      </div>
                                    )}
                                  </div>
                                ) : (
                                  <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                                    {isSelected && (
                                      <div className="bg-white rounded-full p-0.5">
                                        <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                      </div>
                                    )}
                                  </div>
                                )}
                                <div className="flex-1 flex items-center justify-between px-4 py-3">
                                  <p className="text-gray-900">{topping.name}</p>
                                  <span className="text-sm text-gray-900">${topping.price?.toFixed(2)}</span>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    </>
                  )}

                  {/* Extra Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {hotHoagieExtraToppings
                      .filter(topping => {
                        // Remove "Add Extra Sauce" for Grilled Chicken Hoagie and Sausage, Peppers & Onions
                        if ((product.name === 'Grilled Chicken Hoagie' || product.name === 'Sausage, Peppers & Onions') && topping.name === 'Add Extra Sauce') {
                          return false;
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedHotHoagieExtras.includes(topping.id);
                      
                      // Check if cheese is selected - apply to all hot hoagies
                      const hasCheeseSelected = selectedHotHoagieCheese && selectedHotHoagieCheese !== 'hh-cheese7'; // hh-cheese7 is "No Cheese"
                      
                      // Check for conflicting Special Instructions
                      const hasLiteCheese = selectedHotHoagieInstructions.includes('hh-si3');
                      const hasNoSauce = selectedHotHoagieInstructions.includes('hh-si1');
                      const hasLiteSauce = selectedHotHoagieInstructions.includes('hh-si2');
                      
                      let isDisabled = false;
                      // Disable Extra Cheese if no cheese selected, "No Cheese" is selected, or "Lite Cheese" is selected
                      if (topping.id === 'hh-extra2') isDisabled = !hasCheeseSelected || hasLiteCheese; // Extra Cheese
                      // Disable Extra Sauce if "No Sauce" or "Lite Sauce" is selected
                      if (topping.id === 'hh-extra1') isDisabled = hasNoSauce || hasLiteSauce; // Extra Sauce
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedHotHoagieExtras(selectedHotHoagieExtras.filter(id => id !== topping.id));
                            } else {
                              // If selecting "Add Extra Sauce", deselect "No Sauce" and "Lite Sauce"
                              if (topping.name === 'Add Extra Sauce') {
                                setSelectedHotHoagieInstructions(
                                  selectedHotHoagieInstructions.filter(id => id !== 'hh-si1' && id !== 'hh-si2')
                                );
                              }
                              // If selecting "Extra Cheese", deselect "Lite Cheese"
                              if (topping.id === 'hh-extra2') {
                                setSelectedHotHoagieInstructions(
                                  selectedHotHoagieInstructions.filter(id => id !== 'hh-si3')
                                );
                              }
                              setSelectedHotHoagieExtras([...selectedHotHoagieExtras, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected && !isDisabled ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && !isDisabled && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Toppings Section (Only for Grilled Chicken Hoagie) */}
                  {product.name === 'Grilled Chicken Hoagie' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {grilledChickenHoagieNoToppings.map((topping) => {
                          const isSelected = selectedGrilledChickenNoToppings.includes(topping.id);
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedGrilledChickenNoToppings(selectedGrilledChickenNoToppings.filter(id => id !== topping.id));
                                } else {
                                  setSelectedGrilledChickenNoToppings([...selectedGrilledChickenNoToppings, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 cursor-pointer hover:border-gray-300`}
                            >
                              <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                                isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                              }`}>
                                {isSelected && (
                                  <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">
                                  ${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}

                  {/* No Toppings Section (Only for Sausage, Peppers & Onions) */}
                  {product.name === 'Sausage, Peppers & Onions' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {sausagePeppersOnionsNoToppings.map((topping) => {
                          const isSelected = selectedSausagePeppersOnionsNoToppings.includes(topping.id);
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedSausagePeppersOnionsNoToppings(selectedSausagePeppersOnionsNoToppings.filter(id => id !== topping.id));
                                } else {
                                  setSelectedSausagePeppersOnionsNoToppings([...selectedSausagePeppersOnionsNoToppings, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 cursor-pointer hover:border-gray-300`}
                            >
                              <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                                isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                              }`}>
                                {isSelected && (
                                  <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">
                                  ${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}

                  {/* No Toppings Section (Only for Brioche Grilled Chicken) */}
                  {product.name === 'Brioche Grilled Chicken' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {briocheGrilledChickenNoToppings.map((topping) => {
                          const isSelected = selectedBriocheGrilledChickenNoToppings.includes(topping.id);
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedBriocheGrilledChickenNoToppings(selectedBriocheGrilledChickenNoToppings.filter(id => id !== topping.id));
                                } else {
                                  setSelectedBriocheGrilledChickenNoToppings([...selectedBriocheGrilledChickenNoToppings, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 cursor-pointer hover:border-gray-300`}
                            >
                              <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                                isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                              }`}>
                                {isSelected && (
                                  <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">
                                  ${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}

                  {/* Special Instructions Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Special Instructions (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {hotHoagieSpecialInstructions
                      .filter(topping => {
                        // Remove "No Sauce" and "Lite Sauce" for Grilled Chicken Hoagie and Sausage, Peppers & Onions
                        if ((product.name === 'Grilled Chicken Hoagie' || product.name === 'Sausage, Peppers & Onions') && (topping.name === 'No Sauce' || topping.name === 'Lite Sauce')) {
                          return false;
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedHotHoagieInstructions.includes(topping.id);
                      
                      // Check if cheese is selected - apply to all hot hoagies
                      const hasCheeseSelected = selectedHotHoagieCheese && selectedHotHoagieCheese !== 'hh-cheese7'; // hh-cheese7 is "No Cheese"
                      
                      // Check for conflicting Extra options
                      const hasExtraSauce = selectedHotHoagieExtras.includes('hh-extra1');
                      const hasExtraCheese = selectedHotHoagieExtras.includes('hh-extra2');
                      
                      let isDisabled = false;
                      // Disable Lite Cheese if no cheese selected, "No Cheese" is selected, or "Extra Cheese" is selected
                      if (topping.id === 'hh-si3') isDisabled = !hasCheeseSelected || hasExtraCheese; // Lite Cheese
                      // Disable No Sauce and Lite Sauce if Extra Sauce is selected
                      if (topping.id === 'hh-si1') isDisabled = hasExtraSauce; // No Sauce
                      if (topping.id === 'hh-si2') isDisabled = hasExtraSauce; // Lite Sauce
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedHotHoagieInstructions(selectedHotHoagieInstructions.filter(id => id !== topping.id));
                            } else {
                              // If selecting "No Sauce" or "Lite Sauce", deselect "Add Extra Sauce" and the other sauce option
                              if (topping.name === 'No Sauce' || topping.name === 'Lite Sauce') {
                                // Deselect Add Extra Sauce
                                setSelectedHotHoagieExtras(
                                  selectedHotHoagieExtras.filter(id => id !== 'hh-extra1')
                                );
                                // Deselect the other sauce option and add the current one in a single state update
                                const otherSauceId = topping.name === 'No Sauce' ? 'hh-si2' : 'hh-si1';
                                setSelectedHotHoagieInstructions([
                                  ...selectedHotHoagieInstructions.filter(id => id !== otherSauceId),
                                  topping.id
                                ]);
                              } else if (topping.id === 'hh-si3') {
                                // If selecting "Lite Cheese", deselect "Extra Cheese"
                                setSelectedHotHoagieExtras(
                                  selectedHotHoagieExtras.filter(id => id !== 'hh-extra2')
                                );
                                setSelectedHotHoagieInstructions([...selectedHotHoagieInstructions, topping.id]);
                              } else {
                                setSelectedHotHoagieInstructions([...selectedHotHoagieInstructions, topping.id]);
                              }
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected && !isDisabled ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && !isDisabled && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Would You Like To Add Extra Sides Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center justify-between">
                    <span className="font-semibold">Would You Like To Add Extra Sides?</span>
                  </div>
                  <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-8 gap-4">
                    {hotHoagieExtraSides.map((side) => {
                      const isSelected = selectedHotHoagieSides.includes(side.id);
                      return (
                        <div
                          key={side.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedHotHoagieSides(selectedHotHoagieSides.filter(id => id !== side.id));
                            } else {
                              setSelectedHotHoagieSides([...selectedHotHoagieSides, side.id]);
                            }
                          }}
                          className={`flex flex-col h-full min-h-[184px] bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                            isSelected ? 'ring-2 ring-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="h-20 w-full relative bg-gray-50 border-b border-gray-100 flex-shrink-0">
                            {side.image && (
                              <ImageWithFallback
                                src={side.image}
                                alt={side.name}
                                className="w-full h-full object-contain p-1"
                              />
                            )}
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                <div className="bg-white rounded-full p-1">
                                  <Check className="w-5 h-5 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="p-2 flex flex-col items-center justify-center flex-grow text-center gap-1">
                            <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2">{side.name}</span>
                            <span className="text-gray-900 font-bold text-sm">${side.price?.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                    </>
                  )}

                  {/* Burgers Customization */}
                  {product.category === 'burgers' && (
                    <>
                      {/* Substitute Cheese Section */}
                      <div ref={burgerCheeseRef}>
                        <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                          <span className="font-semibold">
                            {product.name === 'Hamburger' ? 'Add Cheese (Optional)' : 'Substitute Cheese (Optional)'}
                          </span>
                        </div>
                        {burgerCheeseError && (
                          <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-2 rounded-lg mb-5 text-sm">
                            Please select at least one cheese option to continue
                          </div>
                        )}
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {burgerSubstituteCheese
                          .filter(cheese => {
                            // Filter out No Cheese for Hamburger
                            if (product.name === 'Hamburger' && cheese.id === 'bsc7') {
                              return false;
                            }
                            return true;
                          })
                          .map((cheese) => {
                          const isSelected = selectedBurgerCheese.includes(cheese.id);
                          return (
                            <div
                              key={cheese.id}
                              onClick={() => {
                                setBurgerCheeseError(false);
                                
                                // Handle mutual exclusion for No Cheese
                                if (cheese.id === 'bsc7') { // No Cheese
                                  // Deselect Extra Cheese and Lite Cheese when selecting No Cheese
                                  setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be4'));
                                  setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl1'));
                                }
                                
                                if (product.name === 'Hamburger') {
                                  // Hamburger: Allow multiple cheese selections
                                  if (isSelected) {
                                    setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== cheese.id));
                                  } else {
                                    setSelectedBurgerCheese([...selectedBurgerCheese, cheese.id]);
                                  }
                                } else {
                                  // Other burgers: Only one cheese allowed
                                  if (isSelected) {
                                    // Don't allow deselecting if it's the only one selected
                                    if (selectedBurgerCheese.length > 1) {
                                      setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== cheese.id));
                                    }
                                  } else {
                                    // Replace with new selection
                                    setSelectedBurgerCheese([cheese.id]);
                                  }
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                {cheese.name === 'No Cheese' ? (
                                  <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                    {isSelected ? (
                                      <div className="bg-[#A72020] rounded-full p-1">
                                        <Check className="w-6 h-6 text-white" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <Circle className="w-8 h-8 text-gray-300" strokeWidth={2} />
                                    )}
                                  </div>
                                ) : (
                                  <>
                                    <ImageWithFallback                                       src={cheese.image || 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400'} 
                                      alt={cheese.name}
                                      className="w-full h-full object-cover"
                                    />
                                    {isSelected && (
                                      <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                        <div className="bg-white rounded-full p-0.5">
                                          <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                        </div>
                                      </div>
                                    )}
                                  </>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{cheese.name}</p>
                                <span className="text-sm text-gray-900">
                                  ${cheese.price.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* Add Toppings Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">Add Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {burgerAddToppings.map((topping) => {
                          const isSelected = selectedBurgerAdd.includes(topping.id);
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedBurgerAdd(selectedBurgerAdd.filter(id => id !== topping.id));
                                } else {
                                  setSelectedBurgerAdd([...selectedBurgerAdd, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={topping.image || 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400'} 
                                  alt={topping.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 h-14">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">+${topping.price.toFixed(2)}</span>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* Extra Toppings Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">Extra Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {burgerExtraToppings.map((topping) => {
                          const isSelected = selectedBurgerExtra.includes(topping.id);
                          const isNoCheese = selectedBurgerCheese.includes('bsc7');
                          
                          // Check if conflicting Lite option is selected
                          const hasLiteCheese = selectedBurgerLite.includes('bl1');
                          const hasLiteMayo = selectedBurgerLite.includes('bl2');
                          const hasLiteMustard = selectedBurgerLite.includes('bl3');
                          const hasLiteKetchup = selectedBurgerLite.includes('bl4');
                          
                          let isDisabled = false;
                          if (topping.id === 'be4') isDisabled = isNoCheese || hasLiteCheese; // Extra Cheese
                          if (topping.id === 'be1') isDisabled = hasLiteMayo; // Extra Mayo
                          if (topping.id === 'be2') isDisabled = hasLiteMustard; // Extra Mustard
                          if (topping.id === 'be3') isDisabled = hasLiteKetchup; // Extra Ketchup
                          
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isDisabled) return;
                                
                                if (isSelected) {
                                  setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== topping.id));
                                } else {
                                  // Deselect conflicting options
                                  if (topping.id === 'be4') { // Extra Cheese
                                    setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== 'bsc7'));
                                    setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl1'));
                                  } else if (topping.id === 'be1') { // Extra Mayo
                                    setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl2'));
                                  } else if (topping.id === 'be2') { // Extra Mustard
                                    setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl3'));
                                  } else if (topping.id === 'be3') { // Extra Ketchup
                                    setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl4'));
                                  }
                                  setSelectedBurgerExtra([...selectedBurgerExtra, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-3 h-14 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] px-4 ${
                                isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'
                              } ${isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-white" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between">
                              <p className="text-gray-900">{topping.name}</p>
                              <p className="text-gray-900">${topping.price.toFixed(2)}</p>
                            </div>
                          </div>
                        );
                      })}
                      </div>

                      {/* Lite Toppings Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">Lite Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {burgerLiteToppings.map((topping) => {
                          const isSelected = selectedBurgerLite.includes(topping.id);
                          const isNoCheese = selectedBurgerCheese.includes('bsc7');
                          
                          // Check if conflicting Extra option is selected
                          const hasExtraCheese = selectedBurgerExtra.includes('be4');
                          const hasExtraMayo = selectedBurgerExtra.includes('be1');
                          const hasExtraMustard = selectedBurgerExtra.includes('be2');
                          const hasExtraKetchup = selectedBurgerExtra.includes('be3');
                          
                          let isDisabled = false;
                          if (topping.id === 'bl1') isDisabled = isNoCheese || hasExtraCheese; // Lite Cheese
                          if (topping.id === 'bl2') isDisabled = hasExtraMayo; // Lite Mayo
                          if (topping.id === 'bl3') isDisabled = hasExtraMustard; // Lite Mustard
                          if (topping.id === 'bl4') isDisabled = hasExtraKetchup; // Lite Ketchup
                          
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isDisabled) return;
                                
                                if (isSelected) {
                                  setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== topping.id));
                                } else {
                                  // Deselect conflicting options
                                  if (topping.id === 'bl1') { // Lite Cheese
                                    setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== 'bsc7'));
                                    setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be4'));
                                  } else if (topping.id === 'bl2') { // Lite Mayo
                                    setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be1'));
                                  } else if (topping.id === 'bl3') { // Lite Mustard
                                    setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be2'));
                                  } else if (topping.id === 'bl4') { // Lite Ketchup
                                    setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be3'));
                                  }
                                  setSelectedBurgerLite([...selectedBurgerLite, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-3 h-14 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] px-4 ${
                                isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'
                              } ${isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                                {isSelected && (
                                  <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between">
                                <p className="text-gray-900">{topping.name}</p>
                                <p className="text-gray-900">$0.00</p>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* No Toppings Section (Only for Cheeseburger Deluxe) */}
                      {product.name === 'Cheeseburger Deluxe' && (
                        <>
                          <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                            <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                          </div>
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                            {cheeseBurgerDeluxeNoToppings.map((topping) => {
                              const isSelected = selectedCheeseBurgerDeluxeNoToppings.includes(topping.id);
                              return (
                                <div
                                  key={topping.id}
                                  onClick={() => {
                                    if (isSelected) {
                                      setSelectedCheeseBurgerDeluxeNoToppings(selectedCheeseBurgerDeluxeNoToppings.filter(id => id !== topping.id));
                                    } else {
                                      setSelectedCheeseBurgerDeluxeNoToppings([...selectedCheeseBurgerDeluxeNoToppings, topping.id]);
                                    }
                                  }}
                                  className={`flex items-center gap-3 h-14 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] px-4 cursor-pointer ${
                                    isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                                  }`}
                                >
                                  <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                                    {isSelected && (
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    )}
                                  </div>
                                  <div className="flex-1 flex items-center justify-between">
                                    <p className="text-gray-900">{topping.name}</p>
                                    <p className="text-gray-900">$0.00</p>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        </>
                      )}
                    </>
                  )}

                  {/* Brioche Customization */}
                  {product.category === 'brioche' && (
                    <>
                      {/* Add Cheese Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">
                          {product.name === 'Brioche Mozzarella Grilled Chicken' ? 'Substitute Cheese (Optional)' : 'Add Cheese (Optional)'}
                        </span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {briocheAddCheese
                          .filter(cheese => !((product.name === 'Brioche Buffalo Crispy Chicken' || product.name === 'Brioche Grilled Chicken') && cheese.id === 'brc7')) // Filter out No Cheese for Buffalo Crispy Chicken and Grilled Chicken
                          .map((cheese) => {
                          const isSelected = selectedBriocheAddCheese === cheese.id;
                          const isNoCheese = cheese.id === 'brc7'; // No Cheese
                          
                          return (
                            <div
                              key={cheese.id}
                              onClick={() => {
                                if (isSelected) {
                                  // For Brioche Mozzarella Grilled Chicken, don't allow deselection (cheese is required)
                                  if (product.name !== 'Brioche Mozzarella Grilled Chicken') {
                                    setSelectedBriocheAddCheese('');
                                  }
                                } else {
                                  // If selecting "No Cheese" here, clear Extra Cheese
                                  if (isNoCheese) {
                                    setSelectedBriocheExtraCheese([]);
                                  }
                                  setSelectedBriocheAddCheese(cheese.id);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                {isNoCheese ? (
                                  <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                    {isSelected ? (
                                      <div className="bg-[#A72020] rounded-full p-1.5">
                                        <Check className="w-3.5 h-3.5 text-white" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <Circle className="w-5 h-5 text-gray-300" strokeWidth={2} />
                                    )}
                                  </div>
                                ) : (
                                  <>
                                    <ImageWithFallback                                       src={cheese.image || 'https://via.placeholder.com/56'} 
                                      alt={cheese.name}
                                      className="w-full h-full object-cover"
                                    />
                                    {isSelected && (
                                      <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                        <div className="bg-white rounded-full p-0.5">
                                          <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                        </div>
                                      </div>
                                    )}
                                  </>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{cheese.name}</p>
                                <span className="text-sm text-gray-900">
                                  +${cheese.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* Extra Cheese Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">Extra Cheese (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {briocheExtraCheese
                          .filter(topping => topping.id !== 'brec2') // Filter out Side of Cheddar Sauce
                          .map((topping) => {
                          const isSelected = selectedBriocheExtraCheese.includes(topping.id);
                          // Check if "No Cheese" is selected in Add Cheese section
                          const isNoCheeseActive = selectedBriocheAddCheese === 'brc7';
                          const isDisabled = isNoCheeseActive;
                          
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                // Don't allow click if disabled
                                if (isDisabled) return;
                                
                                if (isSelected) {
                                  setSelectedBriocheExtraCheese(selectedBriocheExtraCheese.filter(id => id !== topping.id));
                                } else {
                                  setSelectedBriocheExtraCheese([...selectedBriocheExtraCheese, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] ${
                                isDisabled 
                                  ? 'opacity-50 cursor-not-allowed border border-gray-200' 
                                  : isSelected 
                                  ? 'border-2 border-[#A72020] cursor-pointer' 
                                  : 'border border-gray-200 cursor-pointer'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative flex items-center justify-center bg-[#F6F6F6]">
                                {isSelected && !isDisabled ? (
                                  <div className="bg-[#A72020] rounded-full p-1">
                                    <Check className="w-5 h-5 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className={`${isDisabled ? 'text-gray-400' : 'text-gray-900'}`}>{topping.name}</p>
                                <span className={`text-sm ${isDisabled ? 'text-gray-400' : 'text-gray-900'}`}>
                                  +${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* No Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">No Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {(product.name === 'Brioche Grilled Chicken' 
                            ? [...briocheNoToppings, ...briocheGrilledChickenNoToppings]
                            : product.name === 'Brioche Mozzarella Grilled Chicken'
                            ? [...briocheNoToppings, ...briocheMozzarellaGrilledChickenNoToppings]
                            : briocheNoToppings
                        ).map((topping) => {
                          const isSelected = selectedBriocheNo.includes(topping.id);
                          
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedBriocheNo(selectedBriocheNo.filter(id => id !== topping.id));
                                } else {
                                  setSelectedBriocheNo([...selectedBriocheNo, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-1.5">
                                      <Check className="w-3.5 h-3.5 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <Circle className="w-5 h-5 text-gray-300" strokeWidth={2} />
                                  )}
                                </div>
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">
                                  ${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      {/* Side Section */}
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold">Side Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                        {briocheSideToppings.map((topping) => {
                          const isSelected = selectedBriocheSide.includes(topping.id);
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedBriocheSide(selectedBriocheSide.filter(id => id !== topping.id));
                                } else {
                                  setSelectedBriocheSide([...selectedBriocheSide, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={topping.image || 'https://via.placeholder.com/56'} 
                                  alt={topping.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">
                                  +${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Cold Hoagies Customization */}
          {product.category === 'cold-hoagies' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Add Cheese Section */}
                  <div ref={coldHoagieCheeseRef}>
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                      <span className="font-semibold">{product.name === 'Italian Hoagie' ? 'Substitute Cheese (Optional)' : product.name === 'Ham & Cheese' ? 'Add Cheese (Required)' : 'Add Cheese (Optional)'}</span>
                    </div>
                    {coldHoagieCheeseError && (
                      <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-2 rounded-lg mt-2 text-sm">
                        Please select a cheese option to continue
                      </div>
                    )}
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                    {coldHoagieAddCheese.map((cheese) => {
                      const isSelected = selectedColdHoagieCheese === cheese.id;
                      
                      // Calculate cheese price for Tuna Hoagie and Turkey Hoagie
                      const displayPrice = (product.name === 'Tuna Hoagie' || product.name === 'Turkey Hoagie') 
                        ? (cheese.name === 'No Cheese' ? 0 : 0.99)
                        : cheese.price;
                      
                      // Disable No Cheese (ch-cheese7) when Extra Cheese (ch-extra3) or Lite Cheese (ch-lite1) is selected
                      const isDisabled = cheese.id === 'ch-cheese7' && (selectedColdHoagieExtras.includes('ch-extra3') || selectedColdHoagieLite.includes('ch-lite1'));
                      
                      return (
                        <div
                          key={cheese.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedColdHoagieCheese('');
                            } else {
                              setSelectedColdHoagieCheese(cheese.id);
                              setColdHoagieCheeseError(false);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] ${
                            isDisabled 
                              ? 'opacity-40 cursor-not-allowed border border-gray-200' 
                              : isSelected 
                                ? 'border-2 border-[#A72020] cursor-pointer' 
                                : 'border border-gray-200 cursor-pointer'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            {cheese.image ? (
                              <>
                                <ImageWithFallback                                   src={cheese.image} 
                                  alt={cheese.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && !isDisabled && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </>
                            ) : (
                              <div className="w-full h-full flex items-center justify-center bg-[#F6F6F6]">
                                {isSelected && !isDisabled ? (
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                                )}
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{cheese.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${displayPrice?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side Toppings Required Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">On The Side Toppings (Optional)</span>
                  </div>
                  <div ref={coldHoagieSideToppingsRequiredRef}>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {coldHoagieSideToppingsRequired.map((topping) => {
                      const isSelected = selectedColdHoagieSideToppingsRequired.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              // Deselect this option
                              setSelectedColdHoagieSideToppingsRequired(prev => prev.filter(id => id !== topping.id));
                            } else {
                              // Select this option
                              setSelectedColdHoagieSideToppingsRequired(prev => [...prev, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {topping.showCircle ? (
                            <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                              {isSelected ? (
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              ) : (
                                <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                              )}
                            </div>
                          ) : topping.image ? (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback src={topping.image} alt={topping.name} className="w-full h-full object-cover" />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : (
                            <div className="w-14 h-14 flex-shrink-0 flex items-center justify-center bg-white">
                              {isSelected && (
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">${topping.price?.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                    </div>
                  </div>

                  {/* Add Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Add Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {coldHoagieAddToppings
                      .filter((topping) => {
                        // Show Oil and Vinegar only for Tuna Hoagie
                        if (topping.id === 'ch-add-oil' || topping.id === 'ch-add-vinegar') {
                          return product.id === '17c' || product.name === 'Tuna Hoagie';
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedColdHoagieToppings.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedColdHoagieToppings(selectedColdHoagieToppings.filter(id => id !== topping.id));
                            } else {
                              setSelectedColdHoagieToppings([...selectedColdHoagieToppings, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={topping.image || 'https://via.placeholder.com/56'} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {coldHoagieExtraToppings.map((topping) => {
                      const isSelected = selectedColdHoagieExtras.includes(topping.id);
                      
                      // Check if conflicting options are selected
                      const isNoCheese = selectedColdHoagieCheese === 'ch-cheese7';
                      const hasLiteCheese = selectedColdHoagieLite.includes('ch-lite1');
                      const hasLiteMayo = selectedColdHoagieLite.includes('ch-lite5');
                      const hasLiteMustard = selectedColdHoagieLite.includes('ch-lite6');
                      
                      let isDisabled = false;
                      if (topping.id === 'ch-extra3') isDisabled = isNoCheese || hasLiteCheese; // Extra Cheese
                      if (topping.id === 'ch-extra1') isDisabled = hasLiteMayo; // Extra Mayo
                      if (topping.id === 'ch-extra2') isDisabled = hasLiteMustard; // Extra Mustard
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedColdHoagieExtras(selectedColdHoagieExtras.filter(id => id !== topping.id));
                            } else {
                              // Deselect the corresponding Lite option when selecting Extra
                              let liteIdToRemove = '';
                              if (topping.name === 'Extra Cheese') {
                                liteIdToRemove = 'ch-lite1'; // Lite Cheese
                                // Clear No Cheese when selecting Extra Cheese
                                if (selectedColdHoagieCheese === 'ch-cheese7') {
                                  setSelectedColdHoagieCheese('');
                                }
                              } else if (topping.name === 'Extra Mayo') {
                                liteIdToRemove = 'ch-lite5'; // Lite Mayo
                              } else if (topping.name === 'Extra Mustard') {
                                liteIdToRemove = 'ch-lite6'; // Lite Mustard
                              }
                              
                              if (liteIdToRemove) {
                                setSelectedColdHoagieLite(selectedColdHoagieLite.filter(id => id !== liteIdToRemove));
                              }
                              
                              setSelectedColdHoagieExtras([...selectedColdHoagieExtras, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected && !isDisabled ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && !isDisabled && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Lite Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Lite Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {coldHoagieLiteToppings.filter(topping => {
                      // Filter out Lite Oil and Lite Vinegar for Tuna Hoagie
                      if (product.name === 'Tuna Hoagie') {
                        return topping.id !== 'ch-lite7' && topping.id !== 'ch-lite10';
                      }
                      return true;
                    }).map((topping) => {
                      const isSelected = selectedColdHoagieLite.includes(topping.id);
                      
                      // Check if conflicting options are selected
                      const isNoCheese = selectedColdHoagieCheese === 'ch-cheese7';
                      const hasExtraCheese = selectedColdHoagieExtras.includes('ch-extra3');
                      const hasExtraMayo = selectedColdHoagieExtras.includes('ch-extra1');
                      const hasExtraMustard = selectedColdHoagieExtras.includes('ch-extra2');
                      const hasNoLettuce = selectedColdHoagieNo.includes('ch-no2');
                      const hasNoTomatoes = selectedColdHoagieNo.includes('ch-no3');
                      const hasNoRawOnions = selectedColdHoagieNo.includes('ch-no4');
                      const hasNoOregano = selectedColdHoagieNo.includes('ch-no5');
                      const hasNoOil = selectedColdHoagieNo.includes('ch-no6');
                      const hasNoVinegar = selectedColdHoagieNo.includes('ch-no7');
                      const hasNoSalt = selectedColdHoagieNo.includes('ch-no8');
                      
                      let isDisabled = false;
                      if (topping.id === 'ch-lite1') isDisabled = isNoCheese || hasExtraCheese; // Lite Cheese
                      if (topping.id === 'ch-lite2') isDisabled = hasNoLettuce; // Lite Lettuce
                      if (topping.id === 'ch-lite3') isDisabled = hasNoTomatoes; // Lite Tomatoes
                      if (topping.id === 'ch-lite4') isDisabled = hasNoRawOnions; // Lite Raw Onions
                      if (topping.id === 'ch-lite5') isDisabled = hasExtraMayo; // Lite Mayo
                      if (topping.id === 'ch-lite6') isDisabled = hasExtraMustard; // Lite Mustard
                      if (topping.id === 'ch-lite7') isDisabled = hasNoOil; // Lite Oil
                      if (topping.id === 'ch-lite8') isDisabled = hasNoSalt; // Lite Salt
                      if (topping.id === 'ch-lite9') isDisabled = hasNoOregano; // Lite Oregano
                      if (topping.id === 'ch-lite10') isDisabled = hasNoVinegar; // Lite Vinegar
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedColdHoagieLite(selectedColdHoagieLite.filter(id => id !== topping.id));
                            } else {
                              // Deselect the corresponding Extra and No options when selecting Lite
                              let extraIdToRemove = '';
                              let noIdToRemove = '';
                              
                              if (topping.name === 'Lite Cheese') {
                                extraIdToRemove = 'ch-extra3'; // Extra Cheese
                                noIdToRemove = 'ch-no1'; // No Cheese
                                // Clear No Cheese from cheese selection when selecting Lite Cheese
                                if (selectedColdHoagieCheese === 'ch-cheese7') {
                                  setSelectedColdHoagieCheese('');
                                }
                              } else if (topping.name === 'Lite Mayo') {
                                extraIdToRemove = 'ch-extra1'; // Extra Mayo
                              } else if (topping.name === 'Lite Mustard') {
                                extraIdToRemove = 'ch-extra2'; // Extra Mustard
                              } else if (topping.name === 'Lite Lettuce') {
                                noIdToRemove = 'ch-no2'; // No Lettuce
                              } else if (topping.name === 'Lite Tomatoes') {
                                noIdToRemove = 'ch-no3'; // No Tomatoes
                              } else if (topping.name === 'Lite Raw Onions') {
                                noIdToRemove = 'ch-no4'; // No Raw Onions
                              } else if (topping.name === 'Lite Oil') {
                                noIdToRemove = 'ch-no6'; // No Oil
                              } else if (topping.name === 'Lite Salt') {
                                noIdToRemove = 'ch-no8'; // No Salt
                              } else if (topping.name === 'Lite Oregano') {
                                noIdToRemove = 'ch-no5'; // No Oregano
                              } else if (topping.name === 'Lite Vinegar') {
                                noIdToRemove = 'ch-no7'; // No Vinegar
                              }
                              
                              if (extraIdToRemove) {
                                setSelectedColdHoagieExtras(selectedColdHoagieExtras.filter(id => id !== extraIdToRemove));
                              }
                              if (noIdToRemove) {
                                setSelectedColdHoagieNo(selectedColdHoagieNo.filter(id => id !== noIdToRemove));
                              }
                              
                              setSelectedColdHoagieLite([...selectedColdHoagieLite, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected && !isDisabled ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && !isDisabled && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">No Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {coldHoagieNoToppings.filter(topping => {
                      // Filter out No Cheese
                      if (topping.name === 'No Cheese') return false;
                      // Filter out No Oil and No Vinegar for Tuna Hoagie
                      if (product.name === 'Tuna Hoagie') {
                        return topping.id !== 'ch-no6' && topping.id !== 'ch-no7';
                      }
                      return true;
                    }).map((topping) => {
                      const isSelected = selectedColdHoagieNo.includes(topping.id);
                      
                      // Check if conflicting Lite options are selected
                      const hasLiteLettuce = selectedColdHoagieLite.includes('ch-lite2');
                      const hasLiteTomatoes = selectedColdHoagieLite.includes('ch-lite3');
                      const hasLiteRawOnions = selectedColdHoagieLite.includes('ch-lite4');
                      const hasLiteOregano = selectedColdHoagieLite.includes('ch-lite9');
                      const hasLiteOil = selectedColdHoagieLite.includes('ch-lite7');
                      const hasLiteVinegar = selectedColdHoagieLite.includes('ch-lite10');
                      const hasLiteSalt = selectedColdHoagieLite.includes('ch-lite8');
                      
                      let isDisabled = false;
                      if (topping.id === 'ch-no2') isDisabled = hasLiteLettuce; // No Lettuce
                      if (topping.id === 'ch-no3') isDisabled = hasLiteTomatoes; // No Tomatoes
                      if (topping.id === 'ch-no4') isDisabled = hasLiteRawOnions; // No Raw Onions
                      if (topping.id === 'ch-no5') isDisabled = hasLiteOregano; // No Oregano
                      if (topping.id === 'ch-no6') isDisabled = hasLiteOil; // No Oil
                      if (topping.id === 'ch-no7') isDisabled = hasLiteVinegar; // No Vinegar
                      if (topping.id === 'ch-no8') isDisabled = hasLiteSalt; // No Salt
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedColdHoagieNo(selectedColdHoagieNo.filter(id => id !== topping.id));
                            } else {
                              // Deselect the corresponding Lite option when selecting No
                              let liteIdToRemove = '';
                              
                              if (topping.name === 'No Cheese') {
                                liteIdToRemove = 'ch-lite1'; // Lite Cheese
                              } else if (topping.name === 'No Lettuce') {
                                liteIdToRemove = 'ch-lite2'; // Lite Lettuce
                              } else if (topping.name === 'No Tomatoes') {
                                liteIdToRemove = 'ch-lite3'; // Lite Tomatoes
                              } else if (topping.name === 'No Raw Onions') {
                                liteIdToRemove = 'ch-lite4'; // Lite Raw Onions
                              } else if (topping.name === 'No Oregano') {
                                liteIdToRemove = 'ch-lite9'; // Lite Oregano
                              } else if (topping.name === 'No Oil') {
                                liteIdToRemove = 'ch-lite7'; // Lite Oil
                              } else if (topping.name === 'No Vinegar') {
                                liteIdToRemove = 'ch-lite10'; // Lite Vinegar
                              } else if (topping.name === 'No Salt') {
                                liteIdToRemove = 'ch-lite8'; // Lite Salt
                              }
                              
                              if (liteIdToRemove) {
                                setSelectedColdHoagieLite(selectedColdHoagieLite.filter(id => id !== liteIdToRemove));
                              }
                              
                              setSelectedColdHoagieNo([...selectedColdHoagieNo, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected && !isDisabled ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && !isDisabled && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className={isDisabled ? "text-gray-400" : "text-gray-900"}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? "text-gray-400" : "text-gray-900"}`}>
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side of Chips Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side of Extra Chips (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {coldHoagieSideOfChips.map((item) => {
                      return (
                        <div
                          key={item.id}
                          className="flex items-center gap-3 px-4 py-3 rounded-lg bg-[#F6F6F6] border border-gray-200"
                        >
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{item.name} - ${item.price?.toFixed(2)}</p>
                            <div className="flex items-center gap-2">
                              <button
                                onClick={() => setChipsQuantity(Math.max(0, chipsQuantity - 1))}
                                className="w-6 h-6 flex items-center justify-center rounded bg-gray-200 hover:bg-gray-300"
                              >
                                <Minus className="w-4 h-4" />
                              </button>
                              <span className="w-8 text-center">{chipsQuantity}</span>
                              <button
                                onClick={() => setChipsQuantity(chipsQuantity + 1)}
                                className="w-6 h-6 flex items-center justify-center rounded bg-gray-200 hover:bg-gray-300"
                              >
                                <Plus className="w-4 h-4" />
                              </button>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {coldHoagieSideToppings.map((topping) => {
                      const isSelected = selectedColdHoagieSides.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedColdHoagieSides(selectedColdHoagieSides.filter(id => id !== topping.id));
                            } else {
                              setSelectedColdHoagieSides([...selectedColdHoagieSides, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={topping.image || 'https://via.placeholder.com/56'} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Would You Like To Add Extra Sides Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg flex items-center justify-between">
                    <span className="font-semibold">Would You Like To Add Extra Sides?</span>
                  </div>
                  <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-8 gap-4">
                    {hotHoagieExtraSides.map((side) => {
                      const isSelected = selectedColdHoagieExtraSides.includes(side.id);
                      return (
                        <div
                          key={side.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedColdHoagieExtraSides(selectedColdHoagieExtraSides.filter(id => id !== side.id));
                            } else {
                              setSelectedColdHoagieExtraSides([...selectedColdHoagieExtraSides, side.id]);
                            }
                          }}
                          className={`flex flex-col h-full min-h-[184px] bg-[#F6F6F6] rounded-lg overflow-hidden cursor-pointer shadow-sm transition-all hover:shadow-md ${
                            isSelected ? 'ring-2 ring-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="h-20 w-full relative bg-gray-50 border-b border-gray-100 flex-shrink-0">
                            {side.image && (
                              <ImageWithFallback
                                src={side.image}
                                alt={side.name}
                                className="w-full h-full object-contain p-1"
                              />
                            )}
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40 z-10">
                                <div className="bg-white rounded-full p-1">
                                  <Check className="w-5 h-5 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="p-2 flex flex-col items-center justify-center flex-grow text-center gap-1">
                            <span className="text-gray-900 font-medium text-sm leading-tight line-clamp-2">{side.name}</span>
                            <span className="text-gray-900 font-bold text-sm">${side.price?.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Panini Customization */}
          {product.category === 'paninis' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Choose Panini Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Panini (Required)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {paniniChooseType.map((type) => {
                      const isSelected = selectedPaniniType === type.id;
                      return (
                        <div
                          key={type.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedPaniniType('');
                            } else {
                              setSelectedPaniniType(type.id);
                              setPaniniTypeError(false);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] ${
                            paniniTypeError 
                              ? 'border-2 border-red-500 hover:border-red-600' 
                              : 'border border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{type.name}</p>
                            <span className="text-sm text-gray-900">
                              ${type.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  
                  {/* Panini Type Error Message */}
                  {paniniTypeError && (
                    <div 
                      ref={paniniTypeRef}
                      className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 rounded-r-lg flex items-center gap-3"
                      role="alert"
                    >
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <span className="font-semibold">Please select White or Whole Wheat to continue.</span>
                    </div>
                  )}

                  {/* Substitute Cheese Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Substitute Cheese (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {paniniSubstituteCheese.map((cheese) => {
                      const isSelected = selectedPaniniCheese === cheese.id;
                      return (
                        <div
                          key={cheese.id}
                          onClick={() => {
                            if (isSelected) {
                              // For Grilled Veggie Panini and Prosciutto Mozzarella Panini, always keep a cheese selected
                              if (product.name === 'Grilled Veggie Panini' || product.name === 'Prosciutto Mozzarella Panini') {
                                return;
                              }
                              setSelectedPaniniCheese('');
                            } else {
                              setSelectedPaniniCheese(cheese.id);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {cheese.image && (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback                                 src={cheese.image} 
                                alt={cheese.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          )}
                          {!cheese.image && (
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ml-4 my-3 ${
                              isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{cheese.name}</p>
                            <span className="text-sm text-gray-900">
                              ${cheese.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Cheese Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Extra Cheese (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {paniniExtraCheese.map((topping) => {
                      const isSelected = selectedPaniniExtraCheese.includes(topping.id);
                      const isDisabled = selectedPaniniCheese === 'pn-cheese7' || selectedPaniniLite.includes('pn-lite1');
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedPaniniExtraCheese(selectedPaniniExtraCheese.filter(id => id !== topping.id));
                            } else {
                              // Add Extra Cheese
                              setSelectedPaniniExtraCheese([...selectedPaniniExtraCheese, topping.id]);
                              // Remove conflicting Lite Cheese
                              if (topping.id === 'pn-extra1' && selectedPaniniLite.includes('pn-lite1')) {
                                setSelectedPaniniLite(selectedPaniniLite.filter(id => id !== 'pn-lite1'));
                              }
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-40 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Lite Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Lite Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {paniniLiteToppings
                      .filter(topping => {
                        // For Prosciutto Mozzarella Panini, only show: Lite Cheese, Lite Roasted Red Peppers, Lite Pesto Spread
                        if (product.name === 'Prosciutto Mozzarella Panini') {
                          return ['pn-lite1', 'pn-lite8', 'pn-lite9'].includes(topping.id);
                        }
                        // For Grilled Veggie Panini, only show: Lite Cheese, Lite Eggplant, Lite Zucchini, Lite Roasted Red Peppers
                        if (product.name === 'Grilled Veggie Panini') {
                          return ['pn-lite1', 'pn-lite6', 'pn-lite7', 'pn-lite8'].includes(topping.id);
                        }
                        // Only show Lite Oregano for Grilled Chicken Panini
                        if (topping.id === 'pn-lite5') {
                          return product.name === 'Grilled Chicken Panini';
                        }
                        // For Grilled Chicken Panini, hide veggie options and Lite Pesto Spread
                        if (product.name === 'Grilled Chicken Panini') {
                          return !['pn-lite6', 'pn-lite7', 'pn-lite8', 'pn-lite9'].includes(topping.id);
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedPaniniLite.includes(topping.id);
                      let isDisabled = false;
                      
                      // Lite Cheese disabled if No Cheese selected or Extra Cheese selected
                      if (topping.id === 'pn-lite1') {
                        isDisabled = selectedPaniniCheese === 'pn-cheese7' || selectedPaniniExtraCheese.includes('pn-extra1');
                      }
                      // Lite Lettuce disabled if No Lettuce selected
                      if (topping.id === 'pn-lite2') {
                        isDisabled = selectedPaniniNo.includes('pn-no2');
                      }
                      // Lite Tomatoes disabled if No Tomatoes selected
                      if (topping.id === 'pn-lite3') {
                        isDisabled = selectedPaniniNo.includes('pn-no3');
                      }
                      // Lite Mayo disabled if No Mayo selected
                      if (topping.id === 'pn-lite4') {
                        isDisabled = selectedPaniniNo.includes('pn-no4');
                      }
                      // Lite Oregano disabled if No Oregano selected
                      if (topping.id === 'pn-lite5') {
                        isDisabled = selectedPaniniNo.includes('pn-no6');
                      }
                      // Lite Eggplant disabled if No Eggplant selected
                      if (topping.id === 'pn-lite6') {
                        isDisabled = selectedPaniniNo.includes('pn-no7');
                      }
                      // Lite Zucchini disabled if No Zucchini selected
                      if (topping.id === 'pn-lite7') {
                        isDisabled = selectedPaniniNo.includes('pn-no8');
                      }
                      // Lite Roasted Red Peppers disabled if No Roasted Red Peppers selected
                      if (topping.id === 'pn-lite8') {
                        isDisabled = selectedPaniniNo.includes('pn-no9');
                      }
                      // Lite Pesto Spread disabled if No Pesto Spread selected
                      if (topping.id === 'pn-lite9') {
                        isDisabled = selectedPaniniNo.includes('pn-no10');
                      }
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedPaniniLite(selectedPaniniLite.filter(id => id !== topping.id));
                            } else {
                              // Add the lite topping
                              setSelectedPaniniLite([...selectedPaniniLite, topping.id]);
                              
                              // Remove conflicting Extra Cheese if selecting Lite Cheese
                              if (topping.id === 'pn-lite1' && selectedPaniniExtraCheese.includes('pn-extra1')) {
                                setSelectedPaniniExtraCheese(selectedPaniniExtraCheese.filter(id => id !== 'pn-extra1'));
                              }
                              
                              // Remove conflicting No topping
                              const conflicts: Record<string, string> = {
                                'pn-lite2': 'pn-no2',
                                'pn-lite3': 'pn-no3',
                                'pn-lite4': 'pn-no4',
                                'pn-lite5': 'pn-no6',
                                'pn-lite6': 'pn-no7',
                                'pn-lite7': 'pn-no8',
                                'pn-lite8': 'pn-no9',
                                'pn-lite9': 'pn-no10',
                              };
                              const conflictingNo = conflicts[topping.id];
                              if (conflictingNo && selectedPaniniNo.includes(conflictingNo)) {
                                setSelectedPaniniNo(selectedPaniniNo.filter(id => id !== conflictingNo));
                              }
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-40 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">No Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {paniniNoToppings
                      .filter(topping => {
                        // For Prosciutto Mozzarella Panini, only show: No Potato Chips, No Roasted Red Peppers, No Pesto Spread
                        if (product.name === 'Prosciutto Mozzarella Panini') {
                          return ['pn-no5', 'pn-no9', 'pn-no10'].includes(topping.id);
                        }
                        // For Grilled Veggie Panini, only show: No Eggplant, No Zucchini, No Roasted Red Peppers, No Potato Chips
                        if (product.name === 'Grilled Veggie Panini') {
                          return ['pn-no5', 'pn-no7', 'pn-no8', 'pn-no9'].includes(topping.id);
                        }
                        // Only show No Oregano for Grilled Chicken Panini
                        if (topping.id === 'pn-no6') {
                          return product.name === 'Grilled Chicken Panini';
                        }
                        // For Grilled Chicken Panini, hide veggie options and No Pesto Spread
                        if (product.name === 'Grilled Chicken Panini') {
                          return !['pn-no7', 'pn-no8', 'pn-no9', 'pn-no10'].includes(topping.id);
                        }
                        return true;
                      })
                      .map((topping) => {
                      const isSelected = selectedPaniniNo.includes(topping.id);
                      let isDisabled = false;
                      
                      // No Lettuce disabled if Lite Lettuce selected
                      if (topping.id === 'pn-no2') {
                        isDisabled = selectedPaniniLite.includes('pn-lite2');
                      }
                      // No Tomatoes disabled if Lite Tomatoes selected
                      if (topping.id === 'pn-no3') {
                        isDisabled = selectedPaniniLite.includes('pn-lite3');
                      }
                      // No Mayo disabled if Lite Mayo selected
                      if (topping.id === 'pn-no4') {
                        isDisabled = selectedPaniniLite.includes('pn-lite4');
                      }
                      // No Oregano disabled if Lite Oregano selected
                      if (topping.id === 'pn-no6') {
                        isDisabled = selectedPaniniLite.includes('pn-lite5');
                      }
                      // No Eggplant disabled if Lite Eggplant selected
                      if (topping.id === 'pn-no7') {
                        isDisabled = selectedPaniniLite.includes('pn-lite6');
                      }
                      // No Zucchini disabled if Lite Zucchini selected
                      if (topping.id === 'pn-no8') {
                        isDisabled = selectedPaniniLite.includes('pn-lite7');
                      }
                      // No Roasted Red Peppers disabled if Lite Roasted Red Peppers selected
                      if (topping.id === 'pn-no9') {
                        isDisabled = selectedPaniniLite.includes('pn-lite8');
                      }
                      // No Pesto Spread disabled if Lite Pesto Spread selected
                      if (topping.id === 'pn-no10') {
                        isDisabled = selectedPaniniLite.includes('pn-lite9');
                      }
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedPaniniNo(selectedPaniniNo.filter(id => id !== topping.id));
                            } else {
                              // Add the no topping
                              setSelectedPaniniNo([...selectedPaniniNo, topping.id]);
                              
                              // Remove conflicting Lite topping
                              const conflicts: Record<string, string> = {
                                'pn-no2': 'pn-lite2',
                                'pn-no3': 'pn-lite3',
                                'pn-no4': 'pn-lite4',
                                'pn-no6': 'pn-lite5',
                                'pn-no7': 'pn-lite6',
                                'pn-no8': 'pn-lite7',
                                'pn-no9': 'pn-lite8',
                                'pn-no10': 'pn-lite9',
                              };
                              const conflictingLite = conflicts[topping.id];
                              if (conflictingLite && selectedPaniniLite.includes(conflictingLite)) {
                                setSelectedPaniniLite(selectedPaniniLite.filter(id => id !== conflictingLite));
                              }
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-40 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {paniniSideToppings.map((topping) => {
                      const isSelected = selectedPaniniSides.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedPaniniSides(selectedPaniniSides.filter(id => id !== topping.id));
                            } else {
                              setSelectedPaniniSides([...selectedPaniniSides, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {topping.image && (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback                                 src={topping.image} 
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          )}
                          {!topping.image && (
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ml-4 my-3 ${
                              isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Wraps Customization */}
          {product.category === 'wraps' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Choose Wrap Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Choose Wrap (Required)</span>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapTypeOptions.map((type) => {
                      const isSelected = selectedWrapType === type.id;
                      return (
                        <div
                          key={type.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedWrapType('');
                            } else {
                              setSelectedWrapType(type.id);
                              setWrapTypeError(false);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] ${
                            wrapTypeError 
                              ? 'border-2 border-red-500 hover:border-red-600' 
                              : 'border border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{type.name}</p>
                            <span className="text-sm text-gray-900">
                              ${type.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Wrap Type Error Message */}
                  {wrapTypeError && (
                    <div 
                      ref={wrapTypeRef}
                      className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4"
                      role="alert"
                    >
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <span>Please select a wrap type to continue</span>
                    </div>
                  )}

                  {/* Substitute Cheese Section */}
                  <div ref={wrapCheeseRef} className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">
                      {(product.name === 'Tuna Wrap' || product.name === 'Turkey Wrap') ? 'Add Cheese (Optional)' : 'Substitute Cheese (Optional)'}
                    </span>
                  </div>
                  {wrapCheeseError && (
                    <div 
                      className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800"
                      role="alert"
                    >
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <p className="font-semibold">Please select a cheese option before adding to cart</p>
                    </div>
                  )}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapSubstituteCheese.concat(product.name === 'Chicken Caesar Wrap' ? chickenCaesarWrapCheese : []).map((cheese) => {
                      const isSelected = selectedWrapCheese === cheese.id;
                      const isNoCheese = cheese.name === 'No Cheese';
                      return (
                        <div
                          key={cheese.id}
                          onClick={() => {
                            if (isSelected) {
                              // Don't allow deselection for cheesesteak wraps, chicken caesar wrap, grilled chicken wrap, and italian wrap
                              if (product.name !== 'Buffalo Chicken Cheesesteak Wrap' && 
                                  product.name !== 'Cheesesteak Wrap' && 
                                  product.name !== 'Chicken Cheesesteak Wrap' &&
                                  product.name !== 'Chicken Caesar Wrap' &&
                                  product.name !== 'Grilled Chicken Wrap' &&
                                  product.name !== 'Italian Wrap') {
                                setSelectedWrapCheese('');
                              }
                            } else {
                              setSelectedWrapCheese(cheese.id);
                              setWrapCheeseError(false);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            {isNoCheese ? (
                              <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-1">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                            ) : cheese.image ? (
                              <>
                                <ImageWithFallback                                   src={cheese.image} 
                                  alt={cheese.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </>
                            ) : null}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{cheese.name}</p>
                            <span className="text-sm text-gray-900">
                              ${cheese.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Add Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Add Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapAddToppings.map((topping) => {
                      const isSelected = selectedWrapAddToppings.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedWrapAddToppings(selectedWrapAddToppings.filter(id => id !== topping.id));
                            } else {
                              setSelectedWrapAddToppings([...selectedWrapAddToppings, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {topping.image && (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback                                 src={topping.name.toLowerCase().includes('tomato') ? 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' : topping.image} 
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Cheese Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Extra Cheese (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapExtraCheese.map((topping) => {
                      const isSelected = selectedWrapExtraCheese.includes(topping.id);
                      const isDisabled = selectedWrapCheese === 'wrap-cheese7';
                      const hasLiteCheese = selectedWrapLite.includes('wrap-lite1');
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedWrapExtraCheese(selectedWrapExtraCheese.filter(id => id !== topping.id));
                            } else {
                              // Clear Lite Cheese if trying to select Extra Cheese
                              if (hasLiteCheese) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite1'));
                              }
                              setSelectedWrapExtraCheese([...selectedWrapExtraCheese, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Lite Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Lite Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapLiteToppings
                      .concat((product.name === 'Cheesesteak Wrap' || product.name === 'Chicken Cheesesteak Wrap') ? cheesesteakWrapLiteToppings : [])
                      .concat(product.name === 'Grilled Chicken Wrap' ? grilledChickenWrapLiteToppings : [])
                      .concat(product.name === 'Italian Wrap' ? italianWrapLiteToppings : [])
                      .concat(product.name === 'Tuna Wrap' ? tunaWrapLiteToppings : [])
                      .concat(product.name === 'Turkey Wrap' ? turkeyWrapLiteToppings : [])
                      .concat(product.name === 'Veggie Wrap' ? veggieWrapLiteToppings : [])
                      .map((topping) => {
                      const isSelected = selectedWrapLite.includes(topping.id);
                      const isLiteCheese = topping.id === 'wrap-lite1';
                      const hasExtraCheese = selectedWrapExtraCheese.includes('wrap-extra1');
                      
                      // Determine if this topping should be disabled due to mutual exclusion
                      let isDisabled = isLiteCheese && selectedWrapCheese === 'wrap-cheese7';
                      if (topping.id === 'wrap-lite4' && selectedWrapNo.includes('wrap-no5')) isDisabled = true; // Lite Lettuce vs No Lettuce
                      if (topping.id === 'wrap-lite5' && selectedWrapNo.includes('wrap-no6')) isDisabled = true; // Lite Tomatoes vs No Tomatoes
                      if (topping.id === 'wrap-lite6' && selectedWrapNo.includes('wrap-no7')) isDisabled = true; // Lite Oregano vs No Oregano
                      if (topping.id === 'wrap-lite7' && selectedWrapNo.includes('wrap-no8')) isDisabled = true; // Lite Raw Onions vs No Raw Onions
                      if (topping.id === 'wrap-lite8' && selectedWrapNo.includes('wrap-no9')) isDisabled = true; // Lite Spinach vs No Spinach
                      if (topping.id === 'wrap-lite9' && selectedWrapNo.includes('wrap-no10')) isDisabled = true; // Lite Roasted Red Peppers vs No Roasted Red Peppers
                      // Italian Wrap exclusions
                      if (topping.id === 'wrap-lite-ham' && selectedWrapNo.includes('wrap-no-ham')) isDisabled = true; // Lite Ham vs No Ham
                      if (topping.id === 'wrap-lite-capicola' && selectedWrapNo.includes('wrap-no-capicola')) isDisabled = true; // Lite Capicola vs No Capicola
                      if (topping.id === 'wrap-lite-salami' && selectedWrapNo.includes('wrap-no-salami')) isDisabled = true; // Lite Salami vs No Salami
                      if (topping.id === 'wrap-lite10' && selectedWrapNo.includes('wrap-no11')) isDisabled = true; // Lite Lettuce vs No Lettuce
                      if (topping.id === 'wrap-lite11' && selectedWrapNo.includes('wrap-no12')) isDisabled = true; // Lite Tomatoes vs No Tomatoes
                      if (topping.id === 'wrap-lite12' && selectedWrapNo.includes('wrap-no13')) isDisabled = true; // Lite Raw Onions vs No Raw Onions
                      if (topping.id === 'wrap-lite13' && selectedWrapNo.includes('wrap-no14')) isDisabled = true; // Lite Oregano vs No Oregano
                      if (topping.id === 'wrap-lite14' && selectedWrapNo.includes('wrap-no15')) isDisabled = true; // Lite Oil vs No Oil
                      if (topping.id === 'wrap-lite15' && selectedWrapNo.includes('wrap-no16')) isDisabled = true; // Lite Vinegar vs No Vinegar
                      // Tuna Wrap exclusions
                      if (topping.id === 'wrap-lite16' && selectedWrapNo.includes('wrap-no17')) isDisabled = true; // Lite Lettuce vs No Lettuce
                      if (topping.id === 'wrap-lite17' && selectedWrapNo.includes('wrap-no18')) isDisabled = true; // Lite Oregano vs No Oregano
                      if (topping.id === 'wrap-lite18' && selectedWrapNo.includes('wrap-no19')) isDisabled = true; // Lite Tomatoes vs No Tomatoes
                      // Turkey Wrap exclusions
                      if (topping.id === 'wrap-lite19' && selectedWrapNo.includes('wrap-no20')) isDisabled = true; // Lite Lettuce vs No Lettuce
                      if (topping.id === 'wrap-lite20' && selectedWrapNo.includes('wrap-no21')) isDisabled = true; // Lite Tomatoes vs No Tomatoes
                      if (topping.id === 'wrap-lite21' && selectedWrapNo.includes('wrap-no22')) isDisabled = true; // Lite Oregano vs No Oregano
                      if (topping.id === 'wrap-lite22' && selectedWrapNo.includes('wrap-no23')) isDisabled = true; // Lite Raw Onions vs No Raw Onions
                      // Veggie Wrap exclusions
                      if (topping.id === 'wrap-lite23' && selectedWrapNo.includes('wrap-no24')) isDisabled = true; // Lite Grilled Eggplant vs No Grilled Eggplant
                      if (topping.id === 'wrap-lite24' && selectedWrapNo.includes('wrap-no25')) isDisabled = true; // Lite Grilled Zucchini vs No Grilled Zucchini
                      if (topping.id === 'wrap-lite25' && selectedWrapNo.includes('wrap-no26')) isDisabled = true; // Lite Roasted Red Peppers vs No Roasted Red Peppers
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedWrapLite(selectedWrapLite.filter(id => id !== topping.id));
                            } else {
                              // Clear Extra Cheese if trying to select Lite Cheese
                              if (isLiteCheese && hasExtraCheese) {
                                setSelectedWrapExtraCheese(selectedWrapExtraCheese.filter(id => id !== 'wrap-extra1'));
                              }
                              // Clear "No Salt" if trying to select "Lite Salt"
                              if (topping.id === 'wrap-lite2' && selectedWrapNo.includes('wrap-no3')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no3'));
                              }
                              // Clear "No Black Pepper" if trying to select "Lite Black Pepper"
                              if (topping.id === 'wrap-lite3' && selectedWrapNo.includes('wrap-no4')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no4'));
                              }
                              // Clear "No Lettuce" if trying to select "Lite Lettuce"
                              if (topping.id === 'wrap-lite4' && selectedWrapNo.includes('wrap-no5')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no5'));
                              }
                              // Clear "No Tomatoes" if trying to select "Lite Tomatoes"
                              if (topping.id === 'wrap-lite5' && selectedWrapNo.includes('wrap-no6')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no6'));
                              }
                              // Clear "No Oregano" if trying to select "Lite Oregano"
                              if (topping.id === 'wrap-lite6' && selectedWrapNo.includes('wrap-no7')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no7'));
                              }
                              // Clear "No Raw Onions" if trying to select "Lite Onions"
                              if (topping.id === 'wrap-lite7' && selectedWrapNo.includes('wrap-no8')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no8'));
                              }
                              // Clear \"No Spinach\" if trying to select \"Lite Spinach\"
                              if (topping.id === 'wrap-lite8' && selectedWrapNo.includes('wrap-no9')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no9'));
                              }
                              // Clear \"No Roasted Red Peppers\" if trying to select \"Lite Roasted Red Peppers\"
                              if (topping.id === 'wrap-lite9' && selectedWrapNo.includes('wrap-no10')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no10'));
                              }
                              // Italian Wrap exclusions
                              // Clear "No Ham" if trying to select "Lite Ham"
                              if (topping.id === 'wrap-lite-ham' && selectedWrapNo.includes('wrap-no-ham')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no-ham'));
                              }
                              // Clear "No Capicola" if trying to select "Lite Capicola"
                              if (topping.id === 'wrap-lite-capicola' && selectedWrapNo.includes('wrap-no-capicola')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no-capicola'));
                              }
                              // Clear "No Salami" if trying to select "Lite Salami"
                              if (topping.id === 'wrap-lite-salami' && selectedWrapNo.includes('wrap-no-salami')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no-salami'));
                              }
                              // Clear \"No Lettuce\" if trying to select \"Lite Lettuce\"
                              if (topping.id === 'wrap-lite10' && selectedWrapNo.includes('wrap-no11')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no11'));
                              }
                              // Clear \"No Tomatoes\" if trying to select \"Lite Tomatoes\"
                              if (topping.id === 'wrap-lite11' && selectedWrapNo.includes('wrap-no12')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no12'));
                              }
                              // Clear \"No Raw Onions\" if trying to select \"Lite Raw Onions\"
                              if (topping.id === 'wrap-lite12' && selectedWrapNo.includes('wrap-no13')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no13'));
                              }
                              // Clear \"No Oregano\" if trying to select \"Lite Oregano\"
                              if (topping.id === 'wrap-lite13' && selectedWrapNo.includes('wrap-no14')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no14'));
                              }
                              // Clear \"No Oil\" if trying to select \"Lite Oil\"
                              if (topping.id === 'wrap-lite14' && selectedWrapNo.includes('wrap-no15')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no15'));
                              }
                              // Clear \"No Vinegar\" if trying to select \"Lite Vinegar\"
                              if (topping.id === 'wrap-lite15' && selectedWrapNo.includes('wrap-no16')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no16'));
                              }
                              // Tuna Wrap exclusions
                              // Clear \"No Lettuce\" if trying to select \"Lite Lettuce\"
                              if (topping.id === 'wrap-lite16' && selectedWrapNo.includes('wrap-no17')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no17'));
                              }
                              // Clear \"No Oregano\" if trying to select \"Lite Oregano\"
                              if (topping.id === 'wrap-lite17' && selectedWrapNo.includes('wrap-no18')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no18'));
                              }
                              // Clear \"No Tomatoes\" if trying to select \"Lite Tomatoes\"
                              if (topping.id === 'wrap-lite18' && selectedWrapNo.includes('wrap-no19')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no19'));
                              }
                              // Turkey Wrap exclusions
                              // Clear \"No Lettuce\" if trying to select \"Lite Lettuce\"
                              if (topping.id === 'wrap-lite19' && selectedWrapNo.includes('wrap-no20')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no20'));
                              }
                              // Clear \"No Tomatoes\" if trying to select \"Lite Tomatoes\"
                              if (topping.id === 'wrap-lite20' && selectedWrapNo.includes('wrap-no21')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no21'));
                              }
                              // Clear \"No Oregano\" if trying to select \"Lite Oregano\"
                              if (topping.id === 'wrap-lite21' && selectedWrapNo.includes('wrap-no22')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no22'));
                              }
                              // Clear \"No Raw Onions\" if trying to select \"Lite Raw Onions\"
                              if (topping.id === 'wrap-lite22' && selectedWrapNo.includes('wrap-no23')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no23'));
                              }
                              // Veggie Wrap exclusions
                              // Clear \"No Grilled Eggplant\" if trying to select \"Lite Grilled Eggplant\"
                              if (topping.id === 'wrap-lite23' && selectedWrapNo.includes('wrap-no24')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no24'));
                              }
                              // Clear \"No Grilled Zucchini\" if trying to select \"Lite Grilled Zucchini\"
                              if (topping.id === 'wrap-lite24' && selectedWrapNo.includes('wrap-no25')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no25'));
                              }
                              // Clear \"No Roasted Red Peppers\" if trying to select \"Lite Roasted Red Peppers\"
                              if (topping.id === 'wrap-lite25' && selectedWrapNo.includes('wrap-no26')) {
                                setSelectedWrapNo(selectedWrapNo.filter(id => id !== 'wrap-no26'));
                              }
                              setSelectedWrapLite([...selectedWrapLite, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">No Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapNoToppings
                      .concat((product.name === 'Cheesesteak Wrap' || product.name === 'Chicken Cheesesteak Wrap') ? cheesesteakWrapNoToppings : [])
                      .concat(product.name === 'Grilled Chicken Wrap' ? grilledChickenWrapNoToppings : [])
                      .concat(product.name === 'Italian Wrap' ? italianWrapNoToppings : [])
                      .concat(product.name === 'Tuna Wrap' ? tunaWrapNoToppings : [])
                      .concat(product.name === 'Turkey Wrap' ? turkeyWrapNoToppings : [])
                      .concat(product.name === 'Veggie Wrap' ? veggieWrapNoToppings : [])
                      .map((topping) => {
                      const isSelected = selectedWrapNo.includes(topping.id);
                      
                      // Determine if this topping should be disabled due to mutual exclusion
                      let isDisabled = false;
                      if (topping.id === 'wrap-no5' && selectedWrapLite.includes('wrap-lite4')) isDisabled = true; // No Lettuce vs Lite Lettuce
                      if (topping.id === 'wrap-no6' && selectedWrapLite.includes('wrap-lite5')) isDisabled = true; // No Tomatoes vs Lite Tomatoes
                      if (topping.id === 'wrap-no7' && selectedWrapLite.includes('wrap-lite6')) isDisabled = true; // No Oregano vs Lite Oregano
                      if (topping.id === 'wrap-no8' && selectedWrapLite.includes('wrap-lite7')) isDisabled = true; // No Raw Onions vs Lite Raw Onions
                      if (topping.id === 'wrap-no9' && selectedWrapLite.includes('wrap-lite8')) isDisabled = true; // No Spinach vs Lite Spinach
                      if (topping.id === 'wrap-no10' && selectedWrapLite.includes('wrap-lite9')) isDisabled = true; // No Roasted Red Peppers vs Lite Roasted Red Peppers
                      // Italian Wrap exclusions
                      if (topping.id === 'wrap-no-ham' && selectedWrapLite.includes('wrap-lite-ham')) isDisabled = true; // No Ham vs Lite Ham
                      if (topping.id === 'wrap-no-capicola' && selectedWrapLite.includes('wrap-lite-capicola')) isDisabled = true; // No Capicola vs Lite Capicola
                      if (topping.id === 'wrap-no-salami' && selectedWrapLite.includes('wrap-lite-salami')) isDisabled = true; // No Salami vs Lite Salami
                      if (topping.id === 'wrap-no11' && selectedWrapLite.includes('wrap-lite10')) isDisabled = true; // No Lettuce vs Lite Lettuce
                      if (topping.id === 'wrap-no12' && selectedWrapLite.includes('wrap-lite11')) isDisabled = true; // No Tomatoes vs Lite Tomatoes
                      if (topping.id === 'wrap-no13' && selectedWrapLite.includes('wrap-lite12')) isDisabled = true; // No Raw Onions vs Lite Raw Onions
                      if (topping.id === 'wrap-no14' && selectedWrapLite.includes('wrap-lite13')) isDisabled = true; // No Oregano vs Lite Oregano
                      if (topping.id === 'wrap-no15' && selectedWrapLite.includes('wrap-lite14')) isDisabled = true; // No Oil vs Lite Oil
                      if (topping.id === 'wrap-no16' && selectedWrapLite.includes('wrap-lite15')) isDisabled = true; // No Vinegar vs Lite Vinegar
                      // Tuna Wrap exclusions
                      if (topping.id === 'wrap-no17' && selectedWrapLite.includes('wrap-lite16')) isDisabled = true; // No Lettuce vs Lite Lettuce
                      if (topping.id === 'wrap-no18' && selectedWrapLite.includes('wrap-lite17')) isDisabled = true; // No Oregano vs Lite Oregano
                      if (topping.id === 'wrap-no19' && selectedWrapLite.includes('wrap-lite18')) isDisabled = true; // No Tomatoes vs Lite Tomatoes
                      // Turkey Wrap exclusions
                      if (topping.id === 'wrap-no20' && selectedWrapLite.includes('wrap-lite19')) isDisabled = true; // No Lettuce vs Lite Lettuce
                      if (topping.id === 'wrap-no21' && selectedWrapLite.includes('wrap-lite20')) isDisabled = true; // No Tomatoes vs Lite Tomatoes
                      if (topping.id === 'wrap-no22' && selectedWrapLite.includes('wrap-lite21')) isDisabled = true; // No Oregano vs Lite Oregano
                      if (topping.id === 'wrap-no23' && selectedWrapLite.includes('wrap-lite22')) isDisabled = true; // No Raw Onions vs Lite Raw Onions
                      // Veggie Wrap exclusions
                      if (topping.id === 'wrap-no24' && selectedWrapLite.includes('wrap-lite23')) isDisabled = true; // No Grilled Eggplant vs Lite Grilled Eggplant
                      if (topping.id === 'wrap-no25' && selectedWrapLite.includes('wrap-lite24')) isDisabled = true; // No Grilled Zucchini vs Lite Grilled Zucchini
                      if (topping.id === 'wrap-no26' && selectedWrapLite.includes('wrap-lite25')) isDisabled = true; // No Roasted Red Peppers vs Lite Roasted Red Peppers
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            if (isSelected) {
                              setSelectedWrapNo(selectedWrapNo.filter(id => id !== topping.id));
                            } else {
                              // Clear "Lite Salt" if trying to select "No Salt"
                              if (topping.id === 'wrap-no3' && selectedWrapLite.includes('wrap-lite2')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite2'));
                              }
                              // Clear "Lite Black Pepper" if trying to select "No Black Pepper"
                              if (topping.id === 'wrap-no4' && selectedWrapLite.includes('wrap-lite3')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite3'));
                              }
                              // Clear "Lite Lettuce" if trying to select "No Lettuce"
                              if (topping.id === 'wrap-no5' && selectedWrapLite.includes('wrap-lite4')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite4'));
                              }
                              // Clear "Lite Tomatoes" if trying to select "No Tomatoes"
                              if (topping.id === 'wrap-no6' && selectedWrapLite.includes('wrap-lite5')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite5'));
                              }
                              // Clear "Lite Oregano" if trying to select "No Oregano"
                              if (topping.id === 'wrap-no7' && selectedWrapLite.includes('wrap-lite6')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite6'));
                              }
                              // Clear "Lite Onions" if trying to select "No Raw Onions"
                              if (topping.id === 'wrap-no8' && selectedWrapLite.includes('wrap-lite7')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite7'));
                              }
                              // Clear \"Lite Spinach\" if trying to select \"No Spinach\"
                              if (topping.id === 'wrap-no9' && selectedWrapLite.includes('wrap-lite8')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite8'));
                              }
                              // Clear \"Lite Roasted Red Peppers\" if trying to select \"No Roasted Red Peppers\"
                              if (topping.id === 'wrap-no10' && selectedWrapLite.includes('wrap-lite9')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite9'));
                              }
                              // Italian Wrap exclusions
                              // Clear "Lite Ham" if trying to select "No Ham"
                              if (topping.id === 'wrap-no-ham' && selectedWrapLite.includes('wrap-lite-ham')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite-ham'));
                              }
                              // Clear "Lite Capicola" if trying to select "No Capicola"
                              if (topping.id === 'wrap-no-capicola' && selectedWrapLite.includes('wrap-lite-capicola')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite-capicola'));
                              }
                              // Clear "Lite Salami" if trying to select "No Salami"
                              if (topping.id === 'wrap-no-salami' && selectedWrapLite.includes('wrap-lite-salami')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite-salami'));
                              }
                              // Clear \"Lite Lettuce\" if trying to select \"No Lettuce\"
                              if (topping.id === 'wrap-no11' && selectedWrapLite.includes('wrap-lite10')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite10'));
                              }
                              // Clear \"Lite Tomatoes\" if trying to select \"No Tomatoes\"
                              if (topping.id === 'wrap-no12' && selectedWrapLite.includes('wrap-lite11')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite11'));
                              }
                              // Clear \"Lite Raw Onions\" if trying to select \"No Raw Onions\"
                              if (topping.id === 'wrap-no13' && selectedWrapLite.includes('wrap-lite12')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite12'));
                              }
                              // Clear \"Lite Oregano\" if trying to select \"No Oregano\"
                              if (topping.id === 'wrap-no14' && selectedWrapLite.includes('wrap-lite13')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite13'));
                              }
                              // Clear \"Lite Oil\" if trying to select \"No Oil\"
                              if (topping.id === 'wrap-no15' && selectedWrapLite.includes('wrap-lite14')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite14'));
                              }
                              // Clear \"Lite Vinegar\" if trying to select \"No Vinegar\"
                              if (topping.id === 'wrap-no16' && selectedWrapLite.includes('wrap-lite15')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite15'));
                              }
                              // Tuna Wrap exclusions
                              // Clear \"Lite Lettuce\" if trying to select \"No Lettuce\"
                              if (topping.id === 'wrap-no17' && selectedWrapLite.includes('wrap-lite16')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite16'));
                              }
                              // Clear \"Lite Oregano\" if trying to select \"No Oregano\"
                              if (topping.id === 'wrap-no18' && selectedWrapLite.includes('wrap-lite17')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite17'));
                              }
                              // Clear \"Lite Tomatoes\" if trying to select \"No Tomatoes\"
                              if (topping.id === 'wrap-no19' && selectedWrapLite.includes('wrap-lite18')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite18'));
                              }
                              // Turkey Wrap exclusions
                              // Clear \"Lite Lettuce\" if trying to select \"No Lettuce\"
                              if (topping.id === 'wrap-no20' && selectedWrapLite.includes('wrap-lite19')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite19'));
                              }
                              // Clear \"Lite Tomatoes\" if trying to select \"No Tomatoes\"
                              if (topping.id === 'wrap-no21' && selectedWrapLite.includes('wrap-lite20')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite20'));
                              }
                              // Clear \"Lite Oregano\" if trying to select \"No Oregano\"
                              if (topping.id === 'wrap-no22' && selectedWrapLite.includes('wrap-lite21')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite21'));
                              }
                              // Clear \"Lite Raw Onions\" if trying to select \"No Raw Onions\"
                              if (topping.id === 'wrap-no23' && selectedWrapLite.includes('wrap-lite22')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite22'));
                              }
                              // Veggie Wrap exclusions
                              // Clear \"Lite Grilled Eggplant\" if trying to select \"No Grilled Eggplant\"
                              if (topping.id === 'wrap-no24' && selectedWrapLite.includes('wrap-lite23')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite23'));
                              }
                              // Clear \"Lite Grilled Zucchini\" if trying to select \"No Grilled Zucchini\"
                              if (topping.id === 'wrap-no25' && selectedWrapLite.includes('wrap-lite24')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite24'));
                              }
                              // Clear \"Lite Roasted Red Peppers\" if trying to select \"No Roasted Red Peppers\"
                              if (topping.id === 'wrap-no26' && selectedWrapLite.includes('wrap-lite25')) {
                                setSelectedWrapLite(selectedWrapLite.filter(id => id !== 'wrap-lite25'));
                              }
                              setSelectedWrapNo([...selectedWrapNo, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-[#F6F6F6] border border-gray-200 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                            isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                          }`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side of Chips Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side of Extra Chips (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="bg-[#F6F6F6] border border-gray-200 rounded-lg p-4">
                      <div className="flex items-center justify-between">
                        <span className="text-gray-900">Extra Chips - $1.00</span>
                        <div className="flex items-center gap-3">
                          <button
                            onClick={() => setWrapChipsQuantity(Math.max(0, wrapChipsQuantity - 1))}
                            className="w-8 h-8 flex items-center justify-center rounded border border-gray-300 hover:bg-gray-50 transition-colors"
                          >
                            <Minus className="w-4 h-4 text-gray-600" />
                          </button>
                          <span className="w-8 text-center text-gray-900">{wrapChipsQuantity}</span>
                          <button
                            onClick={() => setWrapChipsQuantity(wrapChipsQuantity + 1)}
                            className="w-8 h-8 flex items-center justify-center rounded border border-gray-300 hover:bg-gray-50 transition-colors"
                          >
                            <Plus className="w-4 h-4 text-gray-600" />
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Side Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {wrapSideToppings.map((topping) => {
                      const isSelected = selectedWrapSide.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedWrapSide(selectedWrapSide.filter(id => id !== topping.id));
                            } else {
                              setSelectedWrapSide([...selectedWrapSide, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          {topping.image && (
                            <div className="w-14 h-14 flex-shrink-0 relative">
                              <ImageWithFallback                                 src={topping.name.toLowerCase().includes('tomato') ? 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400' : topping.image} 
                                alt={topping.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                          )}
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Traditional Dinners Customization */}
          {product.category === 'traditional-dinners' && (
            <div ref={traditionalDinnersSidesRef}>
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Sides</span>
                        <span className="text-black font-bold" style={{fontSize: 'calc(1em + 3px)'}}>(Required - Choose 2)</span>
                      </div>
                    </div>
                    {isAdditionalOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sides Section */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {traditionalDinnersSides.filter(side => 
                      !['td-side1', 'td-side3', 'td-side6', 'td-side8', 'td-side9', 'td-side11', 'td-side12', 'td-side14'].includes(side.id)
                    ).map((side) => {
                        const isSelected = selectedTraditionalDinnersSides.includes(side.id);
                        const canSelect = selectedTraditionalDinnersSides.length < 2 || isSelected;
                        return (
                          <div
                            key={side.id}
                            onClick={() => {
                              if (!canSelect && !isSelected) return;
                              if (isSelected) {
                                setSelectedTraditionalDinnersSides(selectedTraditionalDinnersSides.filter(id => id !== side.id));
                              } else {
                                setSelectedTraditionalDinnersSides([...selectedTraditionalDinnersSides, side.id]);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            } ${!canSelect && !isSelected ? 'opacity-50 cursor-not-allowed' : ''}`}
                          >
                            {side.image && (
                              <div className="flex-shrink-0 relative" style={{ height: '56px', width: '56px', overflow: 'hidden' }}>
                                <ImageWithFallback                                   src={side.image} 
                                  alt={side.name}
                                  className="object-cover"
                                  style={{ width: '56px', height: '56px', objectFit: 'cover', position: 'absolute', top: 0, left: 0 }}
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                {!side.image && (
                                  <Circle 
                                    className={`w-5 h-5 flex-shrink-0 ${
                                      isSelected 
                                        ? 'fill-[#a6bba1] text-[#a6bba1]' 
                                        : 'text-gray-300'
                                    }`}
                                  />
                                )}
                                <p className="text-gray-900">{side.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">+${side.price?.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>

                  {/* Traditional Dinners Error Message */}
                  {traditionalDinnersSidesError && (
                    <div className="mt-2 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2">
                      <span className="text-red-600 text-sm">Please select exactly 2 sides to continue.</span>
                    </div>
                  )}

                  {/* Side Soups, Salads, & Extra Bread Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side Soups, Salads, & Extra Bread (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {traditionalDinnersSoupsSalads.map((item) => {
                        const isSelected = selectedTraditionalDinnersSoupsSalads.includes(item.id);
                        return (
                          <div
                            key={item.id}
                            className={`flex items-center gap-0 h-14 rounded-lg overflow-hidden bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            {item.image && (
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={item.image} 
                                  alt={item.name}
                                  className="w-full h-full object-cover"
                                />
                              </div>
                            )}
                            <div className="flex-1 flex items-center justify-between px-4 h-full">
                              {item.id === 'td-extra1' ? (
                                <>
                                  <p className="text-gray-900">{item.name}</p>
                                  <div className="flex items-center gap-2">
                                    <span className="text-sm text-gray-900 mr-2">
                                      ${item.price?.toFixed(2)}
                                    </span>
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        setExtraBreadQuantity(Math.max(0, extraBreadQuantity - 1));
                                      }}
                                      className="w-8 h-8 flex items-center justify-center rounded-lg border border-gray-300 hover:border-[#A72020] hover:bg-[#A72020] hover:text-white transition-colors"
                                    >
                                      <Minus className="w-4 h-4" />
                                    </button>
                                    <span className="w-8 text-center font-semibold">{extraBreadQuantity}</span>
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        setExtraBreadQuantity(extraBreadQuantity + 1);
                                      }}
                                      className="w-8 h-8 flex items-center justify-center rounded-lg border border-gray-300 hover:border-[#A72020] hover:bg-[#A72020] hover:text-white transition-colors"
                                    >
                                      <Plus className="w-4 h-4" />
                                    </button>
                                  </div>
                                </>
                              ) : (
                                <>
                                  <div 
                                    onClick={() => {
                                      if (isSelected) {
                                        setSelectedTraditionalDinnersSoupsSalads(selectedTraditionalDinnersSoupsSalads.filter(id => id !== item.id));
                                      } else {
                                        setSelectedTraditionalDinnersSoupsSalads([...selectedTraditionalDinnersSoupsSalads, item.id]);
                                      }
                                    }}
                                    className="flex-1 cursor-pointer"
                                  >
                                    <p className="text-gray-900">{item.name}</p>
                                  </div>
                                  <span className="text-sm text-gray-900">
                                    ${item.price?.toFixed(2)}
                                  </span>
                                  {item.id === 'td-extra5' && (
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        setShowSoupDialog(true);
                                      }}
                                      className="ml-2 p-1.5 hover:bg-gray-200 rounded-lg transition-colors"
                                    >
                                      <MoreVertical className="w-6 h-6 text-gray-900" />
                                    </button>
                                  )}
                                  {item.id === 'td-extra2' && item.removableIngredients && (
                                    <Popover>
                                      <PopoverTrigger asChild>
                                        <button
                                          onClick={(e) => e.stopPropagation()}
                                          className="ml-2 p-1.5 hover:bg-gray-200 rounded-lg transition-colors"
                                        >
                                          <MoreVertical className="w-6 h-6 text-gray-900" />
                                        </button>
                                      </PopoverTrigger>
                                      <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                        <div className="bg-[#A72020] text-white px-4 py-3 flex items-center justify-between">
                                          <span className="font-semibold">Uncheck to Remove From Salad</span>
                                        </div>
                                        <div className="p-4 max-h-64 overflow-y-auto">
                                          <div className="grid grid-cols-3 gap-3">
                                            {item.removableIngredients.map((ingredient) => {
                                              const isRemoved = sideGardenSaladRemovedIngredients.includes(ingredient.id);
                                              return (
                                                <button
                                                  key={ingredient.id}
                                                  onClick={(e) => {
                                                    e.stopPropagation();
                                                    let newRemovals;
                                                    if (isRemoved) {
                                                      newRemovals = sideGardenSaladRemovedIngredients.filter(id => id !== ingredient.id);
                                                    } else {
                                                      newRemovals = [...sideGardenSaladRemovedIngredients, ingredient.id];
                                                    }
                                                    setSideGardenSaladRemovedIngredients(newRemovals);
                                                    
                                                    console.log('[TD_SALAD_TOGGLE]', { 
                                                      salad: 'garden', 
                                                      ingredient: ingredient.name, 
                                                      checked: isRemoved,
                                                      removedNext: newRemovals 
                                                    });
                                                  }}
                                                  className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                    isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                                  }`}
                                                >
                                                  {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                                  <span className="text-center leading-tight">{ingredient.name}</span>
                                                </button>
                                              );
                                            })}
                                          </div>
                                        </div>
                                      </PopoverContent>
                                    </Popover>
                                  )}
                                  {item.id === 'td-extra3' && item.removableIngredients && (
                                    <Popover>
                                      <PopoverTrigger asChild>
                                        <button
                                          onClick={(e) => e.stopPropagation()}
                                          className="ml-2 p-1.5 hover:bg-gray-200 rounded-lg transition-colors"
                                        >
                                          <MoreVertical className="w-6 h-6 text-gray-900" />
                                        </button>
                                      </PopoverTrigger>
                                      <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                        <div className="bg-[#A72020] text-white px-4 py-3 flex items-center justify-between">
                                          <span className="font-semibold">Uncheck to Remove From Salad</span>
                                        </div>
                                        <div className="p-4 max-h-64 overflow-y-auto">
                                          <div className="grid grid-cols-2 gap-3">
                                            {item.removableIngredients.map((ingredient) => {
                                              const isRemoved = sideCaesarSaladRemovedIngredients.includes(ingredient.id);
                                              return (
                                                <button
                                                  key={ingredient.id}
                                                  onClick={(e) => {
                                                    e.stopPropagation();
                                                    let newRemovals;
                                                    if (isRemoved) {
                                                      newRemovals = sideCaesarSaladRemovedIngredients.filter(id => id !== ingredient.id);
                                                    } else {
                                                      newRemovals = [...sideCaesarSaladRemovedIngredients, ingredient.id];
                                                    }
                                                    setSideCaesarSaladRemovedIngredients(newRemovals);
                                                    
                                                    console.log('[TD_SALAD_TOGGLE]', { 
                                                      salad: 'caesar', 
                                                      ingredient: ingredient.name, 
                                                      checked: isRemoved,
                                                      removedNext: newRemovals 
                                                    });
                                                  }}
                                                  className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                    isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                                  }`}
                                                >
                                                  {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                                  <span className="text-center leading-tight">{ingredient.name}</span>
                                                </button>
                                              );
                                            })}
                                          </div>
                                        </div>
                                      </PopoverContent>
                                    </Popover>
                                  )}
                                </>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>

                  {/* Special Instructions Section - Only for Chicken Parmigiana */}
                  {product.name === 'Chicken Parmigiana' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {bakedPastaSpecialInstructions.map((instruction) => {
                          const isSelected = selectedExtraSauce.includes(instruction.id);
                          return (
                            <div
                              key={instruction.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedExtraSauce(selectedExtraSauce.filter(id => id !== instruction.id));
                                } else {
                                  setSelectedExtraSauce([...selectedExtraSauce, instruction.id]);
                                }
                              }}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <div className="flex items-center gap-3">
                                  <div className="w-5 h-5 flex-shrink-0">
                                    {isSelected ? (
                                      <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                        <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                    )}
                                  </div>
                                  <p className="text-gray-900">{instruction.name}</p>
                                </div>
                                <span className="text-sm text-gray-900">
                                  {instruction.price > 0 ? `$${instruction.price.toFixed(2)}` : ''}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Fish Customization */}
          {product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12') && (
            <div ref={traditionalDinnersSidesRef}>
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Sides (Required - Choose 2)</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  {/* Sides Section */}

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {traditionalDinnersSides.filter(side => 
                      !['td-side1', 'td-side3', 'td-side6', 'td-side9', 'td-side11', 'td-side12', 'td-side14'].includes(side.id)
                    ).map((side) => {
                        const isSelected = selectedTraditionalDinnersSides.includes(side.id);
                        const canSelect = selectedTraditionalDinnersSides.length < 2 || isSelected;
                        return (
                          <div
                            key={side.id}
                            onClick={() => {
                              if (!canSelect && !isSelected) return;
                              
                              const newSelection = isSelected 
                                ? selectedTraditionalDinnersSides.filter(id => id !== side.id)
                                : [...selectedTraditionalDinnersSides, side.id];
                              
                              setSelectedTraditionalDinnersSides(newSelection);
                              
                              if (newSelection.length === 2) {
                                setTraditionalDinnersSidesError(false);
                              }
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            } ${!canSelect && !isSelected ? 'opacity-50 cursor-not-allowed' : ''}`}
                          >
                            {side.image && (
                              <div className="flex-shrink-0 relative" style={{ height: '56px', width: '56px', overflow: 'hidden' }}>
                                <ImageWithFallback                                   src={side.image} 
                                  alt={side.name}
                                  className="object-cover"
                                  style={{ width: '56px', height: '56px', objectFit: 'cover', position: 'absolute', top: 0, left: 0 }}
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                {!side.image && (
                                  <Circle 
                                    className={`w-5 h-5 flex-shrink-0 ${
                                      isSelected 
                                        ? 'fill-[#a6bba1] text-[#a6bba1]' 
                                        : 'text-gray-300'
                                    }`}
                                  />
                                )}
                                <p className="text-gray-900">{side.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">+${side.price?.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>

                  {/* Fish Error Message */}
                  {traditionalDinnersSidesError && (
                    <div className="flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4 text-red-800 mt-4">
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <span>Please select exactly 2 sides to continue.</span>
                    </div>
                  )}

                  {/* Side Soups, Salads, & Extra Bread Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                    <span className="font-semibold">Side Soups, Salads, & Extra Bread (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {traditionalDinnersSoupsSalads.map((item) => {
                        const isSelected = selectedTraditionalDinnersSoupsSalads.includes(item.id);
                        return (
                          <div
                            key={item.id}
                            className={`flex items-center gap-0 h-14 rounded-lg overflow-hidden bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            {item.image && (
                              <div className="w-14 h-14 flex-shrink-0 relative">
                                <ImageWithFallback                                   src={item.image} 
                                  alt={item.name}
                                  className="w-full h-full object-cover"
                                />
                              </div>
                            )}
                            <div className="flex-1 flex items-center justify-between px-4 h-full">
                              {item.id === 'td-extra1' ? (
                                <>
                                  <p className="text-gray-900">{item.name}</p>
                                  <div className="flex items-center gap-2">
                                    <span className="text-sm text-gray-900 mr-2">
                                      ${item.price?.toFixed(2)}
                                    </span>
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        setExtraBreadQuantity(Math.max(0, extraBreadQuantity - 1));
                                      }}
                                      className="w-8 h-8 flex items-center justify-center rounded-lg border border-gray-300 hover:border-[#A72020] hover:bg-[#A72020] hover:text-white transition-colors"
                                    >
                                      <Minus className="w-4 h-4" />
                                    </button>
                                    <span className="w-8 text-center font-semibold">{extraBreadQuantity}</span>
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        setExtraBreadQuantity(extraBreadQuantity + 1);
                                      }}
                                      className="w-8 h-8 flex items-center justify-center rounded-lg border border-gray-300 hover:border-[#A72020] hover:bg-[#A72020] hover:text-white transition-colors"
                                    >
                                      <Plus className="w-4 h-4" />
                                    </button>
                                  </div>
                                </>
                              ) : (
                                <>
                                  <div 
                                    onClick={() => {
                                      if (isSelected) {
                                        setSelectedTraditionalDinnersSoupsSalads(selectedTraditionalDinnersSoupsSalads.filter(id => id !== item.id));
                                      } else {
                                        setSelectedTraditionalDinnersSoupsSalads([...selectedTraditionalDinnersSoupsSalads, item.id]);
                                      }
                                    }}
                                    className="flex-1 cursor-pointer"
                                  >
                                    <p className="text-gray-900">{item.name}</p>
                                  </div>
                                  <span className="text-sm text-gray-900">
                                    ${item.price?.toFixed(2)}
                                  </span>
                                  {item.id === 'td-extra5' && (
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        setShowSoupDialog(true);
                                      }}
                                      className="ml-2 p-1.5 hover:bg-gray-200 rounded-lg transition-colors"
                                    >
                                      <MoreVertical className="w-6 h-6 text-gray-900" />
                                    </button>
                                  )}
                                  {item.id === 'td-extra2' && item.removableIngredients && (
                                    <Popover>
                                      <PopoverTrigger asChild>
                                        <button
                                          onClick={(e) => e.stopPropagation()}
                                          className="ml-2 p-1.5 hover:bg-gray-200 rounded-lg transition-colors"
                                        >
                                          <MoreVertical className="w-6 h-6 text-gray-900" />
                                        </button>
                                      </PopoverTrigger>
                                      <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                        <div className="bg-[#A72020] text-white px-4 py-3 flex items-center justify-between">
                                          <span className="font-semibold">Uncheck to Remove From Salad</span>
                                        </div>
                                        <div className="p-4 max-h-64 overflow-y-auto">
                                          <div className="grid grid-cols-3 gap-3">
                                            {item.removableIngredients.map((ingredient) => {
                                              const isRemoved = sideGardenSaladRemovedIngredients.includes(ingredient.id);
                                              return (
                                                <button
                                                  key={ingredient.id}
                                                  onClick={(e) => {
                                                    e.stopPropagation();
                                                    let newRemovals;
                                                    if (isRemoved) {
                                                      newRemovals = sideGardenSaladRemovedIngredients.filter(id => id !== ingredient.id);
                                                    } else {
                                                      newRemovals = [...sideGardenSaladRemovedIngredients, ingredient.id];
                                                    }
                                                    setSideGardenSaladRemovedIngredients(newRemovals);
                                                    
                                                    console.log('[TD_SALAD_TOGGLE]', { 
                                                      salad: 'garden', 
                                                      ingredient: ingredient.name, 
                                                      checked: isRemoved,
                                                      removedNext: newRemovals 
                                                    });
                                                  }}
                                                  className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                    isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                                  }`}
                                                >
                                                  {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                                  <span className="text-center leading-tight">{ingredient.name}</span>
                                                </button>
                                              );
                                            })}
                                          </div>
                                        </div>
                                      </PopoverContent>
                                    </Popover>
                                  )}
                                  {item.id === 'td-extra3' && item.removableIngredients && (
                                    <Popover>
                                      <PopoverTrigger asChild>
                                        <button
                                          onClick={(e) => e.stopPropagation()}
                                          className="ml-2 p-1.5 hover:bg-gray-200 rounded-lg transition-colors"
                                        >
                                          <MoreVertical className="w-6 h-6 text-gray-900" />
                                        </button>
                                      </PopoverTrigger>
                                      <PopoverContent className="w-[400px] p-0 rounded-lg overflow-hidden" align="end">
                                        <div className="bg-[#A72020] text-white px-4 py-3 flex items-center justify-between">
                                          <span className="font-semibold">Uncheck to Remove From Salad</span>
                                        </div>
                                        <div className="p-4 max-h-64 overflow-y-auto">
                                          <div className="grid grid-cols-2 gap-3">
                                            {item.removableIngredients.map((ingredient) => {
                                              const isRemoved = sideCaesarSaladRemovedIngredients.includes(ingredient.id);
                                              return (
                                                <button
                                                  key={ingredient.id}
                                                  onClick={(e) => {
                                                    e.stopPropagation();
                                                    let newRemovals;
                                                    if (isRemoved) {
                                                      newRemovals = sideCaesarSaladRemovedIngredients.filter(id => id !== ingredient.id);
                                                    } else {
                                                      newRemovals = [...sideCaesarSaladRemovedIngredients, ingredient.id];
                                                    }
                                                    setSideCaesarSaladRemovedIngredients(newRemovals);
                                                    
                                                    console.log('[TD_SALAD_TOGGLE]', { 
                                                      salad: 'caesar', 
                                                      ingredient: ingredient.name, 
                                                      checked: isRemoved,
                                                      removedNext: newRemovals 
                                                    });
                                                  }}
                                                  className={`px-4 py-3 rounded-lg text-white font-semibold transition-all flex items-center justify-center gap-2 min-h-[56px] ${
                                                    isRemoved ? 'bg-gray-500' : 'bg-[#A72020]'
                                                  }`}
                                                >
                                                  {!isRemoved && <Check className="w-4 h-4 flex-shrink-0" />}
                                                  <span className="text-center leading-tight">{ingredient.name}</span>
                                                </button>
                                              );
                                            })}
                                          </div>
                                        </div>
                                      </PopoverContent>
                                    </Popover>
                                  )}
                                </>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>

                  {/* Special Instructions Section for Fish */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6">
                    <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Special Instructions (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {fishSpecialInstructions.filter(i => i.name !== 'Well Done').map((instruction) => {
                      const isSelected = selectedExtraSauce.includes(instruction.id);
                      return (
                        <div
                          key={instruction.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedExtraSauce(selectedExtraSauce.filter(id => id !== instruction.id));
                            } else {
                              setSelectedExtraSauce([...selectedExtraSauce, instruction.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <div className="flex items-center gap-3">
                              <div className="w-5 h-5 flex-shrink-0">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                              <p className="text-gray-900">{instruction.name}</p>
                            </div>
                            <span className="text-sm text-gray-900">
                              {instruction.price > 0 ? `$${instruction.price.toFixed(2)}` : 'Free'}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
            </div>
          )}

          {/* Toppings sections - Only for pizzas and slices */}
          {(product.category === 'pizzas' || product.category === 'by-the-slice' || (product.category === 'stromboli-calzone' && product.id !== 'stromboli-8') || product.category === 'brooklyn-pizza' || product.category === 'specialty-pizza') && (
            <>
              {/* 0. Sauce - Only for pizzas */}
              {((
                 (product.category === 'pizzas') && 
                 !['cyo-gf12', 'cyo-cauliflower', 'cyo-minucci', 'cyo-sicilian-pesto'].includes(product.id)
               ) || 
               (
                 product.category === 'specialty-pizza' && 
                 ['sp-10', 'sp-12', 'sp-15'].includes(product.id)
               )) && (
              <Collapsible open={isSauceOpen} onOpenChange={setIsSauceOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between mb-4">
                    <div className="flex flex-col items-start gap-1">
                      <div className="flex items-center gap-2">
                        <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>
                          {['sp-10', 'sp-12', 'sp-15'].includes(product.id) ? 'Sauce (Required):' : 'Sauce (Optional):'}
                        </span>
                      </div>
                    </div>
                    {isSauceOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5 mb-6">
                  <div className="relative z-10 space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {sauceOptions.map((sauce) => {
                        const isSelected = selectedSauces.includes(sauce.id);
                        const distribution = sauceDistribution[sauce.id] || 'whole';
                        const isSpecialtySaucePizza = ['sp-10', 'sp-12', 'sp-15'].includes(product.id);
                        
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => {
                              handleSauceToggle(sauce.id);
                            }}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] cursor-pointer ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="pl-4 flex-shrink-0">
                              <div className="w-5 h-5">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                    <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                )}
                              </div>
                            </div>
                            <div className="flex-1 flex items-center justify-between px-4 h-14 gap-3">
                              <p className="text-gray-900 font-medium">
                                {(() => {
                                  if (isSpecialtySaucePizza) {
                                      return sauce.name;
                                  }

                                  const isWhitePizza = product.id === 'cyo-white';
                                  let baseName = sauce.name;
                                  
                                  if (sauce.id === 'sauce-pizza') {
                                    baseName = isWhitePizza ? 'White Sauce' : 'Red Sauce';
                                  }
                                  
                                  if (!isSelected) return baseName;
                                  
                                  if (baseName === 'Red Sauce') {
                                    if (distribution === 'left') return 'Left Half White Pizza';
                                    if (distribution === 'right') return 'Right Half White Pizza';
                                  }

                                  if (baseName === 'White Sauce' && isWhitePizza) {
                                    if (distribution === 'left') return 'Left Half Red Pizza';
                                    if (distribution === 'right') return 'Right Half Red Pizza';
                                  }

                                  if (distribution === 'left') return `Left Half ${baseName}, Right Half No ${baseName}`;
                                  if (distribution === 'right') return `Right Half ${baseName}, Left Half No ${baseName}`;
                                  return baseName;
                                })()}
                              </p>
                              <div className="flex items-center gap-3" onClick={(e) => e.stopPropagation()}>
                                {isSelected && !isSpecialtySaucePizza && (
                                  <div className="flex gap-1">
                                    <DistributionIcon 
                                      type="left" 
                                      isActive={distribution === 'left'} 
                                      isInverted={product.id === 'cyo-white'}
                                      onClick={() => {
                                        handleSauceDistributionChange(sauce.id, 'left');
                                      }} 
                                    />
                                    <DistributionIcon 
                                      type="whole" 
                                      isActive={distribution === 'whole'} 
                                      isInverted={product.id === 'cyo-white'}
                                      onClick={() => {
                                        handleSauceDistributionChange(sauce.id, 'whole');
                                      }} 
                                    />
                                    <DistributionIcon 
                                      type="right" 
                                      isActive={distribution === 'right'} 
                                      isInverted={product.id === 'cyo-white'}
                                      onClick={() => {
                                        handleSauceDistributionChange(sauce.id, 'right');
                                      }} 
                                    />
                                  </div>
                                )}
                                {sauce.price > 0 && <span className="text-sm text-gray-900">+${sauce.price.toFixed(2)}</span>}
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  {sauceError && (
                    <div 
                      ref={sauceErrorRef}
                      className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mt-5 rounded-r-lg flex items-center gap-3"
                      role="alert"
                    >
                      <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                      </svg>
                      <p className="font-semibold">Please select a sauce option</p>
                    </div>
                  )}
                </CollapsibleContent>
              </Collapsible>
              )}

              {/* Extra Dipping - Moved up for Buffalo Chicken Stromboli */}
              {product.category === 'stromboli-calzone' && product.name === 'Buffalo Chicken Stromboli' && (
                  <>
                    {/* Extra Sauce Section - Collapsible */}
                    <Collapsible open={isExtraDippingOpen} onOpenChange={setIsExtraDippingOpen} className="mt-6">
                      <CollapsibleTrigger asChild>
                        <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                          <div className="flex flex-col items-start gap-1">
                            <div className="flex items-center gap-2">
                              <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Choose Your Dipping Sauce (Required)</span>
                            </div>
                          </div>
                          {isExtraDippingOpen ? <ChevronUp className="w-6 h-6" /> : <ChevronDown className="w-6 h-6" />}
                        </button>
                      </CollapsibleTrigger>
                      <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                        <div 
                          className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                          style={{ 
                            backgroundImage: `url(${backgroundTexture})`,
                            backgroundSize: 'cover',
                            backgroundPosition: 'center'
                          }}
                        />
                        <div className="relative z-10 space-y-6">
                            {dippingError && (
                              <div 
                                ref={dippingErrorRef}
                                className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mb-4 rounded-r-lg flex items-center gap-3"
                                role="alert"
                              >
                                <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                                </svg>
                                <p className="font-semibold">Please select a sauce option</p>
                              </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                  {[
                                    { id: 'bc', name: 'Bleu Cheese', price: 0, image: 'https://drive.google.com/thumbnail?id=1l7hbAOb2nRDIZhvXO-PiCHf11TT6ETHa&sz=w1000' },
                                    { id: 'br', name: 'Buttermilk Ranch', price: 0, image: 'https://drive.google.com/thumbnail?id=1gg-seSYp4hX9UT15c7A9ZrGTM1TJ5yyn&sz=w1000' },
                                    { id: 'none', name: 'None', price: 0, image: null }
                                  ].map((dipping) => {
                                    const isSelected = selectedExtraSauce.includes(dipping.id);
                                    
                                    return (
                                      <div
                                        key={dipping.id}
                                        onClick={() => {
                                          if (selectedExtraSauce.includes(dipping.id)) {
                                            setSelectedExtraSauce([]);
                                          } else {
                                            setSelectedExtraSauce([dipping.id]);
                                            setDippingError(false);
                                          }
                                        }}
                                        className={`flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] cursor-pointer ${
                                          isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                                        }`}
                                      >
                                        <div className="w-14 h-14 flex-shrink-0 relative bg-white">
                                          {dipping.image ? (
                                            <ImageWithFallback                                               src={dipping.image} 
                                              alt={dipping.name} 
                                              className="w-full h-full object-cover" 
                                            />
                                          ) : (
                                            <div className="w-full h-full flex items-center justify-center bg-gray-100"></div>
                                          )}
                                          
                                          {isSelected && (
                                            <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                              <div className="bg-white rounded-full p-0.5">
                                                <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                              </div>
                                            </div>
                                          )}
                                        </div>
                                        <div className="flex-1 flex items-center justify-between px-4 h-14 gap-3">
                                          <p className="text-gray-900 font-medium text-sm">
                                            {dipping.name}
                                          </p>
                                        </div>
                                      </div>
                                    );
                                  })}
                            </div>
                        </div>
                      </CollapsibleContent>
                    </Collapsible>
                  </>
              )}

              {/* 1. Additional Toppings */}
              <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
            <CollapsibleTrigger asChild>
              <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                <div className="flex flex-col items-start gap-1">
                  <div className="flex items-center gap-2">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Additional Toppings (Optional):</span>
                  </div>
                </div>
                {isAdditionalOpen ? (
                  <ChevronUp className="w-6 h-6" />
                ) : (
                  <ChevronDown className="w-6 h-6" />
                )}
              </button>
            </CollapsibleTrigger>
            <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
              {/* Background texture with opacity */}
              <div 
                className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                style={{ 
                  backgroundImage: `url(${backgroundTexture})`,
                  backgroundSize: 'cover',
                  backgroundPosition: 'center'
                }}
              />
              <div className="relative z-10 space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {[
                    ...(product.name === 'Buffalo Chicken Stromboli' ? [
                      { id: 'side-bc', name: 'Bleu Cheese', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1l7hbAOb2nRDIZhvXO-PiCHf11TT6ETHa&sz=w1000', isSide: true },
                      { id: 'side-br', name: 'Buttermilk Ranch', price: 0.99, image: 'https://drive.google.com/thumbnail?id=1gg-seSYp4hX9UT15c7A9ZrGTM1TJ5yyn&sz=w1000', isSide: true }
                    ] : []),
                    ...[...additionalToppings].sort((a, b) => {
                    const toppingOrder: Record<string, number> = {
                      'extra cheese': 1,
                      'pepperoni': 2,
                      'sausage': 3,
                      'fresh mozzarella': 4,
                      'cup n char pepperoni': 5,
                      'cup & char pepperoni': 5,
                      'mushrooms': 6,
                      'bacon': 7,
                      'ham': 8,
                      'sliced meatballs': 9,
                      'beef steak': 10,
                      'chicken steak': 11,
                      'grilled chicken': 12,
                      'chopped tomato': 13,
                      'ricotta cheese': 14,
                      'ricotta': 14,
                      'broccoli florets': 15,
                      'broccoli': 15,
                      'spinach': 16,
                      'grilled onions': 17,
                      'mix grilled peppers': 18,
                      'roasted peppers': 19,
                      'roasted red peppers': 19,
                      'zucchini': 20,
                      'eggplant': 21,
                      'mix sweet peppers': 22,
                      'mixed sweet peppers': 22,
                      'artichokes': 23,
                      'sundried tomatoes': 24,
                      'sun dried tomatoes': 24,
                      'hot cherry peppers': 25,
                      'sliced hot cherry peppers': 25,
                      'pineapple': 26,
                      'black olives': 27,
                      'sliced black olives': 27,
                      'raw onions': 28,
                      'chopped garlic': 29,
                      'anchovies': 30,
                      'banana peppers': 31,
                      'sliced tomatoes': 32,
                      'sliced tomato': 32,
                      'mike\'s hot honey': 33,
                      'mikes hot honey': 33,
                    };
                    const normalizeA = a.name.toLowerCase().trim();
                    const normalizeB = b.name.toLowerCase().trim();
                    const orderA = toppingOrder[normalizeA] || 999;
                    const orderB = toppingOrder[normalizeB] || 999;
                    return orderA - orderB;
                  })].map((topping: any) => {
                    if (topping.isSide) {
                      const qty = extraSideSauces[topping.id] || 0;
                      const isSelected = qty > 0;
                      return (
                        <div
                          key={topping.id}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] transition-colors ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative bg-white">
                            <ImageWithFallback                               src={topping.image} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 h-14 gap-3">
                            <div className="flex flex-col justify-center min-w-0">
                                <p className="text-gray-900 leading-tight text-sm font-medium truncate">
                                  {topping.name}
                                </p>
                                <span className="text-xs text-gray-500 font-semibold">+$0.99</span>
                            </div>
                            <div className="flex items-center gap-2" onClick={e => e.stopPropagation()}>
                              {isSelected ? (
                                <>
                                  <button 
                                    onClick={() => setExtraSideSauces(prev => ({ ...prev, [topping.id]: Math.max(0, (prev[topping.id] || 0) - 1) }))}
                                    className="w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 hover:bg-gray-300 flex-shrink-0"
                                  >
                                    <Minus className="w-3 h-3" />
                                  </button>
                                  <span className="text-sm font-bold w-4 text-center">{qty}</span>
                                  <button 
                                    onClick={() => setExtraSideSauces(prev => ({ ...prev, [topping.id]: (prev[topping.id] || 0) + 1 }))}
                                    className="w-7 h-7 rounded-full bg-[#A72020] flex items-center justify-center text-white hover:bg-[#8B1B1B] flex-shrink-0"
                                  >
                                    <Plus className="w-3 h-3" />
                                  </button>
                                </>
                              ) : (
                                <button 
                                    onClick={() => setExtraSideSauces(prev => ({ ...prev, [topping.id]: 1 }))}
                                    className="w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-gray-400 hover:bg-[#A72020] hover:text-white transition-colors flex-shrink-0"
                                  >
                                    <Plus className="w-4 h-4" />
                                  </button>
                              )}
                            </div>
                          </div>
                        </div>
                      );
                    }
                    const isSelected = selectedToppings.includes(topping.id);
                    const distribution = toppingDistribution[topping.id] || 'whole';
                    return (
                      <div
                        key={topping.id}
                        onClick={() => handleToppingToggle(topping.id)}
                        className={`flex items-center gap-0 rounded-lg overflow-hidden bg-[#F6F6F6] cursor-pointer ${
                          isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                        }`}
                      >
                        <div 
                          className="w-14 h-14 flex-shrink-0 relative"
                        >
                          <ImageWithFallback                             src={topping.image || PLACEHOLDER_TOPPING_IMAGE} 
                            alt={topping.name}
                            className="w-full h-full object-cover"
                          />
                          {isSelected && (
                            <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                              <div className="bg-white rounded-full p-0.5">
                                <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                              </div>
                            </div>
                          )}
                        </div>
                        <div className="flex-1 flex items-center justify-between px-4 h-14 gap-3">
                          <p className="text-gray-900">
                            {topping.name}
                          </p>
                          <div className="flex items-center gap-3" onClick={(e) => e.stopPropagation()}>
                            {isSelected && (product.category === 'pizzas' || product.category === 'specialty-pizza' || product.category === 'brooklyn-pizza') && (
                              <div className="flex gap-1">
                                <DistributionIcon 
                                  type="left" 
                                  isActive={distribution === 'left'} 
                                  onClick={() => handleDistributionChange(topping.id, 'left')}
                                />
                                <DistributionIcon 
                                  type="whole" 
                                  isActive={distribution === 'whole'} 
                                  onClick={() => handleDistributionChange(topping.id, 'whole')}
                                />
                                <DistributionIcon 
                                  type="right" 
                                  isActive={distribution === 'right'} 
                                  onClick={() => handleDistributionChange(topping.id, 'right')}
                                />
                              </div>
                            )}
                            <span className="text-sm text-gray-900">+${getToppingPrice(topping, distribution).toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                {/* Specialty Toppings - Only for pizzas (Excluded for Specialty Pizzas) */}
                {(product.category === 'pizzas') && (
                  <>
                    {/* Specialty Toppings Divider */}
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                      <span className="font-semibold">Specialty Toppings 1ST HALF (Optional - Choose up to 1)</span>
                    </div>

                    {/* Specialty Toppings Section */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {specialtyToppings.filter(topping => topping.name !== 'White').map((topping) => {
                        const isSelected = selectedToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => handleSpecialtyToppingToggle(topping.id, 'first')}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{topping.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">+${topping.price?.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>

                    {/* Specialty Toppings 2nd Half Divider */}
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                      <span className="font-semibold">Specialty Toppings 2ND HALF (Optional - Choose up to 1)</span>
                    </div>

                    {/* Specialty Toppings Second Half Section */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {specialtyToppingsSecondHalf.filter(topping => topping.name !== 'White').map((topping) => {
                        const isSelected = selectedToppings.includes(topping.id);
                        return (
                          <div
                            key={topping.id}
                            onClick={() => handleSpecialtyToppingToggle(topping.id, 'second')}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="flex-1 flex items-center justify-between px-4 py-3">
                              <div className="flex items-center gap-3">
                                <div className="w-5 h-5 flex-shrink-0">
                                  {isSelected ? (
                                    <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                      <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                    </div>
                                  ) : (
                                    <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                  )}
                                </div>
                                <p className="text-gray-900">{topping.name}</p>
                              </div>
                              <span className="text-sm text-gray-900">+${topping.price?.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </>
                )}

                {/* Extra Sauce - Only for stromboli and calzone */}
                {product.category === 'stromboli-calzone' && product.name !== 'Buffalo Chicken Stromboli' && (
                  <>
                    {/* Extra Sauce Divider */}
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6">
                      <span className="font-semibold">Extra Sauce (Optional)</span>
                    </div>

                    {dippingError && (
                      <div 
                        ref={dippingErrorRef}
                        className="bg-red-50 border-l-4 border-red-600 text-red-700 p-4 mt-5 rounded-r-lg flex items-center gap-3"
                        role="alert"
                      >
                        <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <p className="font-semibold">Please select a sauce option</p>
                      </div>
                    )}

                    {/* Extra Sauce Section */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
                      {extraSauceOptions.filter(sauce => !((product.id === 'stromboli-1' || product.name.toLowerCase().includes('turnover')) && sauce.id === 'es1')).map((sauce) => {
                          const isSelected = selectedExtraSauce.includes(sauce.id);
                          return (
                            <div
                              key={sauce.id}
                              onClick={() => handleExtraSauceToggle(sauce.id)}
                              className={`flex items-center justify-between gap-3 px-4 py-3 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                                isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                              }`}
                            >
                              <div className="flex items-center gap-3 flex-1">
                                <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                  isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                                }`}>
                                  {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                                </div>
                                <span className="text-gray-900">{sauce.name}</span>
                              </div>
                              <span className="text-gray-600">+${sauce.price.toFixed(2)}</span>
                            </div>
                          );
                        })
                      }
                    </div>
                  </>
                )}

                {/* Special Instructions - Only for pizzas and slices */}
                {product.category !== 'stromboli-calzone' && product.category !== 'brooklyn-pizza' && (
                  <>
                    {/* Special Instructions Divider */}
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6">
                      <span className="font-semibold">Special Instructions (Optional)</span>
                    </div>

                    {/* Special Instructions Section */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                      {(() => {
                        // Merge static special instructions with product-specific ones
                        const productSpecificInstructions = product.customizationOptions
                          ?.find(opt => opt.title === 'Special Instructions')
                          ?.options.map(opt => ({
                            id: opt.id,
                            name: opt.name,
                            price: opt.price === 0 ? '$0.00' : `$${opt.price.toFixed(2)}`
                          })) || [];
                        
                        // Combine unique instructions and remove Half White
                        let allInstructions = [
                          ...specialInstructionsOptions,
                          ...productSpecificInstructions.filter(d => !specialInstructionsOptions.some(s => s.id === d.id))
                        ].filter(item => item.name !== 'Half White');

                        // Filter for By the Slice items: Only Double Cut, Well Done, lightly cooked
                        if (product.id.startsWith('slice-')) {
                          const allowed = ['double cut', 'well done', 'lightly cooked'];
                          allInstructions = allInstructions.filter(item => allowed.includes(item.name.toLowerCase()));
                          
                          // Reorder: Swap Double Cut and lightly cooked (resulting order: lightly cooked, Well Done, Double Cut)
                          const order = ['lightly cooked', 'well done', 'double cut'];
                          allInstructions.sort((a, b) => {
                            return order.indexOf(a.name.toLowerCase()) - order.indexOf(b.name.toLowerCase());
                          });
                        }

                        return allInstructions.map((item) => {
                          const isSelected = selectedSpecialInstructions.includes(item.id);
                          return (
                            <div
                              key={item.id}
                              onClick={() => handleSpecialInstructionToggle(item.id)}
                              className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className="flex-1 flex items-center justify-between px-4 py-3">
                                <div className="flex items-center gap-3">
                                  <div className="w-5 h-5 flex-shrink-0">
                                    {isSelected ? (
                                      <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                        <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                      </div>
                                    ) : (
                                      <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                    )}
                                  </div>
                                  <p className="text-gray-900">{item.name}</p>
                                </div>
                                <span className="text-sm text-gray-900">{item.price}</span>
                              </div>
                            </div>
                          );
                        });
                      })()}
                    </div>
                  </>
                )}

                {/* No Toppings - Only for Brooklyn pizzas */}
                {product.category === 'brooklyn-pizza' && (
                  <>
                    {/* No Toppings Divider */}
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6">
                      <span className="font-semibold">No Toppings (Optional)</span>
                    </div>

                    {/* No Toppings Section */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                      {noToppings
                        .filter((item) => {
                          if (product.name === 'Brooklyn Caprese') {
                            return ['No Cherry Tomatoes', 'No Garlic', 'No Basil Ribbons', 'No Oil'].includes(item.name);
                          }
                          if (product.name === 'Brooklyn Eggplant Parmigiana') {
                            return ['No Eggplant', 'No Mozzarella Cheese', 'No Pecorino Cheese', 'No Basil Ribbons'].includes(item.name);
                          }
                          if (product.name === 'Brooklyn Shrimp') {
                            return ['No Scampi Sauce', 'No Feta Cheese', 'No Provolone Cheese', 'No Parsley', 'No Shrimp', 'No Mozzarella Cheese', 'No Old Bay Spice', 'No Garlic', 'No Oil'].includes(item.name);
                          }
                          if (product.name === 'Creamy Garlic') {
                            return ['No Mozzarella Cheese', 'No Garlic', 'No Creamy Alfredo', 'No Feta Cheese', 'No Pesto Basil', 'No Marinara Sauce'].includes(item.name);
                          }
                          if (product.name === 'Mediterranea') {
                            return ['No Eggplant', 'No Sundried Tomatoes', 'No Roasted Red Peppers', 'No Onions', 'No Black Olives', 'No Oregano'].includes(item.name);
                          }
                          if (product.name === 'Roman') {
                            return ['No Zucchini', 'No Roasted Red Peppers', 'No Sundried Tomatoes', 'No Green Olives', 'No Mushrooms', 'No Pesto', 'No Oregano'].includes(item.name);
                          }
                          if (product.name === 'Brooklyn Grandma') {
                            return ['No Mozzarella Cheese', 'No Pecorino Cheese', 'No Oregano', 'No Basil Ribbons'].includes(item.name);
                          }
                          // Fallback for other Brooklyn pizzas
                          return ['No Fresh Mozzarella', 'No Extra Basil', 'No Pecorino Cheese'].includes(item.name);
                        })
                        .map((item) => {
                        const isSelected = selectedNoToppings.includes(item.id);
                        return (
                          <div
                            key={item.id}
                            onClick={() => handleNoToppingToggle(item.id)}
                            className={`flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition-colors ${
                              isSelected ? 'bg-gray-50 border-2 border-[#A72020]' : 'bg-[#F6F6F6] border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'border-[#A72020] bg-white' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-[#A72020]" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between">
                              <p className="text-gray-900">{item.name}</p>
                              <span className="text-sm text-gray-900">${item.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>

                    {/* Special Instructions Divider - Brooklyn only */}
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mt-6">
                      <span className="font-semibold">Special Instructions (Optional)</span>
                    </div>

                    {/* Special Instructions Section - Brooklyn only */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                      {specialInstructionsBrooklyn.map((item) => {
                        const isSelected = selectedBrooklynInstructions.includes(item.id);
                        return (
                          <div
                            key={item.id}
                            onClick={() => handleBrooklynInstructionToggle(item.id)}
                            className={`flex items-center gap-3 rounded-lg px-4 py-3 cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                              isSelected ? 'border-[#A72020] bg-[#A72020]' : 'border-gray-300'
                            }`}>
                              {isSelected && (
                                <Check className="w-3 h-3 text-white" strokeWidth={3} />
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between min-w-0">
                              <p className="text-gray-900">{item.name}</p>
                              <span className="text-sm text-gray-900 ml-2">${item.price.toFixed(2)}</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </>
                )}
              </div>
            </CollapsibleContent>
          </Collapsible>
            </>
          )}

          {/* Pepperoni Roll Special Section - Only Extra Sauce */}
          {product.id === 'stromboli-8' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Extra Sauce (Optional)</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
                    {extraSauceOptions.filter(sauce => !((product.id === 'stromboli-1' || product.id === 'stromboli-8' || product.name.toLowerCase().includes('turnover')) && sauce.id === 'es1')).map((sauce) => {
                        const isSelected = selectedExtraSauce.includes(sauce.id);
                        return (
                          <div
                            key={sauce.id}
                            onClick={() => handleExtraSauceToggle(sauce.id)}
                            className={`flex items-center justify-between gap-3 px-4 py-3 rounded-lg cursor-pointer transition-colors bg-[#F6F6F6] border ${
                              isSelected ? 'border-2 border-[#A72020] bg-[#A72020]/5' : 'border-gray-200 hover:border-gray-300'
                            }`}
                          >
                            <div className="flex items-center gap-3 flex-1">
                              <div className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                isSelected ? 'bg-[#A72020] border-[#A72020]' : 'border-gray-300'
                              }`}>
                                {isSelected && <Check className="w-3 h-3 text-white" strokeWidth={3} />}
                              </div>
                              <span className="text-gray-900">{sauce.name}</span>
                            </div>
                            <span className="text-gray-600">+${sauce.price.toFixed(2)}</span>
                          </div>
                        );
                      })
                    }
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* Toppings - Only for Cheesesteaks */}
          {product.category === 'cheesesteaks' && (
            <>
              {/* Side Toppings - For all cheesesteaks */}
              {product.category === 'cheesesteaks' && (
                <Collapsible open={isSideToppingsOpen} onOpenChange={setIsSideToppingsOpen}>
                  <CollapsibleTrigger asChild>
                    <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <span className="font-bold">Side Toppings (Optional)</span>
                      </div>
                      {isSideToppingsOpen ? (
                        <ChevronUp className="w-6 h-6" />
                      ) : (
                        <ChevronDown className="w-6 h-6" />
                      )}
                    </button>
                  </CollapsibleTrigger>
                  <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                    {/* Background texture with opacity */}
                    <div 
                      className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                      style={{ 
                        backgroundImage: `url(${backgroundTexture})`,
                        backgroundSize: 'cover',
                        backgroundPosition: 'center'
                      }}
                    />
                    
                    {/* Grid de toppings */}
                    <div className={`grid grid-cols-1 md:grid-cols-3 gap-5 relative z-10 mb-5 ${product.name === 'Pizza Steak' ? '' : 'md:grid-flow-col md:grid-rows-5'}`}>
                      {sideToppingItems
                        .filter((item) => {
                          // Hide specific side toppings for Pizza Steak only
                          if (product.name === 'Pizza Steak') {
                            const hiddenIds = ['st6', 'st5', 'st11', 'st9', 'st12', 'st8'];
                            // st6: Side Mayo, st5: Side Ketchup, st11: Side Shredded Lettuce
                            // st9: Side Raw Onions, st12: Side Tomatoes, st8: Side Pickles
                            return !hiddenIds.includes(item.id);
                          }
                          return true;
                        })
                        .map((item) => {
                        const isSelected = selectedSideToppings.includes(item.id);
                        const sideToppingImages: Record<string, string> = {
                          'st1': 'https://drive.google.com/thumbnail?id=1s-xm4fbYN6yXmTafrwYI1y_phOFVshUo&sz=w1000',
                          'st2': 'https://drive.google.com/thumbnail?id=1ZJblzVjTCHrc8BBpo_WV5EUOZs7LXv2x&sz=w1000',
                          'st3': 'https://drive.google.com/thumbnail?id=1kWHOgg-PbnjGq1vJbyvTZD4eGKYT0djd&sz=w1000',
                          'st4': 'https://drive.google.com/thumbnail?id=1jleJl6tUqdtnwkwm4ap526-L6VlefOYH&sz=w1000',
                          'st5': 'https://drive.google.com/thumbnail?id=1d-EDKEtACSwCdw2JkhnvxusWQepJytSk&sz=w1000',
                          'st6': 'https://drive.google.com/thumbnail?id=155jK7leBquZclwQHgWLO4yuWo1_DVbcY&sz=w1000',
                          'st7': 'https://drive.google.com/thumbnail?id=1cEYCMH7PaiZHi8PAGW_l1E9HNo-HqAZm&sz=w1000',
                          'st8': 'https://drive.google.com/thumbnail?id=1cEzDIqy4k7zpRWjqvpcVqRKEltoegzvq&sz=w1000',
                          'st9': 'https://drive.google.com/thumbnail?id=1VShE_FfooQ7FPBY8vv0eDoNpvU6a1cc5&sz=w1000',
                          'st10': 'https://drive.google.com/thumbnail?id=1FixnCdbylb4CTQV_hDIfhua8NaX87sme&sz=w1000',
                          'st11': 'https://drive.google.com/thumbnail?id=1BrTnd31oe3TUcOWkZKcnG0XcvEN17u1-&sz=w1000',
                          'st12': 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w1000',
                          'st13': 'https://drive.google.com/thumbnail?id=1AWQvufIjyVIVncZDRUG-Dy9XfgVERvXc&sz=w1000',
                        };
                        return (
                          <div
                            key={item.id}
                            onClick={() => handleSideToppingToggle(item.id)}
                            className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                              isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                            }`}
                          >
                            <div className="w-14 h-14 min-w-[56px] min-h-[56px] flex-shrink-0 relative bg-gray-100">
                              <ImageWithFallback 
                                src={sideToppingImages[item.id]} 
                                alt={item.name}
                                className="w-full h-full object-cover"
                              />
                              {isSelected && (
                                <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                  <div className="bg-white rounded-full p-0.5">
                                    <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                  </div>
                                </div>
                              )}
                            </div>
                            <div className="flex-1 flex items-center justify-between px-4 h-14">
                              <p className="text-gray-900">{item.name}</p>
                              <p className="text-gray-900">${item.price.toFixed(2)}</p>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </CollapsibleContent>
                </Collapsible>
              )}

              {/* Extra Sides Section - For all cheesesteaks */}
              <Collapsible open={isExtraSidesOpen} onOpenChange={setIsExtraSidesOpen}>
                <CollapsibleTrigger asChild>
                  <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <span className="font-bold">Would You Like To Add Extra Sides?</span>
                    </div>
                    {isExtraSidesOpen ? (
                      <ChevronUp className="w-6 h-6" />
                    ) : (
                      <ChevronDown className="w-6 h-6" />
                    )}
                  </button>
                </CollapsibleTrigger>
                <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                  {/* Background texture with opacity */}
                  <div 
                    className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                    style={{ 
                      backgroundImage: `url(${backgroundTexture})`,
                      backgroundSize: 'cover',
                      backgroundPosition: 'center'
                    }}
                  />
                  
                  <div className="grid grid-cols-1 md:grid-cols-8 gap-5 relative z-10">
                    {extraSidesItems.map((item) => {
                      const isSelected = selectedExtraSides.includes(item.id);
                      return (
                        <div
                          key={item.id}
                          onClick={() => handleExtraSideToggle(item.id)}
                          className={`flex flex-col rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-full h-32 relative bg-gray-100">
                            <ImageWithFallback 
                              src={item.image}
                              alt={item.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex flex-col items-center justify-center px-4 py-3 gap-1">
                            <p className="text-gray-900 text-center">{item.name}</p>
                            <p className="text-gray-900 font-semibold">${item.price.toFixed(2)}</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </>
          )}

          {/* Burger Customization - MOVED UP (Duplicate Removed) */}
          {false && product.category === 'burgers' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10">
                  {/* Substitute Cheese Section */}
                  <div ref={burgerCheeseRef}>
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                      <span className="font-semibold">
                        {product.name === 'Hamburger' ? 'Add Cheese (Optional)' : 'Substitute Cheese (Optional)'}
                      </span>
                    </div>
                    {burgerCheeseError && (
                      <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-2 rounded-lg mb-5 text-sm">
                        Please select at least one cheese option to continue
                      </div>
                    )}
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {burgerSubstituteCheese
                      .filter(cheese => {
                        // Filter out No Cheese for Hamburger
                        if (product.name === 'Hamburger' && cheese.id === 'bsc7') {
                          return false;
                        }
                        return true;
                      })
                      .map((cheese) => {
                      const isSelected = selectedBurgerCheese.includes(cheese.id);
                      return (
                        <div
                          key={cheese.id}
                          onClick={() => {
                            setBurgerCheeseError(false);
                            
                            // Handle mutual exclusion for No Cheese
                            if (cheese.id === 'bsc7') { // No Cheese
                              // Deselect Extra Cheese and Lite Cheese when selecting No Cheese
                              setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be4'));
                              setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl1'));
                            }
                            
                            if (product.name === 'Hamburger') {
                              // Hamburger: Allow multiple cheese selections
                              if (isSelected) {
                                setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== cheese.id));
                              } else {
                                setSelectedBurgerCheese([...selectedBurgerCheese, cheese.id]);
                              }
                            } else {
                              // Other burgers: Only one cheese allowed
                              if (isSelected) {
                                // Don't allow deselecting if it's the only one selected
                                if (selectedBurgerCheese.length > 1) {
                                  setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== cheese.id));
                                }
                              } else {
                                // Replace with new selection
                                setSelectedBurgerCheese([cheese.id]);
                              }
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            {cheese.name === 'No Cheese' ? (
                              <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-1">
                                    <Check className="w-6 h-6 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-8 h-8 text-gray-300" strokeWidth={2} />
                                )}
                              </div>
                            ) : (
                              <>
                                <ImageWithFallback                                   src={cheese.image || 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400'} 
                                  alt={cheese.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </>
                            )}
                        </div>
                        <div className="flex-1 flex items-center justify-between px-4 py-3">
                          <p className="text-gray-900">{cheese.name}</p>
                          <span className="text-sm text-gray-900">
                            ${cheese.price.toFixed(2)}
                          </span>
                        </div>
                      </div>
                    );
                  })}
                </div>

                  {/* Add Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">Add Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {burgerAddToppings.map((topping) => {
                      const isSelected = selectedBurgerAdd.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedBurgerAdd(selectedBurgerAdd.filter(id => id !== topping.id));
                            } else {
                              setSelectedBurgerAdd([...selectedBurgerAdd, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={topping.image || 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400'} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 h-14">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">+${topping.price.toFixed(2)}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">Extra Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {burgerExtraToppings.map((topping) => {
                      const isSelected = selectedBurgerExtra.includes(topping.id);
                      const isNoCheese = selectedBurgerCheese.includes('bsc7');
                      
                      // Check if conflicting Lite option is selected
                      const hasLiteCheese = selectedBurgerLite.includes('bl1');
                      const hasLiteMayo = selectedBurgerLite.includes('bl2');
                      const hasLiteMustard = selectedBurgerLite.includes('bl3');
                      const hasLiteKetchup = selectedBurgerLite.includes('bl4');
                      
                      let isDisabled = false;
                      if (topping.id === 'be4') isDisabled = isNoCheese || hasLiteCheese; // Extra Cheese
                      if (topping.id === 'be1') isDisabled = hasLiteMayo; // Extra Mayo
                      if (topping.id === 'be2') isDisabled = hasLiteMustard; // Extra Mustard
                      if (topping.id === 'be3') isDisabled = hasLiteKetchup; // Extra Ketchup
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            
                            if (isSelected) {
                              setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== topping.id));
                            } else {
                              // Deselect conflicting options
                              if (topping.id === 'be4') { // Extra Cheese
                                setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== 'bsc7'));
                                setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl1'));
                              } else if (topping.id === 'be1') { // Extra Mayo
                                setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl2'));
                              } else if (topping.id === 'be2') { // Extra Mustard
                                setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl3'));
                              } else if (topping.id === 'be3') { // Extra Ketchup
                                setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== 'bl4'));
                              }
                              setSelectedBurgerExtra([...selectedBurgerExtra, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 h-14 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] px-4 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'
                          } ${isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                        }`}
                      >
                        <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                          {isSelected && (
                            <Check className="w-3 h-3 text-white" strokeWidth={3} />
                          )}
                        </div>
                        <div className="flex-1 flex items-center justify-between">
                          <p className="text-gray-900">{topping.name}</p>
                          <p className="text-gray-900">${topping.price.toFixed(2)}</p>
                        </div>
                      </div>
                    );
                  })}
                  </div>

                  {/* Lite Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">Lite Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {burgerLiteToppings.map((topping) => {
                      const isSelected = selectedBurgerLite.includes(topping.id);
                      const isNoCheese = selectedBurgerCheese.includes('bsc7');
                      
                      // Check if conflicting Extra option is selected
                      const hasExtraCheese = selectedBurgerExtra.includes('be4');
                      const hasExtraMayo = selectedBurgerExtra.includes('be1');
                      const hasExtraMustard = selectedBurgerExtra.includes('be2');
                      const hasExtraKetchup = selectedBurgerExtra.includes('be3');
                      
                      let isDisabled = false;
                      if (topping.id === 'bl1') isDisabled = isNoCheese || hasExtraCheese; // Lite Cheese
                      if (topping.id === 'bl2') isDisabled = hasExtraMayo; // Lite Mayo
                      if (topping.id === 'bl3') isDisabled = hasExtraMustard; // Lite Mustard
                      if (topping.id === 'bl4') isDisabled = hasExtraKetchup; // Lite Ketchup
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isDisabled) return;
                            
                            if (isSelected) {
                              setSelectedBurgerLite(selectedBurgerLite.filter(id => id !== topping.id));
                            } else {
                              // Deselect conflicting options
                              if (topping.id === 'bl1') { // Lite Cheese
                                setSelectedBurgerCheese(selectedBurgerCheese.filter(id => id !== 'bsc7'));
                                setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be4'));
                              } else if (topping.id === 'bl2') { // Lite Mayo
                                setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be1'));
                              } else if (topping.id === 'bl3') { // Lite Mustard
                                setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be2'));
                              } else if (topping.id === 'bl4') { // Lite Ketchup
                                setSelectedBurgerExtra(selectedBurgerExtra.filter(id => id !== 'be3'));
                              }
                              setSelectedBurgerLite([...selectedBurgerLite, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-3 h-14 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] px-4 ${
                            isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'
                          } ${isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                            {isSelected && (
                              <Check className="w-3 h-3 text-white" strokeWidth={3} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between">
                            <p className="text-gray-900">{topping.name}</p>
                            <p className="text-gray-900">$0.00</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Toppings Section (Only for Cheeseburger Deluxe) */}
                  {product.name === 'Cheeseburger Deluxe' && (
                    <>
                      <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                        <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                        {cheeseBurgerDeluxeNoToppings.map((topping) => {
                          const isSelected = selectedCheeseBurgerDeluxeNoToppings.includes(topping.id);
                          return (
                            <div
                              key={topping.id}
                              onClick={() => {
                                if (isSelected) {
                                  setSelectedCheeseBurgerDeluxeNoToppings(selectedCheeseBurgerDeluxeNoToppings.filter(id => id !== topping.id));
                                } else {
                                  setSelectedCheeseBurgerDeluxeNoToppings([...selectedCheeseBurgerDeluxeNoToppings, topping.id]);
                                }
                              }}
                              className={`flex items-center gap-3 h-14 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] px-4 ${
                                isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                              }`}
                            >
                              <div className={`rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-[#A72020]' : 'border-2 border-gray-300'}`}>
                                {isSelected && (
                                  <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                )}
                              </div>
                              <div className="flex-1 flex items-center justify-between">
                                <p className="text-gray-900">{topping.name}</p>
                                <span className="text-sm text-gray-900">
                                  ${topping.price?.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </>
                  )}

                  {/* Side Toppings Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">Side Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {burgerSideToppings.map((topping) => {
                      const isSelected = selectedBurgerSide.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedBurgerSide(selectedBurgerSide.filter(id => id !== topping.id));
                            } else {
                              setSelectedBurgerSide([...selectedBurgerSide, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={topping.image || 'https://drive.google.com/thumbnail?id=1vGy2iRsL4C5tR8TFVVC_L3-MYw8DuTE9&sz=w400'} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
            </CollapsibleContent>
          </Collapsible>
        )}












          {/* Brioche Customization - MOVED UP (Duplicate Removed) */}
          {false && product.category === 'brioche' && (
            <Collapsible open={isAdditionalOpen} onOpenChange={setIsAdditionalOpen}>
              <CollapsibleTrigger asChild>
                <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                  <div className="flex flex-col items-start gap-1">
                    <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>1. Add Toppings</span>
                  </div>
                  {isAdditionalOpen ? (
                    <ChevronUp className="w-6 h-6" />
                  ) : (
                    <ChevronDown className="w-6 h-6" />
                  )}
                </button>
              </CollapsibleTrigger>
              <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10">

                  {/* Add Cheese Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">
                      {product.name === 'Brioche Mozzarella Grilled Chicken' ? 'Substitute Cheese (Optional)' : 'Add Cheese (Optional)'}
                    </span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {briocheAddCheese
                      .filter(cheese => !((product.name === 'Brioche Buffalo Crispy Chicken' || product.name === 'Brioche Grilled Chicken') && cheese.id === 'brc7')) // Filter out No Cheese for Buffalo Crispy Chicken and Grilled Chicken
                      .map((cheese) => {
                      const isSelected = selectedBriocheAddCheese === cheese.id;
                      const isNoCheese = cheese.id === 'brc7'; // No Cheese
                      
                      return (
                        <div
                          key={cheese.id}
                          onClick={() => {
                            if (isSelected) {
                              // For Brioche Mozzarella Grilled Chicken, don't allow deselection (cheese is required)
                              if (product.name !== 'Brioche Mozzarella Grilled Chicken') {
                                setSelectedBriocheAddCheese('');
                              }
                            } else {
                              // If selecting "No Cheese" here, clear Extra Cheese
                              if (isNoCheese) {
                                setSelectedBriocheExtraCheese([]);
                              }
                              setSelectedBriocheAddCheese(cheese.id);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            {isNoCheese ? (
                              <div className="w-full h-full flex items-center justify-center bg-gray-50">
                                {isSelected ? (
                                  <div className="bg-[#A72020] rounded-full p-1.5">
                                    <Check className="w-3.5 h-3.5 text-white" strokeWidth={3} />
                                  </div>
                                ) : (
                                  <Circle className="w-5 h-5 text-gray-300" strokeWidth={2} />
                                )}
                              </div>
                            ) : (
                              <>
                                <ImageWithFallback                                   src={cheese.image || 'https://via.placeholder.com/56'} 
                                  alt={cheese.name}
                                  className="w-full h-full object-cover"
                                />
                                {isSelected && (
                                  <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                    <div className="bg-white rounded-full p-0.5">
                                      <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                    </div>
                                  </div>
                                )}
                              </>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{cheese.name}</p>
                            <span className="text-sm text-gray-900">
                              +${cheese.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Extra Cheese Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">Extra Cheese (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {briocheExtraCheese
                      .filter(topping => topping.id !== 'brec2') // Filter out Side of Cheddar Sauce
                      .map((topping) => {
                      const isSelected = selectedBriocheExtraCheese.includes(topping.id);
                      // Check if "No Cheese" is selected in Add Cheese section
                      const isNoCheeseActive = selectedBriocheAddCheese === 'brc7';
                      const isDisabled = isNoCheeseActive;
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            // Don't allow click if disabled
                            if (isDisabled) return;
                            
                            if (isSelected) {
                              setSelectedBriocheExtraCheese(selectedBriocheExtraCheese.filter(id => id !== topping.id));
                            } else {
                              setSelectedBriocheExtraCheese([...selectedBriocheExtraCheese, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden transition-colors bg-[#F6F6F6] ${
                            isDisabled 
                              ? 'opacity-50 cursor-not-allowed border border-gray-200' 
                              : isSelected 
                              ? 'border-2 border-[#A72020] cursor-pointer' 
                              : 'border border-gray-200 cursor-pointer'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative flex items-center justify-center bg-[#F6F6F6]">
                            {isSelected && !isDisabled ? (
                              <div className="bg-[#A72020] rounded-full p-1">
                                <Check className="w-5 h-5 text-white" strokeWidth={3} />
                              </div>
                            ) : (
                              <Circle className="w-6 h-6 text-gray-300" strokeWidth={2} />
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className={`${isDisabled ? 'text-gray-400' : 'text-gray-900'}`}>{topping.name}</p>
                            <span className={`text-sm ${isDisabled ? 'text-gray-400' : 'text-gray-900'}`}>
                              +${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* No Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">No Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    {(product.name === 'Brioche Grilled Chicken' 
                        ? [...briocheNoToppings, ...briocheGrilledChickenNoToppings]
                        : product.name === 'Brioche Mozzarella Grilled Chicken'
                        ? [...briocheNoToppings, ...briocheMozzarellaGrilledChickenNoToppings]
                        : briocheNoToppings
                    ).map((topping) => {
                      const isSelected = selectedBriocheNo.includes(topping.id);
                      
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedBriocheNo(selectedBriocheNo.filter(id => id !== topping.id));
                            } else {
                              setSelectedBriocheNo([...selectedBriocheNo, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <div className="w-full h-full flex items-center justify-center bg-gray-50">
                              {isSelected ? (
                                <div className="bg-[#A72020] rounded-full p-1.5">
                                  <Check className="w-3.5 h-3.5 text-white" strokeWidth={3} />
                                </div>
                              ) : (
                                <Circle className="w-5 h-5 text-gray-300" strokeWidth={2} />
                              )}
                            </div>
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              ${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* Side Section */}
                  <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg mb-5">
                    <span className="font-semibold">Side Toppings (Optional)</span>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                    {briocheSideToppings.map((topping) => {
                      const isSelected = selectedBriocheSide.includes(topping.id);
                      return (
                        <div
                          key={topping.id}
                          onClick={() => {
                            if (isSelected) {
                              setSelectedBriocheSide(selectedBriocheSide.filter(id => id !== topping.id));
                            } else {
                              setSelectedBriocheSide([...selectedBriocheSide, topping.id]);
                            }
                          }}
                          className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                            isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                          }`}
                        >
                          <div className="w-14 h-14 flex-shrink-0 relative">
                            <ImageWithFallback                               src={topping.image || 'https://via.placeholder.com/56'} 
                              alt={topping.name}
                              className="w-full h-full object-cover"
                            />
                            {isSelected && (
                              <div className="absolute inset-0 flex items-center justify-center bg-black/40">
                                <div className="bg-white rounded-full p-0.5">
                                  <Check className="w-4 h-4 text-[#A72020]" strokeWidth={3} />
                                </div>
                              </div>
                            )}
                          </div>
                          <div className="flex-1 flex items-center justify-between px-4 py-3">
                            <p className="text-gray-900">{topping.name}</p>
                            <span className="text-sm text-gray-900">
                              +${topping.price?.toFixed(2)}
                            </span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </CollapsibleContent>
            </Collapsible>
          )}

          {/* No Toppings Section for Minucci Pizzas */}
          {(product.category === 'minucci-pizzas' || product.category === 'specialty-pizza' || (product.category === 'pizzas' && product.id === 'cyo-sicilian-pesto')) && product.customizationOptions && (
            <>
              {product.customizationOptions.map((customOption) => {
                if (customOption.title === 'No Toppings') {
                  return (
                    <Collapsible key={customOption.id} open={isNoToppingsOpen} onOpenChange={setIsNoToppingsOpen} className="mt-6">
                      <CollapsibleTrigger asChild>
                        <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                          <div className="flex flex-col items-start gap-1">
                            <div className="flex items-center gap-2">
                              <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>No Toppings (Optional)</span>
                            </div>
                          </div>
                          {isNoToppingsOpen ? (
                            <ChevronUp className="w-6 h-6" />
                          ) : (
                            <ChevronDown className="w-6 h-6" />
                          )}
                        </button>
                      </CollapsibleTrigger>
                      <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
                        {/* Background texture with opacity */}
                        <div 
                          className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                          style={{ 
                            backgroundImage: `url(${backgroundTexture})`,
                            backgroundSize: 'cover',
                            backgroundPosition: 'center'
                          }}
                        />
                        <div className="relative z-10 space-y-6">
                          {/* No Toppings Options */}
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {customOption.options.map((option) => {
                              const isSelected = selectedNoToppings.includes(option.id);
                              return (
                                <div
                                  key={option.id}
                                  onClick={() => {
                                    if (isSelected) {
                                      setSelectedNoToppings(selectedNoToppings.filter(id => id !== option.id));
                                    } else {
                                      setSelectedNoToppings([...selectedNoToppings, option.id]);
                                    }
                                  }}
                                  className={`flex items-center gap-0 rounded-lg overflow-hidden cursor-pointer transition-colors bg-[#F6F6F6] ${
                                    isSelected ? 'border-2 border-[#A72020]' : 'border border-gray-200'
                                  }`}
                                >
                                  <div className="flex-1 flex items-center justify-between px-4 py-3">
                                    <div className="flex items-center gap-3">
                                      <div className="w-5 h-5 flex-shrink-0">
                                        {isSelected ? (
                                          <div className="bg-[#A72020] rounded-full p-0.5 flex items-center justify-center w-5 h-5">
                                            <Check className="w-3 h-3 text-white" strokeWidth={3} />
                                          </div>
                                        ) : (
                                          <div className="border-2 border-gray-300 rounded-full w-5 h-5"></div>
                                        )}
                                      </div>
                                      <p className="text-gray-900">{option.name}</p>
                                    </div>
                                    <span className="text-sm text-gray-900">${option.price.toFixed(2)}</span>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      </CollapsibleContent>
                    </Collapsible>
                  );
                }
                return null;
              })}
            </>
          )}

          {/* Add Dippings Section - Independent section for all pizzas */}
          {(product.category === 'pizzas' || product.category === 'specialty-pizza' || product.category === 'brooklyn-pizza' || product.category === 'minucci-pizzas') && (
            <div className="mt-6">
              {/* Add Dippings Header */}
              <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-t-lg">
                <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>Add Dippings (Optional)</span>
              </div>

              {/* Add Dippings Grid with Background */}
              <div className="relative border border-t-0 rounded-b-lg p-5">
                <div 
                  className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                  style={{ 
                    backgroundImage: `url(${backgroundTexture})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center'
                  }}
                />
                <div className="relative z-10 grid grid-cols-1 md:grid-cols-3 gap-4">
                  {pizzaDippingsOptions.map((dipping) => {
                    const quantity = selectedPizzaDippings[dipping.id] || 0;
                    const isActive = activeDippingItem === dipping.id;
                    return (
                      <div
                        key={dipping.id}
                        onClick={() => {
                          if (quantity === 0) {
                            // Auto-select with quantity 1 on first click
                            setSelectedPizzaDippings({
                              ...selectedPizzaDippings,
                              [dipping.id]: 1
                            });
                            setActiveDippingItem(dipping.id);
                          } else if (!isActive) {
                            // If already selected but not active, make it active
                            setActiveDippingItem(dipping.id);
                          } else {
                            // If already active and selected, deselect completely
                            const newQuantities = { ...selectedPizzaDippings };
                            delete newQuantities[dipping.id];
                            setSelectedPizzaDippings(newQuantities);
                            setActiveDippingItem(null);
                          }
                        }}
                        className="relative flex items-center gap-3 h-28 rounded-lg overflow-hidden border border-gray-200 bg-[#F6F6F6] cursor-pointer hover:border-[#A72020] transition-colors"
                      >
                        {/* Check circle - positioned in top right corner */}
                        <div className="absolute top-2 right-2 z-10">
                          {quantity > 0 ? (
                            <div className="w-6 h-6 rounded-full border-2 border-[#A72020] bg-[#A72020] flex items-center justify-center">
                              <svg className="w-4 h-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                              </svg>
                            </div>
                          ) : (
                            <div className="w-6 h-6 rounded-full border-2 border-gray-300"></div>
                          )}
                        </div>
                        
                        {/* Image on the left */}
                        <div className="w-28 h-28 flex-shrink-0">
                          <ImageWithFallback                             src={dipping.image} 
                            alt={dipping.name}
                            className="w-full h-full object-cover"
                          />
                        </div>
                        
                        {/* Name, price, and controls stacked vertically */}
                        <div className="flex-1 flex flex-col justify-center gap-1 pr-2">
                          <p className="font-semibold text-sm">{dipping.name}</p>
                          <p className="text-xs text-gray-600">${dipping.price.toFixed(2)}</p>
                          
                          {/* Counter controls below text - only show when active and selected */}
                          {isActive && quantity > 0 && (
                            <div className="flex items-center gap-2 mt-1" onClick={(e) => e.stopPropagation()}>
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  const newQuantities = { ...selectedPizzaDippings };
                                  if (quantity === 1) {
                                    delete newQuantities[dipping.id];
                                    setActiveDippingItem(null);
                                  } else {
                                    newQuantities[dipping.id] = quantity - 1;
                                  }
                                  setSelectedPizzaDippings(newQuantities);
                                }}
                                className="w-6 h-6 rounded-full bg-[#A72020] text-white flex items-center justify-center font-bold text-sm"
                              >
                                
                              </button>
                              <span className="font-bold text-sm min-w-[1rem] text-center">{quantity}</span>
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  setSelectedPizzaDippings({
                                    ...selectedPizzaDippings,
                                    [dipping.id]: quantity + 1
                                  });
                                }}
                                className="w-6 h-6 rounded-full bg-[#A72020] text-white flex items-center justify-center font-bold text-sm"
                              >
                                +
                              </button>
                            </div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          )}

          {/* Add Desserts */}
          {product.category !== 'catering-whole-cakes' && product.category !== 'catering-party-trays' && product.category !== 'desserts' && (
          <Collapsible open={isDessertOpen} onOpenChange={setIsDessertOpen}>
            <CollapsibleTrigger asChild>
              <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>2. Would You Like To Add a Dessert?</span>
                </div>
                {isDessertOpen ? (
                  <ChevronUp className="w-6 h-6" />
                ) : (
                  <ChevronDown className="w-6 h-6" />
                )}
              </button>
            </CollapsibleTrigger>
            <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
              {/* Background texture with opacity */}
              <div 
                className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                style={{ 
                  backgroundImage: `url(${backgroundTexture})`,
                  backgroundSize: 'cover',
                  backgroundPosition: 'center'
                }}
              />
              <div className="relative z-10 space-y-6">
                {/* Individual Desserts Section */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                  {dessertItems.map((item) => {
                    const quantity = selectedDesserts[item.id] || 0;
                    const isActive = activeDessertItem === item.id;
                    
                    return (
                      <AddonCard
                        key={item.id}
                        item={item}
                        quantity={quantity}
                        isActive={isActive}
                        onSelect={() => {
                          if (quantity === 0) {
                            handleDessertToggle(item.id);
                            setActiveDessertItem(item.id);
                          } else if (!isActive) {
                            setActiveDessertItem(item.id);
                          } else {
                            handleDessertToggle(item.id);
                            setActiveDessertItem(null);
                          }
                        }}
                        onIncrement={() => handleDessertIncrement(item.id)}
                        onDecrement={() => handleDessertDecrement(item.id)}
                      />
                    );
                  })}
                </div>

                {/* Whole Cakes Section - Only for catering products */}
                {product.category && product.category.startsWith('catering-') && (
                  <>
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                      <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Whole Cakes</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                      {wholeCakesItems.map((item) => {
                        const quantity = selectedDesserts[item.id] || 0;
                        const isActive = activeDessertItem === item.id;
                        
                        return (
                          <AddonCard
                            key={item.id}
                            item={item}
                            quantity={quantity}
                            isActive={isActive}
                            onSelect={() => {
                              if (quantity === 0) {
                                handleDessertToggle(item.id);
                                setActiveDessertItem(item.id);
                              } else if (!isActive) {
                                setActiveDessertItem(item.id);
                              } else {
                                handleDessertToggle(item.id);
                                setActiveDessertItem(null);
                              }
                            }}
                            onIncrement={() => handleDessertIncrement(item.id)}
                            onDecrement={() => handleDessertDecrement(item.id)}
                          />
                        );
                      })}
                    </div>
                  </>
                )}

                {/* Party Cakes Section - Only for catering products */}
                {product.category && product.category.startsWith('catering-') && (
                  <>
                    <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                      <span className="font-semibold" style={{fontSize: 'calc(1em + 3px)'}}>Party Cakes</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                      {partyCakesItems.map((item) => {
                        const quantity = selectedDesserts[item.id] || 0;
                        const isActive = activeDessertItem === item.id;
                        
                        return (
                          <AddonCard
                            key={item.id}
                            item={item}
                            quantity={quantity}
                            isActive={isActive}
                            onSelect={() => {
                              if (quantity === 0) {
                                handleDessertToggle(item.id);
                                setActiveDessertItem(item.id);
                              } else if (!isActive) {
                                setActiveDessertItem(item.id);
                              } else {
                                handleDessertToggle(item.id);
                                setActiveDessertItem(null);
                              }
                            }}
                            onIncrement={() => handleDessertIncrement(item.id)}
                            onDecrement={() => handleDessertDecrement(item.id)}
                          />
                        );
                      })}
                    </div>
                  </>
                )}
              </div>
            </CollapsibleContent>
          </Collapsible>
          )}

          {/* Add Beverages */}
          {product.category !== 'beverages' && product.category !== 'catering-beverages' && (
          <Collapsible open={isBeverageOpen} onOpenChange={setIsBeverageOpen}>
            <CollapsibleTrigger asChild>
              <button className="w-full bg-[#F5F3EB] text-[#1F2937] p-5 rounded-lg flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <span className="font-bold" style={{fontSize: 'calc(1em + 3px)'}}>3. Would You Like To Add a Beverage?</span>
                </div>
                {isBeverageOpen ? (
                  <ChevronUp className="w-6 h-6" />
                ) : (
                  <ChevronDown className="w-6 h-6" />
                )}
              </button>
            </CollapsibleTrigger>
            <CollapsibleContent className="relative border border-t-0 rounded-b-lg p-5">
              {/* Background texture with opacity */}
              <div 
                className="absolute inset-0 pointer-events-none opacity-30 rounded-b-lg"
                style={{ 
                  backgroundImage: `url(${backgroundTexture})`,
                  backgroundSize: 'cover',
                  backgroundPosition: 'center'
                }}
              />
              <div className="relative z-10 space-y-6">
                {/* 20oz Divider */}
                <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                  <span className="font-semibold">20oz</span>
                </div>

                {/* 20oz Section */}
                <div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                    {beverageItems.filter(item => item.id.startsWith('b1')).map((item) => {
                      const quantity = selectedBeverages[item.id] || 0;
                      const isActive = activeBeverageItem === item.id;
                      
                      return (
                        <AddonCard
                          key={item.id}
                          item={item}
                          quantity={quantity}
                          isActive={isActive}
                          onSelect={() => {
                            if (quantity === 0) {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(item.id);
                            } else if (!isActive) {
                              setActiveBeverageItem(item.id);
                            } else {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(null);
                            }
                          }}
                          onIncrement={() => handleBeverageIncrement(item.id)}
                          onDecrement={() => handleBeverageDecrement(item.id)}
                        />
                      );
                    })}
                  </div>
                </div>

                {/* 2 Liter Divider */}
                <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                  <span className="font-semibold">2 Liter</span>
                </div>

                {/* 2 Liter Section */}
                <div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                    {beverageItems.filter(item => item.id.startsWith('b2')).map((item) => {
                      const quantity = selectedBeverages[item.id] || 0;
                      const isActive = activeBeverageItem === item.id;
                      
                      return (
                        <AddonCard
                          key={item.id}
                          item={item}
                          quantity={quantity}
                          isActive={isActive}
                          onSelect={() => {
                            if (quantity === 0) {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(item.id);
                            } else if (!isActive) {
                              setActiveBeverageItem(item.id);
                            } else {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(null);
                            }
                          }}
                          onIncrement={() => handleBeverageIncrement(item.id)}
                          onDecrement={() => handleBeverageDecrement(item.id)}
                        />
                      );
                    })}
                  </div>
                </div>

                {/* Water Divider */}
                <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                  <span className="font-semibold">Water</span>
                </div>

                {/* Water Section */}
                <div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                    {beverageItems.filter(item => item.id === 'b3' || item.id === 'b4').map((item) => {
                      const quantity = selectedBeverages[item.id] || 0;
                      const isActive = activeBeverageItem === item.id;
                      
                      return (
                        <AddonCard
                          key={item.id}
                          item={item}
                          quantity={quantity}
                          isActive={isActive}
                          onSelect={() => {
                            if (quantity === 0) {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(item.id);
                            } else if (!isActive) {
                              setActiveBeverageItem(item.id);
                            } else {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(null);
                            }
                          }}
                          onIncrement={() => handleBeverageIncrement(item.id)}
                          onDecrement={() => handleBeverageDecrement(item.id)}
                        />
                      );
                    })}
                  </div>
                </div>

                {/* Kids Divider */}
                <div className="bg-[#F5F3EB] text-[#1F2937] px-4 py-3 rounded-lg">
                  <span className="font-semibold">Kids</span>
                </div>

                {/* Kids Section */}
                <div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                    {beverageItems.filter(item => item.id === 'b5' || item.id === 'b6').map((item) => {
                      const quantity = selectedBeverages[item.id] || 0;
                      const isActive = activeBeverageItem === item.id;
                      
                      return (
                        <AddonCard
                          key={item.id}
                          item={item}
                          quantity={quantity}
                          isActive={isActive}
                          onSelect={() => {
                            if (quantity === 0) {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(item.id);
                            } else if (!isActive) {
                              setActiveBeverageItem(item.id);
                            } else {
                              handleBeverageToggle(item.id);
                              setActiveBeverageItem(null);
                            }
                          }}
                          onIncrement={() => handleBeverageIncrement(item.id)}
                          onDecrement={() => handleBeverageDecrement(item.id)}
                        />
                      );
                    })}
                  </div>
                </div>
              </div>
            </CollapsibleContent>
          </Collapsible>
        )}

        {/* Suggested Items - Now inside left column */}
        <div className="py-8 lg:py-12 bg-white">
          <div className="max-w-[960px] mx-auto">
            <h2 className="text-[22px] lg:text-[30px] font-semibold text-gray-900 mb-6">Great pairings for this meal</h2>
            <div className="flex overflow-x-auto gap-4 pb-4 lg:grid lg:grid-cols-3 lg:gap-6 lg:pb-0 scrollbar-hide snap-x snap-mandatory">
              {suggestedAppetizers.map((item) => (
                <div key={item.id} className="flex-shrink-0 w-[168px] lg:w-[280px] snap-start">
                  <ProductCard
                    product={item}
                    onCustomize={(selectedItem) => {
                      if (onProductChange) {
                        onProductChange(selectedItem);
                        window.scrollTo({ top: 0, behavior: 'instant' });
                      }
                    }}
                  />
                </div>
              ))}
            </div>
          </div>
        </div>

          </div>
          </div>
        </div>

        {/* RIGHT COLUMN: Fixed Image + Product Info (Desktop Only) */}
        <div 
          className="hidden lg:block lg:col-start-2 lg:row-start-1 lg:row-span-2 lg:sticky lg:h-full lg:max-h-full lg:overflow-hidden bg-white border-l box-border lg:min-h-0"
          style={{ top: 'var(--appHeaderH, 0px)' }}
        >
          <div className="flex flex-col h-full min-h-0">
          {/* Product Image - 60% of panel height */}
          <div className="basis-[60%] shrink-0 bg-[#F5F3EB] overflow-hidden relative w-full h-full">
            <ImageWithFallback               src={product.image}
              alt={product.name}
              className="absolute inset-0 w-full h-full object-contain object-center lg:object-cover lg:scale-[1.15] transform transition-transform duration-200"
              style={{ 
                WebkitBackfaceVisibility: 'hidden',
                backfaceVisibility: 'hidden',
                transform: 'translateZ(0)'
              }}
            />
          </div>
          
          {/* Product Info - 40% of panel height - scrollable */}
          <div className="basis-[40%] min-h-0 p-4 bg-[#F5F3EB] border-t overflow-y-auto box-border custom-scrollbar">
            <h1 className="text-3xl font-bold text-gray-900 mb-1">
              {product.name.toLowerCase().includes('chicken tenders') ? 'Chicken Tenders W/FF' : product.name}
            </h1>
            
            {/* Choice of two sides - Only for traditional dinners and fish */}
            {(product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) && (
              <p className="text-gray-700 italic mb-1">Choice of two sides</p>
            )}
            
            <p className="text-2xl text-gray-900 mb-1">
              {product.id === 'stromboli-8' ? '$8.49' : displayPrice}
            </p>
            
            <div className="text-gray-600 leading-relaxed mb-1" dangerouslySetInnerHTML={{ __html: product.name === 'Antipasto Salad' ? 'Romaine lettuce, ham, provolone cheese, salami, capicola, black and green olives, tomatoes, onions and marinated vegetables. Served with a side of our fresh baked homemade bread.' : (product.name === 'Boom Boom Chicken Pan Pizza' ? 'Chicken Steak mixed in our homemade buffalo sauce and mozzarella cheese. Served with your choice of bleu cheese or ranch dipping.' : (((product.name.toLowerCase().includes('italian') && product.name.toLowerCase().includes('stromboli')) || product.name === 'Stromboli' || product.id === 'stromboli-1') ? 'Ham, capicola, pepperoni, american cheese and mozzarella. Served with a cup of Pomodoro sauce on the side.' : ((product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') ? getMozzarellaSticksDescription() : ((product.id === 'app8' || product.id === 'capp4') ? getAranciniRiceBallDescription() : ((product.id === 'app18' || (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4')) ? ('Breaded with seasoned flour. Served with celery and <span class="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">(' + (selectedSize === '50' ? '16oz' : selectedSize === '30' ? '8oz' : selectedSize === '20' ? '4oz' : '2oz') + ')</span> bleu cheese.') : ((product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') ? ('Crispy breaded tenders served with french fries and <span class="bg-[#A72020] text-white px-2 py-0.5 rounded font-semibold">(' + (selectedChickenTendersQuantity === '64pcs' ? '32oz' : selectedChickenTendersQuantity === '32pcs' ? '16oz' : selectedChickenTendersQuantity === '16pcs' ? '8oz' : selectedChickenTendersQuantity === '8pcs' ? '4oz' : '2oz') + ')</span> Honey Mustard.') : product.description)))))) }} />
            
            {/* Garlic Bread Size Selection - Desktop - Only for app1 */}
            {product.id === 'app1' && (
              <div className="mb-2">
                <p className="text-gray-600 mb-2">Select size</p>
                <div className="flex gap-2">
                  <button
                    onClick={() => setSelectedGarlicBreadSize('1pcs')}
                    className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                      selectedGarlicBreadSize === '1pcs'
                        ? 'border-[#A72020] bg-[#A72020] text-white'
                        : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                    }`}
                  >
                    Half Loaf
                  </button>
                  <button
                    onClick={() => setSelectedGarlicBreadSize('2pcs')}
                    className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                      selectedGarlicBreadSize === '2pcs'
                        ? 'border-[#A72020] bg-[#A72020] text-white'
                        : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                    }`}
                  >
                    Full Loaf
                  </button>
                </div>
              </div>
            )}
            
            {/* Garlic Bread with Mozzarella Size Selection - Desktop - Only for app2 */}
            {product.id === 'app2' && (
              <div className="mb-2">
                <p className="text-gray-600 mb-2">Select size</p>
                <div className="flex gap-2">
                  <button
                    onClick={() => setSelectedGarlicBreadMozzarellaSize('1pcs')}
                    className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                      selectedGarlicBreadMozzarellaSize === '1pcs'
                        ? 'border-[#A72020] bg-[#A72020] text-white'
                        : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                    }`}
                  >
                    Half Loaf
                  </button>
                  <button
                    onClick={() => setSelectedGarlicBreadMozzarellaSize('2pcs')}
                    className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                      selectedGarlicBreadMozzarellaSize === '2pcs'
                        ? 'border-[#A72020] bg-[#A72020] text-white'
                        : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                    }`}
                  >
                    Full Loaf
                  </button>
                </div>
              </div>
            )}

            {/* Size Selection - Desktop */}
            <div className="hidden lg:block">
              {((!product.name.includes('Sicilian') && !product.name.includes('Pan Pizza') && !product.name.includes('Gluten Free') && product.category !== 'brooklyn-pizza' && product.category !== 'cheesesteaks' && product.category !== 'wings' && product.category !== 'hot-hoagies' && product.category !== 'cold-hoagies' && product.category !== 'by-the-slice' && product.category !== 'burgers' && product.category !== 'brioche' && product.category !== 'paninis' && product.category !== 'wraps' && product.category !== 'appetizers' && product.category !== 'traditional-dinners' && product.category !== 'pasta' && product.category !== 'baked-pasta' && product.category !== 'create-salad' && product.category !== 'salads' && product.category !== 'soups' && product.category !== 'kids' && product.category !== 'beverages' && product.category !== 'desserts' && product.category !== 'catering-desserts' && product.category !== 'pizzelle' && product.category !== 'gelati' && product.id !== 'cp-1' && product.id !== 'k1' && product.id !== 'stromboli-8' && product.id !== 'cptray1' && product.id !== 'cptray2' && product.id !== 'cptray3' && product.id !== 'cptray4' && product.id !== 'cptray5' && product.id !== 'cptray6') || product.category === 'catering-salad-soups' || product.id === 'cyo-minucci') && (
                <div className="mb-2">
                  {/* Size selection label - hide for Whole Cakes, Beverages, Hoagies Wraps, Sides, Seafood, Appetizers, Catering Appetizers, Minucci Pizzas, and Thick Crust Specialty Pizzas */}
                  {product.category !== 'catering-whole-cakes' && product.category !== 'catering-beverages' && product.category !== 'catering-hoagies-wraps' && product.category !== 'catering-appetizers' && product.category !== 'sides' && product.category !== 'seafood' && product.category !== 'appetizers' && product.category !== 'desserts' && product.category !== 'catering-desserts' && product.category !== 'minucci-pizzas' && !['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'].includes(product.id) && (
                    <p className="text-gray-600 mb-2">{product.id === 'cyo-minucci' ? 'Select your pricing option' : 'Select your preferred size'}</p>
                  )}
                  
                  {/* Minucci special pricing buttons */}
                  {product.id === 'cyo-minucci' && (
                    <div className="flex gap-2">
                      <button
                        onClick={() => setSelectedSize('medium')}
                        className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'medium'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        1 Topping
                      </button>
                      <button
                        onClick={() => setSelectedSize('large')}
                        className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'large'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        2-4 Toppings
                      </button>
                    </div>
                  )}
                  
                  {/* Hide size selection for Brioche, Minucci, Seafood, Whole Cakes, Beverages, Hoagies Wraps, Sides, Catering Appetizers, and Thick Crust Specialty Pizzas */}
                  {!product.id.startsWith('brioche-') && product.id !== 'cyo-minucci' && product.category !== 'minucci-pizzas' && product.category !== 'seafood' && product.category !== 'catering-whole-cakes' && product.category !== 'catering-beverages' && product.category !== 'catering-hoagies-wraps' && product.category !== 'catering-appetizers' && product.category !== 'sides' && product.category !== 'desserts' && product.category !== 'catering-desserts' && !['sp-4', 'sp-5', 'sp-6', 'sp-9', 'cyo-sicilian-pesto', 'sp-17'].includes(product.id) && (
                    <div className="flex gap-2">
                      <button
                        onClick={() => setSelectedSize('medium')}
                        className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'medium'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        {product.category === 'catering-pasta' || product.category === 'catering-entrees' || product.category === 'catering-salad-soups' || product.name.includes('Tray') ? 'Medium' : product.category === 'pasta' ? 'Medium' : product.id.startsWith('stromboli-') ? '10" Medium' : (product.id === 'calzone-1' || product.id === 'calzone-2') ? '8" Medium' : '14" Medium'}
                      </button>
                      <button
                        onClick={() => setSelectedSize('large')}
                        className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                          selectedSize === 'large'
                            ? 'border-[#A72020] bg-[#A72020] text-white'
                            : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                        }`}
                      >
                        {product.category === 'catering-pasta' || product.category === 'catering-entrees' || product.category === 'catering-salad-soups' || product.name.includes('Tray') ? 'Large' : product.category === 'pasta' ? 'Large' : (product.id === 'calzone-1' || product.id === 'calzone-2') ? '14" Large' : '16" Large'}
                      </button>
                      {/* Hide Jumbo for Calzone, Turnover, Stromboli, Catering Trays and Catering Salad/Soups */}
                      {product.id !== 'calzone-1' && product.id !== 'calzone-2' && !product.id.startsWith('stromboli-') && product.category !== 'catering-pasta' && product.category !== 'catering-appetizers' && product.category !== 'catering-entrees' && product.category !== 'catering-salad-soups' && !product.name.includes('Tray') && (
                        <button
                          onClick={() => setSelectedSize('jumbo')}
                          className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                            selectedSize === 'jumbo'
                              ? 'border-[#A72020] bg-[#A72020] text-white'
                              : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                          }`}
                        >
                          {product.category === 'pasta' ? 'Jumbo' : '18" Jumbo'}
                        </button>
                      )}
                    </div>
                  )}
                </div>
              )}
              
              {/* Soups Size Selection - Only 16oz and 32oz - Desktop */}
              {product.category === 'soups' && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select your preferred size</p>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setSelectedSize('medium')}
                      className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                        selectedSize === 'medium'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16oz
                    </button>
                    <button
                      onClick={() => setSelectedSize('large')}
                      className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                        selectedSize === 'large'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      32oz
                    </button>
                  </div>
                </div>
              )}
              
              {/* Wings Size Selection - Desktop (excluding Chicken Tenders and Mozzarella Sticks) */}
              {((product.category === 'wings' || product.category === 'catering-appetizers' || product.id === 'app18') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4') && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select your quantity</p>
                  <div className="flex flex-wrap gap-1.5">
                    <button
                      onClick={() => {
                        setSelectedSize('10');
                        setSelectedWingsQuantity('10pcs');
                      }}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedSize === '10'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 PCS
                    </button>
                    <button
                      onClick={() => {
                        setSelectedSize('20');
                        setSelectedWingsQuantity('20pcs');
                      }}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                    <button
                      onClick={() => {
                        setSelectedSize('30');
                        setSelectedWingsQuantity('30pcs');
                      }}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedSize === '30'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 PCS
                    </button>
                    <button
                      onClick={() => {
                        setSelectedSize('50');
                        setSelectedWingsQuantity('50pcs');
                      }}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedSize === '50'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Party Trays Size Selection - Desktop - Only for specific trays (10PCS and 20PCS) */}
              {(product.id === 'cptray1' || product.id === 'cptray2' || product.id === 'cptray4' || product.id === 'cptray5' || product.id === 'cptray6') && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setSelectedSize('10')}
                      className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '10'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Mini Cannoli Tray Size Selection - Desktop - Only for cptray3 (20PCS and 40PCS) */}
              {product.id === 'cptray3' && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setSelectedSize('20')}
                      className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '20'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 PCS
                    </button>
                    <button
                      onClick={() => setSelectedSize('40')}
                      className={`px-5 py-1.5 rounded-lg border-2 transition-colors ${
                        selectedSize === '40'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      40 PCS
                    </button>
                  </div>
                </div>
              )}
              
              {/* Chicken Tenders Quantity Selection - Desktop - For wing3, app6, and capp2 */}
              {(product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex flex-wrap gap-1.5">
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('4pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedChickenTendersQuantity === '4pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      4 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('8pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedChickenTendersQuantity === '8pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      8 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('16pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedChickenTendersQuantity === '16pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('32pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedChickenTendersQuantity === '32pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      32 pcs
                    </button>
                    <button
                      onClick={() => setSelectedChickenTendersQuantity('64pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedChickenTendersQuantity === '64pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      64 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Mozzarella Sticks Quantity Selection - Desktop - For app4, wing4, and capp3 */}
              {(product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex flex-wrap gap-1.5">
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('6pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedMozzarellaSticksQuantity === '6pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      6 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('12pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedMozzarellaSticksQuantity === '12pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      12 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('24pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedMozzarellaSticksQuantity === '24pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      24 pcs
                    </button>
                    <button
                      onClick={() => setSelectedMozzarellaSticksQuantity('48pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedMozzarellaSticksQuantity === '48pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      48 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Arancini Rice Ball Regular Menu Quantity Selection - Desktop - For app8 */}
              {product.id === 'app8' && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex flex-wrap gap-1.5">
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('1pc')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniRegularQuantity === '1pc'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      1 pc
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('2pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniRegularQuantity === '2pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      2 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('4pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniRegularQuantity === '4pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      4 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('8pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniRegularQuantity === '8pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      8 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniRegularQuantity('16pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniRegularQuantity === '16pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      16 pcs
                    </button>
                  </div>
                </div>
              )}
              
              {/* Arancini Rice Ball Catering Quantity Selection - Desktop - For capp4 */}
              {product.id === 'capp4' && (
                <div className="mb-2">
                  <p className="text-gray-600 mb-2">Select quantity</p>
                  <div className="flex flex-wrap gap-1.5">
                    <button
                      onClick={() => setSelectedAranciniQuantity('10pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniQuantity === '10pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      10 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('20pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniQuantity === '20pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      20 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('30pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniQuantity === '30pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      30 pcs
                    </button>
                    <button
                      onClick={() => setSelectedAranciniQuantity('50pcs')}
                      className={`px-3 py-1.5 rounded-lg border-2 transition-colors flex-1 min-w-[60px] ${
                        selectedAranciniQuantity === '50pcs'
                          ? 'border-[#A72020] bg-[#A72020] text-white'
                          : 'border-gray-300 bg-white text-gray-900 hover:border-[#A72020]'
                      }`}
                    >
                      50 pcs
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
          </div>
        </div>

        {/* Add to Cart Bar - Mobile & Desktop: Sticky Bottom */}
        <div data-testid="add-to-cart-bar" className="sticky bottom-0 lg:sticky lg:bottom-0 bg-white border-t shadow-lg lg:shadow-none z-[100] lg:z-auto flex-shrink-0 lg:h-auto lg:min-h-0 box-border lg:row-start-2 lg:col-start-1 lg:w-full lg:max-w-full lg:min-w-0">
        <div className="px-3 sm:px-4 lg:px-8 py-3 lg:py-2 relative shadow-[0_-4px_12px_-2px_rgba(0,0,0,0.08)] lg:shadow-none h-full lg:h-auto lg:flex lg:items-center lg:justify-center box-border">
          {/* Mobile Layout */}
          <div className="lg:hidden flex items-center justify-between gap-2 sm:gap-3">
            {/* Quantity Section */}
            <div className="flex items-center gap-2 flex-shrink-0">
              <span className="text-white font-semibold bg-[#A72020] px-2 sm:px-3 py-1.5 sm:py-2 rounded text-sm sm:text-base whitespace-nowrap">Qty: {quantity}</span>
            </div>

            {/* Add to Cart Button with Price */}
            <Button
              onClick={() => {
                // Validate toast and cheese options for cheesesteaks
                let hasError = false;

                // Validate Buffalo Chicken Stromboli dipping selection
                if (product.name === 'Buffalo Chicken Stromboli') {
                  const hasSelection = selectedExtraSauce.some(id => ['bc', 'br', 'none'].includes(id));
                  if (!hasSelection) {
                    setDippingError(true);
                    hasError = true;
                    setTimeout(() => {
                        dippingErrorRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                  }
                }
                
                if (product.category === 'cheesesteaks' && !toastRoll) {
                  setToastOptionError(true);
                  hasError = true;
                }
                
                // Validate cheese for all cheesesteaks
                if (product.category === 'cheesesteaks') {
                  if (!selectedCheese) {
                    setCheeseOptionError(true);
                    hasError = true;
                  }
                }
                
                // Validate cheese for all hot hoagies
                if (product.category === 'hot-hoagies') {
                  if (!toastRoll) {
                    setToastOptionError(true);
                    hasError = true;
                  }
                  // Cheese is optional for Grilled Chicken Hoagie
                  if (product.name !== 'Grilled Chicken Hoagie' && !selectedHotHoagieCheese) {
                    setHotHoagieCheeseError(true);
                    hasError = true;
                  }
                }
                
                // Validate cheese for all burgers (except Hamburger which is optional)
                if (product.category === 'burgers') {
                  if (!toastRoll) {
                    setToastOptionError(true);
                    hasError = true;
                  }
                  if (product.name !== 'Hamburger' && selectedBurgerCheese.length === 0) {
                    setBurgerCheeseError(true);
                    hasError = true;
                  }
                }

                // Validate for brioche
                if (product.category === 'brioche') {
                  if (!toastRoll) {
                    setToastOptionError(true);
                    hasError = true;
                  }
                }
                
                // Validate sauce choice for wings
                if ((product.id === 'app18' || ((product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) && !selectedWingsSauce) {
                  setWingsSauceError(true);
                  hasError = true;
                }
                
                // Validate special instructions for wings
                if ((product.id === 'app18' || ((product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) && selectedWingsSpecialInstructions.length === 0) {
                  setWingsSpecialInstructionsError(true);
                  hasError = true;
                }
                
                // Validate panini type selection
                if (product.category === 'paninis' && !selectedPaniniType) {
                  setPaniniTypeError(true);
                  hasError = true;
                }
                
                // Validate wrap type selection
                if (product.category === 'wraps' && !selectedWrapType) {
                  setWrapTypeError(true);
                  hasError = true;
                }
                
                // Validate wrap cheese selection for cheesesteak wraps, chicken caesar wrap, grilled chicken wrap, and italian wrap
                if ((product.name === 'Buffalo Chicken Cheesesteak Wrap' || 
                     product.name === 'Cheesesteak Wrap' || 
                     product.name === 'Chicken Cheesesteak Wrap' ||
                     product.name === 'Chicken Caesar Wrap' ||
                     product.name === 'Grilled Chicken Wrap' ||
                     product.name === 'Italian Wrap' ||
                     product.name === 'Veggie Wrap') && !selectedWrapCheese) {
                  setWrapCheeseError(true);
                  hasError = true;
                }
                
                // Validate Create Your Own Kids Pasta selections (k1)
                if (product.id === 'k1') {
                  if (!selectedKidsPastaType) {
                    setKidsPastaTypeError(true);
                    hasError = true;
                  }
                  if (!selectedKidsPastaSauce) {
                    setKidsPastaSauceError(true);
                    hasError = true;
                  }
                }
                
                // Validate Kids Pasta and Meatball pasta type selection (k6)
                if (product.id === 'k6' && !selectedKidsPastaMeatballType) {
                  setKidsPastaMeatballTypeError(true);
                  hasError = true;
                }
                
                // Validate Build Your Own Pasta selections (cp-1)
                if (product.id === 'cp-1') {
                  if (!selectedBuildPastaType) {
                    setBuildPastaTypeError(true);
                    hasError = true;
                  }
                  if (!selectedBuildPastaSauce) {
                    setBuildPastaSauceError(true);
                    hasError = true;
                  }
                }
                
                // Validate Catering Pasta with Sauce pasta type selection (cp7-cp11)
                if (product.id === 'cp7' || product.id === 'cp8' || product.id === 'cp9' || product.id === 'cp10' || product.id === 'cp11') {
                  if (!selectedPastaType) {
                    setCateringPastaTypeError(true);
                    hasError = true;
                  }
                }
                
                // Validate Traditional Dinners and Fish selections (exactly 2 sides required)
                if (product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) {
                  if (selectedTraditionalDinnersSides.length !== 2) {
                    setTraditionalDinnersSidesError(true);
                    hasError = true;
                  }
                }
                
                // Validate Seafood Pasta Type selection for sf-6, sf-7, sf-8, sf-9, sf-10
                if (['sf-6', 'sf-7', 'sf-8', 'sf-9', 'sf-10'].includes(product.id) && !selectedSeafoodPastaType) {
                  setSeafoodPastaTypeError(true);
                  hasError = true;
                }
                
                // Validate Substitute Sauce selection for sf-6 (Calamari Marinara)
                if (product.id === 'sf-6' && !selectedCalamariSubSauce) {
                  setCalamariAppetizerSauceError(true);
                  hasError = true;
                }
                
                // Validate Sauce selection for sf-7 (Baby Clam Sauce Tray)
                if (product.id === 'sf-7' && !selectedBabyClamSauceChoice) {
                  setBabyClamSauceError(true);
                  hasError = true;
                }

                // Validate Sauce selection for sf-8 (Mussels Tray)
                if (product.id === 'sf-8' && !selectedMusselsSauce) {
                  setMusselsAppetizerSauceError(true);
                  hasError = true;
                }

                // Validate Sauce selection for sf-9 (Seafood Combo Tray)
                if (product.id === 'sf-9' && !selectedSeafoodComboSauce) {
                  setSeafoodComboAppetizerSauceError(true);
                  hasError = true;
                }
                
                // Validate Substitute Sauce selection for sf-10 (Shrimp Marinara)
                if (product.id === 'sf-10' && !selectedShrimpMarinaraSubSauce) {
                  setShrimpMarinaraSubSauceError(true);
                  hasError = true;
                }
                
                // Validate Seafood Appetizer Sauce selection (sf-2, sf-3, sf-4, sf-5, app15, app16)
                if (product.id === 'sf-2' && !selectedSeafoodSauceId) {
                  setCalamariSauceError(true);
                  hasError = true;
                }
                
                if (product.id === 'sf-3' && !selectedMusselsSauce) {
                  setMusselsSauceAppetizerError(true);
                  hasError = true;
                }
                
                if (product.id === 'sf-4' && !selectedSeafoodComboSauce) {
                  setSeafoodComboSauceAppetizerError(true);
                  hasError = true;
                }
                
                if (product.id === 'sf-5' && !selectedSeafoodSauceId) {
                  setShrimpSauceError(true);
                  hasError = true;
                }
                
                if (product.id === 'app14' && !selectedCalamariSubSauce) {
                  setCalamariAppetizerSauceError(true);
                  hasError = true;
                }
                
                if (product.id === 'app15' && !selectedMusselsSauce) {
                  setMusselsAppetizerSauceError(true);
                  hasError = true;
                }
                
                if (product.id === 'app16' && !selectedSeafoodComboSauce) {
                  setSeafoodComboAppetizerSauceError(true);
                  hasError = true;
                }
                
                if (product.id === 'app17' && !selectedShrimpMarinaraSubSauce) {
                  setShrimpAppetizerSauceError(true);
                  hasError = true;
                }
                
                // Validate salad base selection for create-salad and specialty salads
                if ((product.category === 'create-salad' || product.category === 'salads') && !selectedSaladBase) {
                  setSaladBaseError(true);
                  hasError = true;
                }
                
                // Validate salad dressing selection for create-salad and specialty salads
                if ((product.category === 'create-salad' || product.category === 'salads') && !selectedSaladDressing) {
                  setSaladDressingError(true);
                  hasError = true;
                }
                
                // Validate Catering Salads base and dressing selection (csalad1-7)
                if (product.category === 'catering-salad-soups') {
                  let baseSelected = false;
                  let dressingSelected = false;
                  
                  if (product.id === 'csalad1') {
                    baseSelected = !!selectedAntipastoBase;
                    dressingSelected = selectedAntipastoDressings.length > 0;
                  } else if (product.id === 'csalad2') {
                    baseSelected = !!selectedCaesarBase;
                    dressingSelected = selectedCaesarDressings.length > 0;
                  } else if (product.id === 'csalad3') {
                    baseSelected = !!selectedChickenCaesarBase;
                    dressingSelected = selectedChickenCaesarDressings.length > 0;
                  } else if (product.id === 'csalad4') {
                    baseSelected = !!selectedGardenBase;
                    dressingSelected = selectedGardenDressings.length > 0;
                  } else if (product.id === 'csalad5') {
                    baseSelected = !!selectedRoastedRedPepperBase;
                    dressingSelected = selectedRoastedRedPepperDressings.length > 0;
                  } else if (product.id === 'csalad6') {
                    baseSelected = !!selectedThreeCheeseBase;
                    dressingSelected = selectedThreeCheeseDressings.length > 0;
                  } else if (product.id === 'csalad7') {
                    baseSelected = !!selectedTraditionalChefBase;
                    dressingSelected = selectedTraditionalChefDressings.length > 0;
                  }
                  
                  if (!baseSelected) {
                    setCateringSaladBaseError(true);
                    hasError = true;
                  }
                  if (!dressingSelected) {
                    setCateringSaladDressingError(true);
                    hasError = true;
                  }
                }

                // Validate Catering Seafood Pasta Types (cs1, cs2, cs4, cs5, cs6)
                if (product.id === 'cs1' && !selectedBabyClamPastaType) {
                  setBabyClamPastaTypeError(true);
                  hasError = true;
                }
                if (product.id === 'cs2' && !selectedCalamariPastaType) {
                  setCalamariPastaTypeError(true);
                  hasError = true;
                }
                if (product.id === 'cs4' && !selectedMusselsPastaType) {
                  setMusselsPastaTypeError(true);
                  hasError = true;
                }
                if (product.id === 'cs5' && !selectedSeafoodComboPastaType) {
                  setSeafoodComboPastaTypeError(true);
                  hasError = true;
                }
                if (product.id === 'cs6' && !selectedShrimpMarinaraPastaType) {
                  setShrimpMarinaraPastaTypeError(true);
                  hasError = true;
                }

                // Validate Catering Seafood Sauce Choices (cs1, cs2, cs4, cs5, cs6)
                if (product.id === 'cs1' && !selectedBabyClamSauceChoice) {
                  setBabyClamSauceError(true);
                  hasError = true;
                }
                if (product.id === 'cs2' && !selectedCalamariSubstituteSauce) {
                  setCalamariSauceError(true);
                  hasError = true;
                }
                if (product.id === 'cs4' && !selectedMusselsSauceChoice) {
                  setMusselsSauceError(true);
                  hasError = true;
                }
                if (product.id === 'cs5' && !selectedSeafoodComboSauceChoice) {
                  setSeafoodComboSauceError(true);
                  hasError = true;
                }
                if (product.id === 'cs6' && !selectedShrimpMarinaraSubstituteSauce) {
                  setShrimpMarinaraSauceError(true);
                  hasError = true;
                }

                // Validate Pasta e Fagioli Substitute selection
                if (product.id === 'soup1' && !selectedPastaFagioliSubstitute) {
                  setPastaFagioliSubstituteError(true);
                  hasError = true;
                }

                // Validate Hoagie Platter selection (min 4 sandwiches)
                if (product.id === 'c13') {
                  const totalSandwiches = Object.values(selectedHoagiePlatterOptions).reduce((sum, count) => sum + count, 0);
                  if (totalSandwiches < 4) {
                    setHoagiePlatterError(true);
                    hasError = true;
                  }
                }

                // Validate Wrap Platter selection (min 4 items and required wrap type)
                if (product.id === 'c14') {
                  const totalWraps = Object.values(selectedWrapPlatterOptions).reduce((sum, count) => sum + count, 0);
                  if (totalWraps < 4) {
                    setWrapPlatterError(true);
                    setIsAdditionalOpen(true);
                    hasError = true;
                  }
                  if (!selectedWrapPlatterWrapType) {
                    setWrapPlatterWrapTypeError(true);
                    setIsSpecialInstructionsOpen(true);
                    hasError = true;
                  }
                }

                // Validate Hot Sandwich Platter selection (min 4 sandwiches)
                if (product.id === 'c15') {
                  const totalSandwiches = Object.values(selectedHotSandwichPlatterOptions).reduce((sum, count) => sum + count, 0);
                  if (totalSandwiches < 4) {
                    setHotSandwichPlatterError(true);
                    setIsAdditionalOpen(true);
                    hasError = true;
                  }
                }
                
                // If there are errors, scroll to the first error and return
                if (hasError) {
                  if (!toastRoll && toastOptionRef.current) {
                    toastOptionRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (cheeseOptionRef.current) {
                    cheeseOptionRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (hotHoagieCheeseRef.current) {
                    hotHoagieCheeseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (coldHoagieSideToppingsRequiredRef.current) {
                    coldHoagieSideToppingsRequiredRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (burgerCheeseRef.current) {
                    burgerCheeseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (wingsSauceRef.current) {
                    wingsSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (wingsSpecialInstructionsRef.current) {
                    wingsSpecialInstructionsRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (paniniTypeRef.current) {
                    paniniTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (wrapTypeRef.current) {
                    wrapTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (wrapCheeseRef.current) {
                    wrapCheeseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (kidsPastaTypeRef.current) {
                    kidsPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (kidsPastaSauceRef.current) {
                    kidsPastaSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (kidsPastaMeatballTypeRef.current) {
                    kidsPastaMeatballTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (buildPastaTypeRef.current) {
                    buildPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (buildPastaSauceRef.current) {
                    buildPastaSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (cateringPastaTypeRef.current) {
                    cateringPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (traditionalDinnersSidesRef.current) {
                    traditionalDinnersSidesRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (seafoodPastaTypeRef.current) {
                    seafoodPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (saladBaseRef.current) {
                    saladBaseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (saladDressingRef.current) {
                    saladDressingRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (saladToppingsRef.current) {
                    saladToppingsRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (cateringSaladBaseRef.current) {
                    cateringSaladBaseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (cateringSaladDressingRef.current) {
                    cateringSaladDressingRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (babyClamPastaTypeRef.current) {
                    babyClamPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (calamariPastaTypeRef.current) {
                    calamariPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (musselsPastaTypeRef.current) {
                    musselsPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (seafoodComboPastaTypeRef.current) {
                    seafoodComboPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (shrimpMarinaraPastaTypeRef.current) {
                    shrimpMarinaraPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (babyClamSauceRef.current) {
                    babyClamSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (calamariSauceRef.current) {
                    calamariSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (musselsSauceRef.current) {
                    musselsSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (seafoodComboSauceRef.current) {
                    seafoodComboSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (shrimpMarinaraSauceRef.current) {
                    shrimpMarinaraSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (hoagiePlatterRef.current) {
                    hoagiePlatterRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (wrapPlatterRef.current) {
                    wrapPlatterRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (wrapPlatterWrapTypeRef.current) {
                    wrapPlatterWrapTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (hotSandwichPlatterRef.current) {
                    hotSandwichPlatterRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                  return;
                }
                
                let modifiedProduct = { ...product };
                
                if (product.id === 'app1') {
                  const sizeOption = garlicBreadSizeOptions.find(opt => opt.id === selectedGarlicBreadSize);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                } else if (product.id === 'app2') {
                  const sizeOption = garlicBreadMozzarellaSizeOptions.find(opt => opt.id === selectedGarlicBreadMozzarellaSize);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                } else if (product.id === 'app18') {
                  const sizeOption = wingsQuantityOptions.find(opt => opt.id === selectedWingsQuantity);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                } else if (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') {
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${selectedSize} pcs)`
                  };
                } else if (product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') {
                  const sizeOption = chickenTendersQuantityOptions.find(opt => opt.id === selectedChickenTendersQuantity);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                } else if (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') {
                  const sizeOption = mozzarellaSticksQuantityOptions.find(opt => opt.id === selectedMozzarellaSticksQuantity);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                } else if (product.id === 'app8') {
                  const sizeOption = aranciniRegularQuantityOptions.find(opt => opt.id === selectedAranciniRegularQuantity);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                } else if (product.id === 'capp4') {
                  const sizeOption = aranciniQuantityOptions.find(opt => opt.id === selectedAranciniQuantity);
                  modifiedProduct = {
                    ...product,
                    name: `${product.name} (${sizeOption?.name})`,
                    price: `$${sizeOption?.price.toFixed(2)}`
                  };
                }
                
                // Build customizations array (LEGACY)
                const customizations: CartItemCustomization[] = [];
                
                // Build selections array (NEW STRUCTURED MODEL)
                const selections: CartSelection[] = [];
                
                // ============================================================
                // DEBUG LOGGING - PHASE 1: RAW UI SELECTIONS
                // ============================================================
                if (debugCartEnabled) {
                  console.log(' DEBUG TOPPINGS - Phase 1: UI Selections', {
                    productId: product.id,
                    productName: product.name,
                    productCategory: product.category,
                    rawUiSelections: {
                      // Pizza toppings
                      selectedToppings,
                      selectedAddToppings,
                      selectedLiteToppings,
                      selectedNoToppings,
                      selectedSideToppings,
                      selectedExtraSauce,
                      // Cheesesteak toppings
                      selectedNoToppingsCheesesteak,
                      // Hot Hoagie toppings & extras
                      selectedHotHoagieExtras,
                      selectedHotHoagieInstructions,
                      selectedHotHoagieSides,
                      selectedGrilledChickenNoToppings,
                      selectedSausagePeppersOnionsNoToppings,
                      selectedCheeseBurgerDeluxeNoToppings,
                      // Cold Hoagie toppings
                      selectedColdHoagieToppings,
                      selectedColdHoagieExtras,
                      selectedColdHoagieLite,
                      selectedColdHoagieNo,
                      selectedColdHoagieSides,
                      // Burger toppings
                      selectedBurgerAdd,
                      selectedBurgerExtra,
                      selectedBurgerLite,
                      selectedBurgerSide,
                      // Wrap toppings
                      selectedWrapAddToppings,
                      selectedWrapLite,
                      selectedWrapNo,
                      selectedWrapSide,
                      // Panini toppings
                      selectedPaniniLite,
                      selectedPaniniNo,
                      selectedPaniniSides,
                      // Brioche toppings
                      selectedBriocheNo,
                      selectedBriocheSide,
                      selectedBriocheGrilledChickenNoToppings,
                      // Kids & Pasta toppings
                      selectedKidsPastaToppings,
                      selectedKidsBakedExtraToppings,
                      selectedKidsBakedLiteToppings,
                      selectedKidsBakedNoToppings,
                      selectedBuildPastaToppings,
                      // Salad toppings
                      selectedSaladToppings,
                      selectedExtraToppings,
                      selectedExtraDressing,
                      // Special Instructions
                      selectedSpecialInstructions,
                      selectedBrooklynInstructions,
                      selectedSaladSpecialInstructions,
                      selectedWingsSpecialInstructions,
                    }
                  });
                }
                
                // ============================================================
                // BUILD CANONICAL LOOKUP FROM OPTION CONFIGURATION
                // This ensures labels & groupTitles match EXACTLY what UI shows
                // ============================================================
                const selectionLookup: SelectionLookup = { byOptionId: {} };
                
                // Register Toast Options (for Cheesesteaks, Burgers, Brioche)
                const toastOptions = [
                  { id: 'toast', name: (product.category === 'burgers' || product.category === 'brioche') ? 'Toast Bun' : 'Toast Roll' },
                  { id: 'no-toast', name: (product.category === 'burgers' || product.category === 'brioche') ? "Don't Toast Bun" : "Don't Toast Roll" }
                ];
                registerOptionsToLookup(selectionLookup, toastOptions, {
                  groupId: 'toast_option',
                  groupTitle: 'Toast Option (Required)',
                  type: 'required_option'
                });
                
                // Register Size Options
                const allSizeOptions = [
                  { id: 'medium', name: 'Medium (14")' },
                  { id: 'large', name: 'Large (16")' },
                  { id: 'jumbo', name: 'Jumbo (18")' },
                  { id: '10', name: '10 pcs' },
                  { id: '20', name: '20 pcs' },
                  { id: '30', name: '30 pcs' },
                  { id: '40', name: '40 pcs' },
                  { id: '50', name: '50 pcs' },
                ];
                registerOptionsToLookup(selectionLookup, allSizeOptions, {
                  groupId: 'size_options',
                  groupTitle: 'Size',
                  type: 'size'
                });

                // Register Wings Quantity Options (app18)
                registerOptionsToLookup(selectionLookup, wingsQuantityOptions, {
                  groupId: 'wings_quantity',
                  groupTitle: 'Quantity',
                  type: 'required_option'
                });

                // Register Chicken Tenders Quantity Options (app6)
                registerOptionsToLookup(selectionLookup, chickenTendersQuantityOptions, {
                  groupId: 'chicken_tenders_quantity',
                  groupTitle: 'Quantity',
                  type: 'required_option'
                });

                // Register Wings Sauce Options (app18, app6)
                registerOptionsToLookup(selectionLookup, wingsSauceOptions, {
                  groupId: 'wings_sauce',
                  groupTitle: 'Sauce',
                  type: 'sauce'
                });

                // Register Wings Special Instructions Options
                registerOptionsToLookup(selectionLookup, wingsSpecialInstructionsOptions, {
                  groupId: 'wings_special_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Chicken Tenders Special Instructions Options
                registerOptionsToLookup(selectionLookup, chickenTendersSpecialInstructionsOptions, {
                  groupId: 'chicken_tenders_special_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Onion Rings Special Instructions Options
                registerOptionsToLookup(selectionLookup, onionRingsInstructionsOptions, {
                  groupId: 'onion_rings_instructions',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });

                // Register Mac & Cheese Bites Instructions Options
                registerOptionsToLookup(selectionLookup, macAndCheeseBitesInstructionsOptions, {
                  groupId: 'mac_cheese_bites_instructions',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });

                // Register Broccoli & Cheddar Bites Instructions Options
                registerOptionsToLookup(selectionLookup, broccoliCheddarBitesInstructionsOptions, {
                  groupId: 'broccoli_cheddar_bites_instructions',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });

                // Register French Fries Instructions Options
                registerOptionsToLookup(selectionLookup, friesInstructionsOptions, {
                  groupId: 'fries_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Passariello Fries Instructions Options
                registerOptionsToLookup(selectionLookup, passarielloFriesInstructionsOptions, {
                  groupId: 'passariello_fries_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Cheddar Steak Fries Instructions Options
                registerOptionsToLookup(selectionLookup, cheddarSteakFriesInstructionsOptions, {
                  groupId: 'cheddar_steak_fries_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Garlic Stick Instructions Options
                registerOptionsToLookup(selectionLookup, garlicStickInstructionsOptions, {
                  groupId: 'garlic_stick_instructions',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });

                // Register Garlic Bread Instructions Options
                registerOptionsToLookup(selectionLookup, garlicBreadInstructionsOptions, {
                  groupId: 'garlic_bread_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Garlic Bread Mozzarella Instructions Options
                registerOptionsToLookup(selectionLookup, garlicBreadMozzarellaInstructionsOptions, {
                  groupId: 'garlic_bread_mozzarella_instructions',
                  groupTitle: 'Special Instructions',
                  type: 'special_instruction'
                });

                // Register Mozzarella Sticks Instructions Options
                registerOptionsToLookup(selectionLookup, mozzarellaSticksInstructionsOptions, {
                  groupId: 'mozzarella_sticks_instructions',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });

                // Register Mozzarella Sticks Special Instructions Options
                registerOptionsToLookup(selectionLookup, mozzarellaSticksSpecialInstructionsOptions, {
                  groupId: 'mozzarella_sticks_special_instructions',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });

                // Register Mozzarella Sticks Quantity Options
                registerOptionsToLookup(selectionLookup, mozzarellaSticksQuantityOptions, {
                  groupId: 'mozzarella_sticks_quantity',
                  groupTitle: 'Quantity',
                  type: 'required_option'
                });

                // Register Arancini Quantity Options
                registerOptionsToLookup(selectionLookup, aranciniQuantityOptions, {
                  groupId: 'arancini_quantity',
                  groupTitle: 'Quantity',
                  type: 'required_option'
                });

                // Register Arancini Special Instructions Options
                registerOptionsToLookup(selectionLookup, aranciniSpecialInstructionsOptions, {
                  groupId: 'arancini_special_instructions',
                  groupTitle: 'Extra Sauce',
                  type: 'special_instruction'
                });

                // Register Arancini Regular Quantity Options
                registerOptionsToLookup(selectionLookup, aranciniRegularQuantityOptions, {
                  groupId: 'arancini_regular_quantity',
                  groupTitle: 'Quantity',
                  type: 'required_option'
                });

                // Register Garlic Bread Size Options
                registerOptionsToLookup(selectionLookup, garlicBreadSizeOptions, {
                  groupId: 'garlic_bread_size',
                  groupTitle: 'Size',
                  type: 'size'
                });

                // Register Garlic Bread with Mozzarella Size Options
                registerOptionsToLookup(selectionLookup, garlicBreadMozzarellaSizeOptions, {
                  groupId: 'garlic_bread_mozzarella_size',
                  groupTitle: 'Size',
                  type: 'size'
                });

                // Register Pizza Sauce Options
                const allSauceOptions = [
                  { id: 'sauce-pizza', name: 'Red Sauce' }
                ];
                registerOptionsToLookup(selectionLookup, allSauceOptions, {
                  groupId: 'pizza_sauce',
                  groupTitle: 'Sauce',
                  type: 'sauce'
                });

                // Register Buffalo Chicken Stromboli Dipping Options
                const buffaloChickenStromboliDipperOptions = [
                   { id: 'bc', name: 'Bleu Cheese', price: 0, image: 'https://images.unsplash.com/photo-1754652327423-4e71f0d71b25?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxibGV1JTIwY2hlZXNlJTIwZGlwJTIwc2F1Y2V8ZW58MXx8fHwxNzY5ODkxMzk1fDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
                   { id: 'br', name: 'Buttermilk Ranch', price: 0, image: 'https://images.unsplash.com/photo-1662142959468-acc8e6b6e629?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxidXR0ZXJtaWxrJTIwcmFuY2glMjBkaXAlMjBzYXVjZXxlbnwxfHx8fDE3Njk4OTEzOTh8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
                   { id: 'none', name: 'None', price: 0, image: null }
                ];
                registerOptionsToLookup(selectionLookup, buffaloChickenStromboliDipperOptions, {
                   groupId: 'buffalo_chicken_stromboli_dipping',
                   groupTitle: 'Choose Dipping',
                   type: 'sauce'
                });

                // Register Standard Stromboli Extra Sauce Options
                registerOptionsToLookup(selectionLookup, extraSauceOptions, {
                   groupId: 'stromboli_extra_sauce',
                   groupTitle: 'Extra Sauce (Optional)',
                   type: 'sauce'
                });

                // Register ALL option arrays with their banner/group titles
                registerOptionsToLookup(selectionLookup, traditionalDinnersSides, {
                  groupId: 'traditional_dinner_sides',
                  groupTitle: '1. Add Sides (Required - Choose 2)',
                  type: 'side'
                });
                registerOptionsToLookup(selectionLookup, traditionalDinnersSoupsSalads, {
                  groupId: 'traditional_dinner_soups_salads',
                  groupTitle: 'Side Soups, Salads, & Extra Bread (Optional)',
                  type: 'side'
                });
                registerOptionsToLookup(selectionLookup, includedToppings, {
                  groupId: 'included_toppings',
                  groupTitle: 'Included Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, additionalToppings, {
                  groupId: 'additional_toppings',
                  groupTitle: 'Additional Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, specialtyToppings, {
                  groupId: 'specialty_toppings',
                  groupTitle: 'Specialty Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, noToppings, {
                  groupId: 'no_toppings',
                  groupTitle: 'No Toppings',
                  type: 'no_topping'
                });
                registerOptionsToLookup(selectionLookup, hotHoagieExtraToppings, {
                  groupId: 'hot_hoagie_extras',
                  groupTitle: 'Extras',
                  type: 'extra_topping'
                });
                registerOptionsToLookup(selectionLookup, coldHoagieAddToppings, {
                  groupId: 'cold_hoagie_add',
                  groupTitle: 'Add Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, burgerAddToppings, {
                  groupId: 'burger_add',
                  groupTitle: 'Add Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, burgerExtraToppings, {
                  groupId: 'burger_extra',
                  groupTitle: 'Extra Toppings',
                  type: 'extra_topping'
                });
                registerOptionsToLookup(selectionLookup, burgerSideToppings, {
                  groupId: 'burger_side',
                  groupTitle: 'Side Toppings',
                  type: 'side'
                });
                registerOptionsToLookup(selectionLookup, wrapAddToppings, {
                  groupId: 'wrap_add',
                  groupTitle: 'Add Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, wrapSubstituteCheese, {
                  groupId: 'wrap_cheese',
                  groupTitle: 'Substitute Cheese',
                  type: 'cheese'
                });
                registerOptionsToLookup(selectionLookup, wrapExtraCheese, {
                  groupId: 'wrap_extra_cheese',
                  groupTitle: 'Extra Cheese',
                  type: 'extra_topping'
                });
                registerOptionsToLookup(selectionLookup, wrapLiteToppings, {
                  groupId: 'wrap_lite',
                  groupTitle: 'Lite Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, wrapNoToppings, {
                  groupId: 'wrap_no',
                  groupTitle: 'No Toppings',
                  type: 'no_topping'
                });
                registerOptionsToLookup(selectionLookup, wrapSideToppings, {
                  groupId: 'wrap_side',
                  groupTitle: 'Side Toppings',
                  type: 'side'
                });
                registerOptionsToLookup(selectionLookup, paniniLiteToppings, {
                  groupId: 'panini_lite',
                  groupTitle: 'Lite Toppings',
                  type: 'topping'
                });
                registerOptionsToLookup(selectionLookup, bakedPastaSides, {
                  groupId: 'baked_pasta_sides',
                  groupTitle: 'Sides',
                  type: 'side'
                });
                registerOptionsToLookup(selectionLookup, bakedPastaSpecialInstructions, {
                  groupId: 'baked_pasta_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, fishSpecialInstructions, {
                  groupId: 'fish_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, cateringEntreeSpecialInstructions, {
                  groupId: 'catering_entree_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, pastaFagioliSpecialInstructions, {
                  groupId: 'pasta_fagioli_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                
                // SALAD BOWLS  SPECIAL INSTRUCTIONS
                registerOptionsToLookup(selectionLookup, antipastoSaladSpecialInstructions, {
                  groupId: 'antipasto_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, caesarSaladSpecialInstructions, {
                  groupId: 'caesar_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, gardenSaladSpecialInstructions, {
                  groupId: 'garden_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, threeCheeseSaladSpecialInstructions, {
                  groupId: 'three_cheese_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, traditionalChefSaladSpecialInstructions, {
                  groupId: 'traditional_chef_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, calamariSaladSpecialInstructions, {
                  groupId: 'calamari_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, capreseSaladSpecialInstructions, {
                  groupId: 'caprese_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, farfallePastaSaladSpecialInstructions, {
                  groupId: 'farfalle_pasta_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, italianChoppedSpecialInstructions, {
                  groupId: 'italian_chopped_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, roastedRedPeppersSaladSpecialInstructions, {
                  groupId: 'roasted_red_peppers_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, tunaSaladSpecialInstructions, {
                  groupId: 'tuna_salad_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                
                // KIDS PASTA  SPECIAL INSTRUCTIONS
                registerOptionsToLookup(selectionLookup, kidsPastaSpecialInstructions, {
                  groupId: 'kids_pasta_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, kidsPastaMeatballSpecialInstructions, {
                  groupId: 'kids_pasta_meatball_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                
                // BROOKLYN PIZZA  SPECIAL INSTRUCTIONS
                registerOptionsToLookup(selectionLookup, specialInstructionsBrooklyn, {
                  groupId: 'brooklyn_pizza_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                
                // HOT HOAGIES  SPECIAL INSTRUCTIONS
                registerOptionsToLookup(selectionLookup, hotHoagieSpecialInstructions, {
                  groupId: 'hot_hoagie_special_instructions',
                  groupTitle: 'Special Instructions (Optional)',
                  type: 'special_instruction'
                });
                
                registerOptionsToLookup(selectionLookup, saladBaseOptions, {
                  groupId: 'salad_base',
                  groupTitle: 'Salad Base',
                  type: 'salad_base'
                });
                registerOptionsToLookup(selectionLookup, saladDressingOptions, {
                  groupId: 'salad_dressing',
                  groupTitle: 'Dressing',
                  type: 'dressing'
                });
                registerOptionsToLookup(selectionLookup, saladDressingInstructions, {
                  groupId: 'salad_dressing_instructions',
                  groupTitle: 'Dressing Instructions',
                  type: 'special_instruction'
                });
                registerOptionsToLookup(selectionLookup, kidsPastaTypes, {
                  groupId: 'kids_pasta_type',
                  groupTitle: 'Pasta Type',
                  type: 'pasta_type'
                });
                registerOptionsToLookup(selectionLookup, kidsPastaSauces, {
                  groupId: 'kids_pasta_sauce',
                  groupTitle: 'Sauce',
                  type: 'sauce'
                });
                registerOptionsToLookup(selectionLookup, pastaTypes, {
                  groupId: 'pasta_type',
                  groupTitle: 'Pasta Type',
                  type: 'pasta_type'
                });
                registerOptionsToLookup(selectionLookup, sauceOptions, {
                  groupId: 'pizza_sauce',
                  groupTitle: 'Sauce',
                  type: 'sauce'
                });
                registerOptionsToLookup(selectionLookup, cheeseOptions, {
                  groupId: 'cheese',
                  groupTitle: 'Cheese',
                  type: 'cheese'
                });
                registerOptionsToLookup(selectionLookup, wrapTypeOptions, {
                  groupId: 'wrap_type',
                  groupTitle: 'Wrap Type',
                  type: 'wrap_type'
                });
                registerOptionsToLookup(selectionLookup, beverageItems, {
                  groupId: 'beverages',
                  groupTitle: 'Beverages',
                  type: 'beverage'
                });
                registerOptionsToLookup(selectionLookup, dessertItems, {
                  groupId: 'desserts',
                  groupTitle: 'Desserts',
                  type: 'dessert'
                });
                
                // Register customizationOptions from the current product (e.g., Minucci No Toppings)
                if (product.customizationOptions) {
                  product.customizationOptions.forEach((customOption) => {
                    if (customOption.options && customOption.options.length > 0) {
                      registerOptionsToLookup(selectionLookup, customOption.options, {
                        groupId: customOption.id,
                        groupTitle: customOption.title,
                        type: 'no_topping'
                      });
                    }
                  });
                }
                
                // Register Extra Sides for Cheesesteaks
                registerOptionsToLookup(selectionLookup, extraSidesItems, {
                  groupId: 'extra_sides',
                  groupTitle: 'Would You Like To Add Extra Sides',
                  type: 'side'
                });

                // Register ALL missing arrays to reach ZERO warnings
                registerMissingArrays(selectionLookup, {
                  specialtyToppingsSecondHalf, extraToppings, liteToppings, specialInstructionsBrooklyn,
                  specialInstructionsOptions, pizzaDippingsOptions, cheesesteakToppings,
                  createYourOwnCheesesteakToppings, cheesesteakNoToppings, cheesesteakSideToppingsRequired,
                  burgerLiteToppings, burgerSubstituteCheese, briocheNoToppings,
                  briocheGrilledChickenNoToppings, briocheMozzarellaGrilledChickenNoToppings,
                  briocheSideToppings, briocheAddCheese, briocheExtraCheese, hotHoagieSides,
                  hotHoagieSpecialInstructions, hotHoagieExtraSides, hotHoagieSubstituteCheese,
                  grilledChickenHoagieNoToppings, sausagePeppersOnionsNoToppings,
                  cheeseBurgerDeluxeNoToppings, coldHoagieExtraToppings, coldHoagieLiteToppings,
                  coldHoagieNoToppings, coldHoagieSideToppings, coldHoagieAddCheese,
                  coldHoagieSideToppingsRequired, coldHoagieSideOfChips, paniniNoToppings,
                  paniniSideToppings, paniniChooseType, paniniExtraCheese, paniniSubstituteCheese,
                  wrapLiteToppings, wrapNoToppings, wrapSideToppings, wrapSubstituteCheese, wrapExtraCheese,
                  cheesesteakWrapLiteToppings, cheesesteakWrapNoToppings, grilledChickenWrapLiteToppings,
                  grilledChickenWrapNoToppings, italianWrapLiteToppings, italianWrapNoToppings,
                  pastaVegetables, pastaProteins, pastaCheesesExtras, pastaAdditions,
                  buildPastaSauces, buildPastaToppings, buildPastaSoups, seafoodPastaTypes,
                  babyClamPastaTypes, babyClamSauceChoices, calamariPastaTypes,
                  calamariSubstituteSauce, musselsPastaTypes, musselsSauceChoices,
                  seafoodComboPastaTypes, seafoodComboSauceChoices, shrimpMarinaraPastaTypes,
                  shrimpMarinaraSubstituteSauce, saladToppingsOptions, antipastoSaladBases,
                  antipastoSaladDressings, antipastoSaladSpecialInstructions,
                  caesarSaladSpecialInstructions, calamariSaladSpecialInstructions,
                  capreseSaladSpecialInstructions, farfallePastaSaladSpecialInstructions,
                  gardenSaladSpecialInstructions, italianChoppedSpecialInstructions,
                  roastedRedPeppersSaladSpecialInstructions, traditionalChefSaladSpecialInstructions,
                  tunaSaladSpecialInstructions, threeCheeseSaladSpecialInstructions,
                  kidsPastaToppings, kidsPastaSpecialInstructions, kidsBakedExtraToppings,
                  kidsBakedLiteToppings, kidsBakedNoToppings, kidsPastaMeatballToppings,
                  kidsPastaMeatballSpecialInstructions, mashedPotatoesToppings,
                  meatballsSausageSauceToppings, pastaFagioliSubstituteCracker,
                  pastaFagioliSubstituteOptions, wingsSpecialInstructionsOptions,
                  wingsExtraSauceOptions, wingsExtraCheeseRanchOptions,
                  chickenTendersExtraSauceOptions, mozzarellaSticksExtraSauceOptions,
                  mozzarellaSticksSpecialInstructionsOptions, aranciniSpecialInstructionsOptions,
                  hoagiePlatterOptions, hoagiePlatterCutOptions, hoagiePlatterSideToppings,
                  wrapPlatterOptions, wrapPlatterWrapTypes, wrapPlatterSideToppings,
                  hotSandwichPlatterOptions, hotSandwichPlatterCutOptions,
                  hotSandwichPlatterSideToppings, cannoliSpecialInstruction,
                  dessertTraySpecialInstruction,
                  calamariSubSauceOptions, musselsSauceOptions,
                  seafoodComboSauceOptions, marinaraAppetizerSauceOptions,
                  shrimpMarinaraSubSauceOptions
                });
                
                // Master helper function - now uses canonical lookup ONLY
                const getItemName = (id: string): string => {
                  if (!id) return '';
                  
                  // Special sauce override
                  if (id === 'sauce-white') return 'White Sauce';
                  if (id === 'sauce-pizza') return 'Red Sauce';

                  // Special case for pizza sizes (fixes console warnings)
                  if (id === 'medium') return 'Medium (14")';
                  if (id === 'large') return 'Large (16")';
                  if (id === 'jumbo') return 'Jumbo (18")';

                  // First, check the canonical lookup
                  const meta = selectionLookup.byOptionId[id];
                  if (meta) return meta.label;
                  
                  // Fallback: check allProducts for products that might not be in lookup
                  if (allProducts) {
                    const product = allProducts.find(p => p.id === id);
                    if (product) return product.name;
                  }
                  
                  // Last fallback: humanized ID so we never lose user selections in cart reporting.
                  const humanized = id
                    .replace(/[_-]+/g, ' ')
                    .replace(/\b\w/g, (c) => c.toUpperCase())
                    .trim();
                  console.warn('[Selections] Missing label in lookup for ID:', {
                    id,
                    fallbackLabel: humanized,
                    productId: product.id,
                    productName: product.name
                  });
                  return humanized;
                };
                
                // Helper to get group info for a selection ID
                const getToppingGroupInfo = (
                  id: string
                ): { groupId?: string; groupTitle?: string; type?: SelectionType } | undefined => {
                  if (!id) return undefined;
                  const meta = selectionLookup.byOptionId[id];
                  if (!meta) return undefined;
                  return {
                    groupId: meta.groupId,
                    groupTitle: meta.groupTitle,
                    type: meta.type,
                  };
                };
                
                // Helper function to get beverage category based on ID
                const getBeverageCategory = (id: string): BeverageCategory => {
                  if (id.startsWith('b1')) return '20oz';
                  if (id.startsWith('b2')) return '2_liter';
                  if (id.includes('water')) return 'water';
                  if (id.includes('juice')) return 'juice';
                  return 'other';
                };

                // Helper to format Salad Name with customizations
                const formatSaladCartName = (id: string, baseName: string) => {
                    let removedIds: string[] = [];
                    let sourceItems: Topping[] = [];
                    
                    // Check if it's Side Garden Salad (Traditional Dinners or Pasta Build)
                    if (id === 'td-extra2' || id === 'bps3') {
                        removedIds = sideGardenSaladRemovedIngredients;
                        sourceItems = [...traditionalDinnersSoupsSalads, ...buildPastaSoups];
                    } 
                    // Check if it's Side Caesar Salad (Traditional Dinners or Pasta Build)
                    else if (id === 'td-extra3' || id === 'bps4') {
                        removedIds = sideCaesarSaladRemovedIngredients;
                        sourceItems = [...traditionalDinnersSoupsSalads, ...buildPastaSoups];
                    } else {
                        return baseName;
                    }

                    if (removedIds.length === 0) return baseName;

                    // Find names for removed IDs
                    const removedNames = removedIds.map(remId => {
                        // Find the ingredient definition in any of the salad items
                        for (const item of sourceItems) {
                            if (item.removableIngredients) {
                                const found = item.removableIngredients.find(ing => ing.id === remId);
                                if (found) return found.name;
                            }
                        }
                        return getItemName(remId) || ''; // Fallback
                    }).filter(n => n);

                    if (removedNames.length === 0) return baseName;

                    return `${baseName} (No ${removedNames.join(', No ')})`;
                };
                
                // Add Size (pizzas + soups)
                if ((product.category === 'pizzas' || product.category === 'soups') && selectedSize) {
                  const sizeNames: Record<string, string> = product.category === 'soups'
                    ? { 'medium': '16Oz', 'large': '32Oz' }
                    : { 'medium': 'Medium (14")', 'large': 'Large (16")', 'jumbo': 'Jumbo (18")' };
                  if (sizeNames[selectedSize]) {
                    // LEGACY
                    customizations.push({
                      category: 'Size',
                      items: [sizeNames[selectedSize]]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: selectedSize,
                      label: sizeNames[selectedSize],
                      type: 'size',
                      groupId: 'size_options',
                      groupTitle: 'Size'
                    });
                  }
                }
                
                // Add Pasta Type (for catering pasta dishes - multiple variables) - REQUIRED
                if (selectedPastaType) {
                  const pastaTypeName = getItemName(selectedPastaType);
                  // LEGACY
                  customizations.push({
                    category: 'Pasta Type',
                    items: [pastaTypeName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedPastaType,
                    label: pastaTypeName,
                    type: 'required_option',
                    groupId: 'pasta_type_required',
                    groupTitle: 'Pasta Type (Required)'
                  });
                }
                if (selectedBabyClamPastaType) {
                  const pastaTypeName = getItemName(selectedBabyClamPastaType);
                  // LEGACY
                  customizations.push({
                    category: 'Pasta Type',
                    items: [pastaTypeName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedBabyClamPastaType,
                    label: pastaTypeName,
                    type: 'required_option',
                    groupId: 'baby_clam_pasta_type_required',
                    groupTitle: 'Pasta Type (Required)'
                  });
                }
                if (selectedCalamariPastaType) {
                  const pastaTypeName = getItemName(selectedCalamariPastaType);
                  // LEGACY
                  customizations.push({
                    category: 'Pasta Type',
                    items: [pastaTypeName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedCalamariPastaType,
                    label: pastaTypeName,
                    type: 'required_option',
                    groupId: 'calamari_pasta_type_required',
                    groupTitle: 'Pasta Type (Required)'
                  });
                }
                if (selectedMusselsPastaType) {
                  const pastaTypeName = getItemName(selectedMusselsPastaType);
                  // LEGACY
                  customizations.push({
                    category: 'Pasta Type',
                    items: [pastaTypeName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedMusselsPastaType,
                    label: pastaTypeName,
                    type: 'required_option',
                    groupId: 'mussels_pasta_type_required',
                    groupTitle: 'Pasta Type (Required)'
                  });
                }
                if (selectedSeafoodComboPastaType) {
                  const pastaTypeName = getItemName(selectedSeafoodComboPastaType);
                  // LEGACY
                  customizations.push({
                    category: 'Pasta Type',
                    items: [pastaTypeName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedSeafoodComboPastaType,
                    label: pastaTypeName,
                    type: 'required_option',
                    groupId: 'seafood_combo_pasta_type_required',
                    groupTitle: 'Pasta Type (Required)'
                  });
                }
                if (selectedShrimpMarinaraPastaType) {
                  const pastaTypeName = getItemName(selectedShrimpMarinaraPastaType);
                  // LEGACY
                  customizations.push({
                    category: 'Pasta Type',
                    items: [pastaTypeName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedShrimpMarinaraPastaType,
                    label: pastaTypeName,
                    type: 'required_option',
                    groupId: 'shrimp_marinara_pasta_type_required',
                    groupTitle: 'Pasta Type (Required)'
                  });
                }
                
                // Add Sauce Choice (for seafood dishes - multiple variables) - REQUIRED
                if (selectedBabyClamSauceChoice) {
                  const sauceName = getItemName(selectedBabyClamSauceChoice);
                  // LEGACY
                  customizations.push({
                    category: 'Sauce',
                    items: [sauceName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedBabyClamSauceChoice,
                    label: sauceName,
                    type: 'required_option',
                    groupId: 'baby_clam_sauce_required',
                    groupTitle: 'Choose Your Sauce (Required)'
                  });
                }
                if (selectedMusselsSauceChoice) {
                  const sauceName = getItemName(selectedMusselsSauceChoice);
                  // LEGACY
                  customizations.push({
                    category: 'Sauce',
                    items: [sauceName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedMusselsSauceChoice,
                    label: sauceName,
                    type: 'required_option',
                    groupId: 'mussels_sauce_required',
                    groupTitle: 'Choose Your Sauce (Required)'
                  });
                }
                if (selectedSeafoodComboSauceChoice) {
                  const sauceName = getItemName(selectedSeafoodComboSauceChoice);
                  // LEGACY
                  customizations.push({
                    category: 'Sauce',
                    items: [sauceName]
                  });
                  // NEW STRUCTURED
                  selections.push({
                    id: selectedSeafoodComboSauceChoice,
                    label: sauceName,
                    type: 'required_option',
                    groupId: 'seafood_combo_sauce_required',
                    groupTitle: 'Choose Your Sauce (Required)'
                  });
                }
                
                // ============================================================
                // SEAFOOD SAUCE SELECTIONS (UNIFIED & FIXED)
                // ============================================================
                if (product.category === 'seafood' && selectedSeafoodSauceId) {
                   let optionsArray: any[] = [];
                   // Generic groupId as requested by user
                   let groupId = 'seafood_sauce'; 
                   
                   // Determine which options array to use based on product ID
                   if (product.id === 'sf-3' || product.id === 'app15') { // Mussels
                     optionsArray = musselsSauceOptions;
                   } else if (product.id === 'sf-4' || product.id === 'app16') { // Seafood Combo
                     optionsArray = seafoodComboSauceOptions;
                   } else if (product.id === 'sf-2' || product.id === 'sf-5' || product.id === 'app17') { // Calamari/Shrimp Marinara
                     optionsArray = marinaraAppetizerSauceOptions;
                   } else {
                     // Check other arrays if needed or use fallback
                     optionsArray = [
                        ...musselsSauceOptions,
                        ...seafoodComboSauceOptions, 
                        ...marinaraAppetizerSauceOptions,
                        ...calamariSubSauceOptions,
                        ...shrimpMarinaraSubSauceOptions
                     ];
                   }
                   
                   // Find label in the specific array first
                   let option = optionsArray.find(o => o.id === selectedSeafoodSauceId);
                   // Fallback to searching all if not found
                   if (!option) {
                      const allSeafoodOptions = [
                        ...musselsSauceOptions,
                        ...seafoodComboSauceOptions, 
                        ...marinaraAppetizerSauceOptions,
                        ...calamariSubSauceOptions,
                        ...shrimpMarinaraSubSauceOptions
                      ];
                      option = allSeafoodOptions.find(o => o.id === selectedSeafoodSauceId);
                   }
                   
                   const sauceName = option ? option.name : getItemName(selectedSeafoodSauceId);
                   
                   if (debugCartEnabled) {
                     console.log('[SEAFOOD SAUCE] selectedSeafoodSauceId', selectedSeafoodSauceId);
                     console.log('[SEAFOOD SAUCE] pushing selection', { sauceName, groupId, productId: product.id });
                   }
                   
                   if (sauceName) {
                     // Add to legacy customizations for safety
                     customizations.push({
                       category: 'Sauce',
                       items: [sauceName]
                     });
                     
                     // Add to structured selections
                     selections.push({
                       id: selectedSeafoodSauceId,
                       label: sauceName,
                       type: 'sauce',
                       groupId: 'seafood_sauce', // Unified Group ID as requested
                       groupTitle: 'Sauce',
                       productId: product.id
                     });
                   }
                }

                if (selectedSeafoodPastaType) {
                   const option = seafoodPastaTypes.find(o => o.id === selectedSeafoodPastaType);
                   const pastaName = option ? option.name : getItemName(selectedSeafoodPastaType);
                   
                   if (debugCartEnabled) {
                     console.log(' DEBUG SEAFOOD PASTA - Type', {
                       selectedId: selectedSeafoodPastaType,
                       foundOption: option,
                       resolvedName: pastaName,
                       product: product.name
                     });
                   }
                   
                   if (pastaName) {
                     customizations.push({
                       category: 'Pasta Type',
                       items: [pastaName]
                     });
                     selections.push({
                       id: selectedSeafoodPastaType,
                       label: pastaName,
                       type: 'required_option',
                       groupId: 'seafood_pasta_type_required',
                       groupTitle: 'Pasta Type',
                       productId: product.id
                     });
                   }
                }
                
                // ============================================================
                // CRITICAL FIX: Add REQUIRED groups to selections
                // ============================================================
                
                // Add Toast Option (REQUIRED only in categories that use toast)
                if ((product.category === 'cheesesteaks' || product.category === 'hot-hoagies' || product.category === 'burgers' || product.category === 'brioche') && toastRoll) {
                  const toastLabel = toastRoll === 'toast' ? 'Toast Roll' : "Don't Toast Roll";
                  // LEGACY
                  customizations.push({
                    category: 'Toast Option',
                    items: [toastLabel]
                  });
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selections.push({
                    id: toastRoll,
                    label: toastLabel,
                    type: 'required_option',
                    groupId: 'toast_option',
                    groupTitle: 'Toast Option (Required)'
                  });
                }
                
                // Add Cheese Selection (REQUIRED for cheesesteaks only)
                if (product.category === 'cheesesteaks' && selectedCheese) {
                  const cheeseName = getItemName(selectedCheese);
                  // LEGACY
                  customizations.push({
                    category: 'Cheese',
                    items: [cheeseName]
                  });
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selections.push({
                    id: selectedCheese,
                    label: cheeseName,
                    type: 'required_option',
                    groupId: 'cheese_required',
                    groupTitle: 'Cheese (Required)'
                  });
                }
                
                // Add Hot Hoagie Cheese Selection (REQUIRED)
                if (product.category === 'hot-hoagies' && selectedHotHoagieCheese) {
                  const cheeseName = getItemName(selectedHotHoagieCheese);
                  // LEGACY (will be added later in code)
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selections.push({
                    id: selectedHotHoagieCheese,
                    label: cheeseName,
                    type: 'required_option',
                    groupId: 'hot_hoagie_cheese_required',
                    groupTitle: 'Cheese (Required)'
                  });
                }
                
                // Add Panini Type Selection (REQUIRED)
                if (selectedPaniniType) {
                  const paniniTypeName = getItemName(selectedPaniniType);
                  // LEGACY
                  customizations.push({
                    category: 'Panini Type',
                    items: [paniniTypeName]
                  });
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selections.push({
                    id: selectedPaniniType,
                    label: paniniTypeName,
                    type: 'required_option',
                    groupId: 'panini_type_required',
                    groupTitle: 'Choose Your Panini Type (Required)'
                  });
                }
                
                // Add Wrap Type Selection (REQUIRED)
                if (selectedWrapType) {
                  const wrapTypeName = getItemName(selectedWrapType);
                  // LEGACY
                  customizations.push({
                    category: 'Wrap Type',
                    items: [wrapTypeName]
                  });
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selections.push({
                    id: selectedWrapType,
                    label: wrapTypeName,
                    type: 'required_option',
                    groupId: 'wrap_type_required',
                    groupTitle: 'Choose Your Wrap Type (Required)'
                  });
                }
                
                // Add Wrap Cheese Selection (REQUIRED for certain wraps)
                if (selectedWrapCheese) {
                  const cheeseName = getItemName(selectedWrapCheese);
                  // LEGACY
                  customizations.push({
                    category: 'Cheese',
                    items: [cheeseName]
                  });
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selections.push({
                    id: selectedWrapCheese,
                    label: cheeseName,
                    type: 'required_option',
                    groupId: 'wrap_cheese_required',
                    groupTitle: 'Cheese (Required)'
                  });
                }
                
                
                // Add Wings Special Instructions (OPTIONAL)
                if (selectedWingsSpecialInstructions.length > 0) {
                  const instructionNames = selectedWingsSpecialInstructions.map(id => getItemName(id));
                  // LEGACY
                  customizations.push({
                    category: 'Special Instructions',
                    items: instructionNames
                  });
                  // NEW STRUCTURED - Add to selections
                  selectedWingsSpecialInstructions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({
                        id,
                        label: name,
                        type: 'special_instruction',
                        groupId: 'wings_special_instructions',
                        groupTitle: 'Special Instructions (Optional)',
                        productId: product.id
                      });
                    }
                  });
                }
                
                // Add Burger Cheese Selection (REQUIRED for most burgers)
                if (product.category === 'burgers' && selectedBurgerCheese && selectedBurgerCheese.length > 0) {
                  const cheeseNames = selectedBurgerCheese.map(id => getItemName(id));
                  // LEGACY
                  customizations.push({
                    category: 'Cheese',
                    items: cheeseNames
                  });
                  // NEW STRUCTURED - Add to selections with proper grouping
                  selectedBurgerCheese.forEach(cheeseId => {
                    const cheeseName = getItemName(cheeseId);
                    if (cheeseName) {
                      selections.push({
                        id: cheeseId,
                        label: cheeseName,
                        type: 'required_option',
                        groupId: 'burger_cheese_required',
                        groupTitle: 'Cheese (Required)'
                      });
                    }
                  });
                }
                
                // Add selected toppings with distribution
                if (selectedToppings.length > 0) {
                  const wholeToppings: string[] = [];
                  const leftToppings: string[] = [];
                  const rightToppings: string[] = [];
                  
                  selectedToppings.forEach(toppingId => {
                    const distribution = toppingDistribution[toppingId] || 'whole';
                    const name = getItemName(toppingId);
                    
                    if (distribution === 'whole') {
                      wholeToppings.push(name);
                    } else if (distribution === 'left') {
                      leftToppings.push(`${name} (Left)`);
                    } else if (distribution === 'right') {
                      rightToppings.push(`${name} (Right)`);
                    }
                    
                    // NEW STRUCTURED - Add each topping with group info to selections
                    const groupInfo = getToppingGroupInfo(toppingId);
                    selections.push({
                      id: toppingId,
                      label: name,
                      type: 'topping',
                      groupId: groupInfo.groupId,
                      groupTitle: groupInfo.groupTitle,
                      distribution: distribution
                    });
                  });
                  
                  // LEGACY - Keep for backward compatibility
                  if (wholeToppings.length > 0) {
                    customizations.push({
                      category: 'Toppings',
                      items: wholeToppings
                    });
                  }
                  if (leftToppings.length > 0 || rightToppings.length > 0) {
                    const halfItems = [...leftToppings, ...rightToppings];
                    customizations.push({
                      category: 'Half Toppings',
                      items: halfItems
                    });
                  }
                }
                
                // Add special instructions
                if (selectedSpecialInstructions.length > 0) {
                  const names = selectedSpecialInstructions.map(id => getItemName(id));
                  // LEGACY
                  customizations.push({
                    category: 'Special Instructions',
                    items: names
                  });
                  
                  // NEW STRUCTURED
                  selectedSpecialInstructions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({
                        id,
                        label: name,
                        type: 'special_instruction'
                      });
                    }
                  });
                }
                
                // Add "Add" toppings
                if (selectedAddToppings.length > 0) {
                  const names = selectedAddToppings.map(id => getItemName(id));
                  customizations.push({
                    category: 'Add Toppings',
                    items: names
                  });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedAddToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Add "Lite" toppings
                if (selectedLiteToppings.length > 0) {
                  const names = selectedLiteToppings.map(id => getItemName(id));
                  customizations.push({
                    category: 'Lite Toppings',
                    items: names
                  });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedLiteToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Add "No" toppings
                if (selectedNoToppings.length > 0) {
                  const names = selectedNoToppings.map(id => getItemName(id));
                  customizations.push({
                    category: 'No Toppings',
                    items: names
                  });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedNoToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedNoToppingsCheesesteak.length > 0) {
                  const names = selectedNoToppingsCheesesteak.map(id => getItemName(id));
                  customizations.push({
                    category: 'No Toppings',
                    items: names
                  });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedNoToppingsCheesesteak.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Add extra sides/sauces
                if (selectedExtraSauce.length > 0) {
                  const names = selectedExtraSauce.map(id => getItemName(id));
                  customizations.push({
                    category: 'Extra Sauce',
                    items: names
                  });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedExtraSauce.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Add side toppings
                if (selectedSideToppings.length > 0) {
                  const names = selectedSideToppings.map(id => {
                    if (product.category === 'cheesesteaks') {
                      return sideToppingItems.find((t: any) => t.id === id)?.name || getItemName(id);
                    }
                    return getItemName(id);
                  });
                  customizations.push({
                    category: 'Side Toppings',
                    items: names
                  });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedSideToppings.forEach(toppingId => {
                    const name = product.category === 'cheesesteaks'
                      ? (sideToppingItems.find((t: any) => t.id === toppingId)?.name || getItemName(toppingId))
                      : getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Add salad customizations (REQUIRED)
                if (selectedSaladBase) {
                  const baseName = saladBaseOptions.find(b => b.id === selectedSaladBase)?.name;
                  if (baseName) {
                    // LEGACY
                    customizations.push({
                      category: 'Salad Base',
                      items: [baseName]
                    });
                    // NEW STRUCTURED - Add to selections with proper grouping
                    selections.push({
                      id: selectedSaladBase,
                      label: baseName,
                      type: 'required_option',
                      groupId: 'salad_base_required',
                      groupTitle: 'Choose Your Base (Required)'
                    });
                  }
                }
                
                if (selectedSaladDressing) {
                  const dressingName = saladDressingOptions.find(d => d.id === selectedSaladDressing)?.name;
                  if (dressingName) {
                    // LEGACY
                    customizations.push({
                      category: 'Dressing',
                      items: [dressingName]
                    });
                    // NEW STRUCTURED - Add to selections with proper grouping
                    selections.push({
                      id: selectedSaladDressing,
                      label: dressingName,
                      type: 'required_option',
                      groupId: 'salad_dressing_required',
                      groupTitle: 'Choose Your Dressing (Required)'
                    });
                  }
                }
                
                // Add salad toppings (Choose Your Toppings)
                if (selectedSaladToppings.length > 0) {
                  const toppingNames = selectedSaladToppings.map(id => {
                    const topping = saladToppingsOptions.find(t => t.id === id);
                    return topping?.name;
                  }).filter((name): name is string => name !== undefined);
                  
                  if (toppingNames.length > 0) {
                    customizations.push({
                      category: 'Salad Toppings',
                      items: toppingNames
                    });
                  }
                  
                  // NEW STRUCTURED - Add to selections with group info
                  selectedSaladToppings.forEach(toppingId => {
                    const topping = saladToppingsOptions.find(t => t.id === toppingId);
                    if (topping) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: topping.name,
                        type: 'topping',
                        groupId: groupInfo?.groupId || 'salad_toppings',
                        groupTitle: groupInfo?.groupTitle || 'Choose Your Toppings'
                      });
                    }
                  });
                }
                
                // Add salad extra toppings
                if (selectedExtraToppings.length > 0) {
                  const extraToppingNames = selectedExtraToppings.map(id => {
                    const topping = saladExtraToppingsOptions.find(t => t.id === id);
                    return topping?.name;
                  }).filter((name): name is string => name !== undefined);
                  
                  if (extraToppingNames.length > 0) {
                    customizations.push({
                      category: 'Extra Toppings',
                      items: extraToppingNames
                    });
                  }
                  
                  // NEW STRUCTURED - Add to selections with group info
                  selectedExtraToppings.forEach(toppingId => {
                    const topping = saladExtraToppingsOptions.find(t => t.id === toppingId);
                    if (topping) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: topping.name,
                        type: 'topping',
                        groupId: groupInfo?.groupId || 'salad_extra_toppings',
                        groupTitle: groupInfo?.groupTitle || 'Extra Toppings'
                      });
                    }
                  });
                }
                
                // Add salad extra dressing
                if (selectedExtraDressing.length > 0) {
                  const extraDressingNames = selectedExtraDressing.map(id => {
                    const dressing = saladExtraDressingOptions.find(d => d.id === id);
                    return dressing?.name;
                  }).filter((name): name is string => name !== undefined);
                  
                  if (extraDressingNames.length > 0) {
                    customizations.push({
                      category: 'Extra Dressing',
                      items: extraDressingNames
                    });
                  }
                  
                  // NEW STRUCTURED - Add to selections
                  selectedExtraDressing.forEach(dressingId => {
                    const dressing = saladExtraDressingOptions.find(d => d.id === dressingId);
                    if (dressing) {
                      selections.push({
                        id: dressingId,
                        label: dressing.name,
                        type: 'side',
                        groupId: 'salad_extra_dressing',
                        groupTitle: 'Extra Dressing',
                        productId: product.id
                      });
                    }
                  });
                }

                // Add salad dressing instructions
                if (selectedDressingInstructions) {
                  const instructionName = saladDressingInstructions.find(i => i.id === selectedDressingInstructions)?.name;
                  if (instructionName) {
                    customizations.push({
                      category: 'Dressing Instructions',
                      items: [instructionName]
                    });
                    selections.push({
                      id: selectedDressingInstructions,
                      label: instructionName,
                      type: 'special_instruction',
                      groupId: 'salad_dressing_instructions',
                      groupTitle: 'Dressing Instructions'
                    });
                  }
                }
                
                // Add selected desserts (RECORD version)
                if (Object.keys(selectedDesserts).length > 0) {
                  const dessertItemsList: string[] = [];
                  Object.entries(selectedDesserts).forEach(([dessertId, qty]) => {
                    if (qty > 0) {
                      const dessert = dessertItems.find(d => d.id === dessertId) || 
                                    allProducts?.find(p => p.id === dessertId) ||
                                    wholeCakesItems.find(c => c.id === dessertId) ||
                                    partyCakesItems.find(c => c.id === dessertId);
                      
                      const name = dessert?.name;
                      if (name) {
                        dessertItemsList.push(`${name} x${qty}`);
                        selections.push({
                          id: dessertId,
                          label: name,
                          type: 'dessert'
                        });
                      }
                    }
                  });
                  
                  if (dessertItemsList.length > 0) {
                    customizations.push({
                      category: 'Desserts',
                      items: dessertItemsList
                    });
                  }
                }
                
                // Add selected beverages (RECORD version)
                if (Object.keys(selectedBeverages).length > 0) {
                  const beverageItemsList: string[] = [];
                  Object.entries(selectedBeverages).forEach(([beverageId, qty]) => {
                    if (qty > 0) {
                      const beverage = beverageItems.find(b => b.id === beverageId) || allProducts?.find(p => p.id === beverageId);
                      const name = beverage?.name;
                      
                      if (name) {
                        beverageItemsList.push(`${name} x${qty}`);
                        selections.push({
                          id: beverageId,
                          label: name,
                          type: 'beverage',
                          beverageCategory: getBeverageCategory(beverageId)
                        });
                      }
                    }
                  });
                  
                  if (beverageItemsList.length > 0) {
                    customizations.push({
                      category: 'Beverages',
                      items: beverageItemsList
                    });
                  }
                }
                
                // ============================================================
                // CRITICAL FIX: Add ALL MISSING topping groups to selections
                // ============================================================
                
                // Cold Hoagie Toppings - MISSING from selections!
                if (selectedColdHoagieToppings.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedColdHoagieToppings.map(id => getItemName(id)) });
                  selectedColdHoagieToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedColdHoagieExtras.length > 0) {
                  customizations.push({ category: 'Extras', items: selectedColdHoagieExtras.map(id => getItemName(id)) });
                  selectedColdHoagieExtras.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedColdHoagieLite.length > 0) {
                  customizations.push({ category: 'Lite', items: selectedColdHoagieLite.map(id => getItemName(id)) });
                  selectedColdHoagieLite.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedColdHoagieNo.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedColdHoagieNo.map(id => getItemName(id)) });
                  selectedColdHoagieNo.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedColdHoagieSides.length > 0) {
                  customizations.push({ category: 'Sides', items: selectedColdHoagieSides.map(id => getItemName(id)) });
                  selectedColdHoagieSides.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Burger Toppings - MISSING from selections!
                if (selectedBurgerAdd.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedBurgerAdd.map(id => getItemName(id)) });
                  selectedBurgerAdd.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedBurgerExtra.length > 0) {
                  customizations.push({ category: 'Extras', items: selectedBurgerExtra.map(id => getItemName(id)) });
                  selectedBurgerExtra.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedBurgerLite.length > 0) {
                  customizations.push({ category: 'Lite Toppings', items: selectedBurgerLite.map(id => getItemName(id)) });
                  selectedBurgerLite.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedBurgerSide.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedBurgerSide.map(id => getItemName(id)) });
                  selectedBurgerSide.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Wrap Toppings - MISSING from selections!
                if (selectedWrapAddToppings.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedWrapAddToppings.map(id => getItemName(id)) });
                  selectedWrapAddToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Wrap Extra Cheese
                if (selectedWrapExtraCheese.length > 0) {
                  selectedWrapExtraCheese.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'extra_topping', groupId: 'wrap_extra_cheese', groupTitle: 'Extra Cheese' });
                    }
                  });
                }
                
                if (selectedWrapLite.length > 0) {
                  customizations.push({ category: 'Lite Toppings', items: selectedWrapLite.map(id => getItemName(id)) });
                  selectedWrapLite.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedWrapNo.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedWrapNo.map(id => getItemName(id)) });
                  selectedWrapNo.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedWrapSide.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedWrapSide.map(id => getItemName(id)) });
                  selectedWrapSide.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Panini Extra Cheese
                if (selectedPaniniExtraCheese.length > 0) {
                  selectedPaniniExtraCheese.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'extra_topping', groupId: 'panini_extra_cheese', groupTitle: 'Extra Cheese' });
                    }
                  });
                }
                
                // Panini Toppings - MISSING from selections!
                if (selectedPaniniLite.length > 0) {
                  customizations.push({ category: 'Lite Toppings', items: selectedPaniniLite.map(id => getItemName(id)) });
                  selectedPaniniLite.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedPaniniNo.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedPaniniNo.map(id => getItemName(id)) });
                  selectedPaniniNo.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedPaniniSides.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedPaniniSides.map(id => getItemName(id)) });
                  selectedPaniniSides.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Brioche Add Cheese
                if (selectedBriocheAddCheese) {
                  const name = getItemName(selectedBriocheAddCheese);
                  if (name) {
                    selections.push({ id: selectedBriocheAddCheese, label: name, type: 'cheese', groupId: 'brioche_add_cheese', groupTitle: 'Add Cheese' });
                  }
                }
                
                // Brioche Extra Cheese
                if (selectedBriocheExtraCheese.length > 0) {
                  selectedBriocheExtraCheese.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'extra_topping', groupId: 'brioche_extra_cheese', groupTitle: 'Extra Cheese' });
                    }
                  });
                }
                
                // Brioche Toppings - MISSING from selections!
                if (selectedBriocheNo.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedBriocheNo.map(id => getItemName(id)) });
                  selectedBriocheNo.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedBriocheSide.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedBriocheSide.map(id => getItemName(id)) });
                  selectedBriocheSide.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Hot Hoagie No Toppings - MISSING from selections!
                if (selectedGrilledChickenNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedGrilledChickenNoToppings.map(id => getItemName(id)) });
                  selectedGrilledChickenNoToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedSausagePeppersOnionsNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedSausagePeppersOnionsNoToppings.map(id => getItemName(id)) });
                  selectedSausagePeppersOnionsNoToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedCheeseBurgerDeluxeNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedCheeseBurgerDeluxeNoToppings.map(id => getItemName(id)) });
                  selectedCheeseBurgerDeluxeNoToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedBriocheGrilledChickenNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedBriocheGrilledChickenNoToppings.map(id => getItemName(id)) });
                  selectedBriocheGrilledChickenNoToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Kids Pasta Toppings - MISSING from selections!
                if (selectedKidsPastaToppings.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedKidsPastaToppings.map(id => getItemName(id)) });
                  selectedKidsPastaToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedKidsBakedExtraToppings.length > 0) {
                  customizations.push({ category: 'Extra Toppings', items: selectedKidsBakedExtraToppings.map(id => getItemName(id)) });
                  selectedKidsBakedExtraToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedKidsBakedLiteToppings.length > 0) {
                  customizations.push({ category: 'Lite Toppings', items: selectedKidsBakedLiteToppings.map(id => getItemName(id)) });
                  selectedKidsBakedLiteToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                if (selectedKidsBakedNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedKidsBakedNoToppings.map(id => getItemName(id)) });
                  selectedKidsBakedNoToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Build Pasta Toppings - MISSING from selections!
                if (selectedBuildPastaToppings.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedBuildPastaToppings.map(id => getItemName(id)) });
                  selectedBuildPastaToppings.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // ============================================================
                // CRITICAL FIX: Add MISSING topping groups to selections
                // These were only being added to customizations but NOT selections!
                // ============================================================
                
                // Cheesesteaks - CRITICAL MISSING GROUP!
                if (product.category === 'cheesesteaks') {
                  // Main toppings (mapped to selectedToppings)
                  if (selectedToppings.length > 0) {
                    // LEGACY - only add if not already in customizations
                    if (!customizations.some(c => c.category === 'Toppings' && c.items.length === selectedToppings.length)) {
                      customizations.push({ category: 'Toppings', items: selectedToppings.map(id => getItemName(id)) });
                    }
                    // NEW STRUCTURED
                    registerSelectionsFromIds(selectedToppings, {
                      debugKey: "selectedToppings (Cheesesteak)",
                      fallbackType: "topping",
                    });
                  }
                  
                  // No Toppings
                  if (selectedNoToppingsCheesesteak.length > 0) {
                    // LEGACY
                     if (!customizations.some(c => c.category === 'No Toppings' && c.items.length === selectedNoToppingsCheesesteak.length)) {
                      customizations.push({ category: 'No Toppings', items: selectedNoToppingsCheesesteak.map(id => getItemName(id)) });
                    }
                    // NEW STRUCTURED
                    registerSelectionsFromIds(selectedNoToppingsCheesesteak, {
                      debugKey: "selectedNoToppingsCheesesteak",
                      fallbackType: "no_topping",
                    });
                  }

                  // Side Toppings
                  if (selectedSideToppings.length > 0) {
                    const sideToppingNames = selectedSideToppings.map(id => sideToppingItems.find((t: any) => t.id === id)?.name || getItemName(id));
                    // LEGACY
                     if (!customizations.some(c => c.category === 'Side Toppings' && c.items.length === selectedSideToppings.length)) {
                      customizations.push({ category: 'Side Toppings', items: sideToppingNames });
                    }
                    // NEW STRUCTURED
                    registerSelectionsFromIds(selectedSideToppings, {
                        debugKey: "selectedSideToppings",
                        fallbackType: "side",
                    });
                  }

                  // Extra Sides
                  if (selectedExtraSides.length > 0) {
                    // LEGACY
                     if (!customizations.some(c => c.category === 'Extra Sides' && c.items.length === selectedExtraSides.length)) {
                      customizations.push({ category: 'Extra Sides', items: selectedExtraSides.map(id => getItemName(id)) });
                    }
                    // NEW STRUCTURED
                    registerSelectionsFromIds(selectedExtraSides, {
                        debugKey: "selectedExtraSides",
                        fallbackType: "side",
                    });
                  }
                }

                // Hot Hoagie Extras - CRITICAL MISSING GROUP!
                if (selectedHotHoagieExtras.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Extras', items: selectedHotHoagieExtras.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections with group info
                  selectedHotHoagieExtras.forEach(toppingId => {
                    const name = getItemName(toppingId);
                    if (name) {
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle
                      });
                    }
                  });
                }
                
                // Pasta Additions
                if (selectedPastaAdditions.length > 0) {
                  customizations.push({ category: 'Pasta Additions', items: selectedPastaAdditions.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedPastaAdditions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'other' });
                    }
                  });
                }
                
                if (selectedHotHoagieSides.length > 0) {
                  customizations.push({ category: 'Sides', items: selectedHotHoagieSides.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedHotHoagieSides.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side' });
                    }
                  });
                }
                if (selectedHotHoagieInstructions.length > 0) {
                  customizations.push({ category: 'Special Instructions', items: selectedHotHoagieInstructions.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedHotHoagieInstructions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'special_instruction' });
                    }
                  });
                }
                if (product.category === 'hot-hoagies' && selectedHotHoagieCheese) {
                  customizations.push({ category: 'Cheese', items: [getItemName(selectedHotHoagieCheese)] });
                }
                if (selectedGrilledChickenSideToppingsRequired.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedGrilledChickenSideToppingsRequired.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedGrilledChickenSideToppingsRequired.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side', groupId: 'grilled_chicken_side_toppings', groupTitle: 'On The Side Toppings' });
                    }
                  });
                }
                if (selectedCheesesteakSideToppingsRequired.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedCheesesteakSideToppingsRequired.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedCheesesteakSideToppingsRequired.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side', groupId: 'cheesesteak_on_the_side_toppings', groupTitle: 'On The Side Toppings' });
                    }
                  });
                }
                if (selectedTraditionalDinnersSides.length > 0) {
                  customizations.push({ category: 'Sides', items: selectedTraditionalDinnersSides.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedTraditionalDinnersSides.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side' });
                    }
                  });
                }
                if (selectedTraditionalDinnersSoupsSalads.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Soups & Salads', items: selectedTraditionalDinnersSoupsSalads.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedTraditionalDinnersSoupsSalads.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      const selObj: CartSelection = { 
                          id, 
                          label: name, 
                          type: 'other', 
                          groupId: 'soups_salads', 
                          groupTitle: 'Soups & Salads',
                          productId: product.id 
                      };
                      
                      if (id === 'td-extra2') { // Side Garden Salad
                         const item = traditionalDinnersSoupsSalads.find(s => s.id === 'td-extra2');
                         const removedNames = item?.removableIngredients
                             ?.filter(ing => sideGardenSaladRemovedIngredients.includes(ing.id))
                             .map(ing => ing.name) || [];
                         
                         if (removedNames.length > 0) {
                             selObj.removedIngredients = removedNames;
                         }
                      } else if (id === 'td-extra3') { // Side Caesar Salad
                         const item = traditionalDinnersSoupsSalads.find(s => s.id === 'td-extra3');
                         const removedNames = item?.removableIngredients
                             ?.filter(ing => sideCaesarSaladRemovedIngredients.includes(ing.id))
                             .map(ing => ing.name) || [];
                         
                         if (removedNames.length > 0) {
                             selObj.removedIngredients = removedNames;
                         }
                      }
                      
                      selections.push(selObj);
                    }
                  });
                }
                if (product.category === 'cold-hoagies' && selectedColdHoagieCheese) {
                  customizations.push({ category: 'Cheese', items: [getItemName(selectedColdHoagieCheese)] });
                }
                if (selectedColdHoagieSideToppingsRequired.length > 0) {
                  customizations.push({ category: 'Side Toppings', items: selectedColdHoagieSideToppingsRequired.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedColdHoagieSideToppingsRequired.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side', groupId: 'cold_hoagie_side_toppings', groupTitle: 'On The Side Toppings' });
                    }
                  });
                }
                if (selectedColdHoagieToppings.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedColdHoagieToppings.map(id => getItemName(id)) });
                }
                if (selectedColdHoagieExtras.length > 0) {
                  customizations.push({ category: 'Extras', items: selectedColdHoagieExtras.map(id => getItemName(id)) });
                }
                if (selectedColdHoagieLite.length > 0) {
                  customizations.push({ category: 'Lite', items: selectedColdHoagieLite.map(id => getItemName(id)) });
                }
                if (selectedColdHoagieNo.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedColdHoagieNo.map(id => getItemName(id)) });
                }
                if (selectedColdHoagieSides.length > 0) {
                  customizations.push({ category: 'Sides', items: selectedColdHoagieSides.map(id => getItemName(id)) });
                }
                if (selectedColdHoagieExtraSides.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Extra Sides', items: selectedColdHoagieExtraSides.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedColdHoagieExtraSides.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side', groupId: 'cold_hoagie_extra_sides', groupTitle: 'Extra Sides' });
                    }
                  });
                }
                if (selectedBurgerAdd.length > 0) {
                  customizations.push({ category: 'Add Toppings', items: selectedBurgerAdd.map(id => getItemName(id)) });
                }
                if (selectedBurgerExtra.length > 0) {
                  customizations.push({ category: 'Extras', items: selectedBurgerExtra.map(id => getItemName(id)) });
                }
                // ============================================================
                // CRITICAL FIX: Add ALL missing special instructions & extras to selections
                // ============================================================
                if (selectedSaladSpecialInstructions.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Special Instructions', items: selectedSaladSpecialInstructions.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedSaladSpecialInstructions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'special_instruction' });
                    }
                  });
                }
                if (selectedExtraDressings.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Extra Dressings', items: selectedExtraDressings.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedExtraDressings.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'other', groupId: 'extra_dressings', groupTitle: 'Extra Dressings' });
                    }
                  });
                }
                if (selectedDressingInstruction) {
                  // LEGACY
                  customizations.push({ category: 'Dressing Instruction', items: [getItemName(selectedDressingInstruction)] });
                  // NEW STRUCTURED - Add to selections
                  const name = getItemName(selectedDressingInstruction);
                  if (name) {
                    selections.push({ id: selectedDressingInstruction, label: name, type: 'special_instruction' });
                  }
                }
                if (selectedExtraSides.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Extra Sides', items: selectedExtraSides.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedExtraSides.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'side', groupId: 'extra_sides', groupTitle: 'Extra Sides' });
                    }
                  });
                }
                if (selectedBrooklynInstructions.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Special Instructions', items: selectedBrooklynInstructions.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedBrooklynInstructions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'special_instruction' });
                    }
                  });
                }
                
                // Add Pizza Dippings (Optional)
                if (Object.keys(selectedPizzaDippings).length > 0) {
                  const dippingItems: string[] = [];
                  Object.entries(selectedPizzaDippings).forEach(([dippingId, qty]) => {
                    if (qty > 0) {
                      const dipping = pizzaDippingsOptions.find(d => d.id === dippingId);
                      if (dipping) {
                        dippingItems.push(`${dipping.name} x${qty}`);
                      }
                    }
                  });
                  
                  if (dippingItems.length > 0) {
                    // LEGACY
                    customizations.push({
                      category: 'Add Dippings',
                      items: dippingItems
                    });
                    // NEW STRUCTURED - Add to selections
                    Object.entries(selectedPizzaDippings).forEach(([dippingId, qty]) => {
                      if (qty > 0) {
                        const dipping = pizzaDippingsOptions.find(d => d.id === dippingId);
                        if (dipping) {
                          selections.push({
                            id: dippingId,
                            label: `${dipping.name} x${qty}`,
                            type: 'other',
                            groupId: 'pizza_dippings',
                            groupTitle: 'Add Dippings (Optional)'
                          });
                        }
                      }
                    });
                  }
                }
                
                // Pasta e Fagioli Substitute
                if (selectedPastaFagioliSubstitute) {
                  // LEGACY
                  customizations.push({ category: 'Substitute', items: [getItemName(selectedPastaFagioliSubstitute)] });
                  // NEW STRUCTURED - Add to selections
                  const name = getItemName(selectedPastaFagioliSubstitute);
                  if (name) {
                    selections.push({ id: selectedPastaFagioliSubstitute, label: name, type: 'other', groupId: 'substitute', groupTitle: 'Substitute' });
                  }
                }
                
                // Pasta e Fagioli Special Instructions
                if (selectedPastaFagioliSpecialInstructions.length > 0) {
                  // LEGACY
                  customizations.push({ category: 'Special Instructions', items: selectedPastaFagioliSpecialInstructions.map(id => getItemName(id)) });
                  // NEW STRUCTURED - Add to selections
                  selectedPastaFagioliSpecialInstructions.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      selections.push({ id, label: name, type: 'special_instruction' });
                    }
                  });
                }
                
                if (selectedGrilledChickenNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedGrilledChickenNoToppings.map(id => getItemName(id)) });
                }
                if (selectedSausagePeppersOnionsNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedSausagePeppersOnionsNoToppings.map(id => getItemName(id)) });
                }
                if (selectedCheeseBurgerDeluxeNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedCheeseBurgerDeluxeNoToppings.map(id => getItemName(id)) });
                }
                if (selectedBriocheGrilledChickenNoToppings.length > 0) {
                  customizations.push({ category: 'No Toppings', items: selectedBriocheGrilledChickenNoToppings.map(id => getItemName(id)) });
                }
                
                // ====================================================================
                // FINAL STEP: ensure ALL toppings, extras, sides and instructions
                // are mapped into selections before calling onAddToCart
                // ====================================================================
                
                // Generic helper to ensure any array of ids becomes CartSelection entries
                const registerSelectionsFromIds = (
                  ids: string[] | undefined,
                  options: {
                    fallbackType?: 'topping' | 'extra_topping' | 'no_topping' | 'side' | 'special_instruction' | 'sauce' | 'pasta_type' | 'other';
                    fallbackGroupId?: string;
                    fallbackGroupTitle?: string;
                    debugKey?: string;
                  } = {}
                ) => {
                  if (!ids || ids.length === 0) return;

                  ids.forEach((id) => {
                    if (!id) return;

                    // Skip if this id is already in selections (avoid duplicates)
                    const alreadyExists = selections.some((sel) => sel.id === id);
                    if (alreadyExists) return;

                    const name =
                      getItemName(id) ||
                      id.replace(/[_-]+/g, ' ').replace(/\b\w/g, (c) => c.toUpperCase()).trim();

                    const groupInfo = getToppingGroupInfo ? getToppingGroupInfo(id) : undefined;

                    selections.push({
                      id,
                      label: name,
                      type: groupInfo?.type ?? options.fallbackType ?? "topping",
                      groupId: groupInfo?.groupId ?? options.fallbackGroupId,
                      groupTitle: groupInfo?.groupTitle ?? options.fallbackGroupTitle,
                      productId: product.id,
                    });
                  });
                };
                
                // Extra sauces / cheese ranch (Record<id, size>)
                const registerExtraSauceSelections = (
                  record: Record<string, string>,
                  options: {
                    groupId: string;
                    groupTitle: string;
                    baseLabel: string;
                    debugKey: string;
                    prefix?: string;
                  }
                ) => {
                  Object.entries(record).forEach(([sauceId, size]) => {
                    if (!size) return;

                    const selectionId = `${options.groupId}:${sauceId}:${size}`;
                    const alreadyExists = selections.some((sel) => sel.id === selectionId);
                    if (alreadyExists) return;

                    const sauceName = getItemName(sauceId) ?? options.baseLabel;

                    selections.push({
                      id: selectionId,
                      label: `${options.prefix ?? ''}${sauceName} (${size})`,
                      type: "extra_topping",
                      groupId: options.groupId,
                      groupTitle: options.groupTitle,
                      productId: product.id,
                    });
                  });
                };

                // Wrap Platter selections (Record<id, quantity>)
                const registerWrapPlatterSelections = (
                  record: { [key: string]: number },
                  options: {
                    groupId: string;
                    groupTitle: string;
                    debugKey: string;
                    isSide?: boolean;
                  }
                ) => {
                  Object.entries(record).forEach(([itemId, qty]) => {
                    if (!qty || qty <= 0) return;

                    const selectionId = `${options.groupId}:${itemId}`;
                    const alreadyExists = selections.some((sel) => sel.id === selectionId);
                    if (alreadyExists) return;

                    const name = getItemName(itemId) ?? "Wrap Platter Item";

                    selections.push({
                      id: selectionId,
                      label: `${name} x${qty}`,
                      type: options.isSide ? "side" : "topping",
                      groupId: options.groupId,
                      groupTitle: options.groupTitle,
                      productId: product.id,
                    });
                  });
                };
                
                // Map all missing selections that were only in customizations
                registerSelectionsFromIds(selectedGrilledChickenNoToppings, {
                  debugKey: "selectedGrilledChickenNoToppings",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedSausagePeppersOnionsNoToppings, {
                  debugKey: "selectedSausagePeppersOnionsNoToppings",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedCheeseBurgerDeluxeNoToppings, {
                  debugKey: "selectedCheeseBurgerDeluxeNoToppings",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedBriocheGrilledChickenNoToppings, {
                  debugKey: "selectedBriocheGrilledChickenNoToppings",
                  fallbackType: "no_topping",
                });
                
                // Hot hoagies
                registerSelectionsFromIds(selectedHotHoagieExtras, {
                  debugKey: "selectedHotHoagieExtras",
                  fallbackType: "extra_topping",
                });
                
                // Cold hoagies
                registerSelectionsFromIds(selectedColdHoagieToppings, {
                  debugKey: "selectedColdHoagieToppings",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedColdHoagieExtras, {
                  debugKey: "selectedColdHoagieExtras",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedColdHoagieLite, {
                  debugKey: "selectedColdHoagieLite",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedColdHoagieNo, {
                  debugKey: "selectedColdHoagieNo",
                  fallbackType: "no_topping",
                });
                
                // Extra Side Sauces (Stromboli/Calzone/etc)
                if (product.name === 'Buffalo Chicken Stromboli' && extraSideSauces && Object.keys(extraSideSauces).length > 0) {
                  Object.entries(extraSideSauces).forEach(([id, qty]) => {
                    if (!qty || qty <= 0) return;
                    
                    const name = id === 'side-bc' ? 'Bleu Cheese' : 
                                 id === 'side-br' ? 'Buttermilk Ranch' : 
                                 'Side Sauce';
                    
                    const selectionId = `side_sauce:${id}`;
                    if (!selections.some(s => s.id === selectionId)) {
                        selections.push({
                          id: selectionId,
                          label: `(${qty}) ${name}`,
                          type: 'extra_topping',
                          groupId: 'additional_toppings',
                          groupTitle: 'Additional Toppings',
                          productId: product.id,
                        });
                    }
                  });
                }
                
                // Wings & Chicken Tenders - Extra Sauces/Cheese/Ranch
                if (selectedWingsExtraSauce && Object.keys(selectedWingsExtraSauce).length > 0) {
                  registerExtraSauceSelections(selectedWingsExtraSauce, {
                    groupId: "wings_extra_sauce",
                    groupTitle: "Wings  Extra Sauce",
                    baseLabel: "Extra Sauce",
                    debugKey: "selectedWingsExtraSauce",
                  });
                }
                if (selectedWingsExtraCheeseRanch && Object.keys(selectedWingsExtraCheeseRanch).length > 0) {
                  registerExtraSauceSelections(selectedWingsExtraCheeseRanch, {
                    groupId: "wings_extra_cheese_ranch",
                    groupTitle: "Wings  Extra Cheese/Ranch",
                    baseLabel: "Extra Cheese/Ranch",
                    debugKey: "selectedWingsExtraCheeseRanch",
                  });
                }
                if (selectedChickenTendersExtraSauce && Object.keys(selectedChickenTendersExtraSauce).length > 0) {
                  registerExtraSauceSelections(selectedChickenTendersExtraSauce, {
                    groupId: "chicken_tenders_extra_sauce",
                    groupTitle: "Chicken Tenders  Extra Sauce",
                    baseLabel: "Extra Sauce",
                    debugKey: "selectedChickenTendersExtraSauce",
                  });
                }
                if (selectedChickenTendersExtraCheeseRanch && Object.keys(selectedChickenTendersExtraCheeseRanch).length > 0) {
                  registerExtraSauceSelections(selectedChickenTendersExtraCheeseRanch, {
                    groupId: "chicken_tenders_extra_cheese_ranch",
                    groupTitle: "Chicken Tenders  Extra Cheese/Ranch",
                    baseLabel: "Extra Cheese/Ranch",
                    debugKey: "selectedChickenTendersExtraCheeseRanch",
                  });
                }
                
                // Wrap Platter
                if (selectedWrapPlatterOptions && Object.keys(selectedWrapPlatterOptions).length > 0) {
                  registerWrapPlatterSelections(selectedWrapPlatterOptions, {
                    groupId: "wrap_platter_options",
                    groupTitle: "Wrap Platter  Wraps",
                    debugKey: "selectedWrapPlatterOptions",
                  });
                }
                if (selectedWrapPlatterSideToppings && Object.keys(selectedWrapPlatterSideToppings).length > 0) {
                  registerWrapPlatterSelections(selectedWrapPlatterSideToppings, {
                    groupId: "wrap_platter_side_toppings",
                    groupTitle: "Wrap Platter  Side Toppings",
                    debugKey: "selectedWrapPlatterSideToppings",
                    isSide: true,
                  });
                }
                
                // Burgers
                registerSelectionsFromIds(selectedBurgerAdd, {
                  debugKey: "selectedBurgerAdd",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedBurgerExtra, {
                  debugKey: "selectedBurgerExtra",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedBurgerLite, {
                  debugKey: "selectedBurgerLite",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedBurgerSide, {
                  debugKey: "selectedBurgerSide",
                  fallbackType: "side",
                });
                
                // Wraps
                registerSelectionsFromIds(selectedWrapAddToppings, {
                  debugKey: "selectedWrapAddToppings",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedWrapLite, {
                  debugKey: "selectedWrapLite",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedWrapNo, {
                  debugKey: "selectedWrapNo",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedWrapSide, {
                  debugKey: "selectedWrapSide",
                  fallbackType: "side",
                });
                
                // Paninis
                registerSelectionsFromIds(selectedPaniniLite, {
                  debugKey: "selectedPaniniLite",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedPaniniNo, {
                  debugKey: "selectedPaniniNo",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedPaniniSides, {
                  debugKey: "selectedPaniniSides",
                  fallbackType: "side",
                });
                
                // Brioche
                registerSelectionsFromIds(selectedBriocheNo, {
                  debugKey: "selectedBriocheNo",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedBriocheSide, {
                  debugKey: "selectedBriocheSide",
                  fallbackType: "side",
                });
                
                // Kids & Pasta
                if (selectedKidsPastaType) {
                  registerSelectionsFromIds([selectedKidsPastaType], {
                    debugKey: "selectedKidsPastaType",
                    fallbackType: "pasta_type",
                  });
                }
                if (selectedKidsPastaSauce) {
                  registerSelectionsFromIds([selectedKidsPastaSauce], {
                    debugKey: "selectedKidsPastaSauce",
                    fallbackType: "sauce",
                  });
                }
                registerSelectionsFromIds(selectedKidsPastaSpecialInstructions, {
                  debugKey: "selectedKidsPastaSpecialInstructions",
                  fallbackType: "special_instruction",
                });
                registerSelectionsFromIds(selectedKidsPastaToppings, {
                  debugKey: "selectedKidsPastaToppings",
                  fallbackType: "topping",
                });
                if (selectedKidsPastaMeatballType) {
                  registerSelectionsFromIds([selectedKidsPastaMeatballType], {
                    debugKey: "selectedKidsPastaMeatballType",
                    fallbackType: "pasta_type",
                  });
                }
                registerSelectionsFromIds(selectedKidsPastaMeatballSpecialInstructions, {
                  debugKey: "selectedKidsPastaMeatballSpecialInstructions",
                  fallbackType: "special_instruction",
                });
                registerSelectionsFromIds(selectedKidsPastaMeatballToppings, {
                  debugKey: "selectedKidsPastaMeatballToppings",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedKidsBakedExtraToppings, {
                  debugKey: "selectedKidsBakedExtraToppings",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedKidsBakedLiteToppings, {
                  debugKey: "selectedKidsBakedLiteToppings",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedKidsBakedNoToppings, {
                  debugKey: "selectedKidsBakedNoToppings",
                  fallbackType: "no_topping",
                });
                registerSelectionsFromIds(selectedBuildPastaToppings, {
                  debugKey: "selectedBuildPastaToppings",
                  fallbackType: "topping",
                });
                
                // Salads / extras
                registerSelectionsFromIds(selectedSaladToppings, {
                  debugKey: "selectedSaladToppings",
                  fallbackType: "topping",
                });
                registerSelectionsFromIds(selectedExtraToppings, {
                  debugKey: "selectedExtraToppings",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedExtraDressing, {
                  debugKey: "selectedExtraDressing",
                  fallbackType: "side",
                });
                
                // Build Pasta Singles
                if (selectedBuildPastaType) {
                  registerSelectionsFromIds([selectedBuildPastaType], {
                    debugKey: "selectedBuildPastaType",
                    fallbackType: "pasta_type",
                  });
                }
                if (selectedBuildPastaSauce) {
                  registerSelectionsFromIds([selectedBuildPastaSauce], {
                    debugKey: "selectedBuildPastaSauce",
                    fallbackType: "sauce",
                  });
                }
                if (selectedBuildPastaSoup && selectedBuildPastaSoup.length > 0) {
                  selectedBuildPastaSoup.forEach(id => {
                    const name = getItemName(id);
                    if (name) {
                      const selObj: CartSelection = {
                        id,
                        label: name,
                        type: 'side',
                        productId: product.id
                      };
                      
                      // Add removed ingredients for Salad customization
                      // Side Garden Salad
                      if (id === 'bps3') {
                         // Map IDs to names preserving the order from the configuration
                         const soup = buildPastaSoups.find(s => s.id === 'bps3');
                         const removedNames = soup?.removableIngredients
                             ?.filter(ing => sideGardenSaladRemovedIngredients.includes(ing.id))
                             .map(ing => ing.name) || [];
                         
                         if (removedNames.length > 0) {
                             selObj.removedIngredients = removedNames;
                         }
                      } 
                      // Side Caesar Salad
                      else if (id === 'bps4') {
                         const soup = buildPastaSoups.find(s => s.id === 'bps4');
                         const removedNames = soup?.removableIngredients
                             ?.filter(ing => sideCaesarSaladRemovedIngredients.includes(ing.id))
                             .map(ing => ing.name) || [];

                         if (removedNames.length > 0) {
                             selObj.removedIngredients = removedNames;
                         }
                      }
                      
                      selections.push(selObj);
                    }
                  });
                }
                
                // Side Toppings Required
                registerSelectionsFromIds(selectedColdHoagieSideToppingsRequired, {
                  debugKey: "selectedColdHoagieSideToppingsRequired",
                  fallbackType: "side",
                  fallbackGroupId: "cold_hoagie_side_toppings_required",
                  fallbackGroupTitle: "Side Toppings (Required)",
                });
                registerSelectionsFromIds(selectedGrilledChickenSideToppingsRequired, {
                  debugKey: "selectedGrilledChickenSideToppingsRequired",
                  fallbackType: "side",
                  fallbackGroupId: "grilled_chicken_side_toppings_required",
                  fallbackGroupTitle: "Side Toppings (Required)",
                });
                registerSelectionsFromIds(selectedCheesesteakSideToppingsRequired, {
                  debugKey: "selectedCheesesteakSideToppingsRequired",
                  fallbackType: "side",
                  fallbackGroupId: "cheesesteak_on_the_side_toppings",
                  fallbackGroupTitle: "On The Side Toppings",
                });
                registerSelectionsFromIds(selectedHotHoagieSides, {
                  debugKey: "selectedHotHoagieSides",
                  fallbackType: "side",
                });
                
                // Extra Cheeses
                registerSelectionsFromIds(selectedBriocheExtraCheese, {
                  debugKey: "selectedBriocheExtraCheese",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedPaniniExtraCheese, {
                  debugKey: "selectedPaniniExtraCheese",
                  fallbackType: "extra_topping",
                });
                registerSelectionsFromIds(selectedWrapExtraCheese, {
                  debugKey: "selectedWrapExtraCheese",
                  fallbackType: "extra_topping",
                });
                
                // Special Instructions
                registerSelectionsFromIds(selectedChickenTendersSpecialInstructions, {
                  debugKey: "selectedChickenTendersSpecialInstructions",
                  fallbackType: "special_instruction",
                  fallbackGroupId: "chicken_tenders_instructions",
                  fallbackGroupTitle: "Chicken Tenders  Special Instructions",
                });
                
                // Wings Main Sauce (Manual registration)
                if (selectedWingsSauce) {
                   const opt = wingsSauceOptions.find(o => o.id === selectedWingsSauce) || 
                               chickenTendersSauceOptions.find(o => o.id === selectedWingsSauce);
                   if (opt) {
                      selections.push({
                         id: selectedWingsSauce,
                         label: opt.name,
                         type: 'sauce',
                         groupId: 'wings_sauce',
                         groupTitle: 'Sauce',
                         productId: product.id
                      });
                   }
                }

                registerSelectionsFromIds(selectedWingsSpecialInstructions, {
                  debugKey: "selectedWingsSpecialInstructions",
                  fallbackType: "special_instruction",
                  fallbackGroupId: "wings_instructions",
                  fallbackGroupTitle: "Wings  Special Instructions",
                });

                // Appetizers & Sides Instructions
                registerSelectionsFromIds(selectedMozzarellaSticksInstructions, {
                  debugKey: "selectedMozzarellaSticksInstructions",
                  fallbackType: "extra_topping",
                  fallbackGroupId: "mozzarella_sticks_instructions", 
                  fallbackGroupTitle: "Extra Sauce",
                });
                
                registerSelectionsFromIds(selectedMozzarellaSticksSpecialInstructions, {
                  debugKey: "selectedMozzarellaSticksSpecialInstructions",
                  fallbackType: "extra_topping",
                });

                registerSelectionsFromIds(selectedAranciniInstructions, {
                   debugKey: "selectedAranciniInstructions",
                   fallbackType: "special_instruction",
                });

                registerSelectionsFromIds(selectedAranciniRegularInstructions, {
                   debugKey: "selectedAranciniRegularInstructions",
                   fallbackType: "special_instruction",
                });
                
                registerSelectionsFromIds(selectedFriesInstructions, {
                   debugKey: "selectedFriesInstructions",
                   fallbackType: "special_instruction",
                });
                
                registerSelectionsFromIds(selectedOnionRingsInstructions, {
                   debugKey: "selectedOnionRingsInstructions",
                   fallbackType: "extra_topping",
                });

                // Mac & Cheese Bites logic (app13)
                if (product.id === 'app13') {
                   // 1. Always include (4oz) Ranch Sauce first
                   selections.push({
                      id: 'included-ranch-4oz',
                      label: '(4oz) Ranch Sauce',
                      type: 'special_instruction', // Use special_instruction so it groups with extras without header
                      groupId: 'mac_cheese_bites_instructions',
                      groupTitle: 'Extras', 
                      productId: product.id,
                   });

                   // 2. Add selected extras
                   if (selectedMacAndCheeseBitesInstructions && selectedMacAndCheeseBitesInstructions.length > 0) {
                      selectedMacAndCheeseBitesInstructions.forEach(id => {
                         const option = macAndCheeseBitesInstructionsOptions.find(o => o.id === id);
                         if (option) {
                            selections.push({
                               id: id,
                               label: option.name,
                               type: 'special_instruction',
                               groupId: 'mac_cheese_bites_instructions',
                               groupTitle: 'Extras',
                               productId: product.id,
                               price: option.price || 0
                            });
                         }
                      });
                   }
                }

                 // Broccoli & Cheddar Bites - Include Ranch Sauce automatically
                 if (product.id === 'app7') {
                    selections.push({
                       id: 'included-ranch-4oz',
                       label: '(4oz) Ranch Sauce',
                       type: 'sauce',
                       groupTitle: 'Included',
                       productId: product.id,
                    });

                    // Add selected extras
                    if (selectedBroccoliCheddarBitesInstructions && selectedBroccoliCheddarBitesInstructions.length > 0) {
                       selectedBroccoliCheddarBitesInstructions.forEach(id => {
                          const option = broccoliCheddarBitesInstructionsOptions.find(o => o.id === id);
                          if (option) {
                             selections.push({
                                id: id,
                                label: option.name,
                                type: 'special_instruction',
                                groupTitle: 'Extras',
                                productId: product.id,
                                price: option.price || 0
                             });
                          }
                       });
                    }
                 }
                
                registerSelectionsFromIds(selectedPassarielloFriesInstructions, {
                   debugKey: "selectedPassarielloFriesInstructions",
                   fallbackType: "special_instruction",
                });
                
                registerSelectionsFromIds(selectedCheddarSteakFriesInstructions, {
                   debugKey: "selectedCheddarSteakFriesInstructions",
                   fallbackType: "special_instruction",
                });
                
                registerSelectionsFromIds(selectedGarlicStickInstructions, {
                   debugKey: "selectedGarlicStickInstructions",
                   fallbackType: "extra_topping",
                });
                
                registerSelectionsFromIds(selectedGarlicBreadInstructions, {
                   debugKey: "selectedGarlicBreadInstructions",
                   fallbackType: "special_instruction",
                });
                
                registerSelectionsFromIds(selectedGarlicBreadMozzarellaInstructions, {
                   debugKey: "selectedGarlicBreadMozzarellaInstructions",
                   fallbackType: "special_instruction",
                });

                // Convert single string sauce selections to array for registration
                if (selectedCalamariSubSauce) {
                  registerSelectionsFromIds([selectedCalamariSubSauce], {
                    debugKey: "selectedCalamariSubSauce",
                    fallbackType: "sauce",
                    fallbackGroupTitle: "Sauce",
                  });
                }
                
                if (selectedMusselsSauce) {
                  registerSelectionsFromIds([selectedMusselsSauce], {
                    debugKey: "selectedMusselsSauce",
                    fallbackType: "sauce",
                    fallbackGroupTitle: "Sauce",
                  });
                }
                
                if (selectedSeafoodComboSauce) {
                  registerSelectionsFromIds([selectedSeafoodComboSauce], {
                    debugKey: "selectedSeafoodComboSauce",
                    fallbackType: "sauce",
                    fallbackGroupTitle: "Sauce",
                  });
                }
                
                if (selectedShrimpMarinaraSubSauce) {
                  registerSelectionsFromIds([selectedShrimpMarinaraSubSauce], {
                    debugKey: "selectedShrimpMarinaraSubSauce",
                    fallbackType: "sauce",
                    fallbackGroupTitle: "Sauce",
                  });
                }
                
                // Chicken Tenders Extra Sauce (Record<string, string>)
                Object.entries(selectedChickenTendersExtraSauce).forEach(([sauceId, size]) => {
                  if (!size) return;
                  const option = chickenTendersExtraSauceOptions.find(o => o.id === sauceId);
                  if (option) {
                    selections.push({
                      id: `${sauceId}-${size}`,
                      label: `${option.name} (${size})`,
                      type: 'extra_topping',
                      groupTitle: 'Extra Sauce'
                    });
                  }
                });
                
                // Wings Extra Sauce (Record<string, string>)
                Object.entries(selectedWingsExtraSauce).forEach(([sauceId, size]) => {
                  if (!size) return;
                  const option = wingsExtraSauceOptions.find(o => o.id === sauceId);
                  if (option) {
                    selections.push({
                      id: `${sauceId}-${size}`,
                      label: `${option.name} (${size})`,
                      type: 'extra_topping',
                      groupTitle: 'Extra Sauce'
                    });
                  }
                });

                 // Chicken Tenders Extra Cheese/Ranch (Record<string, string>)
                Object.entries(selectedChickenTendersExtraCheeseRanch).forEach(([itemId, size]) => {
                  if (!size) return;
                  const option = chickenTendersExtraCheeseRanchOptions.find(o => o.id === itemId);
                  if (option) {
                    selections.push({
                      id: `${itemId}-${size}`,
                      label: `${option.name} (${size})`,
                      type: 'extra_topping',
                      groupTitle: 'Extra Dipping Sauce'
                    });
                  }
                });

                 // Wings Extra Cheese/Ranch (Record<string, string>)
                Object.entries(selectedWingsExtraCheeseRanch).forEach(([itemId, size]) => {
                  if (!size) return;
                  const option = wingsExtraCheeseRanchOptions.find(o => o.id === itemId);
                  if (option) {
                    selections.push({
                      id: `${itemId}-${size}`,
                      label: `${option.name} (${size})`,
                      type: 'extra_topping',
                      groupTitle: 'Extra Dipping Sauce'
                    });
                  }
                });
                
                // ============================================================
                // DEBUG LOGGING - PHASE 2: CART ITEM SELECTIONS
                // ============================================================
                if (debugCartEnabled) {
                  console.log(' DEBUG TOPPINGS - Phase 2: CartItem.selections', {
                    productId: modifiedProduct.id,
                    productName: modifiedProduct.name,
                    totalSelectionsCount: selections.length,
                    selections: selections,
                    groupedSelections: selections.reduce((acc, sel) => {
                      const key = sel.groupTitle || sel.type;
                      if (!acc[key]) acc[key] = [];
                      acc[key].push(sel.label);
                      return acc;
                    }, {} as Record<string, string[]>)
                  });
                }
                
                // ============================================================
                // AUTOMATIC CAPTURE OF ALL MISSING SELECTIONS
                // ============================================================
                
                // ============================================================
                // TRADITIONAL DINNERS LOGIC (Manual Registration)
                // ============================================================
                if (product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) {
                   // 1. Register Sides
                   registerSelectionsFromIds(selectedTraditionalDinnersSides, {
                      debugKey: "selectedTraditionalDinnersSides",
                      fallbackType: "side",
                      fallbackGroupId: "traditional_dinners_sides",
                      fallbackGroupTitle: "Add Sides"
                   });

                   // 2. Register Soups/Salads/Extra Bread
                   // We need to handle this manually to inject removals and quantity
                   if (selectedTraditionalDinnersSoupsSalads && selectedTraditionalDinnersSoupsSalads.length > 0) {
                      const soupsSaladsItems: string[] = []; // For Customizations string

                      selectedTraditionalDinnersSoupsSalads.forEach(id => {
                         const item = traditionalDinnersSoupsSalads.find(i => i.id === id);
                         if (!item) return;

                         // Special handling for Extra Bread (td-extra1)
                         if (id === 'td-extra1') {
                            if (extraBreadQuantity > 0) {
                               const qtyLabel = extraBreadQuantity > 1 ? `Extra Bread x${extraBreadQuantity}` : `Extra Bread`;
                               const selId = `${id}-qty-${extraBreadQuantity}`; // Unique ID for quantity
                               
                               // Check if already pushed (unlikely in this loop but good practice)
                               if (!selections.some(s => s.id === selId)) {
                                   selections.push({
                                      id: selId,
                                      label: qtyLabel,
                                      type: 'side',
                                      groupId: 'traditional_dinners_soups_salads',
                                      groupTitle: 'Side Soups, Salads, & Extra Bread',
                                      productId: product.id
                                   });
                               }
                               soupsSaladsItems.push(qtyLabel);
                            }
                            return;
                         }

                         // Standard item (Soup or Salad)
                         const selObj: CartSelection = {
                            id: id,
                            label: item.name,
                            type: 'side',
                            groupId: 'traditional_dinners_soups_salads',
                            groupTitle: 'Side Soups, Salads, & Extra Bread',
                            productId: product.id
                         };

                         // Handle Removals
                         let removedNames: string[] = [];
                         let labelSuffix = '';

                         if (id === 'td-extra2') { // Garden Salad
                             removedNames = item.removableIngredients
                                 ?.filter(ing => sideGardenSaladRemovedIngredients.includes(ing.id))
                                 .map(ing => ing.name) || [];
                         } else if (id === 'td-extra3') { // Caesar Salad
                             removedNames = item.removableIngredients
                                 ?.filter(ing => sideCaesarSaladRemovedIngredients.includes(ing.id))
                                 .map(ing => ing.name) || [];
                         }

                         if (removedNames.length > 0) {
                             selObj.removedIngredients = removedNames;
                             // For customizations string: "Side Garden Salad (No Tomatoes, No Onions)"
                             const removedStr = removedNames.map(r => `No ${r}`).join(', ');
                             labelSuffix = ` (${removedStr})`;
                             
                             // CRITICAL FIX: Append suffix to main label so cart displays it even without customizations support
                             selObj.label = `${item.name}${labelSuffix}`;

                             // Explicitly add "No X" selections for restoration and persistence
                             removedNames.forEach(rName => {
                                 const stableId = `${id}-no-${rName.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`;
                                 // Only push if not already present
                                 if (!selections.some(s => s.id === stableId)) {
                                     selections.push({
                                         id: stableId,
                                         label: `No ${rName}`,
                                         type: 'no_topping', 
                                         groupId: id, // e.g. td-extra2
                                         groupTitle: 'Side Soups, Salads, & Extra Bread',
                                         productId: product.id
                                     });
                                 }
                             });
                         }

                         // Avoid duplicates if already registered (unlikely here)
                         if (!selections.some(s => s.id === id)) {
                             selections.push(selObj);
                         }
                         soupsSaladsItems.push(`${item.name}${labelSuffix}`);
                      });

                      // Debug Log B
                      if (debugCartEnabled) {
                         console.log('[TD_ADD_TO_CART_BUILD]', { 
                            soupsSaladsItems,
                            extraBreadQuantity,
                            gardenRemovals: sideGardenSaladRemovedIngredients,
                            caesarRemovals: sideCaesarSaladRemovedIngredients,
                            patchedSelections: selections.filter(s => s.groupId === 'traditional_dinners_soups_salads')
                         });
                      }

                      // Push to customizations for Display Builder Priority
                      if (soupsSaladsItems.length > 0) {
                         customizations.push({
                            category: 'Side Soups, Salads, & Extra Bread',
                            items: soupsSaladsItems
                         });
                      }
                   }

                   // 3. Add Sides to customizations too (for strict builder)
                   if (selectedTraditionalDinnersSides && selectedTraditionalDinnersSides.length > 0) {
                      const sideNames = selectedTraditionalDinnersSides.map(id => getItemName(id)).filter(Boolean) as string[];
                      if (sideNames.length > 0) {
                         customizations.push({
                            category: 'Add Sides',
                            items: sideNames
                         });
                      }
                   }
                }

                // ============================================================
                // BUILD YOUR OWN PASTA LOGIC (Manual Salad Removals Registration)
                // ============================================================
                if (product.category === 'create-pasta') {
                   // Remove previously auto-registered soup/salad entries so we can replace with enriched labels.
                   for (let i = selections.length - 1; i >= 0; i--) {
                      const sid = String(selections[i]?.id || '');
                      const gId = String(selections[i]?.groupId || '');
                      if (sid === 'bps3' || sid === 'bps4' || gId === 'build_pasta_soup') {
                         selections.splice(i, 1);
                      }
                   }

                   // Remove stale customizations for this section to avoid duplicates.
                   for (let i = customizations.length - 1; i >= 0; i--) {
                      const cat = String(customizations[i]?.category || '').toLowerCase();
                      if (cat === 'choose soup or salad') {
                         customizations.splice(i, 1);
                      }
                   }

                   if (selectedBuildPastaSoup && selectedBuildPastaSoup.length > 0) {
                      const soupItems: string[] = [];

                      selectedBuildPastaSoup.forEach(id => {
                         const soup = buildPastaSoups.find(s => s.id === id);
                         const baseName = soup?.name || getItemName(id);
                         if (!baseName) return;

                         let removedNames: string[] = [];
                         if (id === 'bps3') {
                            removedNames = soup?.removableIngredients
                              ?.filter(ing => sideGardenSaladRemovedIngredients.includes(ing.id))
                              .map(ing => ing.name) || [];
                         } else if (id === 'bps4') {
                            removedNames = soup?.removableIngredients
                              ?.filter(ing => sideCaesarSaladRemovedIngredients.includes(ing.id))
                              .map(ing => ing.name) || [];
                         }

                         const removedSuffix =
                           removedNames.length > 0 ? ` (${removedNames.map(n => `No ${n}`).join(', ')})` : '';
                         const finalLabel = `${baseName}${removedSuffix}`;

                         const selObj: CartSelection = {
                            id,
                            label: finalLabel,
                            type: 'side',
                            groupId: 'build_pasta_soup',
                            groupTitle: 'Choose Soup or Salad',
                            productId: product.id
                         };

                         if (removedNames.length > 0) {
                            selObj.removedIngredients = removedNames;
                            removedNames.forEach(rName => {
                               const stableId = `${id}-no-${rName.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`;
                               if (!selections.some(s => s.id === stableId)) {
                                  selections.push({
                                     id: stableId,
                                     label: `No ${rName}`,
                                     type: 'no_topping',
                                     groupId: id,
                                     groupTitle: 'Choose Soup or Salad',
                                     productId: product.id
                                  });
                               }
                            });
                         }

                         selections.push(selObj);
                         soupItems.push(finalLabel);
                      });

                      if (soupItems.length > 0) {
                         customizations.push({
                            category: 'Choose Soup or Salad',
                            items: soupItems
                         });
                      }
                   }
                }

                const rawSelectionSources: Record<string, RawSelectionShape> = {
                  // GLOBAL / base states
                  selectedSize: { kind: "singleString", value: selectedSize },
                  selectedSauces: { kind: "stringArray", value: selectedSauces },
                  selectedIncluded: { kind: "singleString", value: selectedIncluded },
                  selectedToppings: { kind: "stringArray", value: selectedToppings },
                  selectedDesserts: { kind: "numberRecord", value: selectedDesserts },
                  selectedBeverages: { kind: "numberRecord", value: selectedBeverages },
                  selectedSpecialInstructions: { kind: "stringArray", value: selectedSpecialInstructions },
                  selectedExtraSauce: { kind: "stringArray", value: selectedExtraSauce },
                  selectedNoToppings: { kind: "stringArray", value: selectedNoToppings },
                  selectedBrooklynInstructions: { kind: "stringArray", value: selectedBrooklynInstructions },
                  selectedCheese: { kind: "singleString", value: (product.category === 'appetizers' ? '' : selectedCheese) },
                  selectedSideToppings: { kind: "stringArray", value: selectedSideToppings },
                  selectedExtraSides: { kind: "stringArray", value: selectedExtraSides },
                  selectedSaladBase: { kind: "singleString", value: selectedSaladBase },
                  selectedSaladDressing: { kind: "singleString", value: selectedSaladDressing },
                  selectedDressingInstruction: { kind: "singleString", value: selectedDressingInstruction },
                  selectedExtraDressings: { kind: "stringArray", value: selectedExtraDressings },
                  selectedSaladSpecialInstructions: { kind: "stringArray", value: selectedSaladSpecialInstructions },
                  selectedAddToppings: { kind: "stringArray", value: selectedAddToppings },
                  selectedLiteToppings: { kind: "stringArray", value: selectedLiteToppings },
                  selectedNoToppingsCheesesteak: { kind: "stringArray", value: selectedNoToppingsCheesesteak },
                  toastRoll: { kind: "singleString", value: toastRoll },

                  // Hot Hoagies states
                  selectedHotHoagieExtras: { kind: "stringArray", value: selectedHotHoagieExtras },
                  selectedHotHoagieSides: { kind: "stringArray", value: selectedHotHoagieSides },
                  selectedHotHoagieInstructions: { kind: "stringArray", value: selectedHotHoagieInstructions },
                  selectedGrilledChickenNoToppings: { kind: "stringArray", value: selectedGrilledChickenNoToppings },
                  selectedSausagePeppersOnionsNoToppings: { kind: "stringArray", value: selectedSausagePeppersOnionsNoToppings },
                  selectedCheeseBurgerDeluxeNoToppings: { kind: "stringArray", value: selectedCheeseBurgerDeluxeNoToppings },
                  selectedBriocheGrilledChickenNoToppings: { kind: "stringArray", value: selectedBriocheGrilledChickenNoToppings },
                  selectedHotHoagieCheese: { kind: "singleString", value: selectedHotHoagieCheese },

                  // Grilled Chicken Side Toppings (Required)
                  selectedGrilledChickenSideToppingsRequired: { kind: "stringArray", value: selectedGrilledChickenSideToppingsRequired },
                  
                  // Cheesesteak Side Toppings (Required)
                  selectedCheesesteakSideToppingsRequired: { kind: "stringArray", value: selectedCheesesteakSideToppingsRequired },
                  
                  // Traditional Dinners states
                  selectedTraditionalDinnersSides: { kind: "stringArray", value: product.category === 'traditional-dinners' ? [] : selectedTraditionalDinnersSides },
                  selectedTraditionalDinnersSoupsSalads: { kind: "stringArray", value: product.category === 'traditional-dinners' ? [] : selectedTraditionalDinnersSoupsSalads },

                  // Catering Pasta states
                  selectedPastaType: { kind: "singleString", value: selectedPastaType },
                  selectedPastaAdditions: { kind: "stringArray", value: selectedPastaAdditions },

                  // Cold Hoagies states
                  selectedColdHoagieCheese: { kind: "singleString", value: selectedColdHoagieCheese },
                  selectedColdHoagieSideToppingsRequired: { kind: "stringArray", value: selectedColdHoagieSideToppingsRequired },
                  selectedColdHoagieToppings: { kind: "stringArray", value: selectedColdHoagieToppings },
                  selectedColdHoagieExtras: { kind: "stringArray", value: selectedColdHoagieExtras },
                  selectedColdHoagieLite: { kind: "stringArray", value: selectedColdHoagieLite },
                  selectedColdHoagieNo: { kind: "stringArray", value: selectedColdHoagieNo },
                  selectedColdHoagieSides: { kind: "stringArray", value: selectedColdHoagieSides },
                  selectedColdHoagieExtraSides: { kind: "stringArray", value: selectedColdHoagieExtraSides },

                  // Burger states
                  selectedBurgerAdd: { kind: "stringArray", value: selectedBurgerAdd },
                  selectedBurgerExtra: { kind: "stringArray", value: selectedBurgerExtra },
                  selectedBurgerLite: { kind: "stringArray", value: selectedBurgerLite },
                  selectedBurgerSide: { kind: "stringArray", value: selectedBurgerSide },
                  selectedBurgerCheese: { kind: "stringArray", value: (product.category === 'appetizers' ? [] : selectedBurgerCheese) },

                  // Chicken Tenders state
                  selectedChickenTendersQuantity: { kind: "singleString", value: selectedChickenTendersQuantity },
                  selectedChickenTendersSauce: { kind: "singleString", value: selectedChickenTendersSauce },
                  selectedChickenTendersSpecialInstructions: { kind: "stringArray", value: selectedChickenTendersSpecialInstructions },
                  selectedChickenTendersExtraSauce: { kind: "stringRecord", value: selectedChickenTendersExtraSauce },
                  selectedChickenTendersExtraCheeseRanch: { kind: "stringRecord", value: selectedChickenTendersExtraCheeseRanch },
                  selectedSubstituteSauce: { kind: "singleString", value: selectedSubstituteSauce },

                  // Mozzarella Sticks state
                  selectedMozzarellaSticksSpecialInstructions: { kind: "stringArray", value: selectedMozzarellaSticksSpecialInstructions },
                  selectedMozzarellaSticksQuantity: { kind: "singleString", value: selectedMozzarellaSticksQuantity },
                  selectedMozzarellaSticksInstructions: { kind: "stringArray", value: selectedMozzarellaSticksInstructions },

                  // Arancini Rice Ball state
                  selectedAranciniQuantity: { kind: "singleString", value: selectedAranciniQuantity },
                  selectedAranciniInstructions: { kind: "stringArray", value: selectedAranciniInstructions },
                  selectedAranciniRegularQuantity: { kind: "singleString", value: selectedAranciniRegularQuantity },
                  selectedAranciniRegularInstructions: { kind: "stringArray", value: selectedAranciniRegularInstructions },

                  // French Fries state
                  selectedFriesInstructions: { kind: "stringArray", value: selectedFriesInstructions },

                  // Garlic Stick state
                  selectedGarlicStickInstructions: { kind: "stringArray", value: selectedGarlicStickInstructions },

                  // Garlic Bread state
                  selectedGarlicBreadInstructions: { kind: "stringArray", value: selectedGarlicBreadInstructions },
                  selectedGarlicBreadMozzarellaInstructions: { kind: "stringArray", value: selectedGarlicBreadMozzarellaInstructions },
                  selectedGarlicBreadSize: { kind: "singleString", value: selectedGarlicBreadSize },
                  selectedGarlicBreadMozzarellaSize: { kind: "singleString", value: selectedGarlicBreadMozzarellaSize },

                  // Salad states
                  selectedSaladToppings: { kind: "stringArray", value: selectedSaladToppings },
                  selectedDressingInstructions: { kind: "singleString", value: selectedDressingInstructions },
                  selectedExtraDressing: { kind: "stringArray", value: selectedExtraDressing },
                  selectedExtraToppings: { kind: "stringArray", value: selectedExtraToppings },

                  // Onion Rings state
                  selectedOnionRingsInstructions: { kind: "stringArray", value: selectedOnionRingsInstructions },

                  // Mac & Cheese Bites state
                  selectedMacAndCheeseBitesInstructions: { kind: "stringArray", value: selectedMacAndCheeseBitesInstructions },

                  // Broccoli & Cheddar Bites state
                  selectedBroccoliCheddarBitesInstructions: { kind: "stringArray", value: selectedBroccoliCheddarBitesInstructions },

                  // Passariello Fries state
                  selectedPassarielloFriesInstructions: { kind: "stringArray", value: selectedPassarielloFriesInstructions },
                  
                  // Cheddar Steak Fries state
                  selectedCheddarSteakFriesInstructions: { kind: "stringArray", value: selectedCheddarSteakFriesInstructions },

                  // Calamari state
                  selectedCalamariSubSauce: { kind: "singleString", value: selectedCalamariSubSauce },

                  // Mussels state
                  selectedMusselsSauce: { kind: "singleString", value: selectedMusselsSauce },

                  // Seafood Combo state
                  selectedSeafoodComboSauce: { kind: "singleString", value: selectedSeafoodComboSauce },

                  // Shrimp Marinara state
                  selectedShrimpMarinaraSubSauce: { kind: "singleString", value: selectedShrimpMarinaraSubSauce },

                  // Marinara Appetizer Sauce
                  selectedMarinaraAppetizerSauce: { kind: "singleString", value: selectedMarinaraAppetizerSauce },

                  // Pasta e Fagioli Substitute
                  selectedPastaFagioliSubstitute: { kind: "singleString", value: selectedPastaFagioliSubstitute },

                  // Seafood Pasta Type
                  selectedSeafoodPastaType: { kind: "singleString", value: selectedSeafoodPastaType },

                  // Wings state
                  selectedWingsQuantity: { kind: "singleString", value: selectedWingsQuantity },
                  selectedWingsSauce: { kind: "singleString", value: selectedWingsSauce },
                  selectedWingsSpecialInstructions: { kind: "stringArray", value: selectedWingsSpecialInstructions },
                  selectedWingsExtraSauce: { kind: "stringRecord", value: selectedWingsExtraSauce },
                  selectedWingsExtraCheeseRanch: { kind: "stringRecord", value: selectedWingsExtraCheeseRanch },

                  // Pizza Dippings state
                  selectedPizzaDippings: { kind: "numberRecord", value: selectedPizzaDippings },

                  // Brioche states
                  selectedBriocheAddCheese: { kind: "singleString", value: selectedBriocheAddCheese },
                  selectedBriocheExtraCheese: { kind: "stringArray", value: selectedBriocheExtraCheese },
                  selectedBriocheNo: { kind: "stringArray", value: selectedBriocheNo },
                  selectedBriocheSide: { kind: "stringArray", value: selectedBriocheSide },

                  // Panini states
                  selectedPaniniType: { kind: "singleString", value: selectedPaniniType },
                  selectedPaniniExtraCheese: { kind: "stringArray", value: selectedPaniniExtraCheese },
                  selectedPaniniLite: { kind: "stringArray", value: selectedPaniniLite },
                  selectedPaniniNo: { kind: "stringArray", value: selectedPaniniNo },
                  selectedPaniniSides: { kind: "stringArray", value: selectedPaniniSides },
                  selectedPaniniCheese: { kind: "singleString", value: selectedPaniniCheese },

                  // Wrap states
                  selectedWrapType: { kind: "singleString", value: selectedWrapType },
                  selectedWrapCheese: { kind: "singleString", value: selectedWrapCheese },
                  selectedWrapAddToppings: { kind: "stringArray", value: selectedWrapAddToppings },
                  selectedWrapExtraCheese: { kind: "stringArray", value: selectedWrapExtraCheese },
                  selectedWrapLite: { kind: "stringArray", value: selectedWrapLite },
                  selectedWrapNo: { kind: "stringArray", value: selectedWrapNo },
                  selectedWrapSide: { kind: "stringArray", value: selectedWrapSide },

                  // Pasta Fagioli Soup states
                  selectedPastaFagioliSpecialInstructions: { kind: "stringArray", value: selectedPastaFagioliSpecialInstructions },
                  selectedPastaFagioliSubstituteCracker: { kind: "stringArray", value: selectedPastaFagioliSubstituteCracker },

                  // Kids Pasta states
                  selectedKidsPastaType: { kind: "singleString", value: selectedKidsPastaType },
                  selectedKidsPastaSauce: { kind: "singleString", value: selectedKidsPastaSauce },
                  selectedKidsPastaToppings: { kind: "stringArray", value: selectedKidsPastaToppings },
                  selectedKidsPastaSpecialInstructions: { kind: "stringArray", value: selectedKidsPastaSpecialInstructions },

                  // Build Your Own Pasta states
                  selectedBuildPastaType: { kind: "singleString", value: selectedBuildPastaType },
                  selectedBuildPastaSauce: { kind: "singleString", value: selectedBuildPastaSauce },
                  selectedBuildPastaToppings: { kind: "stringArray", value: selectedBuildPastaToppings },
                  selectedBuildPastaSoup: { kind: "stringArray", value: selectedBuildPastaSoup },

                  // Kids Baked items states
                  selectedKidsBakedExtraToppings: { kind: "stringArray", value: selectedKidsBakedExtraToppings },
                  selectedKidsBakedLiteToppings: { kind: "stringArray", value: selectedKidsBakedLiteToppings },
                  selectedKidsBakedNoToppings: { kind: "stringArray", value: selectedKidsBakedNoToppings },

                  // Kids Pasta and Meatball states
                  selectedKidsPastaMeatballType: { kind: "singleString", value: selectedKidsPastaMeatballType },
                  selectedKidsPastaMeatballSpecialInstructions: { kind: "stringArray", value: selectedKidsPastaMeatballSpecialInstructions },
                  selectedKidsPastaMeatballToppings: { kind: "stringArray", value: selectedKidsPastaMeatballToppings },

                  // Salad Bowl states
                  selectedAntipastoBase: { kind: "singleString", value: selectedAntipastoBase },
                  selectedAntipastoDressings: { kind: "stringArray", value: selectedAntipastoDressings },
                  selectedAntipastoSpecialInstructions: { kind: "stringArray", value: selectedAntipastoSpecialInstructions },
                  
                  selectedCaesarBase: { kind: "singleString", value: selectedCaesarBase },
                  selectedCaesarDressings: { kind: "stringArray", value: selectedCaesarDressings },
                  selectedCaesarSpecialInstructions: { kind: "stringArray", value: selectedCaesarSpecialInstructions },
                  
                  selectedChickenCaesarBase: { kind: "singleString", value: selectedChickenCaesarBase },
                  selectedChickenCaesarDressings: { kind: "stringArray", value: selectedChickenCaesarDressings },
                  selectedChickenCaesarSpecialInstructions: { kind: "stringArray", value: selectedChickenCaesarSpecialInstructions },
                  
                  selectedGardenBase: { kind: "singleString", value: selectedGardenBase },
                  selectedGardenDressings: { kind: "stringArray", value: selectedGardenDressings },
                  selectedGardenSpecialInstructions: { kind: "stringArray", value: selectedGardenSpecialInstructions },
                  
                  selectedRoastedRedPepperBase: { kind: "singleString", value: selectedRoastedRedPepperBase },
                  selectedRoastedRedPepperDressings: { kind: "stringArray", value: selectedRoastedRedPepperDressings },
                  
                  selectedThreeCheeseBase: { kind: "singleString", value: selectedThreeCheeseBase },
                  selectedThreeCheeseDressings: { kind: "stringArray", value: selectedThreeCheeseDressings },
                  selectedThreeCheeseSpecialInstructions: { kind: "stringArray", value: selectedThreeCheeseSpecialInstructions },
                  
                  selectedTraditionalChefBase: { kind: "singleString", value: selectedTraditionalChefBase },
                  selectedTraditionalChefDressings: { kind: "stringArray", value: selectedTraditionalChefDressings },
                  selectedTraditionalChefSpecialInstructions: { kind: "stringArray", value: selectedTraditionalChefSpecialInstructions },

                  // Regular Salads - Special Instructions
                  selectedCalamariSpecialInstructions: { kind: "stringArray", value: selectedCalamariSpecialInstructions },
                  selectedCapreseSpecialInstructions: { kind: "stringArray", value: selectedCapreseSpecialInstructions },
                  selectedFarfallePastaSpecialInstructions: { kind: "stringArray", value: selectedFarfallePastaSpecialInstructions },
                  selectedItalianChoppedSpecialInstructions: { kind: "stringArray", value: selectedItalianChoppedSpecialInstructions },
                  selectedRoastedRedPeppersSpecialInstructions: { kind: "stringArray", value: selectedRoastedRedPeppersSpecialInstructions },
                  selectedTunaSpecialInstructions: { kind: "stringArray", value: selectedTunaSpecialInstructions },

                  // Hoagie Platter states
                  selectedHoagiePlatterOptions: { kind: "numberRecord", value: selectedHoagiePlatterOptions },
                  selectedHoagiePlatterCut: { kind: "singleString", value: selectedHoagiePlatterCut },
                  selectedHoagiePlatterSideToppings: { kind: "numberRecord", value: selectedHoagiePlatterSideToppings },

                  // Wrap Platter states
                  selectedWrapPlatterOptions: { kind: "numberRecord", value: selectedWrapPlatterOptions },
                  selectedWrapPlatterWrapType: { kind: "singleString", value: selectedWrapPlatterWrapType },
                  selectedWrapPlatterSideToppings: { kind: "numberRecord", value: selectedWrapPlatterSideToppings },

                  // Hot Sandwich Platter states
                  selectedHotSandwichPlatterOptions: { kind: "numberRecord", value: selectedHotSandwichPlatterOptions },
                  selectedHotSandwichPlatterCut: { kind: "singleString", value: selectedHotSandwichPlatterCut },
                  selectedHotSandwichPlatterSideToppings: { kind: "numberRecord", value: selectedHotSandwichPlatterSideToppings },

                  // Seafood Tray states
                  selectedBabyClamPastaType: { kind: "singleString", value: selectedBabyClamPastaType },
                  selectedBabyClamSauceChoice: { kind: "singleString", value: selectedBabyClamSauceChoice },
                  
                  selectedCalamariPastaType: { kind: "singleString", value: selectedCalamariPastaType },
                  selectedCalamariSubstituteSauce: { kind: "singleString", value: selectedCalamariSubstituteSauce },
                  
                  selectedMusselsPastaType: { kind: "singleString", value: selectedMusselsPastaType },
                  selectedMusselsSauceChoice: { kind: "singleString", value: selectedMusselsSauceChoice },
                  
                  selectedSeafoodComboPastaType: { kind: "singleString", value: selectedSeafoodComboPastaType },
                  selectedSeafoodComboSauceChoice: { kind: "singleString", value: selectedSeafoodComboSauceChoice },
                  
                  selectedShrimpMarinaraPastaType: { kind: "singleString", value: selectedShrimpMarinaraPastaType },
                  selectedShrimpMarinaraSubstituteSauce: { kind: "singleString", value: selectedShrimpMarinaraSubstituteSauce },

                  // Cannoli states
                  selectedCannoliSpecialInstruction: { kind: "booleanRecord", value: selectedCannoliSpecialInstruction ? { 'cannoli-special': selectedCannoliSpecialInstruction } : {} },

                  // Dessert Tray states
                  selectedDessertTraySpecialInstruction: { kind: "booleanRecord", value: selectedDessertTraySpecialInstruction ? { 'dessert-tray-special': selectedDessertTraySpecialInstruction } : {} },
                };

                // Apply filtering before auto-capture
                const filteredSources = filterSelectionSourcesByProduct(rawSelectionSources, product);
                
                // Call the auto-capture function with FILTERED sources only
                completeSelectionsFromRawSources(selections, filteredSources, getItemName, product);
                
                // Patch distribution for sauces
                const extraSauceSelections: typeof selections = [];
                
                selections.forEach(sel => {
                  if (sauceDistribution[sel.id]) {
                    const dist = sauceDistribution[sel.id];
                    
                    if (dist && dist !== 'whole') {
                      // Preserve distribution so CartSidebar handles the display (e.g. "Red Sauce (Left)")
                      sel.distribution = dist;
                      
                      const baseName = sel.id === 'sauce-pizza' ? 'Red Sauce' : sel.label;
                      
                      // For split sauces, explicitly add the complementary half.
                      if (baseName === 'Red Sauce') {
                        const otherSide = dist === 'left' ? 'right' : 'left';
                        
                        // Add the complementary White Pizza selection
                        extraSauceSelections.push({
                          id: `generated-white-pizza-${Date.now()}`,
                          label: 'White Pizza',
                          type: sel.type,
                          distribution: otherSide,
                          groupId: sel.groupId,
                          groupTitle: sel.groupTitle,
                          productId: sel.productId
                        });
                      } else if (baseName === 'White Sauce' || baseName === 'White Pizza') {
                        const otherSide = dist === 'left' ? 'right' : 'left';

                        // Add the complementary Red Pizza selection
                        extraSauceSelections.push({
                          id: `generated-red-pizza-${Date.now()}`,
                          label: 'Red Pizza',
                          type: sel.type,
                          distribution: otherSide,
                          groupId: sel.groupId,
                          groupTitle: sel.groupTitle,
                          productId: sel.productId
                        });
                      }
                    } else {
                      sel.distribution = 'whole';
                    }
                  }
                });
                
                // Add generated selections
                extraSauceSelections.forEach(s => selections.push(s));

                // Patch distribution for toppings
                selections.forEach(sel => {
                  if ((sel.type === 'topping' || sel.type === 'extra_topping') && toppingDistribution[sel.id]) {
                    sel.distribution = toppingDistribution[sel.id];
                  }
                });
                
                if (debugCartEnabled) {
                  console.log('[DEBUG] ProductDetailPage  onAddToCart', {
                    productId: modifiedProduct.id,
                    productName: modifiedProduct.name,
                    quantity,
                    selectionsCount: selections.length,
                    selections,
                  });
                }
                
                // Update price with total calculated unit price
                modifiedProduct.price = `$${calculateUnitPrice()}`;
                
                // VALIDATION: Required Sauce for Specialty Pizzas
                if (['sp-10', 'sp-12', 'sp-15'].includes(product.id)) {
                  // Check if any sauce is selected (sauce-pizza or sauce-white)
                  // Note: selectedSauces state tracks IDs.
                  if (selectedSauces.length === 0) {
                     setSauceError(true);
                     setIsSauceOpen(true);
                     return;
                  }
                }

                // ============================================================
                // INJECT INCLUDED SAUCE SELECTION
                // ============================================================
                let includedSauceLabel = '';

                // Mozzarella Sticks Group
                if (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') {
                    if (selectedMozzarellaSticksQuantity === '6pcs') includedSauceLabel = '(4oz) Pomodoro Sauce';
                    else if (selectedMozzarellaSticksQuantity === '12pcs') includedSauceLabel = '(8oz) Pomodoro Sauce';
                    else if (selectedMozzarellaSticksQuantity === '24pcs') includedSauceLabel = '(16oz) Pomodoro Sauce';
                    else if (selectedMozzarellaSticksQuantity === '48pcs') includedSauceLabel = '(32oz) Pomodoro Sauce';
                    else includedSauceLabel = '(4oz) Pomodoro Sauce';
                }
                // Arancini Regular
                else if (product.id === 'app8') {
                    if (selectedAranciniRegularQuantity === '1pc' || selectedAranciniRegularQuantity === '2pcs') includedSauceLabel = '(4oz) Pomodoro Sauce';
                    else if (selectedAranciniRegularQuantity === '4pcs') includedSauceLabel = '(8oz) Pomodoro Sauce';
                    else if (selectedAranciniRegularQuantity === '8pcs') includedSauceLabel = '(16oz) Pomodoro Sauce';
                    else if (selectedAranciniRegularQuantity === '16pcs') includedSauceLabel = '(32oz) Pomodoro Sauce';
                    else includedSauceLabel = '(4oz) Pomodoro Sauce';
                }
                // Arancini Catering
                else if (product.id === 'capp4') {
                     if (selectedAranciniQuantity === '10pcs') includedSauceLabel = '(16oz) Pomodoro Sauce';
                     else if (selectedAranciniQuantity === '20pcs') includedSauceLabel = '(32oz) Pomodoro Sauce';
                     else if (selectedAranciniQuantity === '30pcs') includedSauceLabel = '(48oz) Pomodoro Sauce';
                     else if (selectedAranciniQuantity === '50pcs') includedSauceLabel = '(80oz) Pomodoro Sauce';
                     else includedSauceLabel = '(16oz) Pomodoro Sauce';
                }
                // Mac & Cheese Bites (app13) handled in custom block above
                else if (product.id === 'app13') {
                     // Do nothing here, handled explicitly above to avoid duplications
                }
                // Wings & Catering Appetizers (Wings)
                else if (product.id === 'app18' || (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') || (product.category === 'catering-appetizers' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) {
                     let sizeStr = '2oz';
                     if (product.id === 'app18') {
                        if (selectedWingsQuantity === '10pcs') sizeStr = '2oz';
                        else if (selectedWingsQuantity === '20pcs') sizeStr = '4oz';
                        else if (selectedWingsQuantity === '30pcs') sizeStr = '8oz';
                        else if (selectedWingsQuantity === '50pcs') sizeStr = '16oz';
                     } else {
                        if (selectedSize === '10') sizeStr = '2oz';
                        else if (selectedSize === '20') sizeStr = '4oz';
                        else if (selectedSize === '30') sizeStr = '8oz';
                        else if (selectedSize === '50') sizeStr = '16oz';
                     }
                     includedSauceLabel = `${sizeStr} Bleu Cheese`;
                }
                // Broccoli, Garlic Sticks
                // app12 (Cheddar Steak Fries) removed from here
                else if (false) {
                     // includedSauceLabel = '(4oz) Pomodoro Sauce';
                }

                if (includedSauceLabel) {
                    selections.unshift({
                        id: `included-sauce-${product.id}`,
                        label: includedSauceLabel,
                        type: 'extra_topping',
                        groupId: 'included_sauce',
                        groupTitle: 'Included',
                        productId: product.id,
                        price: 0
                    });
                }

                // Cold Hoagies / Wraps: report Side of Extra Chips with quantity suffix (xN)
                if (product.category === 'cold-hoagies' && chipsQuantity > 0) {
                  const chipsLine = `Side of Extra Chips x${chipsQuantity}`;
                  customizations.push({ category: 'Side of Extra Chips', items: [chipsLine] });
                  if (!selections.some(s => s.id === 'ch-chips')) {
                    selections.push({
                      id: 'ch-chips',
                      label: chipsLine,
                      type: 'side',
                      groupId: 'cold_hoagie_side_of_chips',
                      groupTitle: 'Side of Extra Chips',
                      productId: product.id
                    });
                  }
                }
                if (product.category === 'wraps' && wrapChipsQuantity > 0) {
                  const chipsLine = `Side of Extra Chips x${wrapChipsQuantity}`;
                  customizations.push({ category: 'Side of Extra Chips', items: [chipsLine] });
                  if (!selections.some(s => s.id === 'ch-chips')) {
                    selections.push({
                      id: 'ch-chips',
                      label: chipsLine,
                      type: 'side',
                      groupId: 'wrap_side_of_chips',
                      groupTitle: 'Side of Extra Chips',
                      productId: product.id
                    });
                  }
                }

                let filteredSelections = filterSelectionsByProduct(selections, modifiedProduct);
                // PASTA/CREATE-PASTA final normalization: rebuild soup/salad rows with canonical IDs + removals.
                if (product.category === 'create-pasta' || product.category === 'pasta') {
                  const soupIdSet = new Set((buildPastaSoups || []).map(s => String(s.id)));
                  const soupNameSet = new Set((buildPastaSoups || []).map(s => String(s.name || '').toLowerCase().trim()));
                  const isSoupLabel = (value: string): boolean => {
                    const t = String(value || '').toLowerCase().trim();
                    if (!t) return false;
                    if (soupNameSet.has(t)) return true;
                    if (t.startsWith('side garden salad')) return true;
                    if (t.startsWith('side caesar salad')) return true;
                    if (t === 'soup of the day') return true;
                    if (t === 'pasta e fagioli') return true;
                    return false;
                  };
                  const getSoupById = (id: string) => buildPastaSoups.find(s => s.id === id);
                  const getRemovedNames = (id: string): string[] => {
                    const soup = getSoupById(id);
                    if (!soup?.removableIngredients) return [];
                    if (id === 'bps3') {
                      return soup.removableIngredients
                        .filter(ing => sideGardenSaladRemovedIngredients.includes(ing.id))
                        .map(ing => ing.name);
                    }
                    if (id === 'bps4') {
                      return soup.removableIngredients
                        .filter(ing => sideCaesarSaladRemovedIngredients.includes(ing.id))
                        .map(ing => ing.name);
                    }
                    return [];
                  };

                  filteredSelections = filteredSelections.filter((s) => {
                    const sid = String(s?.id || '');
                    const gid = String(s?.groupId || '').toLowerCase();
                    const gtitle = String(s?.groupTitle || '').toLowerCase();
                    const label = String(s?.label || '');
                    const isSoupBySection = gid.includes('build_pasta_soup') || gtitle.includes('choose soup or salad');
                    const isSoupBySynthetic = sid.startsWith('cp-soup-');
                    const isSoupBySharedId = soupIdSet.has(sid) && (isSoupBySection || isSoupLabel(label) || s?.type === 'side');
                    return !(isSoupBySection || isSoupBySynthetic || isSoupBySharedId);
                  });

                  const soupLabelsForCustomization: string[] = [];
                  (selectedBuildPastaSoup || []).forEach((id) => {
                    const soup = getSoupById(id);
                    const baseName = soup?.name || getItemName(id);
                    if (!baseName) return;
                    const removedNames = getRemovedNames(id);
                    const suffix = removedNames.length > 0 ? ` (No ${removedNames.join(', No ')})` : '';
                    const label = `${baseName}${suffix}`;

                    filteredSelections.push({
                      id: `cp-soup-${id}`,
                      label,
                      type: 'side',
                      groupId: 'build_pasta_soup',
                      groupTitle: 'Choose Soup or Salad',
                      productId: product.id,
                      removedIngredients: removedNames.length > 0 ? removedNames : undefined
                    });

                    soupLabelsForCustomization.push(label);
                  });

                  for (let i = customizations.length - 1; i >= 0; i--) {
                    const cat = String(customizations[i]?.category || '').toLowerCase();
                    if (cat === 'choose soup or salad' || cat === 'soups & salads' || cat === 'side soups, salads, & extra bread') {
                      customizations.splice(i, 1);
                    }
                  }
                  if (soupLabelsForCustomization.length > 0) {
                    customizations.push({
                      category: 'Choose Soup or Salad',
                      items: soupLabelsForCustomization
                    });
                  }
                }
                if ((modifiedProduct.category || '').toLowerCase().includes('cheesesteak')) {
                  filteredSelections = sanitizeCheesesteakSelections(filteredSelections);
                  const cleanedCustomizations = sanitizeCheesesteakCustomizations(filteredSelections);
                  customizations.length = 0;
                  customizations.push(...cleanedCustomizations);
                }
                
                // FIX: Mac & Cheese Bites (app13) - Ensure customizations are clean to avoid legacy strings
                if (modifiedProduct.id === 'app13') {
                   // Clear customizations array to rely solely on selections
                   customizations.length = 0; 
                }

                if (debugCartEnabled && modifiedProduct.id === 'app13') {
                   console.log(' Mac & Cheese Bites Debug (Mobile):', {
                      productId: modifiedProduct.id,
                      productName: modifiedProduct.name,
                      selections: filteredSelections,
                      customizations: customizations
                   });
                }

                if (debugCartEnabled) {
                   console.log('[DEBUG] Mobile AddToCart Payload:', {
                      productId: modifiedProduct.id,
                      productName: modifiedProduct.name,
                      category: modifiedProduct.category,
                      selectedWingsSauce: selectedWingsSauce,
                      selections: filteredSelections,
                      customizations: customizations
                   });
                }
                
                // ============================================================
                // ARANCINI FIX: QUANTITY DISPLAY
                // ============================================================
                if (modifiedProduct.id === 'app8' || modifiedProduct.id === 'capp4') {
                   // 1. Identify selected count
                   let rawQty = '';
                   if (modifiedProduct.id === 'app8') rawQty = selectedAranciniRegularQuantity;
                   else rawQty = selectedAranciniQuantity;
                   
                   const countMatch = rawQty.match(/(\d+)/);
                   const count = countMatch ? countMatch[1] : '1';
                   
                   // 2. Remove any auto-generated "pcs" selection from filteredSelections
                   const idxToRemove = filteredSelections.findIndex(s => s.id === rawQty || s.label === rawQty || s.label.toLowerCase().includes('pcs'));
                   if (idxToRemove !== -1) {
                      filteredSelections.splice(idxToRemove, 1);
                   }
                   
                   // 3. Push explicit clean Quantity selection
                   filteredSelections.push({
                      id: `arancini-qty-${count}`,
                      label: `${count} Arancini Rice Ball`,
                      type: 'required_option',
                      groupTitle: 'Quantity',
                      productId: modifiedProduct.id
                   });
                }

                // ============================================================
                // MOZZARELLA STICKS FIX: QUANTITY DISPLAY
                // ============================================================
                if (modifiedProduct.id === 'app4' || modifiedProduct.id === 'wing4' || modifiedProduct.id === 'capp3') {
                   // 1. Identify selected count
                   const rawQty = selectedMozzarellaSticksQuantity;
                   const countMatch = rawQty.match(/(\d+)/);
                   const count = countMatch ? countMatch[1] : '6';
                   
                   // 2. Remove any auto-generated "pcs" selection from filteredSelections
                   const idxToRemove = filteredSelections.findIndex(s => s.id === rawQty || s.label === rawQty || s.label.toLowerCase().includes('pcs'));
                   if (idxToRemove !== -1) {
                      filteredSelections.splice(idxToRemove, 1);
                   }
                   
                   // 3. Push explicit clean Quantity selection
                   filteredSelections.push({
                      id: `sticks-qty-${count}`,
                      label: `${count} Mozzarella Sticks`,
                      type: 'required_option',
                      groupTitle: 'Quantity',
                      productId: modifiedProduct.id
                   });
                }

                // ============================================================
                // CHICKEN TENDERS FIX: QUANTITY DISPLAY
                // ============================================================
                if (modifiedProduct.id === 'app6' || modifiedProduct.id === 'wing3' || modifiedProduct.id === 'capp2') {
                   // 1. Identify selected count
                   const rawQty = selectedChickenTendersQuantity;
                   const countMatch = rawQty.match(/(\d+)/);
                   const count = countMatch ? countMatch[1] : '4';
                   
                   // 2. Remove any auto-generated "pcs" selection from filteredSelections
                   const idxToRemove = filteredSelections.findIndex(s => s.id === rawQty || s.label === rawQty || s.label.toLowerCase().includes('pcs'));
                   if (idxToRemove !== -1) {
                      filteredSelections.splice(idxToRemove, 1);
                   }
                   
                   // 3. Push explicit clean Quantity selection
                   filteredSelections.push({
                      id: `tenders-qty-${count}`,
                      label: `${count} Chicken Tenders`,
                      type: 'required_option',
                      groupTitle: 'Quantity',
                      productId: modifiedProduct.id
                   });
                }
                
                // ============================================================
                // SEAFOOD FIX: CLEANUP AND PUSH SAUCE
                // ============================================================
                if (product.category === 'seafood') {
                  if (debugCartEnabled) {
                     console.log('[SEAFOOD] before cleanup selections:', JSON.stringify(filteredSelections));
                  }
                  
                  // 1) Clean contamination (burger_cheese, etc)
                  for (let i = filteredSelections.length - 1; i >= 0; i--) {
                    const s = filteredSelections[i];
                    if (s.groupId === "burger_cheese" || s.groupTitle === "Cheese" || s.type === "cheese") {
                       filteredSelections.splice(i, 1);
                    }
                  }
                  // Remove stale Seafood pasta-type entries before re-adding deterministically.
                  for (let i = filteredSelections.length - 1; i >= 0; i--) {
                    const s = filteredSelections[i];
                    const gid = String(s?.groupId || '').toLowerCase();
                    const gtitle = String(s?.groupTitle || '').toLowerCase();
                    const stype = String(s?.type || '').toLowerCase();
                    if (
                      gid === 'seafood_pasta_type_required' ||
                      gid === 'seafood_pasta_type' ||
                      (gtitle.includes('pasta') && gtitle.includes('type')) ||
                      stype === 'pasta_type'
                    ) {
                      filteredSelections.splice(i, 1);
                    }
                  }
                  
                  // Clean customizations
                  for (let i = customizations.length - 1; i >= 0; i--) {
                    const cat = String(customizations[i]?.category || '').toLowerCase();
                    if (cat === "cheese" || cat === "pasta type") {
                       customizations.splice(i, 1);
                    }
                  }

                  if (debugCartEnabled) {
                     console.log('[SEAFOOD] after cleanup selections:', JSON.stringify(filteredSelections));
                  }

                  // 2) Push required pasta type ("Your Choice of Pasta")
                  if (selectedSeafoodPastaType) {
                    const pastaOption = seafoodPastaTypes.find(x => x.id === selectedSeafoodPastaType);
                    const pastaLabel = pastaOption?.name || getItemName(selectedSeafoodPastaType);
                    if (pastaLabel) {
                      filteredSelections.push({
                        id: selectedSeafoodPastaType,
                        label: pastaLabel,
                        type: "required_option",
                        groupId: "seafood_pasta_type_required",
                        groupTitle: "Pasta Type",
                        productId: product.id,
                      });
                      customizations.push({
                        category: "Pasta Type",
                        items: [pastaLabel]
                      });
                    }
                  }

                  // 3) Push required sauce
                  let sauceLabel = seafoodSauceOptions.find(x => x.id === selectedSeafoodSauceId)?.label;
                  
                  // Fallback lookup
                  if (!sauceLabel) {
                     const allOptions = [
                        ...musselsSauceOptions,
                        ...seafoodComboSauceOptions,
                        ...marinaraAppetizerSauceOptions,
                        ...calamariSubSauceOptions,
                        ...shrimpMarinaraSubSauceOptions,
                        ...babyClamSauceChoices
                     ];
                     sauceLabel = allOptions.find(x => x.id === selectedSeafoodSauceId)?.name;
                  }

                  if (sauceLabel) {
                    if (debugCartEnabled) {
                       console.log('[SEAFOOD] pushing sauce selection:', sauceLabel);
                    }
                    filteredSelections.push({
                      id: selectedSeafoodSauceId,
                      label: sauceLabel,
                      type: "sauce",
                      groupId: "seafood_sauce",
                      groupTitle: "Sauce",
                      productId: product.id,
                    });
                  }
                }

                // ============================================================
                // BRIOCHE FIX: remove cross-category cheese contamination
                // ============================================================
                if (product.category === 'brioche') {
                  const allowedBriocheCheeseIds = new Set([
                    'brc1', 'brc2', 'brc3', 'brc4', 'brc5', 'brc6', 'brc7'
                  ]);

                  // Keep only Brioche cheese selections.
                  for (let i = filteredSelections.length - 1; i >= 0; i--) {
                    const s = filteredSelections[i] as any;
                    const sid = String(s?.id || '');
                    const gid = String(s?.groupId || '').toLowerCase();
                    const isCheeseLike = s?.type === 'cheese' || gid.includes('cheese') || String(s?.groupTitle || '').toLowerCase().includes('cheese');
                    if (!isCheeseLike) continue;

                    const isBriocheCheese =
                      allowedBriocheCheeseIds.has(sid) ||
                      gid.includes('brioche');

                    if (!isBriocheCheese) {
                      filteredSelections.splice(i, 1);
                    }
                  }

                  // Remove generic cheese customizations; Brioche cheese is re-added deterministically later.
                  for (let i = customizations.length - 1; i >= 0; i--) {
                    const cat = String(customizations[i]?.category || '').toLowerCase();
                    if (cat === 'cheese') {
                      customizations.splice(i, 1);
                    }
                  }
                }

                // --- SIZE FILTERING LOGIC (Start) ---
                if (isNoSizePizza) {
                    if (filteredSelections && filteredSelections.length > 0) {
                        const initialCount = filteredSelections.length;
                        filteredSelections = stripSizeSelections(filteredSelections);
                        const afterCount = filteredSelections.length;
                        if (debugCartEnabled && initialCount !== afterCount) {
                            console.log('[NO_SIZE_DEBUG_ADD_TO_CART]', { 
                                productId: modifiedProduct.id, 
                                category: modifiedProduct.category, 
                                before: initialCount, 
                                after: afterCount 
                            });
                        }
                    }

                    if (customizations && customizations.length > 0) {
                         for (let i = customizations.length - 1; i >= 0; i--) {
                             const c = customizations[i];
                             if (c.category === 'Size') {
                                 customizations.splice(i, 1);
                                 continue;
                             }
                             if (c.items && c.items.length > 0) {
                                 const originalItemsCount = c.items.length;
                                 c.items = c.items.filter(txt => {
                                     if (/^(Small|Medium|Large|Jumbo|Personal)\b/i.test(txt)) return false;
                                     if (/\d+"\s+(Small|Medium|Large|Jumbo)/i.test(txt)) return false;
                                     return true;
                                 });
                                 if (c.items.length !== originalItemsCount && debugCartEnabled) {
                                      console.log('[NO_SIZE_DEBUG_ADD_TO_CART] Removed sizes from customization items:', { category: c.category, removed: originalItemsCount - c.items.length });
                                 }
                                 if (c.items.length === 0) {
                                     customizations.splice(i, 1);
                                 }
                             }
                         }
                    }
                }
                // --- SIZE FILTERING LOGIC (End) ---

                onAddToCart(modifiedProduct, quantity, customizations, filteredSelections);
                onBack();
              }}
              className="flex-1 min-w-0 bg-[#A72020] hover:bg-[#8B1A1A] text-white h-[2.73rem] flex items-center justify-center gap-2 sm:gap-2.5 font-semibold rounded-md transition-colors px-2 sm:px-4"
            >
              <span className="text-[15px] sm:text-[17px] leading-none whitespace-nowrap">${calculateTotal()}</span>
              <span className="text-white/40 text-xs sm:text-sm">|</span>
              <span className="text-[15px] sm:text-[17px] leading-none whitespace-nowrap">{isEditMode ? 'SAVE' : 'ADD TO CART'}</span>
            </Button>
          </div>

          {/* Desktop Layout */}
          <div className="hidden lg:flex items-center justify-center gap-4 xl:gap-6 w-full max-w-full overflow-hidden">
            {/* Item is for Name */}
            <div className="text-gray-700 flex items-center gap-2 xl:gap-3 flex-shrink min-w-0">
              <span className="text-xs xl:text-sm whitespace-nowrap flex-shrink-0">Item is for</span>
              <input
                type="text"
                value={itemName}
                onChange={(e) => setItemName(e.target.value)}
                placeholder="Name"
                className="font-semibold border-b-2 border-gray-300 focus:border-[#A72020] outline-none px-2 py-1 bg-transparent transition-colors text-xs xl:text-sm w-20 xl:w-24 min-w-0"
              />
            </div>

            {/* Quantity Section */}
            <div className="flex items-center gap-2 xl:gap-3 flex-shrink-0">
              <span className="text-gray-700 text-xs xl:text-sm whitespace-nowrap">Quantity</span>
              <button
                onClick={() => setQuantity(Math.max(1, quantity - 1))}
                className="flex items-center justify-center hover:opacity-70 transition-opacity p-0.5 xl:p-1"
              >
                <Minus className="w-3.5 xl:w-4 h-3.5 xl:h-4 text-gray-700" />
              </button>
              <span className="font-semibold text-gray-900 min-w-[24px] xl:min-w-[32px] text-center text-sm xl:text-base">{quantity}</span>
              <button
                onClick={() => setQuantity(quantity + 1)}
                className="flex items-center justify-center hover:opacity-70 transition-opacity p-0.5 xl:p-1"
              >
                <Plus className="w-3.5 xl:w-4 h-3.5 xl:h-4 text-gray-700" />
              </button>
            </div>

            {/* Add to Cart Button with Price */}
            <Button
                onClick={() => {
                  // Validate toast and cheese options for cheesesteaks
                  let hasError = false;

                  // Validate Buffalo Chicken Stromboli dipping selection
                  if (product.name === 'Buffalo Chicken Stromboli') {
                    const hasSelection = selectedExtraSauce.some(id => ['bc', 'br', 'none'].includes(id));
                    if (!hasSelection) {
                      setDippingError(true);
                      hasError = true;
                      setTimeout(() => {
                          dippingErrorRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      }, 100);
                    }
                  }
                  
                  if (product.category === 'cheesesteaks' && !toastRoll) {
                    setToastOptionError(true);
                    hasError = true;
                  }
                  
                  if (product.category === 'cheesesteaks' && !selectedCheese) {
                    setCheeseOptionError(true);
                    hasError = true;
                  }
                  
                  // Validate cheese for all hot hoagies
                  if (product.category === 'hot-hoagies') {
                    if (!toastRoll) {
                      setToastOptionError(true);
                      hasError = true;
                    }
                    // Cheese is optional for Grilled Chicken Hoagie
                    if (product.name !== 'Grilled Chicken Hoagie' && !selectedHotHoagieCheese) {
                      setHotHoagieCheeseError(true);
                      hasError = true;
                    }
                  }

                  // Validate cheese for all burgers (except Hamburger which is optional)
                  if (product.category === 'burgers') {
                    if (!toastRoll) {
                      setToastOptionError(true);
                      hasError = true;
                    }
                    if (product.name !== 'Hamburger' && selectedBurgerCheese.length === 0) {
                      setBurgerCheeseError(true);
                      hasError = true;
                    }
                  }

                  // Validate for brioche
                  if (product.category === 'brioche') {
                    if (!toastRoll) {
                      setToastOptionError(true);
                      hasError = true;
                    }
                  }

                  // Validate cheese for Cold Hoagies (Ham & Cheese)
                  if (product.category === 'cold-hoagies') {
                    if (product.name === 'Ham & Cheese' && !selectedColdHoagieCheese) {
                      setColdHoagieCheeseError(true);
                      hasError = true;
                    }
                  }
                  
                  // Validate sauce choice for wings
                  if ((product.id === 'app18' || ((product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) && !selectedWingsSauce) {
                    setWingsSauceError(true);
                    hasError = true;
                  }
                  
                  // Validate special instructions for wings
                  if ((product.id === 'app18' || ((product.category === 'wings' || product.category === 'catering-appetizers') && product.id !== 'wing3' && product.id !== 'wing4' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) && selectedWingsSpecialInstructions.length === 0) {
                    setWingsSpecialInstructionsError(true);
                    hasError = true;
                  }
                  
                  // Validate panini type selection
                  if (product.category === 'paninis' && !selectedPaniniType) {
                    setPaniniTypeError(true);
                    hasError = true;
                  }
                  
                  // Validate wrap type selection
                  if (product.category === 'wraps' && !selectedWrapType) {
                    setWrapTypeError(true);
                    hasError = true;
                  }
                  
                  // Validate wrap cheese selection for cheesesteak wraps, chicken caesar wrap, grilled chicken wrap, italian wrap, and veggie wrap
                  if ((product.name === 'Buffalo Chicken Cheesesteak Wrap' || 
                       product.name === 'Cheesesteak Wrap' || 
                       product.name === 'Chicken Cheesesteak Wrap' ||
                       product.name === 'Chicken Caesar Wrap' ||
                       product.name === 'Grilled Chicken Wrap' ||
                       product.name === 'Italian Wrap' ||
                       product.name === 'Veggie Wrap') && !selectedWrapCheese) {
                    setWrapCheeseError(true);
                    hasError = true;
                  }
                  
                  // Validate Create Your Own Kids Pasta selections (k1)
                  if (product.id === 'k1') {
                    if (!selectedKidsPastaType) {
                      setKidsPastaTypeError(true);
                      hasError = true;
                    }
                    if (!selectedKidsPastaSauce) {
                      setKidsPastaSauceError(true);
                      hasError = true;
                    }
                  }
                  
                  // Validate Kids Pasta and Meatball pasta type selection (k6)
                  if (product.id === 'k6' && !selectedKidsPastaMeatballType) {
                    setKidsPastaMeatballTypeError(true);
                    hasError = true;
                  }
                  
                  // Validate Build Your Own Pasta selections (cp-1)
                  if (product.id === 'cp-1') {
                    if (!selectedBuildPastaType) {
                      setBuildPastaTypeError(true);
                      hasError = true;
                    }
                    if (!selectedBuildPastaSauce) {
                      setBuildPastaSauceError(true);
                      hasError = true;
                    }
                  }
                  
                  // Validate Catering Pasta with Sauce pasta type selection (cp7-cp11)
                  if (product.id === 'cp7' || product.id === 'cp8' || product.id === 'cp9' || product.id === 'cp10' || product.id === 'cp11') {
                    if (!selectedPastaType) {
                      setCateringPastaTypeError(true);
                      hasError = true;
                    }
                  }
                  
                  // Validate Traditional Dinners and Fish selections (exactly 2 sides required)
                  if (product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) {
                    if (selectedTraditionalDinnersSides.length !== 2) {
                      setTraditionalDinnersSidesError(true);
                      hasError = true;
                    }
                  }
                  
                  // Validate Seafood Pasta Type selection for sf-6, sf-7, sf-8, sf-9, sf-10
                  if (['sf-6', 'sf-7', 'sf-8', 'sf-9', 'sf-10'].includes(product.id) && !selectedSeafoodPastaType) {
                    setSeafoodPastaTypeError(true);
                    hasError = true;
                  }
                  
                  // Validate Substitute Sauce selection for sf-6 (Calamari Marinara)
                  if (product.id === 'sf-6' && !selectedCalamariSubSauce) {
                    setCalamariAppetizerSauceError(true);
                    hasError = true;
                  }
                  
                  // Validate Substitute Sauce selection for sf-10 (Shrimp Marinara)
                  if (product.id === 'sf-10' && !selectedShrimpMarinaraSubSauce) {
                    setShrimpMarinaraSubSauceError(true);
                    hasError = true;
                  }
                  
                  // Validate Seafood Appetizer Sauce selection (sf-2, sf-3, sf-4, sf-5, app15, app16)
                  if (product.id === 'sf-2' && !selectedSeafoodSauceId) {
                    setCalamariSauceError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'sf-3' && !selectedMusselsSauce) {
                    setMusselsSauceAppetizerError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'sf-4' && !selectedSeafoodComboSauce) {
                    setSeafoodComboSauceAppetizerError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'sf-5' && !selectedSeafoodSauceId) {
                    setShrimpSauceError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'app14' && !selectedCalamariSubSauce) {
                    setCalamariAppetizerSauceError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'app15' && !selectedMusselsSauce) {
                    setMusselsAppetizerSauceError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'app16' && !selectedSeafoodComboSauce) {
                    setSeafoodComboAppetizerSauceError(true);
                    hasError = true;
                  }
                  
                  if (product.id === 'app17' && !selectedShrimpMarinaraSubSauce) {
                    setShrimpAppetizerSauceError(true);
                    hasError = true;
                  }
                  
                  // Validate salad base selection for create-salad and specialty salads
                  if ((product.category === 'create-salad' || product.category === 'salads') && !selectedSaladBase) {
                    setSaladBaseError(true);
                    hasError = true;
                  }
                  
                  // Validate salad dressing selection for create-salad and specialty salads
                  if ((product.category === 'create-salad' || product.category === 'salads') && !selectedSaladDressing) {
                    setSaladDressingError(true);
                    hasError = true;
                  }
                  
                  // Validate Catering Salads base and dressing selection (csalad1-7)
                  if (product.category === 'catering-salad-soups') {
                    let baseSelected = false;
                    let dressingSelected = false;
                    
                    if (product.id === 'csalad1') {
                      baseSelected = !!selectedAntipastoBase;
                      dressingSelected = selectedAntipastoDressings.length > 0;
                    } else if (product.id === 'csalad2') {
                      baseSelected = !!selectedCaesarBase;
                      dressingSelected = selectedCaesarDressings.length > 0;
                    } else if (product.id === 'csalad3') {
                      baseSelected = !!selectedChickenCaesarBase;
                      dressingSelected = selectedChickenCaesarDressings.length > 0;
                    } else if (product.id === 'csalad4') {
                      baseSelected = !!selectedGardenBase;
                      dressingSelected = selectedGardenDressings.length > 0;
                    } else if (product.id === 'csalad5') {
                      baseSelected = !!selectedRoastedRedPepperBase;
                      dressingSelected = selectedRoastedRedPepperDressings.length > 0;
                    } else if (product.id === 'csalad6') {
                      baseSelected = !!selectedThreeCheeseBase;
                      dressingSelected = selectedThreeCheeseDressings.length > 0;
                    } else if (product.id === 'csalad7') {
                      baseSelected = !!selectedTraditionalChefBase;
                      dressingSelected = selectedTraditionalChefDressings.length > 0;
                    }
                    
                    if (!baseSelected) {
                      setCateringSaladBaseError(true);
                      hasError = true;
                    }
                    if (!dressingSelected) {
                      setCateringSaladDressingError(true);
                      hasError = true;
                    }
                  }

                  // Validate Catering Seafood Pasta Types (cs1, cs2, cs4, cs5, cs6)
                  if (product.id === 'cs1' && !selectedBabyClamPastaType) {
                    setBabyClamPastaTypeError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs2' && !selectedCalamariPastaType) {
                    setCalamariPastaTypeError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs4' && !selectedMusselsPastaType) {
                    setMusselsPastaTypeError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs5' && !selectedSeafoodComboPastaType) {
                    setSeafoodComboPastaTypeError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs6' && !selectedShrimpMarinaraPastaType) {
                    setShrimpMarinaraPastaTypeError(true);
                    hasError = true;
                  }

                  // Validate Catering Seafood Sauce Choices (cs1, cs2, cs4, cs5, cs6)
                  if (product.id === 'cs1' && !selectedBabyClamSauceChoice) {
                    setBabyClamSauceError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs2' && !selectedCalamariSubstituteSauce) {
                    setCalamariSauceError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs4' && !selectedMusselsSauceChoice) {
                    setMusselsSauceError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs5' && !selectedSeafoodComboSauceChoice) {
                    setSeafoodComboSauceError(true);
                    hasError = true;
                  }
                  if (product.id === 'cs6' && !selectedShrimpMarinaraSubstituteSauce) {
                    setShrimpMarinaraSauceError(true);
                    hasError = true;
                  }

                  // Validate Required Sauce for Specialty Pizzas
                  if (['sp-10', 'sp-12', 'sp-15'].includes(product.id) && selectedSauces.length === 0) {
                     setSauceError(true);
                     setIsSauceOpen(true);
                     hasError = true;
                  }

                  // Validate Pasta e Fagioli Substitute selection
                  if (product.id === 'soup1' && !selectedPastaFagioliSubstitute) {
                    setPastaFagioliSubstituteError(true);
                    hasError = true;
                  }

                  // Validate Hoagie Platter selection (min 4 sandwiches)
                  if (product.id === 'c13') {
                    const totalSandwiches = Object.values(selectedHoagiePlatterOptions).reduce((sum, count) => sum + count, 0);
                    if (totalSandwiches < 4) {
                      setHoagiePlatterError(true);
                      setIsAdditionalOpen(true); // Open the section to show error
                      hasError = true;
                    }
                  }

                  // Validate Wrap Platter selection (min 4 items and required wrap type)
                  if (product.id === 'c14') {
                    const totalWraps = Object.values(selectedWrapPlatterOptions).reduce((sum, count) => sum + count, 0);
                    if (totalWraps < 4) {
                      setWrapPlatterError(true);
                      setIsAdditionalOpen(true);
                      hasError = true;
                    }
                    if (!selectedWrapPlatterWrapType) {
                      setWrapPlatterWrapTypeError(true);
                      setIsSpecialInstructionsOpen(true);
                      hasError = true;
                    }
                  }

                  // Validate Hot Sandwich Platter selection (min 4 sandwiches)
                  if (product.id === 'c15') {
                    const totalSandwiches = Object.values(selectedHotSandwichPlatterOptions).reduce((sum, count) => sum + count, 0);
                    if (totalSandwiches < 4) {
                      setHotSandwichPlatterError(true);
                      setIsAdditionalOpen(true);
                      hasError = true;
                    }
                  }
                  
                  // If there are errors, scroll to the first error and return
                  if (hasError) {
                    if (!toastRoll && toastOptionRef.current) {
                      toastOptionRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (!selectedCheese && cheeseOptionRef.current) {
                      cheeseOptionRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (hotHoagieCheeseRef.current) {
                      hotHoagieCheeseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (coldHoagieSideToppingsRequiredRef.current) {
                      coldHoagieSideToppingsRequiredRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (wingsSauceRef.current) {
                      wingsSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (wingsSpecialInstructionsRef.current) {
                      wingsSpecialInstructionsRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (paniniTypeRef.current) {
                      paniniTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (wrapTypeRef.current) {
                      wrapTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (wrapCheeseRef.current) {
                      wrapCheeseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (kidsPastaTypeRef.current) {
                      kidsPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (sauceErrorRef.current) {
                      sauceErrorRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (kidsPastaSauceRef.current) {
                      kidsPastaSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (kidsPastaMeatballTypeRef.current) {
                      kidsPastaMeatballTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (buildPastaTypeRef.current) {
                      buildPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (buildPastaSauceRef.current) {
                      buildPastaSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (cateringPastaTypeRef.current) {
                      cateringPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (traditionalDinnersSidesRef.current) {
                      traditionalDinnersSidesRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (seafoodPastaTypeRef.current) {
                      seafoodPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (saladBaseRef.current) {
                      saladBaseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (saladDressingRef.current) {
                      saladDressingRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (saladToppingsRef.current) {
                      saladToppingsRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (cateringSaladBaseRef.current) {
                      cateringSaladBaseRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (cateringSaladDressingRef.current) {
                      cateringSaladDressingRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (babyClamPastaTypeRef.current) {
                      babyClamPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (calamariPastaTypeRef.current) {
                      calamariPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (musselsPastaTypeRef.current) {
                      musselsPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (seafoodComboPastaTypeRef.current) {
                      seafoodComboPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (shrimpMarinaraPastaTypeRef.current) {
                      shrimpMarinaraPastaTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (babyClamSauceRef.current) {
                      babyClamSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (calamariSauceRef.current) {
                      calamariSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (musselsSauceRef.current) {
                      musselsSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (seafoodComboSauceRef.current) {
                      seafoodComboSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (shrimpMarinaraSauceRef.current) {
                      shrimpMarinaraSauceRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (hoagiePlatterRef.current) {
                      hoagiePlatterRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (wrapPlatterRef.current) {
                      wrapPlatterRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (wrapPlatterWrapTypeRef.current) {
                      wrapPlatterWrapTypeRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else if (hotSandwichPlatterRef.current) {
                      hotSandwichPlatterRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return;
                  }
                  
                  // Create a modified product with size information for Garlic Bread items
                  let modifiedProduct = { ...product };
                  
                  if (product.id === 'app1') {
                    const sizeOption = garlicBreadSizeOptions.find(opt => opt.id === selectedGarlicBreadSize);
                    modifiedProduct = {
                      ...product,
                      name: `${product.name} (${sizeOption?.name})`,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  } else if (product.id === 'app2') {
                    const sizeOption = garlicBreadMozzarellaSizeOptions.find(opt => opt.id === selectedGarlicBreadMozzarellaSize);
                    modifiedProduct = {
                      ...product,
                      name: `${product.name} (${sizeOption?.name})`,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  } else if (product.id === 'app18') {
                    const sizeOption = wingsQuantityOptions.find(opt => opt.id === selectedWingsQuantity);
                    modifiedProduct = {
                      ...product,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  } else if (product.id === 'app6' || product.id === 'wing3' || product.id === 'capp2') {
                    const sizeOption = chickenTendersQuantityOptions.find(opt => opt.id === selectedChickenTendersQuantity);
                    modifiedProduct = {
                      ...product,
                      name: `${product.name} (${sizeOption?.name})`,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  } else if (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') {
                    const sizeOption = mozzarellaSticksQuantityOptions.find(opt => opt.id === selectedMozzarellaSticksQuantity);
                    modifiedProduct = {
                      ...product,
                      name: `${product.name} (${sizeOption?.name})`,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  } else if (product.id === 'app8') {
                    const sizeOption = aranciniRegularQuantityOptions.find(opt => opt.id === selectedAranciniRegularQuantity);
                    modifiedProduct = {
                      ...product,
                      name: `${product.name} (${sizeOption?.name})`,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  } else if (product.id === 'capp4') {
                    const sizeOption = aranciniQuantityOptions.find(opt => opt.id === selectedAranciniQuantity);
                    modifiedProduct = {
                      ...product,
                      name: `${product.name} (${sizeOption?.name})`,
                      price: `$${sizeOption?.price.toFixed(2)}`
                    };
                  }
                  
                  // FIX: Ensure name includes quantity for Wings (app18 and generic)
                  if (product.id === 'app18') {
                       const sizeOption = wingsQuantityOptions.find(opt => opt.id === selectedWingsQuantity);
                       if (sizeOption) modifiedProduct.name = `${product.name} (${sizeOption.name})`;
                  } else if (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') {
                       modifiedProduct.name = `${product.name} (${selectedSize} pcs)`;
                  }

                  // Build customizations array
                  const customizations: CartItemCustomization[] = [];
                  
                  // Build selections array (NEW STRUCTURED MODEL)
                  const selections: CartSelection[] = [];
                  
                  // ============================================================
                  // BUILD CANONICAL LOOKUP FROM OPTION CONFIGURATION (DESKTOP)
                  // This ensures labels & groupTitles match EXACTLY what UI shows
                  // ============================================================
                  const selectionLookupDesktop: SelectionLookup = { byOptionId: {} };

                  // Register Toast Options (for Cheesesteaks, Burgers, Brioche)
                  const toastOptions = [
                    { id: 'toast', name: (product.category === 'burgers' || product.category === 'brioche') ? 'Toast Bun' : 'Toast Roll' },
                    { id: 'no-toast', name: (product.category === 'burgers' || product.category === 'brioche') ? "Don't Toast Bun" : "Don't Toast Roll" }
                  ];
                  registerOptionsToLookup(selectionLookupDesktop, toastOptions, {
                    groupId: 'toast_option',
                    groupTitle: 'Toast Option (Required)',
                    type: 'required_option'
                  });
                  
                  // Register Size Options
                  const allSizeOptions = [
                    { id: 'medium', name: 'Medium (14")' },
                    { id: 'large', name: 'Large (16")' },
                    { id: 'jumbo', name: 'Jumbo (18")' },
                    { id: '10', name: '10 pcs' },
                    { id: '20', name: '20 pcs' },
                    { id: '30', name: '30 pcs' },
                    { id: '40', name: '40 pcs' },
                    { id: '50', name: '50 pcs' },
                  ];
                  registerOptionsToLookup(selectionLookupDesktop, allSizeOptions, {
                    groupId: 'size_options',
                    groupTitle: 'Size',
                    type: 'size'
                  });

                  // Register Wings Quantity Options (app18)
                  registerOptionsToLookup(selectionLookupDesktop, wingsQuantityOptions, {
                    groupId: 'wings_quantity',
                    groupTitle: 'Quantity',
                    type: 'required_option'
                  });

                  // Register Chicken Tenders Quantity Options (app6)
                  registerOptionsToLookup(selectionLookupDesktop, chickenTendersQuantityOptions, {
                    groupId: 'chicken_tenders_quantity',
                    groupTitle: 'Quantity',
                    type: 'required_option'
                  });

                  // Register Wings Sauce Options (app18, app6)
                  registerOptionsToLookup(selectionLookupDesktop, wingsSauceOptions, {
                    groupId: 'wings_sauce',
                    groupTitle: 'Sauce',
                    type: 'sauce'
                  });

                  // Register Wings Special Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, wingsSpecialInstructionsOptions, {
                    groupId: 'wings_special_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Chicken Tenders Special Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, chickenTendersSpecialInstructionsOptions, {
                    groupId: 'chicken_tenders_special_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Onion Rings Special Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, onionRingsInstructionsOptions, {
                    groupId: 'onion_rings_instructions',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });

                  // Register Mac & Cheese Bites Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, macAndCheeseBitesInstructionsOptions, {
                    groupId: 'mac_cheese_bites_instructions',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });

                  // Register Broccoli & Cheddar Bites Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, broccoliCheddarBitesInstructionsOptions, {
                    groupId: 'broccoli_cheddar_bites_instructions',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });

                  // Register French Fries Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, friesInstructionsOptions, {
                    groupId: 'fries_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Passariello Fries Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, passarielloFriesInstructionsOptions, {
                    groupId: 'passariello_fries_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Cheddar Steak Fries Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, cheddarSteakFriesInstructionsOptions, {
                    groupId: 'cheddar_steak_fries_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Garlic Stick Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, garlicStickInstructionsOptions, {
                    groupId: 'garlic_stick_instructions',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });

                  // Register Garlic Bread Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, garlicBreadInstructionsOptions, {
                    groupId: 'garlic_bread_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Garlic Bread Mozzarella Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, garlicBreadMozzarellaInstructionsOptions, {
                    groupId: 'garlic_bread_mozzarella_instructions',
                    groupTitle: 'Special Instructions',
                    type: 'special_instruction'
                  });

                  // Register Mozzarella Sticks Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, mozzarellaSticksInstructionsOptions, {
                    groupId: 'mozzarella_sticks_instructions',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });

                  // Register Mozzarella Sticks Special Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, mozzarellaSticksSpecialInstructionsOptions, {
                    groupId: 'mozzarella_sticks_special_instructions',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });

                  // Register Mozzarella Sticks Quantity Options
                  registerOptionsToLookup(selectionLookupDesktop, mozzarellaSticksQuantityOptions, {
                    groupId: 'mozzarella_sticks_quantity',
                    groupTitle: 'Quantity',
                    type: 'required_option'
                  });

                  // Register Arancini Quantity Options
                  registerOptionsToLookup(selectionLookupDesktop, aranciniQuantityOptions, {
                    groupId: 'arancini_quantity',
                    groupTitle: 'Quantity',
                    type: 'required_option'
                  });

                  // Register Arancini Special Instructions Options
                  registerOptionsToLookup(selectionLookupDesktop, aranciniSpecialInstructionsOptions, {
                    groupId: 'arancini_special_instructions',
                    groupTitle: 'Extra Sauce',
                    type: 'special_instruction'
                  });

                  // Register Arancini Regular Quantity Options
                  registerOptionsToLookup(selectionLookupDesktop, aranciniRegularQuantityOptions, {
                    groupId: 'arancini_regular_quantity',
                    groupTitle: 'Quantity',
                    type: 'required_option'
                  });

                  // Register Garlic Bread Size Options
                  registerOptionsToLookup(selectionLookupDesktop, garlicBreadSizeOptions, {
                    groupId: 'garlic_bread_size',
                    groupTitle: 'Size',
                    type: 'size'
                  });

                  // Register Garlic Bread with Mozzarella Size Options
                  registerOptionsToLookup(selectionLookupDesktop, garlicBreadMozzarellaSizeOptions, {
                    groupId: 'garlic_bread_mozzarella_size',
                    groupTitle: 'Size',
                    type: 'size'
                  });

                  // Register Pizza Sauce Options
                  const allSauceOptions = [
                    { id: 'sauce-pizza', name: 'Red Sauce' }
                  ];
                  registerOptionsToLookup(selectionLookupDesktop, allSauceOptions, {
                    groupId: 'pizza_sauce',
                    groupTitle: 'Sauce',
                    type: 'sauce'
                  });

                  // Register Buffalo Chicken Stromboli Dipping Options
                  const buffaloChickenStromboliDipperOptionsDesktop = [
                     { id: 'bc', name: 'Bleu Cheese', price: 0, image: 'https://images.unsplash.com/photo-1754652327423-4e71f0d71b25?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxibGV1JTIwY2hlZXNlJTIwZGlwJTIwc2F1Y2V8ZW58MXx8fHwxNzY5ODkxMzk1fDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
                     { id: 'br', name: 'Buttermilk Ranch', price: 0, image: 'https://images.unsplash.com/photo-1662142959468-acc8e6b6e629?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxidXR0ZXJtaWxrJTIwcmFuY2glMjBkaXAlMjBzYXVjZXxlbnwxfHx8fDE3Njk4OTEzOTh8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral' },
                     { id: 'none', name: 'None', price: 0, image: null }
                  ];
                  registerOptionsToLookup(selectionLookupDesktop, buffaloChickenStromboliDipperOptionsDesktop, {
                     groupId: 'buffalo_chicken_stromboli_dipping',
                     groupTitle: 'Choose Dipping',
                     type: 'sauce'
                  });
                  
                  // Register Standard Stromboli Extra Sauce Options
                  registerOptionsToLookup(selectionLookupDesktop, extraSauceOptions, {
                     groupId: 'stromboli_extra_sauce',
                     groupTitle: 'Extra Sauce (Optional)',
                     type: 'sauce'
                  });
                  
                  // Register ALL option arrays with their banner/group titles
                  registerOptionsToLookup(selectionLookupDesktop, traditionalDinnersSides, {
                    groupId: 'traditional_dinner_sides',
                    groupTitle: '1. Add Sides (Required - Choose 2)',
                    type: 'side'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, traditionalDinnersSoupsSalads, {
                    groupId: 'traditional_dinner_soups_salads',
                    groupTitle: 'Side Soups, Salads, & Extra Bread (Optional)',
                    type: 'side'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, includedToppings, {
                    groupId: 'included_toppings',
                    groupTitle: 'Included Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, additionalToppings, {
                    groupId: 'additional_toppings',
                    groupTitle: 'Additional Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, specialtyToppings, {
                    groupId: 'specialty_toppings',
                    groupTitle: 'Specialty Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, noToppings, {
                    groupId: 'no_toppings',
                    groupTitle: 'No Toppings',
                    type: 'no_topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, hotHoagieExtraToppings, {
                    groupId: 'hot_hoagie_extras',
                    groupTitle: 'Extras',
                    type: 'extra_topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, coldHoagieAddToppings, {
                    groupId: 'cold_hoagie_add',
                    groupTitle: 'Add Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, burgerAddToppings, {
                    groupId: 'burger_add',
                    groupTitle: 'Add Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, burgerExtraToppings, {
                    groupId: 'burger_extra',
                    groupTitle: 'Extra Toppings',
                    type: 'extra_topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, burgerSideToppings, {
                    groupId: 'burger_side',
                    groupTitle: 'Side Toppings',
                    type: 'side'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapAddToppings, {
                    groupId: 'wrap_add',
                    groupTitle: 'Add Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapSubstituteCheese, {
                    groupId: 'wrap_cheese',
                    groupTitle: 'Substitute Cheese',
                    type: 'cheese'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapExtraCheese, {
                    groupId: 'wrap_extra_cheese',
                    groupTitle: 'Extra Cheese',
                    type: 'extra_topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapLiteToppings, {
                    groupId: 'wrap_lite',
                    groupTitle: 'Lite Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapNoToppings, {
                    groupId: 'wrap_no',
                    groupTitle: 'No Toppings',
                    type: 'no_topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapSideToppings, {
                    groupId: 'wrap_side',
                    groupTitle: 'Side Toppings',
                    type: 'side'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, paniniLiteToppings, {
                    groupId: 'panini_lite',
                    groupTitle: 'Lite Toppings',
                    type: 'topping'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, bakedPastaSides, {
                    groupId: 'baked_pasta_sides',
                    groupTitle: 'Sides',
                    type: 'side'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, bakedPastaSpecialInstructions, {
                    groupId: 'baked_pasta_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, fishSpecialInstructions, {
                    groupId: 'fish_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, cateringEntreeSpecialInstructions, {
                    groupId: 'catering_entree_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, pastaFagioliSpecialInstructions, {
                    groupId: 'pasta_fagioli_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  
                  // SALAD BOWLS  SPECIAL INSTRUCTIONS
                  registerOptionsToLookup(selectionLookupDesktop, antipastoSaladSpecialInstructions, {
                    groupId: 'antipasto_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, caesarSaladSpecialInstructions, {
                    groupId: 'caesar_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, gardenSaladSpecialInstructions, {
                    groupId: 'garden_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, threeCheeseSaladSpecialInstructions, {
                    groupId: 'three_cheese_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, traditionalChefSaladSpecialInstructions, {
                    groupId: 'traditional_chef_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, calamariSaladSpecialInstructions, {
                    groupId: 'calamari_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, capreseSaladSpecialInstructions, {
                    groupId: 'caprese_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, farfallePastaSaladSpecialInstructions, {
                    groupId: 'farfalle_pasta_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, italianChoppedSpecialInstructions, {
                    groupId: 'italian_chopped_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, roastedRedPeppersSaladSpecialInstructions, {
                    groupId: 'roasted_red_peppers_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, tunaSaladSpecialInstructions, {
                    groupId: 'tuna_salad_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  
                  // KIDS PASTA  SPECIAL INSTRUCTIONS
                  registerOptionsToLookup(selectionLookupDesktop, kidsPastaSpecialInstructions, {
                    groupId: 'kids_pasta_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, kidsPastaMeatballSpecialInstructions, {
                    groupId: 'kids_pasta_meatball_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  
                  // BROOKLYN PIZZA  SPECIAL INSTRUCTIONS
                  registerOptionsToLookup(selectionLookupDesktop, specialInstructionsBrooklyn, {
                    groupId: 'brooklyn_pizza_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  
                  // HOT HOAGIES  SPECIAL INSTRUCTIONS
                  registerOptionsToLookup(selectionLookupDesktop, hotHoagieSpecialInstructions, {
                    groupId: 'hot_hoagie_special_instructions',
                    groupTitle: 'Special Instructions (Optional)',
                    type: 'special_instruction'
                  });
                  
                  registerOptionsToLookup(selectionLookupDesktop, saladBaseOptions, {
                    groupId: 'salad_base',
                    groupTitle: 'Salad Base',
                    type: 'salad_base'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, saladDressingOptions, {
                    groupId: 'salad_dressing',
                    groupTitle: 'Dressing',
                    type: 'dressing'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, saladDressingInstructions, {
                    groupId: 'salad_dressing_instructions',
                    groupTitle: 'Dressing Instructions',
                    type: 'special_instruction'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, kidsPastaTypes, {
                    groupId: 'kids_pasta_type',
                    groupTitle: 'Pasta Type',
                    type: 'pasta_type'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, kidsPastaSauces, {
                    groupId: 'kids_pasta_sauce',
                    groupTitle: 'Sauce',
                    type: 'sauce'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, pastaTypes, {
                    groupId: 'pasta_type',
                    groupTitle: 'Pasta Type',
                    type: 'pasta_type'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, cheeseOptions, {
                    groupId: 'cheese',
                    groupTitle: 'Cheese',
                    type: 'cheese'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, wrapTypeOptions, {
                    groupId: 'wrap_type',
                    groupTitle: 'Wrap Type',
                    type: 'wrap_type'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, beverageItems, {
                    groupId: 'beverages',
                    groupTitle: 'Beverages',
                    type: 'beverage'
                  });
                  registerOptionsToLookup(selectionLookupDesktop, dessertItems, {
                    groupId: 'desserts',
                    groupTitle: 'Desserts',
                    type: 'dessert'
                  });

                  // Register Panini Type
                  registerOptionsToLookup(selectionLookupDesktop, paniniChooseType, {
                    groupId: 'panini_type',
                    groupTitle: 'Choose Panini (Required)',
                    type: 'required_option'
                  });
                  
                  // Register customizationOptions from the current product (e.g., Minucci No Toppings) (DESKTOP)
                  if (product.customizationOptions) {
                    product.customizationOptions.forEach((customOption) => {
                      if (customOption.options && customOption.options.length > 0) {
                        registerOptionsToLookup(selectionLookupDesktop, customOption.options, {
                          groupId: customOption.id,
                          groupTitle: customOption.title,
                          type: 'no_topping'
                        });
                      }
                    });
                  }
                  
                  // Register ALL missing arrays to reach ZERO warnings (DESKTOP)
                  registerMissingArrays(selectionLookupDesktop, {
                    specialtyToppingsSecondHalf, extraToppings, liteToppings, specialInstructionsBrooklyn,
                    specialInstructionsOptions, pizzaDippingsOptions, cheesesteakToppings,
                    createYourOwnCheesesteakToppings, cheesesteakNoToppings, cheesesteakSideToppingsRequired,
                    burgerLiteToppings, burgerSubstituteCheese, briocheNoToppings,
                    briocheGrilledChickenNoToppings, briocheMozzarellaGrilledChickenNoToppings,
                    briocheSideToppings, briocheAddCheese, briocheExtraCheese, hotHoagieSides,
                    hotHoagieSpecialInstructions, hotHoagieExtraSides, hotHoagieSubstituteCheese,
                    grilledChickenHoagieNoToppings, sausagePeppersOnionsNoToppings,
                    cheeseBurgerDeluxeNoToppings, coldHoagieExtraToppings, coldHoagieLiteToppings,
                    coldHoagieNoToppings, coldHoagieSideToppings, coldHoagieAddCheese,
                    coldHoagieSideToppingsRequired, coldHoagieSideOfChips, paniniNoToppings,
                    paniniSideToppings, paniniExtraCheese, paniniSubstituteCheese,
                    wrapLiteToppings, wrapNoToppings, wrapSideToppings, wrapSubstituteCheese, wrapExtraCheese,
                    cheesesteakWrapLiteToppings, cheesesteakWrapNoToppings, grilledChickenWrapLiteToppings,
                    grilledChickenWrapNoToppings, italianWrapLiteToppings, italianWrapNoToppings,
                    pastaVegetables, pastaProteins, pastaCheesesExtras, pastaAdditions,
                    buildPastaSauces, buildPastaToppings, buildPastaSoups, seafoodPastaTypes,
                    babyClamPastaTypes, babyClamSauceChoices, calamariPastaTypes,
                    calamariSubstituteSauce, musselsPastaTypes, musselsSauceChoices,
                    seafoodComboPastaTypes, seafoodComboSauceChoices, shrimpMarinaraPastaTypes,
                    shrimpMarinaraSubstituteSauce, saladToppingsOptions, antipastoSaladBases,
                    antipastoSaladDressings, antipastoSaladSpecialInstructions,
                    caesarSaladSpecialInstructions, calamariSaladSpecialInstructions,
                    capreseSaladSpecialInstructions, farfallePastaSaladSpecialInstructions,
                    gardenSaladSpecialInstructions, italianChoppedSpecialInstructions,
                    roastedRedPeppersSaladSpecialInstructions, traditionalChefSaladSpecialInstructions,
                    tunaSaladSpecialInstructions, threeCheeseSaladSpecialInstructions,
                    kidsPastaToppings, kidsPastaSpecialInstructions, kidsBakedExtraToppings,
                    kidsBakedLiteToppings, kidsBakedNoToppings, kidsPastaMeatballToppings,
                    kidsPastaMeatballSpecialInstructions, mashedPotatoesToppings,
                    meatballsSausageSauceToppings, pastaFagioliSubstituteCracker,
                    pastaFagioliSubstituteOptions, wingsSpecialInstructionsOptions,
                    wingsExtraSauceOptions, wingsExtraCheeseRanchOptions,
                    chickenTendersExtraSauceOptions, mozzarellaSticksExtraSauceOptions,
                    mozzarellaSticksSpecialInstructionsOptions, aranciniSpecialInstructionsOptions,
                    hoagiePlatterOptions, hoagiePlatterCutOptions, hoagiePlatterSideToppings,
                    wrapPlatterOptions, wrapPlatterWrapTypes, wrapPlatterSideToppings,
                    hotSandwichPlatterOptions, hotSandwichPlatterCutOptions,
                    hotSandwichPlatterSideToppings, cannoliSpecialInstruction,
                    dessertTraySpecialInstruction,
                    calamariSubSauceOptions, musselsSauceOptions,
                    seafoodComboSauceOptions, marinaraAppetizerSauceOptions
                  });
                  
                  // Master helper function - now uses canonical lookup ONLY (DESKTOP)
                  const getItemName = (id: string): string => {
                    if (!id) return '';
                    
                    // Special case for pizza sizes (fixes console warnings)
                    if (id === 'medium') return 'Medium (14")';
                    if (id === 'large') return 'Large (16")';
                    if (id === 'jumbo') return 'Jumbo (18")';

                    // First, check the canonical lookup
                    const meta = selectionLookupDesktop.byOptionId[id];
                    if (meta) return meta.label;
                    
                    // Fallback: check allProducts for products that might not be in lookup
                    if (allProducts) {
                      const product = allProducts.find(p => p.id === id);
                      if (product) return product.name;
                    }
                    
                    // Last fallback: humanized ID so we never lose user selections in cart reporting.
                    const humanized = id
                      .replace(/[_-]+/g, ' ')
                      .replace(/\b\w/g, (c) => c.toUpperCase())
                      .trim();
                    console.warn('[Selections] Missing label in lookup for ID (DESKTOP):', {
                      id,
                      fallbackLabel: humanized,
                      productId: product.id,
                      productName: product.name
                    });
                    return humanized;
                  };
                  
                  // Helper to get group info for a selection ID (DESKTOP)
                  const getToppingGroupInfo = (
                    id: string
                  ): { groupId?: string; groupTitle?: string; type?: SelectionType } | undefined => {
                    if (!id) return undefined;
                    const meta = selectionLookupDesktop.byOptionId[id];
                    if (!meta) return undefined;
                    return {
                      groupId: meta.groupId,
                      groupTitle: meta.groupTitle,
                      type: meta.type,
                    };
                  };
                  
                  // Helper function to get beverage category based on ID
                  const getBeverageCategory = (id: string): BeverageCategory => {
                    if (id.startsWith('b1')) return '20oz';
                    if (id.startsWith('b2')) return '2_liter';
                    if (id.includes('water')) return 'water';
                    if (id.includes('juice')) return 'juice';
                    return 'other';
                  };
                  
                  // Add Toast Roll (for Cheesesteaks, Hot Hoagies, Burgers, and Brioche)
                  if ((product.category === 'cheesesteaks' || product.category === 'hot-hoagies' || product.category === 'burgers' || product.category === 'brioche') && toastRoll) {
                    const isBun = product.category === 'burgers' || product.category === 'brioche';
                    const toastName = toastRoll === 'toast' 
                      ? (isBun ? 'Toast Bun' : 'Toast Roll') 
                      : (isBun ? "Don't Toast Bun" : "Don't Toast Roll");
                      
                    // LEGACY
                    customizations.push({
                      category: 'Toast Option',
                      items: [toastName]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: toastRoll,
                      label: toastName,
                      type: 'required_option',
                      groupId: 'toast_option',
                      groupTitle: 'Toast Option (Required)'
                    });
                  }
                  
                  // Add Cheese (for Cheesesteaks)
                  if (product.category === 'cheesesteaks' && selectedCheese) {
                     const cheeseName = getItemName(selectedCheese);
                     if (cheeseName) {
                        // LEGACY
                        customizations.push({
                          category: 'Cheese',
                          items: [cheeseName]
                        });
                        // NEW STRUCTURED
                        selections.push({
                          id: selectedCheese,
                          label: cheeseName,
                          type: 'required_option',
                          groupId: 'cheese',
                          groupTitle: 'Cheese'
                        });
                     }
                  }

                  // Add Size (pizzas + soups)
                  if ((product.category === 'pizzas' || product.category === 'soups') && selectedSize) {
                    const sizeNames: Record<string, string> = product.category === 'soups'
                      ? { 'medium': '16Oz', 'large': '32Oz' }
                      : { 'medium': 'Medium (14")', 'large': 'Large (16")', 'jumbo': 'Jumbo (18")' };
                    if (sizeNames[selectedSize]) {
                      customizations.push({
                        category: 'Size',
                        items: [sizeNames[selectedSize]]
                      });
                      selections.push({
                        id: selectedSize,
                        label: sizeNames[selectedSize],
                        type: 'size',
                        groupId: 'size_options',
                        groupTitle: 'Size'
                      });
                    }
                  }
                  
                  // Add Pasta Type (for catering pasta dishes - multiple variables)
                  if (selectedPastaType) {
                    const pastaTypeName = getItemName(selectedPastaType);
                    customizations.push({
                      category: 'Pasta Type',
                      items: [pastaTypeName]
                    });
                  }
                  if (selectedBabyClamPastaType) {
                    const pastaTypeName = getItemName(selectedBabyClamPastaType);
                    customizations.push({
                      category: 'Pasta Type',
                      items: [pastaTypeName]
                    });
                  }
                  if (selectedCalamariPastaType) {
                    const pastaTypeName = getItemName(selectedCalamariPastaType);
                    customizations.push({
                      category: 'Pasta Type',
                      items: [pastaTypeName]
                    });
                  }
                  if (selectedMusselsPastaType) {
                    const pastaTypeName = getItemName(selectedMusselsPastaType);
                    customizations.push({
                      category: 'Pasta Type',
                      items: [pastaTypeName]
                    });
                  }
                  if (selectedSeafoodComboPastaType) {
                    const pastaTypeName = getItemName(selectedSeafoodComboPastaType);
                    customizations.push({
                      category: 'Pasta Type',
                      items: [pastaTypeName]
                    });
                  }
                  if (selectedShrimpMarinaraPastaType) {
                    const pastaTypeName = getItemName(selectedShrimpMarinaraPastaType);
                    customizations.push({
                      category: 'Pasta Type',
                      items: [pastaTypeName]
                    });
                  }
                  
                  // Add Sauce Choice (for seafood dishes - multiple variables)
                  if (selectedBabyClamSauceChoice) {
                    const sauceName = getItemName(selectedBabyClamSauceChoice);
                    customizations.push({
                      category: 'Sauce',
                      items: [sauceName]
                    });
                  }
                  if (selectedMusselsSauceChoice) {
                    const sauceName = getItemName(selectedMusselsSauceChoice);
                    customizations.push({
                      category: 'Sauce',
                      items: [sauceName]
                    });
                  }
                  if (selectedSeafoodComboSauceChoice) {
                    const sauceName = getItemName(selectedSeafoodComboSauceChoice);
                    customizations.push({
                      category: 'Sauce',
                      items: [sauceName]
                    });
                  }
                  
                  // Add Wings Sauce Selection (REQUIRED)
                  if (selectedWingsSauce) {
                    const sauceName = getItemName(selectedWingsSauce);
                    customizations.push({
                      category: 'Sauce',
                      items: [sauceName]
                    });
                  }
                  
                  // Add Wings Special Instructions (OPTIONAL)
                  if (selectedWingsSpecialInstructions.length > 0) {
                    const instructionNames = selectedWingsSpecialInstructions.map(id => getItemName(id));
                    customizations.push({
                      category: 'Special Instructions',
                      items: instructionNames
                    });
                  }
                  
                  // Add Cheese Selection (for cheesesteaks)
                  if (product.category === 'cheesesteaks' && selectedCheese) {
                    const cheeseName = getItemName(selectedCheese);
                    customizations.push({
                      category: 'Cheese',
                      items: [cheeseName]
                    });
                  }
                  
                  // Add Burger Cheese Selection (REQUIRED for most burgers)
                  if (product.category === 'burgers' && selectedBurgerCheese && selectedBurgerCheese.length > 0) {
                    const cheeseNames = selectedBurgerCheese.map(id => getItemName(id));
                    customizations.push({
                      category: 'Cheese',
                      items: cheeseNames
                    });
                    // NEW STRUCTURED
                    selectedBurgerCheese.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({
                          id,
                          label: name,
                          type: 'cheese',
                          groupId: 'burger_cheese',
                          groupTitle: 'Cheese'
                        });
                      }
                    });
                  }

                  // Add Hot Hoagie Cheese Selection
                  if (product.category === 'hot-hoagies' && selectedHotHoagieCheese) {
                    const cheeseName = getItemName(selectedHotHoagieCheese);
                    customizations.push({
                      category: 'Cheese',
                      items: [cheeseName]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: selectedHotHoagieCheese,
                      label: cheeseName,
                      type: 'cheese',
                      groupId: 'hot_hoagie_cheese',
                      groupTitle: 'Cheese'
                    });
                  }

                  // Add Brioche Cheese Selection
                  if (selectedBriocheAddCheese) {
                    const cheeseName = getItemName(selectedBriocheAddCheese);
                    customizations.push({
                      category: 'Cheese',
                      items: [cheeseName]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: selectedBriocheAddCheese,
                      label: cheeseName,
                      type: 'cheese',
                      groupId: 'brioche_cheese',
                      groupTitle: 'Cheese'
                    });
                  }

                  // Add Panini Cheese Selection
                  if (selectedPaniniCheese) {
                    const cheeseName = getItemName(selectedPaniniCheese);
                    customizations.push({
                      category: 'Substitute Cheese',
                      items: [cheeseName]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: selectedPaniniCheese,
                      label: cheeseName,
                      type: 'cheese',
                      groupId: 'panini_cheese',
                      groupTitle: 'Substitute Cheese'
                    });
                  }

                  // Add Wrap Cheese Selection
                  if (selectedWrapCheese) {
                    const cheeseName = getItemName(selectedWrapCheese);
                    customizations.push({
                      category: 'Cheese',
                      items: [cheeseName]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: selectedWrapCheese,
                      label: cheeseName,
                      type: 'cheese',
                      groupId: 'wrap_cheese',
                      groupTitle: 'Cheese'
                    });
                  }

                  // Add Panini Type (REQUIRED)
                  if (selectedPaniniType) {
                    const paniniTypeName = getItemName(selectedPaniniType);
                    // LEGACY
                    customizations.push({
                      category: 'Panini Type',
                      items: [paniniTypeName]
                    });
                    // NEW STRUCTURED
                    selections.push({
                      id: selectedPaniniType,
                      label: paniniTypeName,
                      type: 'required_option',
                      groupId: 'panini_type',
                      groupTitle: 'Choose Panini (Required)'
                    });
                  }
                  
                  // Add selected toppings with distribution
                  if (selectedToppings.length > 0) {
                    const wholeToppings: string[] = [];
                    const leftToppings: string[] = [];
                    const rightToppings: string[] = [];
                    
                    selectedToppings.forEach(toppingId => {
                      const distribution = toppingDistribution[toppingId] || 'whole';
                      const name = getItemName(toppingId);
                      
                      if (distribution === 'whole') {
                        wholeToppings.push(name);
                      } else if (distribution === 'left') {
                        leftToppings.push(`${name} (Left)`);
                      } else if (distribution === 'right') {
                        rightToppings.push(`${name} (Right)`);
                      }
                      
                      // NEW STRUCTURED - Add each topping with group info to selections
                      const groupInfo = getToppingGroupInfo(toppingId);
                      selections.push({
                        id: toppingId,
                        label: name,
                        type: 'topping',
                        groupId: groupInfo.groupId,
                        groupTitle: groupInfo.groupTitle,
                        distribution: distribution
                      });
                    });
                    
                    // LEGACY - Keep for backward compatibility
                    if (wholeToppings.length > 0) {
                      customizations.push({
                        category: 'Toppings',
                        items: wholeToppings
                      });
                    }
                    if (leftToppings.length > 0 || rightToppings.length > 0) {
                      const halfItems = [...leftToppings, ...rightToppings];
                      customizations.push({
                        category: 'Half Toppings',
                        items: halfItems
                      });
                    }
                  }
                  
                  // Add special instructions
                  if (selectedSpecialInstructions.length > 0) {
                    const names = selectedSpecialInstructions.map(id => getItemName(id));
                    // LEGACY
                    customizations.push({
                      category: 'Special Instructions',
                      items: names
                    });
                    
                    // NEW STRUCTURED
                    selectedSpecialInstructions.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({
                          id,
                          label: name,
                          type: 'special_instruction'
                        });
                      }
                    });
                  }
                  
                  // Add "Add" toppings
                  if (selectedAddToppings.length > 0) {
                    const names = selectedAddToppings.map(id => getItemName(id));
                    customizations.push({
                      category: 'Add Toppings',
                      items: names
                    });
                    // NEW STRUCTURED - Add to selections with group info
                    selectedAddToppings.forEach(toppingId => {
                      const name = getItemName(toppingId);
                      if (name) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: name,
                          type: 'topping',
                          groupId: groupInfo.groupId,
                          groupTitle: groupInfo.groupTitle
                        });
                      }
                    });
                  }
                  
                  // Add "Lite" toppings
                  if (selectedLiteToppings.length > 0) {
                    const names = selectedLiteToppings.map(id => getItemName(id));
                    customizations.push({
                      category: 'Lite Toppings',
                      items: names
                    });
                    // NEW STRUCTURED - Add to selections with group info
                    selectedLiteToppings.forEach(toppingId => {
                      const name = getItemName(toppingId);
                      if (name) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: name,
                          type: 'topping',
                          groupId: groupInfo.groupId,
                          groupTitle: groupInfo.groupTitle
                        });
                      }
                    });
                  }
                  
                  // Add "No" toppings
                  if (selectedNoToppings.length > 0) {
                    const names = selectedNoToppings.map(id => getItemName(id));
                    customizations.push({
                      category: 'No Toppings',
                      items: names
                    });
                    // NEW STRUCTURED - Add to selections with group info
                    selectedNoToppings.forEach(toppingId => {
                      const name = getItemName(toppingId);
                      if (name) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: name,
                          type: 'topping',
                          groupId: groupInfo.groupId,
                          groupTitle: groupInfo.groupTitle
                        });
                      }
                    });
                  }
                  
                  if (selectedNoToppingsCheesesteak.length > 0) {
                    const names = selectedNoToppingsCheesesteak.map(id => getItemName(id));
                    customizations.push({
                      category: 'No Toppings',
                      items: names
                    });
                    // NEW STRUCTURED - Add to selections with group info
                    selectedNoToppingsCheesesteak.forEach(toppingId => {
                      const name = getItemName(toppingId);
                      if (name) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: name,
                          type: 'topping',
                          groupId: groupInfo.groupId,
                          groupTitle: groupInfo.groupTitle
                        });
                      }
                    });
                  }
                  
                  // Add extra sides/sauces
                  if (selectedExtraSauce.length > 0) {
                    const names = selectedExtraSauce.map(id => getItemName(id));
                    customizations.push({
                      category: 'Extra Sauce',
                      items: names
                    });
                    // NEW STRUCTURED - Add to selections with group info
                    selectedExtraSauce.forEach(toppingId => {
                      const name = getItemName(toppingId);
                      if (name) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: name,
                          type: 'topping',
                          groupId: groupInfo.groupId,
                          groupTitle: groupInfo.groupTitle
                        });
                      }
                    });
                  }
                  
                  // Add side toppings
                  if (selectedSideToppings.length > 0) {
                    const names = selectedSideToppings.map(id => {
                      if (product.category === 'cheesesteaks') {
                        return sideToppingItems.find((t: any) => t.id === id)?.name || getItemName(id);
                      }
                      return getItemName(id);
                    });
                    customizations.push({
                      category: 'Side Toppings',
                      items: names
                    });
                    // NEW STRUCTURED - Add to selections with group info
                    selectedSideToppings.forEach(toppingId => {
                      const name = product.category === 'cheesesteaks'
                        ? (sideToppingItems.find((t: any) => t.id === toppingId)?.name || getItemName(toppingId))
                        : getItemName(toppingId);
                      if (name) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: name,
                          type: 'topping',
                          groupId: groupInfo.groupId,
                          groupTitle: groupInfo.groupTitle
                        });
                      }
                    });
                  }
                  
                  // Add salad customizations
                  if (selectedSaladBase) {
                    const baseName = saladBaseOptions.find(b => b.id === selectedSaladBase)?.name;
                    if (baseName) {
                      customizations.push({
                        category: 'Salad Base',
                        items: [baseName]
                      });
                      selections.push({
                        id: selectedSaladBase,
                        label: baseName,
                        type: 'required_option',
                        groupId: 'salad_base_required',
                        groupTitle: 'Choose Your Base (Required)',
                        productId: product.id
                      });
                    }
                  }
                  
                  if (selectedSaladDressing) {
                    const dressingName = saladDressingOptions.find(d => d.id === selectedSaladDressing)?.name;
                    if (dressingName) {
                      customizations.push({
                        category: 'Dressing',
                        items: [dressingName]
                      });
                      selections.push({
                        id: selectedSaladDressing,
                        label: dressingName,
                        type: 'required_option',
                        groupId: 'salad_dressing_required',
                        groupTitle: 'Choose Your Dressing (Required)',
                        productId: product.id
                      });
                    }
                  }
                  
                  // Add salad toppings (Choose Your Toppings)
                  if (selectedSaladToppings.length > 0) {
                    const toppingNames = selectedSaladToppings.map(id => {
                      const topping = saladToppingsOptions.find(t => t.id === id);
                      return topping?.name;
                    }).filter((name): name is string => name !== undefined);
                    
                    if (toppingNames.length > 0) {
                      customizations.push({
                        category: 'Salad Toppings',
                        items: toppingNames
                      });
                    }
                    
                    // NEW STRUCTURED - Add to selections with group info
                    selectedSaladToppings.forEach(toppingId => {
                      const topping = saladToppingsOptions.find(t => t.id === toppingId);
                      if (topping) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: topping.name,
                          type: 'topping',
                          groupId: groupInfo?.groupId || 'salad_toppings',
                          groupTitle: groupInfo?.groupTitle || 'Choose Your Toppings'
                        });
                      }
                    });
                  }
                  
                  // Add salad extra toppings
                  if (selectedExtraToppings.length > 0) {
                    const extraToppingNames = selectedExtraToppings.map(id => {
                      const topping = saladExtraToppingsOptions.find(t => t.id === id);
                      return topping?.name;
                    }).filter((name): name is string => name !== undefined);
                    
                    if (extraToppingNames.length > 0) {
                      customizations.push({
                        category: 'Extra Toppings',
                        items: extraToppingNames
                      });
                    }
                    
                    // NEW STRUCTURED - Add to selections with group info
                    selectedExtraToppings.forEach(toppingId => {
                      const topping = saladExtraToppingsOptions.find(t => t.id === toppingId);
                      if (topping) {
                        const groupInfo = getToppingGroupInfo(toppingId);
                        selections.push({
                          id: toppingId,
                          label: topping.name,
                          type: 'topping',
                          groupId: groupInfo?.groupId || 'salad_extra_toppings',
                          groupTitle: groupInfo?.groupTitle || 'Extra Toppings'
                        });
                      }
                    });
                  }
                  
                  // Add salad extra dressing
                  if (selectedExtraDressing.length > 0) {
                    const extraDressingNames = selectedExtraDressing.map(id => {
                      const dressing = saladExtraDressingOptions.find(d => d.id === id);
                      return dressing?.name;
                    }).filter((name): name is string => name !== undefined);
                    
                    if (extraDressingNames.length > 0) {
                      customizations.push({
                        category: 'Extra Dressing',
                        items: extraDressingNames
                      });
                    }
                    
                    // NEW STRUCTURED - Add to selections
                    selectedExtraDressing.forEach(dressingId => {
                      const dressing = saladExtraDressingOptions.find(d => d.id === dressingId);
                      if (dressing) {
                        selections.push({
                          id: dressingId,
                          label: dressing.name,
                          type: 'side',
                          groupId: 'salad_extra_dressing',
                          groupTitle: 'Extra Dressing',
                          productId: product.id
                        });
                      }
                    });
                  }

                  // Add salad dressing instructions
                  if (selectedDressingInstructions) {
                    const instructionName = saladDressingInstructions.find(i => i.id === selectedDressingInstructions)?.name;
                    if (instructionName) {
                      customizations.push({
                        category: 'Dressing Instructions',
                        items: [instructionName]
                      });
                      selections.push({
                        id: selectedDressingInstructions,
                        label: instructionName,
                        type: 'special_instruction',
                        groupId: 'salad_dressing_instructions',
                        groupTitle: 'Dressing Instructions'
                      });
                    }
                  }
                  
                  // Add selected desserts (RECORD version)
                  if (Object.keys(selectedDesserts).length > 0) {
                    const dessertItems: string[] = [];
                    Object.entries(selectedDesserts).forEach(([dessertId, qty]) => {
                      if (qty > 0) {
                        const dessert = allProducts.find(p => p.id === dessertId) || 
                                      dessertItems.find(d => d.id === dessertId) ||
                                      wholeCakesItems.find(c => c.id === dessertId) ||
                                      partyCakesItems.find(c => c.id === dessertId);
                        
                        const name = dessert?.name;
                        if (name) {
                          dessertItems.push(`${name} x${qty}`);
                          selections.push({
                            id: dessertId,
                            label: name,
                            type: 'dessert'
                          });
                        }
                      }
                    });
                    
                    if (dessertItems.length > 0) {
                      customizations.push({
                        category: 'Desserts',
                        items: dessertItems
                      });
                    }
                  }
                  
                  // Add selected beverages (RECORD version)
                  if (Object.keys(selectedBeverages).length > 0) {
                    const beverageItemsList: string[] = [];
                    Object.entries(selectedBeverages).forEach(([beverageId, qty]) => {
                      if (qty > 0) {
                        const beverage = beverageItems.find(b => b.id === beverageId) || allProducts.find(p => p.id === beverageId);
                        const name = beverage?.name;
                        
                        if (name) {
                          beverageItemsList.push(`${name} x${qty}`);
                          selections.push({
                            id: beverageId,
                            label: name,
                            type: 'beverage',
                            beverageCategory: getBeverageCategory(beverageId)
                          });
                        }
                      }
                    });
                    
                    if (beverageItemsList.length > 0) {
                      customizations.push({
                        category: 'Beverages',
                        items: beverageItemsList
                      });
                    }
                  }
                  
                  // Add ALL missing customizations
                  if (selectedPastaAdditions.length > 0) {
                    customizations.push({ category: 'Pasta Additions', items: selectedPastaAdditions.map(id => getItemName(id)) });
                  }
                  if (selectedHotHoagieExtras.length > 0) {
                    customizations.push({ category: 'Extras', items: selectedHotHoagieExtras.map(id => getItemName(id)) });
                  }
                  if (selectedHotHoagieSides.length > 0) {
                    customizations.push({ category: 'Sides', items: selectedHotHoagieSides.map(id => getItemName(id)) });
                    // NEW STRUCTURED - Add to selections
                    selectedHotHoagieSides.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({ id, label: name, type: 'side' });
                      }
                    });
                  }
                  if (selectedHotHoagieInstructions.length > 0) {
                    customizations.push({ category: 'Special Instructions', items: selectedHotHoagieInstructions.map(id => getItemName(id)) });
                    // NEW STRUCTURED - Add to selections
                    selectedHotHoagieInstructions.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({ id, label: name, type: 'special_instruction' });
                      }
                    });
                  }
                  if (product.category === 'hot-hoagies' && selectedHotHoagieCheese) {
                    customizations.push({ category: 'Cheese', items: [getItemName(selectedHotHoagieCheese)] });
                  }
                  if (selectedGrilledChickenSideToppingsRequired.length > 0) {
                    customizations.push({ category: 'Side Toppings', items: selectedGrilledChickenSideToppingsRequired.map(id => getItemName(id)) });
                    // NEW STRUCTURED - Add to selections
                    selectedGrilledChickenSideToppingsRequired.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({ id, label: name, type: 'side', groupId: 'grilled_chicken_side_toppings', groupTitle: 'On The Side Toppings' });
                      }
                    });
                  }
                  if (selectedCheesesteakSideToppingsRequired.length > 0) {
                    customizations.push({ category: 'Side Toppings', items: selectedCheesesteakSideToppingsRequired.map(id => getItemName(id)) });
                    // NEW STRUCTURED - Add to selections
                    selectedCheesesteakSideToppingsRequired.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({ id, label: name, type: 'side', groupId: 'cheesesteak_on_the_side_toppings', groupTitle: 'On The Side Toppings' });
                      }
                    });
                  }
                  if (selectedTraditionalDinnersSides.length > 0) {
                    customizations.push({ category: 'Sides', items: selectedTraditionalDinnersSides.map(id => getItemName(id)) });
                    // NEW STRUCTURED - Add to selections
                    selectedTraditionalDinnersSides.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({ id, label: name, type: 'side' });
                      }
                    });
                  }
                  if (selectedTraditionalDinnersSoupsSalads.length > 0) {
                    customizations.push({ category: 'Soups & Salads', items: selectedTraditionalDinnersSoupsSalads.map(id => getItemName(id)) });
                  }
                  if (product.category === 'cold-hoagies' && selectedColdHoagieCheese) {
                    customizations.push({ category: 'Cheese', items: [getItemName(selectedColdHoagieCheese)] });
                  }
                  if (selectedColdHoagieSideToppingsRequired.length > 0) {
                    customizations.push({ category: 'Side Toppings', items: selectedColdHoagieSideToppingsRequired.map(id => getItemName(id)) });
                    // NEW STRUCTURED - Add to selections
                    selectedColdHoagieSideToppingsRequired.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({ id, label: name, type: 'side', groupId: 'cold_hoagie_side_toppings', groupTitle: 'On The Side Toppings' });
                      }
                    });
                  }
                  if (selectedColdHoagieToppings.length > 0) {
                    customizations.push({ category: 'Add Toppings', items: selectedColdHoagieToppings.map(id => getItemName(id)) });
                  }
                  if (selectedColdHoagieExtras.length > 0) {
                    customizations.push({ category: 'Extras', items: selectedColdHoagieExtras.map(id => getItemName(id)) });
                  }
                  if (selectedColdHoagieLite.length > 0) {
                    customizations.push({ category: 'Lite', items: selectedColdHoagieLite.map(id => getItemName(id)) });
                  }
                  if (selectedColdHoagieNo.length > 0) {
                    customizations.push({ category: 'No Toppings', items: selectedColdHoagieNo.map(id => getItemName(id)) });
                  }
                  if (selectedColdHoagieSides.length > 0) {
                    customizations.push({ category: 'Sides', items: selectedColdHoagieSides.map(id => getItemName(id)) });
                  }
                  if (selectedColdHoagieExtraSides.length > 0) {
                    customizations.push({ category: 'Extra Sides', items: selectedColdHoagieExtraSides.map(id => getItemName(id)) });
                  }
                  if (selectedBurgerAdd.length > 0) {
                    customizations.push({ category: 'Add Toppings', items: selectedBurgerAdd.map(id => getItemName(id)) });
                  }
                  if (selectedBurgerExtra.length > 0) {
                    customizations.push({ category: 'Extras', items: selectedBurgerExtra.map(id => getItemName(id)) });
                  }

                  // Mac & Cheese Bites - Include Ranch Sauce automatically
                  if (product.id === 'app13') {
                    selections.push({
                      id: 'included-ranch-4oz',
                      label: '4oz Ranch Sauce',
                      type: 'sauce',
                      groupTitle: 'Included'
                    });

                    // Add selected extras
                    if (selectedMacAndCheeseBitesInstructions && selectedMacAndCheeseBitesInstructions.length > 0) {
                       selectedMacAndCheeseBitesInstructions.forEach(id => {
                          const option = macAndCheeseBitesInstructionsOptions.find(o => o.id === id);
                          if (option) {
                             selections.push({
                                id: id,
                                label: option.name,
                                type: 'special_instruction',
                                groupTitle: 'Extras',
                                price: option.price || 0
                             });
                          }
                       });
                    }
                  }

                  // Broccoli & Cheddar Bites - Include Ranch Sauce automatically
                  if (product.id === 'app7') {
                    selections.push({
                      id: 'included-ranch-4oz',
                      label: '4oz Ranch Sauce',
                      type: 'sauce',
                      groupTitle: 'Included'
                    });

                    // Add selected extras
                    if (selectedBroccoliCheddarBitesInstructions && selectedBroccoliCheddarBitesInstructions.length > 0) {
                       selectedBroccoliCheddarBitesInstructions.forEach(id => {
                          const option = broccoliCheddarBitesInstructionsOptions.find(o => o.id === id);
                          if (option) {
                             selections.push({
                                id: id,
                                label: option.name,
                                type: 'special_instruction',
                                groupTitle: 'Extras',
                                price: option.price || 0
                             });
                          }
                       });
                    }
                  }
                  if (selectedSaladSpecialInstructions.length > 0) {
                    customizations.push({ category: 'Special Instructions', items: selectedSaladSpecialInstructions.map(id => getItemName(id)) });
                  }
                  if (selectedExtraDressings.length > 0) {
                    customizations.push({ category: 'Extra Dressings', items: selectedExtraDressings.map(id => getItemName(id)) });
                  }
                  if (selectedDressingInstruction) {
                    customizations.push({ category: 'Dressing Instruction', items: [getItemName(selectedDressingInstruction)] });
                  }
                  if (selectedExtraSides.length > 0) {
                    customizations.push({ category: 'Extra Sides', items: selectedExtraSides.map(id => getItemName(id)) });
                  }
                  if (selectedBrooklynInstructions.length > 0) {
                    customizations.push({ category: 'Special Instructions', items: selectedBrooklynInstructions.map(id => getItemName(id)) });
                  }

                  // Pasta e Fagioli (Soups): Substitute + Special Instructions
                  if (selectedPastaFagioliSubstitute) {
                    const substituteName = getItemName(selectedPastaFagioliSubstitute);
                    if (substituteName) {
                      customizations.push({ category: 'Substitute', items: [substituteName] });
                      selections.push({
                        id: selectedPastaFagioliSubstitute,
                        label: substituteName,
                        type: 'other',
                        groupId: 'substitute',
                        groupTitle: 'Substitute',
                      });
                    }
                  }
                  if (selectedPastaFagioliSpecialInstructions.length > 0) {
                    const names = selectedPastaFagioliSpecialInstructions.map(id => getItemName(id)).filter(Boolean);
                    if (names.length > 0) {
                      customizations.push({ category: 'Special Instructions', items: names });
                    }
                    selectedPastaFagioliSpecialInstructions.forEach(id => {
                      const name = getItemName(id);
                      if (name) {
                        selections.push({
                          id,
                          label: name,
                          type: 'special_instruction',
                          groupId: 'pasta_fagioli_special_instructions',
                          groupTitle: 'Special Instructions',
                        });
                      }
                    });
                  }
                  
                  // Add Pizza Dippings (Optional)
                  if (Object.keys(selectedPizzaDippings).length > 0) {
                    const dippingItems: string[] = [];
                    Object.entries(selectedPizzaDippings).forEach(([dippingId, qty]) => {
                      if (qty > 0) {
                        const dipping = pizzaDippingsOptions.find(d => d.id === dippingId);
                        if (dipping) {
                          dippingItems.push(`${dipping.name} x${qty}`);
                        }
                      }
                    });
                    if (dippingItems.length > 0) {
                      customizations.push({ category: 'Add Dippings', items: dippingItems });
                    }
                  }
                  
                  if (selectedGrilledChickenNoToppings.length > 0) {
                    customizations.push({ category: 'No Toppings', items: selectedGrilledChickenNoToppings.map(id => getItemName(id)) });
                  }
                  if (selectedSausagePeppersOnionsNoToppings.length > 0) {
                    customizations.push({ category: 'No Toppings', items: selectedSausagePeppersOnionsNoToppings.map(id => getItemName(id)) });
                  }
                  if (selectedCheeseBurgerDeluxeNoToppings.length > 0) {
                    customizations.push({ category: 'No Toppings', items: selectedCheeseBurgerDeluxeNoToppings.map(id => getItemName(id)) });
                  }
                  if (selectedBriocheGrilledChickenNoToppings.length > 0) {
                    customizations.push({ category: 'No Toppings', items: selectedBriocheGrilledChickenNoToppings.map(id => getItemName(id)) });
                  }
                  
                  // ====================================================================
                  // FINAL STEP: ensure ALL toppings, extras, sides and instructions
                  // are mapped into selections before calling onAddToCart (DESKTOP)
                  // ====================================================================
                  
                  // Generic helper to ensure any array of ids becomes CartSelection entries
                  const registerSelectionsFromIds = (
                    ids: string[] | undefined,
                    options: {
                      fallbackType?: 'topping' | 'extra_topping' | 'no_topping' | 'side' | 'special_instruction' | 'sauce' | 'pasta_type' | 'other';
                      fallbackGroupId?: string;
                      fallbackGroupTitle?: string;
                      debugKey?: string;
                    } = {}
                  ) => {
                    if (!ids || ids.length === 0) return;

                    ids.forEach((id) => {
                      if (!id) return;

                      // Skip if this id is already in selections (avoid duplicates)
                      const alreadyExists = selections.some((sel) => sel.id === id);
                      if (alreadyExists) return;

                      const name =
                        getItemName(id) ||
                        id.replace(/[_-]+/g, ' ').replace(/\b\w/g, (c) => c.toUpperCase()).trim();

                      const groupInfo = getToppingGroupInfo ? getToppingGroupInfo(id) : undefined;

                      selections.push({
                        id,
                        label: name,
                        type: groupInfo?.type ?? options.fallbackType ?? "topping",
                        groupId: groupInfo?.groupId ?? options.fallbackGroupId,
                        groupTitle: groupInfo?.groupTitle ?? options.fallbackGroupTitle,
                        productId: product.id,
                      });
                    });
                  };
                  
                  // Extra sauces / cheese ranch (Record<id, size>)
                  const registerExtraSauceSelections = (
                    record: Record<string, string>,
                    options: {
                      groupId: string;
                      groupTitle: string;
                      baseLabel: string;
                      debugKey: string;
                    }
                  ) => {
                    Object.entries(record).forEach(([sauceId, size]) => {
                      if (!size) return;

                      const selectionId = `${options.groupId}:${sauceId}:${size}`;
                      const alreadyExists = selections.some((sel) => sel.id === selectionId);
                      if (alreadyExists) return;

                      const sauceName = getItemName(sauceId) ?? options.baseLabel;

                      selections.push({
                        id: selectionId,
                        label: `${sauceName} (${size})`,
                        type: "extra_topping",
                        groupId: options.groupId,
                        groupTitle: options.groupTitle,
                        productId: product.id,
                      });
                    });
                  };

                  // Wrap Platter selections (Record<id, quantity>)
                  const registerWrapPlatterSelections = (
                    record: { [key: string]: number },
                    options: {
                      groupId: string;
                      groupTitle: string;
                      debugKey: string;
                      isSide?: boolean;
                    }
                  ) => {
                    Object.entries(record).forEach(([itemId, qty]) => {
                      if (!qty || qty <= 0) return;

                      const selectionId = `${options.groupId}:${itemId}`;
                      const alreadyExists = selections.some((sel) => sel.id === selectionId);
                      if (alreadyExists) return;

                      const name = getItemName(itemId) ?? "Wrap Platter Item";

                      selections.push({
                        id: selectionId,
                        label: `${name} x${qty}`,
                        type: options.isSide ? "side" : "topping",
                        groupId: options.groupId,
                        groupTitle: options.groupTitle,
                        productId: product.id,
                      });
                    });
                  };
                  
                  // Map all missing selections
                  registerSelectionsFromIds(selectedGrilledChickenNoToppings, { debugKey: "selectedGrilledChickenNoToppings", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedSausagePeppersOnionsNoToppings, { debugKey: "selectedSausagePeppersOnionsNoToppings", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedCheeseBurgerDeluxeNoToppings, { debugKey: "selectedCheeseBurgerDeluxeNoToppings", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedBriocheGrilledChickenNoToppings, { debugKey: "selectedBriocheGrilledChickenNoToppings", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedHotHoagieExtras, { debugKey: "selectedHotHoagieExtras", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedColdHoagieToppings, { debugKey: "selectedColdHoagieToppings", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedColdHoagieExtras, { debugKey: "selectedColdHoagieExtras", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedColdHoagieLite, { debugKey: "selectedColdHoagieLite", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedColdHoagieNo, { debugKey: "selectedColdHoagieNo", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedBurgerAdd, { debugKey: "selectedBurgerAdd", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedBurgerExtra, { debugKey: "selectedBurgerExtra", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedBurgerLite, { debugKey: "selectedBurgerLite", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedBurgerSide, { debugKey: "selectedBurgerSide", fallbackType: "side" });
                  registerSelectionsFromIds(selectedWrapAddToppings, { debugKey: "selectedWrapAddToppings", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedWrapLite, { debugKey: "selectedWrapLite", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedWrapNo, { debugKey: "selectedWrapNo", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedWrapSide, { debugKey: "selectedWrapSide", fallbackType: "side" });
                  registerSelectionsFromIds(selectedPaniniLite, { debugKey: "selectedPaniniLite", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedPaniniNo, { debugKey: "selectedPaniniNo", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedPaniniSides, { debugKey: "selectedPaniniSides", fallbackType: "side" });
                  registerSelectionsFromIds(selectedBriocheNo, { debugKey: "selectedBriocheNo", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedBriocheSide, { debugKey: "selectedBriocheSide", fallbackType: "side" });
                  if (selectedKidsPastaType) registerSelectionsFromIds([selectedKidsPastaType], { debugKey: "selectedKidsPastaType", fallbackType: "pasta_type" });
                  if (selectedKidsPastaSauce) registerSelectionsFromIds([selectedKidsPastaSauce], { debugKey: "selectedKidsPastaSauce", fallbackType: "sauce" });
                  registerSelectionsFromIds(selectedKidsPastaSpecialInstructions, { debugKey: "selectedKidsPastaSpecialInstructions", fallbackType: "special_instruction" });
                  registerSelectionsFromIds(selectedKidsPastaToppings, { debugKey: "selectedKidsPastaToppings", fallbackType: "topping" });
                  if (selectedKidsPastaMeatballType) registerSelectionsFromIds([selectedKidsPastaMeatballType], { debugKey: "selectedKidsPastaMeatballType", fallbackType: "pasta_type" });
                  registerSelectionsFromIds(selectedKidsPastaMeatballSpecialInstructions, { debugKey: "selectedKidsPastaMeatballSpecialInstructions", fallbackType: "special_instruction" });
                  registerSelectionsFromIds(selectedKidsPastaMeatballToppings, { debugKey: "selectedKidsPastaMeatballToppings", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedKidsBakedExtraToppings, { debugKey: "selectedKidsBakedExtraToppings", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedKidsBakedLiteToppings, { debugKey: "selectedKidsBakedLiteToppings", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedKidsBakedNoToppings, { debugKey: "selectedKidsBakedNoToppings", fallbackType: "no_topping" });
                  registerSelectionsFromIds(selectedBuildPastaToppings, { debugKey: "selectedBuildPastaToppings", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedSaladToppings, { debugKey: "selectedSaladToppings", fallbackType: "topping" });
                  registerSelectionsFromIds(selectedExtraToppings, { debugKey: "selectedExtraToppings", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedExtraDressing, { debugKey: "selectedExtraDressing", fallbackType: "side" });
                  if (selectedBuildPastaType) registerSelectionsFromIds([selectedBuildPastaType], { debugKey: "selectedBuildPastaType", fallbackType: "pasta_type" });
                  if (selectedBuildPastaSauce) registerSelectionsFromIds([selectedBuildPastaSauce], { debugKey: "selectedBuildPastaSauce", fallbackType: "sauce" });
                  if (selectedBuildPastaSoup && selectedBuildPastaSoup.length > 0) registerSelectionsFromIds(selectedBuildPastaSoup, { debugKey: "selectedBuildPastaSoup", fallbackType: "side" });
                  registerSelectionsFromIds(selectedColdHoagieSideToppingsRequired, { debugKey: "selectedColdHoagieSideToppingsRequired", fallbackType: "side", fallbackGroupId: "cold_hoagie_side_toppings_required", fallbackGroupTitle: "Side Toppings (Required)" });
                  registerSelectionsFromIds(selectedGrilledChickenSideToppingsRequired, { debugKey: "selectedGrilledChickenSideToppingsRequired", fallbackType: "side", fallbackGroupId: "grilled_chicken_side_toppings_required", fallbackGroupTitle: "Side Toppings (Required)" });
                  registerSelectionsFromIds(selectedCheesesteakSideToppingsRequired, { debugKey: "selectedCheesesteakSideToppingsRequired", fallbackType: "side", fallbackGroupId: "cheesesteak_on_the_side_toppings", fallbackGroupTitle: "On The Side Toppings" });
                  registerSelectionsFromIds(selectedHotHoagieSides, { debugKey: "selectedHotHoagieSides", fallbackType: "side" });
                  registerSelectionsFromIds(selectedBriocheExtraCheese, { debugKey: "selectedBriocheExtraCheese", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedPaniniExtraCheese, { debugKey: "selectedPaniniExtraCheese", fallbackType: "extra_topping" });
                  registerSelectionsFromIds(selectedWrapExtraCheese, { debugKey: "selectedWrapExtraCheese", fallbackType: "extra_topping" });
                  if (selectedWingsExtraSauce && Object.keys(selectedWingsExtraSauce).length > 0) registerExtraSauceSelections(selectedWingsExtraSauce, { groupId: "wings_extra_sauce", groupTitle: "Wings  Extra Sauce", baseLabel: "Extra Sauce", debugKey: "selectedWingsExtraSauce" });
                  if (selectedWingsExtraCheeseRanch && Object.keys(selectedWingsExtraCheeseRanch).length > 0) registerExtraSauceSelections(selectedWingsExtraCheeseRanch, { groupId: "wings_extra_cheese_ranch", groupTitle: "Wings  Extra Cheese/Ranch", baseLabel: "Extra Cheese/Ranch", debugKey: "selectedWingsExtraCheeseRanch" });
                  if (selectedChickenTendersExtraSauce && Object.keys(selectedChickenTendersExtraSauce).length > 0) registerExtraSauceSelections(selectedChickenTendersExtraSauce, { groupId: "chicken_tenders_extra_sauce", groupTitle: "Chicken Tenders  Extra Sauce", baseLabel: "Extra Sauce", debugKey: "selectedChickenTendersExtraSauce" });
                  if (selectedChickenTendersExtraCheeseRanch && Object.keys(selectedChickenTendersExtraCheeseRanch).length > 0) registerExtraSauceSelections(selectedChickenTendersExtraCheeseRanch, { groupId: "chicken_tenders_extra_cheese_ranch", groupTitle: "Chicken Tenders  Extra Cheese/Ranch", baseLabel: "Extra Cheese/Ranch", debugKey: "selectedChickenTendersExtraCheeseRanch" });
                  if (selectedWrapPlatterOptions && Object.keys(selectedWrapPlatterOptions).length > 0) registerWrapPlatterSelections(selectedWrapPlatterOptions, { groupId: "wrap_platter_options", groupTitle: "Wrap Platter  Wraps", debugKey: "selectedWrapPlatterOptions" });
                  if (selectedWrapPlatterSideToppings && Object.keys(selectedWrapPlatterSideToppings).length > 0) registerWrapPlatterSelections(selectedWrapPlatterSideToppings, { groupId: "wrap_platter_side_toppings", groupTitle: "Wrap Platter  Side Toppings", debugKey: "selectedWrapPlatterSideToppings", isSide: true });
                  registerSelectionsFromIds(selectedChickenTendersSpecialInstructions, { debugKey: "selectedChickenTendersSpecialInstructions", fallbackType: "special_instruction", fallbackGroupId: "chicken_tenders_instructions", fallbackGroupTitle: "Chicken Tenders  Special Instructions" });
                  registerSelectionsFromIds(selectedWingsSpecialInstructions, { debugKey: "selectedWingsSpecialInstructions", fallbackType: "special_instruction", fallbackGroupId: "wings_instructions", fallbackGroupTitle: "Wings  Special Instructions" });
                  if (selectedPastaFagioliSubstitute) {
                    registerSelectionsFromIds([selectedPastaFagioliSubstitute], { debugKey: "selectedPastaFagioliSubstitute", fallbackType: "other", fallbackGroupId: "substitute", fallbackGroupTitle: "Substitute" });
                  }
                  registerSelectionsFromIds(selectedPastaFagioliSpecialInstructions, { debugKey: "selectedPastaFagioliSpecialInstructions", fallbackType: "special_instruction", fallbackGroupId: "pasta_fagioli_special_instructions", fallbackGroupTitle: "Special Instructions" });
                  
                  // Extra Side Sauces (Stromboli/Calzone/etc)
                  if (product.name === 'Buffalo Chicken Stromboli' && extraSideSauces && Object.keys(extraSideSauces).length > 0) {
                    Object.entries(extraSideSauces).forEach(([id, qty]) => {
                      if (!qty || qty <= 0) return;
                      
                      const name = id === 'side-bc' ? 'Bleu Cheese' : 
                                   id === 'side-br' ? 'Buttermilk Ranch' : 
                                   'Side Sauce';
                      
                      const selectionId = `side_sauce:${id}`;
                      if (!selections.some(s => s.id === selectionId)) {
                          selections.push({
                            id: selectionId,
                            label: `(${qty}) ${name}`,
                            type: 'extra_topping',
                            groupId: 'additional_toppings',
                            groupTitle: 'Additional Toppings',
                            productId: product.id,
                          });
                      }
                    });
                  }

                  // ============================================================
                  // AUTOMATIC CAPTURE OF ALL MISSING SELECTIONS (DESKTOP)
                  // ============================================================
                  
                  const rawSelectionSourcesDesktop: Record<string, RawSelectionShape> = {
                    // GLOBAL / base states
                    selectedSize: { kind: "singleString", value: selectedSize },
                    selectedSauces: { kind: "stringArray", value: selectedSauces },
                    selectedIncluded: { kind: "singleString", value: selectedIncluded },
                    selectedToppings: { kind: "stringArray", value: selectedToppings },
                    selectedDesserts: { kind: "numberRecord", value: selectedDesserts },
                    selectedBeverages: { kind: "numberRecord", value: selectedBeverages },
                    selectedSpecialInstructions: { kind: "stringArray", value: selectedSpecialInstructions },
                    selectedExtraSauce: { kind: "stringArray", value: selectedExtraSauce },
                    selectedNoToppings: { kind: "stringArray", value: selectedNoToppings },
                    selectedBrooklynInstructions: { kind: "stringArray", value: selectedBrooklynInstructions },
                    selectedCheese: { kind: "singleString", value: (product.category === 'appetizers' ? '' : selectedCheese) },
                    selectedSideToppings: { kind: "stringArray", value: selectedSideToppings },
                    selectedExtraSides: { kind: "stringArray", value: selectedExtraSides },
                    selectedSaladBase: { kind: "singleString", value: selectedSaladBase },
                    selectedSaladDressing: { kind: "singleString", value: selectedSaladDressing },
                    selectedDressingInstruction: { kind: "singleString", value: selectedDressingInstruction },
                    selectedExtraDressings: { kind: "stringArray", value: selectedExtraDressings },
                    selectedSaladSpecialInstructions: { kind: "stringArray", value: selectedSaladSpecialInstructions },
                    selectedAddToppings: { kind: "stringArray", value: selectedAddToppings },
                    selectedLiteToppings: { kind: "stringArray", value: selectedLiteToppings },
                    selectedNoToppingsCheesesteak: { kind: "stringArray", value: selectedNoToppingsCheesesteak },

                    // Hot Hoagies states
                    selectedHotHoagieExtras: { kind: "stringArray", value: selectedHotHoagieExtras },
                    selectedHotHoagieSides: { kind: "stringArray", value: selectedHotHoagieSides },
                    selectedHotHoagieInstructions: { kind: "stringArray", value: selectedHotHoagieInstructions },
                    selectedGrilledChickenNoToppings: { kind: "stringArray", value: selectedGrilledChickenNoToppings },
                    selectedSausagePeppersOnionsNoToppings: { kind: "stringArray", value: selectedSausagePeppersOnionsNoToppings },
                    selectedCheeseBurgerDeluxeNoToppings: { kind: "stringArray", value: selectedCheeseBurgerDeluxeNoToppings },
                    selectedBriocheGrilledChickenNoToppings: { kind: "stringArray", value: selectedBriocheGrilledChickenNoToppings },
                    selectedHotHoagieCheese: { kind: "singleString", value: selectedHotHoagieCheese },

                    // Grilled Chicken Side Toppings (Required)
                    selectedGrilledChickenSideToppingsRequired: { kind: "stringArray", value: selectedGrilledChickenSideToppingsRequired },
                    
                    // Cheesesteak Side Toppings (Required)
                    selectedCheesesteakSideToppingsRequired: { kind: "stringArray", value: selectedCheesesteakSideToppingsRequired },
                    
                    // Traditional Dinners states
                    selectedTraditionalDinnersSides: { kind: "stringArray", value: selectedTraditionalDinnersSides },
                    selectedTraditionalDinnersSoupsSalads: { kind: "stringArray", value: selectedTraditionalDinnersSoupsSalads },

                    // Catering Pasta states
                    selectedPastaType: { kind: "singleString", value: selectedPastaType },
                    selectedPastaAdditions: { kind: "stringArray", value: selectedPastaAdditions },

                    // Cold Hoagies states
                    selectedColdHoagieCheese: { kind: "singleString", value: selectedColdHoagieCheese },
                    selectedColdHoagieSideToppingsRequired: { kind: "stringArray", value: selectedColdHoagieSideToppingsRequired },
                    selectedColdHoagieToppings: { kind: "stringArray", value: selectedColdHoagieToppings },
                    selectedColdHoagieExtras: { kind: "stringArray", value: selectedColdHoagieExtras },
                    selectedColdHoagieLite: { kind: "stringArray", value: selectedColdHoagieLite },
                    selectedColdHoagieNo: { kind: "stringArray", value: selectedColdHoagieNo },
                    selectedColdHoagieSides: { kind: "stringArray", value: selectedColdHoagieSides },
                    selectedColdHoagieExtraSides: { kind: "stringArray", value: selectedColdHoagieExtraSides },

                    // Burger states
                    selectedBurgerAdd: { kind: "stringArray", value: selectedBurgerAdd },
                    selectedBurgerExtra: { kind: "stringArray", value: selectedBurgerExtra },
                    selectedBurgerLite: { kind: "stringArray", value: selectedBurgerLite },
                    selectedBurgerSide: { kind: "stringArray", value: selectedBurgerSide },
                    selectedBurgerCheese: { kind: "stringArray", value: (product.category === 'appetizers' ? [] : selectedBurgerCheese) },

                    // Chicken Tenders state
                    selectedChickenTendersQuantity: { kind: "singleString", value: selectedChickenTendersQuantity },
                    selectedChickenTendersSauce: { kind: "singleString", value: selectedChickenTendersSauce },
                    selectedChickenTendersSpecialInstructions: { kind: "stringArray", value: selectedChickenTendersSpecialInstructions },
                    selectedChickenTendersExtraSauce: { kind: "stringRecord", value: selectedChickenTendersExtraSauce },
                    selectedChickenTendersExtraCheeseRanch: { kind: "stringRecord", value: selectedChickenTendersExtraCheeseRanch },
                    selectedSubstituteSauce: { kind: "singleString", value: selectedSubstituteSauce },

                    // Mozzarella Sticks state
                    selectedMozzarellaSticksSpecialInstructions: { kind: "stringArray", value: selectedMozzarellaSticksSpecialInstructions },
                    selectedMozzarellaSticksQuantity: { kind: "singleString", value: selectedMozzarellaSticksQuantity },
                    selectedMozzarellaSticksInstructions: { kind: "stringArray", value: selectedMozzarellaSticksInstructions },

                    // Arancini Rice Ball state
                    selectedAranciniQuantity: { kind: "singleString", value: selectedAranciniQuantity },
                    selectedAranciniInstructions: { kind: "stringArray", value: selectedAranciniInstructions },
                    selectedAranciniRegularQuantity: { kind: "singleString", value: selectedAranciniRegularQuantity },
                    selectedAranciniRegularInstructions: { kind: "stringArray", value: selectedAranciniRegularInstructions },

                    // French Fries state
                    selectedFriesInstructions: { kind: "stringArray", value: selectedFriesInstructions },

                    // Garlic Stick state
                    selectedGarlicStickInstructions: { kind: "stringArray", value: selectedGarlicStickInstructions },

                    // Garlic Bread state
                    selectedGarlicBreadInstructions: { kind: "stringArray", value: selectedGarlicBreadInstructions },
                    selectedGarlicBreadMozzarellaInstructions: { kind: "stringArray", value: selectedGarlicBreadMozzarellaInstructions },
                    selectedGarlicBreadSize: { kind: "singleString", value: selectedGarlicBreadSize },
                    selectedGarlicBreadMozzarellaSize: { kind: "singleString", value: selectedGarlicBreadMozzarellaSize },

                    // Salad states
                    selectedSaladToppings: { kind: "stringArray", value: selectedSaladToppings },
                    selectedDressingInstructions: { kind: "singleString", value: selectedDressingInstructions },
                    selectedExtraDressing: { kind: "stringArray", value: selectedExtraDressing },
                    selectedExtraToppings: { kind: "stringArray", value: selectedExtraToppings },

                    // Onion Rings state
                    selectedOnionRingsInstructions: { kind: "stringArray", value: selectedOnionRingsInstructions },

                    // Mac & Cheese Bites state
                    selectedMacAndCheeseBitesInstructions: { kind: "stringArray", value: selectedMacAndCheeseBitesInstructions },

                    // Broccoli & Cheddar Bites state
                    selectedBroccoliCheddarBitesInstructions: { kind: "stringArray", value: selectedBroccoliCheddarBitesInstructions },

                    // Passariello Fries state
                    selectedPassarielloFriesInstructions: { kind: "stringArray", value: selectedPassarielloFriesInstructions },
                    
                    // Cheddar Steak Fries state
                    selectedCheddarSteakFriesInstructions: { kind: "stringArray", value: selectedCheddarSteakFriesInstructions },

                    // Calamari state
                    selectedCalamariSubSauce: { kind: "singleString", value: selectedCalamariSubSauce },

                    // Mussels state
                    selectedMusselsSauce: { kind: "singleString", value: selectedMusselsSauce },

                    // Seafood Combo state
                    selectedSeafoodComboSauce: { kind: "singleString", value: selectedSeafoodComboSauce },

                    // Shrimp Marinara state
                    selectedShrimpMarinaraSubSauce: { kind: "singleString", value: selectedShrimpMarinaraSubSauce },

                    // Marinara Appetizer Sauce
                    selectedMarinaraAppetizerSauce: { kind: "singleString", value: selectedMarinaraAppetizerSauce },

                    // Pasta e Fagioli Substitute
                    selectedPastaFagioliSubstitute: { kind: "singleString", value: selectedPastaFagioliSubstitute },

                    // Seafood Pasta Type
                    selectedSeafoodPastaType: { kind: "singleString", value: selectedSeafoodPastaType },

                    // Wings state
                    selectedWingsQuantity: { kind: "singleString", value: selectedWingsQuantity },
                    selectedWingsSauce: { kind: "singleString", value: selectedWingsSauce },
                    selectedWingsSpecialInstructions: { kind: "stringArray", value: selectedWingsSpecialInstructions },
                    selectedWingsExtraSauce: { kind: "stringRecord", value: selectedWingsExtraSauce },
                    selectedWingsExtraCheeseRanch: { kind: "stringRecord", value: selectedWingsExtraCheeseRanch },

                    // Pizza Dippings state
                    selectedPizzaDippings: { kind: "numberRecord", value: selectedPizzaDippings },

                    // Brioche states
                    selectedBriocheAddCheese: { kind: "singleString", value: selectedBriocheAddCheese },
                    selectedBriocheExtraCheese: { kind: "stringArray", value: selectedBriocheExtraCheese },
                    selectedBriocheNo: { kind: "stringArray", value: selectedBriocheNo },
                    selectedBriocheSide: { kind: "stringArray", value: selectedBriocheSide },

                    // Panini states
                    // selectedPaniniType handled manually
                    // selectedPaniniType: { kind: "singleString", value: selectedPaniniType },
                    selectedPaniniExtraCheese: { kind: "stringArray", value: selectedPaniniExtraCheese },
                    selectedPaniniLite: { kind: "stringArray", value: selectedPaniniLite },
                    selectedPaniniNo: { kind: "stringArray", value: selectedPaniniNo },
                    selectedPaniniSides: { kind: "stringArray", value: selectedPaniniSides },
                    // selectedPaniniCheese handled manually to avoid duplication
                    // selectedPaniniCheese: { kind: "singleString", value: selectedPaniniCheese },

                    // Wrap states
                    selectedWrapType: { kind: "singleString", value: selectedWrapType },
                    selectedWrapCheese: { kind: "singleString", value: selectedWrapCheese },
                    selectedWrapAddToppings: { kind: "stringArray", value: selectedWrapAddToppings },
                    selectedWrapExtraCheese: { kind: "stringArray", value: selectedWrapExtraCheese },
                    selectedWrapLite: { kind: "stringArray", value: selectedWrapLite },
                    selectedWrapNo: { kind: "stringArray", value: selectedWrapNo },
                    selectedWrapSide: { kind: "stringArray", value: selectedWrapSide },

                    // Pasta Fagioli Soup states
                    selectedPastaFagioliSpecialInstructions: { kind: "stringArray", value: selectedPastaFagioliSpecialInstructions },
                    selectedPastaFagioliSubstituteCracker: { kind: "stringArray", value: selectedPastaFagioliSubstituteCracker },

                    // Kids Pasta states
                    selectedKidsPastaType: { kind: "singleString", value: selectedKidsPastaType },
                    selectedKidsPastaSauce: { kind: "singleString", value: selectedKidsPastaSauce },
                    selectedKidsPastaToppings: { kind: "stringArray", value: selectedKidsPastaToppings },
                    selectedKidsPastaSpecialInstructions: { kind: "stringArray", value: selectedKidsPastaSpecialInstructions },

                    // Build Your Own Pasta states
                    selectedBuildPastaType: { kind: "singleString", value: selectedBuildPastaType },
                    selectedBuildPastaSauce: { kind: "singleString", value: selectedBuildPastaSauce },
                    selectedBuildPastaToppings: { kind: "stringArray", value: selectedBuildPastaToppings },
                    selectedBuildPastaSoup: { kind: "stringArray", value: selectedBuildPastaSoup },

                    // Kids Baked items states
                    selectedKidsBakedExtraToppings: { kind: "stringArray", value: selectedKidsBakedExtraToppings },
                    selectedKidsBakedLiteToppings: { kind: "stringArray", value: selectedKidsBakedLiteToppings },
                    selectedKidsBakedNoToppings: { kind: "stringArray", value: selectedKidsBakedNoToppings },

                    // Kids Pasta and Meatball states
                    selectedKidsPastaMeatballType: { kind: "singleString", value: selectedKidsPastaMeatballType },
                    selectedKidsPastaMeatballSpecialInstructions: { kind: "stringArray", value: selectedKidsPastaMeatballSpecialInstructions },
                    selectedKidsPastaMeatballToppings: { kind: "stringArray", value: selectedKidsPastaMeatballToppings },

                    // Salad Bowl states
                    selectedAntipastoBase: { kind: "singleString", value: selectedAntipastoBase },
                    selectedAntipastoDressings: { kind: "stringArray", value: selectedAntipastoDressings },
                    selectedAntipastoSpecialInstructions: { kind: "stringArray", value: selectedAntipastoSpecialInstructions },
                    
                    selectedCaesarBase: { kind: "singleString", value: selectedCaesarBase },
                    selectedCaesarDressings: { kind: "stringArray", value: selectedCaesarDressings },
                    selectedCaesarSpecialInstructions: { kind: "stringArray", value: selectedCaesarSpecialInstructions },
                    
                    selectedChickenCaesarBase: { kind: "singleString", value: selectedChickenCaesarBase },
                    selectedChickenCaesarDressings: { kind: "stringArray", value: selectedChickenCaesarDressings },
                    selectedChickenCaesarSpecialInstructions: { kind: "stringArray", value: selectedChickenCaesarSpecialInstructions },
                    
                    selectedGardenBase: { kind: "singleString", value: selectedGardenBase },
                    selectedGardenDressings: { kind: "stringArray", value: selectedGardenDressings },
                    selectedGardenSpecialInstructions: { kind: "stringArray", value: selectedGardenSpecialInstructions },
                    
                    selectedRoastedRedPepperBase: { kind: "singleString", value: selectedRoastedRedPepperBase },
                    selectedRoastedRedPepperDressings: { kind: "stringArray", value: selectedRoastedRedPepperDressings },
                    
                    selectedThreeCheeseBase: { kind: "singleString", value: selectedThreeCheeseBase },
                    selectedThreeCheeseDressings: { kind: "stringArray", value: selectedThreeCheeseDressings },
                    selectedThreeCheeseSpecialInstructions: { kind: "stringArray", value: selectedThreeCheeseSpecialInstructions },
                    
                    selectedTraditionalChefBase: { kind: "singleString", value: selectedTraditionalChefBase },
                    selectedTraditionalChefDressings: { kind: "stringArray", value: selectedTraditionalChefDressings },
                    selectedTraditionalChefSpecialInstructions: { kind: "stringArray", value: selectedTraditionalChefSpecialInstructions },

                    // Regular Salads - Special Instructions
                    selectedCalamariSpecialInstructions: { kind: "stringArray", value: selectedCalamariSpecialInstructions },
                    selectedCapreseSpecialInstructions: { kind: "stringArray", value: selectedCapreseSpecialInstructions },
                    selectedFarfallePastaSpecialInstructions: { kind: "stringArray", value: selectedFarfallePastaSpecialInstructions },
                    selectedItalianChoppedSpecialInstructions: { kind: "stringArray", value: selectedItalianChoppedSpecialInstructions },
                    selectedRoastedRedPeppersSpecialInstructions: { kind: "stringArray", value: selectedRoastedRedPeppersSpecialInstructions },
                    selectedTunaSpecialInstructions: { kind: "stringArray", value: selectedTunaSpecialInstructions },

                    // Hoagie Platter states
                    selectedHoagiePlatterOptions: { kind: "numberRecord", value: selectedHoagiePlatterOptions },
                    selectedHoagiePlatterCut: { kind: "singleString", value: selectedHoagiePlatterCut },
                    selectedHoagiePlatterSideToppings: { kind: "numberRecord", value: selectedHoagiePlatterSideToppings },

                    // Wrap Platter states
                    selectedWrapPlatterOptions: { kind: "numberRecord", value: selectedWrapPlatterOptions },
                    selectedWrapPlatterWrapType: { kind: "singleString", value: selectedWrapPlatterWrapType },
                    selectedWrapPlatterSideToppings: { kind: "numberRecord", value: selectedWrapPlatterSideToppings },

                    // Hot Sandwich Platter states
                    selectedHotSandwichPlatterOptions: { kind: "numberRecord", value: selectedHotSandwichPlatterOptions },
                    selectedHotSandwichPlatterCut: { kind: "singleString", value: selectedHotSandwichPlatterCut },
                    selectedHotSandwichPlatterSideToppings: { kind: "numberRecord", value: selectedHotSandwichPlatterSideToppings },

                    // Seafood Tray states
                    selectedBabyClamPastaType: { kind: "singleString", value: selectedBabyClamPastaType },
                    selectedBabyClamSauceChoice: { kind: "singleString", value: selectedBabyClamSauceChoice },
                    
                    selectedCalamariPastaType: { kind: "singleString", value: selectedCalamariPastaType },
                    selectedCalamariSubstituteSauce: { kind: "singleString", value: selectedCalamariSubstituteSauce },
                    
                    selectedMusselsPastaType: { kind: "singleString", value: selectedMusselsPastaType },
                    selectedMusselsSauceChoice: { kind: "singleString", value: selectedMusselsSauceChoice },
                    
                    selectedSeafoodComboPastaType: { kind: "singleString", value: selectedSeafoodComboPastaType },
                    selectedSeafoodComboSauceChoice: { kind: "singleString", value: selectedSeafoodComboSauceChoice },
                    
                    selectedShrimpMarinaraPastaType: { kind: "singleString", value: selectedShrimpMarinaraPastaType },
                    selectedShrimpMarinaraSubstituteSauce: { kind: "singleString", value: selectedShrimpMarinaraSubstituteSauce },

                    // Cannoli states
                    selectedCannoliSpecialInstruction: { kind: "booleanRecord", value: selectedCannoliSpecialInstruction ? { 'cannoli-special': selectedCannoliSpecialInstruction } : {} },

                    // Dessert Tray states
                    selectedDessertTraySpecialInstruction: { kind: "booleanRecord", value: selectedDessertTraySpecialInstruction ? { 'dessert-tray-special': selectedDessertTraySpecialInstruction } : {} },
                  };

                  // Apply filtering before auto-capture (DESKTOP)
                  const filteredSourcesDesktop = filterSelectionSourcesByProduct(rawSelectionSourcesDesktop, product);
                  
                  // Call the auto-capture function with FILTERED sources only (DESKTOP)
                  completeSelectionsFromRawSources(selections, filteredSourcesDesktop, getItemName, product);
                  
                  // Patch distribution for sauces (DESKTOP)
                  const extraSauceSelectionsDesktop: typeof selections = [];
                  
                  selections.forEach(sel => {
                    if (sauceDistribution[sel.id]) {
                      const dist = sauceDistribution[sel.id];
                      
                      if (dist && dist !== 'whole') {
                        // Preserve distribution
                        sel.distribution = dist;

                        const baseName = sel.id === 'sauce-pizza' ? 'Red Sauce' : sel.label;
                        
                        // For split sauces, generate complementary half.
                        if (baseName === 'Red Sauce') {
                          const otherSide = dist === 'left' ? 'right' : 'left';
                          
                          // Add the complementary White Pizza selection
                          extraSauceSelectionsDesktop.push({
                            id: `generated-white-pizza-dt-${Date.now()}`,
                            label: 'White Pizza',
                            type: sel.type,
                            distribution: otherSide,
                            groupId: sel.groupId,
                            groupTitle: sel.groupTitle,
                            productId: sel.productId
                          });
                        } else if (baseName === 'White Sauce' || baseName === 'White Pizza') {
                          const otherSide = dist === 'left' ? 'right' : 'left';

                          // Add the complementary Red Pizza selection
                          extraSauceSelectionsDesktop.push({
                            id: `generated-red-pizza-dt-${Date.now()}`,
                            label: 'Red Pizza',
                            type: sel.type,
                            distribution: otherSide,
                            groupId: sel.groupId,
                            groupTitle: sel.groupTitle,
                            productId: sel.productId
                          });
                        }
                      } else {
                        sel.distribution = 'whole';
                      }
                    }
                  });
                  
                  // Add generated selections
                  extraSauceSelectionsDesktop.forEach(s => selections.push(s));

                  // Patch distribution for toppings (DESKTOP)
                  selections.forEach(sel => {
                    if ((sel.type === 'topping' || sel.type === 'extra_topping') && toppingDistribution[sel.id]) {
                      sel.distribution = toppingDistribution[sel.id];
                    }
                  });
                  
                  if (debugCartEnabled) {
                    console.log('[DEBUG] ProductDetailPage  onAddToCart (DESKTOP)', {
                      productId: modifiedProduct.id,
                      productName: modifiedProduct.name,
                      quantity,
                      selectionsCount: selections.length,
                      selections,
                    });
                  }
                  
                  // Update price with total calculated unit price
                  modifiedProduct.price = `$${calculateUnitPrice()}`;
                  
                  // ============================================================
                  // INJECT INCLUDED SAUCE SELECTION (DESKTOP)
                  // ============================================================
                  let includedSauceLabel = '';

                  // Mozzarella Sticks Group
                  if (product.id === 'app4' || product.id === 'wing4' || product.id === 'capp3') {
                      if (selectedMozzarellaSticksQuantity === '6pcs') includedSauceLabel = '(4oz) Pomodoro Sauce';
                      else if (selectedMozzarellaSticksQuantity === '12pcs') includedSauceLabel = '(8oz) Pomodoro Sauce';
                      else if (selectedMozzarellaSticksQuantity === '24pcs') includedSauceLabel = '(16oz) Pomodoro Sauce';
                      else if (selectedMozzarellaSticksQuantity === '48pcs') includedSauceLabel = '(32oz) Pomodoro Sauce';
                      else includedSauceLabel = '(4oz) Pomodoro Sauce';
                  }
                  // Arancini Regular
                  else if (product.id === 'app8') {
                      if (selectedAranciniRegularQuantity === '1pc' || selectedAranciniRegularQuantity === '2pcs') includedSauceLabel = '(4oz) Pomodoro Sauce';
                      else if (selectedAranciniRegularQuantity === '4pcs') includedSauceLabel = '(8oz) Pomodoro Sauce';
                      else if (selectedAranciniRegularQuantity === '8pcs') includedSauceLabel = '(16oz) Pomodoro Sauce';
                      else if (selectedAranciniRegularQuantity === '16pcs') includedSauceLabel = '(32oz) Pomodoro Sauce';
                      else includedSauceLabel = '(4oz) Pomodoro Sauce';
                  }
                  // Arancini Catering
                  else if (product.id === 'capp4') {
                       if (selectedAranciniQuantity === '10pcs') includedSauceLabel = '(16oz) Pomodoro Sauce';
                       else if (selectedAranciniQuantity === '20pcs') includedSauceLabel = '(32oz) Pomodoro Sauce';
                       else if (selectedAranciniQuantity === '30pcs') includedSauceLabel = '(48oz) Pomodoro Sauce';
                       else if (selectedAranciniQuantity === '50pcs') includedSauceLabel = '(80oz) Pomodoro Sauce';
                       else includedSauceLabel = '(16oz) Pomodoro Sauce';
                  }
                  // Wings & Catering Appetizers (Wings)
                  else if (product.id === 'app18' || (product.category === 'wings' && product.id !== 'wing3' && product.id !== 'wing4') || (product.category === 'catering-appetizers' && product.id !== 'capp2' && product.id !== 'capp3' && product.id !== 'capp4')) {
                       let sizeStr = '2oz';
                       if (product.id === 'app18') {
                          if (selectedWingsQuantity === '10pcs') sizeStr = '2oz';
                          else if (selectedWingsQuantity === '20pcs') sizeStr = '4oz';
                          else if (selectedWingsQuantity === '30pcs') sizeStr = '8oz';
                          else if (selectedWingsQuantity === '50pcs') sizeStr = '16oz';
                       } else {
                          if (selectedSize === '10') sizeStr = '2oz';
                          else if (selectedSize === '20') sizeStr = '4oz';
                          else if (selectedSize === '30') sizeStr = '8oz';
                          else if (selectedSize === '50') sizeStr = '16oz';
                       }
                       includedSauceLabel = `${sizeStr} Bleu Cheese`;
                  }
                  // Mac & Cheese, Broccoli, Garlic Sticks, Onion Rings
                  else if (false) {
                       includedSauceLabel = '(4oz) Pomodoro Sauce';
                  }

                  if (includedSauceLabel) {
                      selections.unshift({
                          id: `included-sauce-${product.id}`,
                          label: includedSauceLabel,
                          type: 'extra_topping',
                          groupId: 'included_sauce',
                          groupTitle: 'Included',
                          productId: product.id,
                          price: 0
                      });
                  }
                  
                  // Cold Hoagies / Wraps: report Side of Extra Chips with quantity suffix (xN)
                  if (product.category === 'cold-hoagies' && chipsQuantity > 0) {
                    const chipsLine = `Side of Extra Chips x${chipsQuantity}`;
                    customizations.push({ category: 'Side of Extra Chips', items: [chipsLine] });
                    if (!selections.some(s => s.id === 'ch-chips')) {
                      selections.push({
                        id: 'ch-chips',
                        label: chipsLine,
                        type: 'side',
                        groupId: 'cold_hoagie_side_of_chips',
                        groupTitle: 'Side of Extra Chips',
                        productId: product.id
                      });
                    }
                  }
                  if (product.category === 'wraps' && wrapChipsQuantity > 0) {
                    const chipsLine = `Side of Extra Chips x${wrapChipsQuantity}`;
                    customizations.push({ category: 'Side of Extra Chips', items: [chipsLine] });
                    if (!selections.some(s => s.id === 'ch-chips')) {
                      selections.push({
                        id: 'ch-chips',
                        label: chipsLine,
                        type: 'side',
                        groupId: 'wrap_side_of_chips',
                        groupTitle: 'Side of Extra Chips',
                        productId: product.id
                      });
                    }
                  }

                  let filteredSelections = filterSelectionsByProduct(selections, modifiedProduct);
                  if (product.category === 'create-pasta' || product.category === 'pasta') {
                    const soupIdSet = new Set((buildPastaSoups || []).map(s => String(s.id)));
                    const soupNameSet = new Set((buildPastaSoups || []).map(s => String(s.name || '').toLowerCase().trim()));
                    const isSoupLabel = (value: string): boolean => {
                      const t = String(value || '').toLowerCase().trim();
                      if (!t) return false;
                      if (soupNameSet.has(t)) return true;
                      if (t.startsWith('side garden salad')) return true;
                      if (t.startsWith('side caesar salad')) return true;
                      if (t === 'soup of the day') return true;
                      if (t === 'pasta e fagioli') return true;
                      return false;
                    };
                    const getSoupById = (id: string) => buildPastaSoups.find(s => s.id === id);
                    const getRemovedNames = (id: string): string[] => {
                      const soup = getSoupById(id);
                      if (!soup?.removableIngredients) return [];
                      if (id === 'bps3') {
                        return soup.removableIngredients
                          .filter(ing => sideGardenSaladRemovedIngredients.includes(ing.id))
                          .map(ing => ing.name);
                      }
                      if (id === 'bps4') {
                        return soup.removableIngredients
                          .filter(ing => sideCaesarSaladRemovedIngredients.includes(ing.id))
                          .map(ing => ing.name);
                      }
                      return [];
                    };

                    filteredSelections = filteredSelections.filter((s) => {
                      const sid = String(s?.id || '');
                      const gid = String(s?.groupId || '').toLowerCase();
                      const gtitle = String(s?.groupTitle || '').toLowerCase();
                      const label = String(s?.label || '');
                      const isSoupBySection = gid.includes('build_pasta_soup') || gtitle.includes('choose soup or salad');
                      const isSoupBySynthetic = sid.startsWith('cp-soup-');
                      const isSoupBySharedId = soupIdSet.has(sid) && (isSoupBySection || isSoupLabel(label) || s?.type === 'side');
                      return !(isSoupBySection || isSoupBySynthetic || isSoupBySharedId);
                    });

                    const soupLabelsForCustomization: string[] = [];
                    (selectedBuildPastaSoup || []).forEach((id) => {
                      const soup = getSoupById(id);
                      const baseName = soup?.name || getItemName(id);
                      if (!baseName) return;
                      const removedNames = getRemovedNames(id);
                      const suffix = removedNames.length > 0 ? ` (No ${removedNames.join(', No ')})` : '';
                      const label = `${baseName}${suffix}`;

                      filteredSelections.push({
                        id: `cp-soup-${id}`,
                        label,
                        type: 'side',
                        groupId: 'build_pasta_soup',
                        groupTitle: 'Choose Soup or Salad',
                        productId: product.id,
                        removedIngredients: removedNames.length > 0 ? removedNames : undefined
                      });

                      soupLabelsForCustomization.push(label);
                    });

                    for (let i = customizations.length - 1; i >= 0; i--) {
                      const cat = String(customizations[i]?.category || '').toLowerCase();
                      if (cat === 'choose soup or salad' || cat === 'soups & salads' || cat === 'side soups, salads, & extra bread') {
                        customizations.splice(i, 1);
                      }
                    }
                    if (soupLabelsForCustomization.length > 0) {
                      customizations.push({
                        category: 'Choose Soup or Salad',
                        items: soupLabelsForCustomization
                      });
                    }
                  }
                  if ((modifiedProduct.category || '').toLowerCase().includes('cheesesteak')) {
                    filteredSelections = sanitizeCheesesteakSelections(filteredSelections);
                    const cleanedCustomizations = sanitizeCheesesteakCustomizations(filteredSelections);
                    customizations.length = 0;
                    customizations.push(...cleanedCustomizations);
                  }
                  
                  // FIX: Mac & Cheese Bites (app13) - Ensure customizations are clean to avoid legacy strings
                  if (modifiedProduct.id === 'app13') {
                     // Clear customizations array to rely solely on selections
                     customizations.length = 0; 
                  }
                  
                  if (debugCartEnabled) {
                     console.log('[DEBUG] Desktop AddToCart Payload:', {
                        productId: modifiedProduct.id,
                        productName: modifiedProduct.name,
                        category: modifiedProduct.category,
                        selectedWingsSauce: selectedWingsSauce,
                        selections: filteredSelections,
                        customizations: customizations
                     });
                  }
                  
                  // ============================================================
                  // ARANCINI FIX: QUANTITY DISPLAY
                  // ============================================================
                  if (modifiedProduct.id === 'app8' || modifiedProduct.id === 'capp4') {
                     // 1. Identify selected count
                     let rawQty = '';
                     if (modifiedProduct.id === 'app8') rawQty = selectedAranciniRegularQuantity;
                     else rawQty = selectedAranciniQuantity;
                     
                     const countMatch = rawQty.match(/(\d+)/);
                     const count = countMatch ? countMatch[1] : '1';
                     
                     // 2. Remove any auto-generated "pcs" selection from filteredSelections
                     const idxToRemove = filteredSelections.findIndex(s => s.id === rawQty || s.label === rawQty || s.label.toLowerCase().includes('pcs'));
                     if (idxToRemove !== -1) {
                        filteredSelections.splice(idxToRemove, 1);
                     }
                     
                     // 3. Push explicit clean Quantity selection
                     filteredSelections.push({
                        id: `arancini-qty-${count}`,
                        label: `${count} Arancini Rice Ball`,
                        type: 'required_option',
                        groupTitle: 'Quantity',
                        productId: modifiedProduct.id
                     });
                  }

                  // ============================================================
                  // MOZZARELLA STICKS FIX: QUANTITY DISPLAY
                  // ============================================================
                  if (modifiedProduct.id === 'app4' || modifiedProduct.id === 'wing4' || modifiedProduct.id === 'capp3') {
                     // 1. Identify selected count
                     const rawQty = selectedMozzarellaSticksQuantity;
                     const countMatch = rawQty.match(/(\d+)/);
                     const count = countMatch ? countMatch[1] : '6';
                     
                     // 2. Remove any auto-generated "pcs" selection from filteredSelections
                     const idxToRemove = filteredSelections.findIndex(s => s.id === rawQty || s.label === rawQty || s.label.toLowerCase().includes('pcs'));
                     if (idxToRemove !== -1) {
                        filteredSelections.splice(idxToRemove, 1);
                     }
                     
                     // 3. Push explicit clean Quantity selection
                     filteredSelections.push({
                        id: `sticks-qty-${count}`,
                        label: `${count} Mozzarella Sticks`,
                        type: 'required_option',
                        groupTitle: 'Quantity',
                        productId: modifiedProduct.id
                     });
                  }

                  // ============================================================
                  // CHICKEN TENDERS FIX: QUANTITY DISPLAY
                  // ============================================================
                  if (modifiedProduct.id === 'app6' || modifiedProduct.id === 'wing3' || modifiedProduct.id === 'capp2') {
                     // 1. Identify selected count
                     const rawQty = selectedChickenTendersQuantity;
                     const countMatch = rawQty.match(/(\d+)/);
                     const count = countMatch ? countMatch[1] : '4';
                     
                     // 2. Remove any auto-generated "pcs" selection from filteredSelections
                     const idxToRemove = filteredSelections.findIndex(s => s.id === rawQty || s.label === rawQty || s.label.toLowerCase().includes('pcs'));
                     if (idxToRemove !== -1) {
                        filteredSelections.splice(idxToRemove, 1);
                     }
                     
                     // 3. Push explicit clean Quantity selection
                     filteredSelections.push({
                        id: `tenders-qty-${count}`,
                        label: `${count} Chicken Tenders`,
                        type: 'required_option',
                        groupTitle: 'Quantity',
                        productId: modifiedProduct.id
                     });
                  }
                  
                  // ============================================================
                  // SEAFOOD FIX: CLEANUP AND PUSH SAUCE
                  // ============================================================
                if (product.category === 'seafood') {
                  if (debugCartEnabled) {
                     console.log('[SEAFOOD] before cleanup selections:', JSON.stringify(filteredSelections));
                  }
                  
                  // 1) Clean contamination (burger_cheese, etc)
                  for (let i = filteredSelections.length - 1; i >= 0; i--) {
                    const s = filteredSelections[i];
                    if (s.groupId === "burger_cheese" || s.groupTitle === "Cheese" || s.type === "cheese") {
                       filteredSelections.splice(i, 1);
                    }
                  }
                  // Remove stale Seafood pasta-type entries before re-adding deterministically.
                  for (let i = filteredSelections.length - 1; i >= 0; i--) {
                    const s = filteredSelections[i];
                    const gid = String(s?.groupId || '').toLowerCase();
                    const gtitle = String(s?.groupTitle || '').toLowerCase();
                    const stype = String(s?.type || '').toLowerCase();
                    if (
                      gid === 'seafood_pasta_type_required' ||
                      gid === 'seafood_pasta_type' ||
                      (gtitle.includes('pasta') && gtitle.includes('type')) ||
                      stype === 'pasta_type'
                    ) {
                      filteredSelections.splice(i, 1);
                    }
                  }
                  
                  // Clean customizations
                  for (let i = customizations.length - 1; i >= 0; i--) {
                    const cat = String(customizations[i]?.category || '').toLowerCase();
                    if (cat === "cheese" || cat === "pasta type") {
                       customizations.splice(i, 1);
                    }
                  }

                  if (debugCartEnabled) {
                     console.log('[SEAFOOD] after cleanup selections:', JSON.stringify(filteredSelections));
                  }

                  // 2) Push required pasta type ("Your Choice of Pasta")
                  if (selectedSeafoodPastaType) {
                    const pastaOption = seafoodPastaTypes.find(x => x.id === selectedSeafoodPastaType);
                    const pastaLabel = pastaOption?.name || getItemName(selectedSeafoodPastaType);
                    if (pastaLabel) {
                      filteredSelections.push({
                        id: selectedSeafoodPastaType,
                        label: pastaLabel,
                        type: "required_option",
                        groupId: "seafood_pasta_type_required",
                        groupTitle: "Pasta Type",
                        productId: product.id,
                      });
                      customizations.push({
                        category: "Pasta Type",
                        items: [pastaLabel]
                      });
                    }
                  }

                  // 3) Push required sauce
                  let sauceLabel = seafoodSauceOptions.find(x => x.id === selectedSeafoodSauceId)?.label;
                    
                    // Fallback lookup
                    if (!sauceLabel) {
                       const allOptions = [
                          ...musselsSauceOptions,
                          ...seafoodComboSauceOptions,
                          ...marinaraAppetizerSauceOptions,
                          ...calamariSubSauceOptions,
                          ...shrimpMarinaraSubSauceOptions,
                          ...babyClamSauceChoices
                       ];
                       sauceLabel = allOptions.find(x => x.id === selectedSeafoodSauceId)?.name;
                    }

                    if (sauceLabel) {
                      if (debugCartEnabled) {
                         console.log('[SEAFOOD] pushing sauce selection:', sauceLabel);
                      }
                      filteredSelections.push({
                        id: selectedSeafoodSauceId,
                        label: sauceLabel,
                        type: "sauce",
                        groupId: "seafood_sauce",
                        groupTitle: "Sauce",
                        productId: product.id,
                      });
                    }
                  }

                  // ============================================================
                  // BRIOCHE FIX: remove cross-category cheese contamination
                  // ============================================================
                  if (product.category === 'brioche') {
                    const allowedBriocheCheeseIds = new Set([
                      'brc1', 'brc2', 'brc3', 'brc4', 'brc5', 'brc6', 'brc7'
                    ]);

                    // Keep only Brioche cheese selections.
                    for (let i = filteredSelections.length - 1; i >= 0; i--) {
                      const s = filteredSelections[i] as any;
                      const sid = String(s?.id || '');
                      const gid = String(s?.groupId || '').toLowerCase();
                      const isCheeseLike = s?.type === 'cheese' || gid.includes('cheese') || String(s?.groupTitle || '').toLowerCase().includes('cheese');
                      if (!isCheeseLike) continue;

                      const isBriocheCheese =
                        allowedBriocheCheeseIds.has(sid) ||
                        gid.includes('brioche');

                      if (!isBriocheCheese) {
                        filteredSelections.splice(i, 1);
                      }
                    }

                    // Remove generic cheese customizations; Brioche cheese is re-added deterministically later.
                    for (let i = customizations.length - 1; i >= 0; i--) {
                      const cat = String(customizations[i]?.category || '').toLowerCase();
                      if (cat === 'cheese') {
                        customizations.splice(i, 1);
                      }
                    }
                  }

                  // ============================================================
                  // TRADITIONAL DINNERS FIX: REMOVALS & FORMATTING
                  // ============================================================
                  if (product.category === 'traditional-dinners' || (product.category === 'seafood' && (product.id === 'sf-11' || product.id === 'sf-12'))) {
                     const gardenRemoved = sideGardenSaladRemovedIngredients;
                     const caesarRemoved = sideCaesarSaladRemovedIngredients;
                     
                     // Helper to get ingredient name
                     const getIngName = (saladId: string, ingId: string) => {
                        const salad = traditionalDinnersSoupsSalads.find(s => s.id === saladId);
                        return salad?.removableIngredients?.find(i => i.id === ingId)?.name;
                     };

                     // 1. Patch Selections
                     filteredSelections.forEach(sel => {
                        if (sel.id === 'td-extra2' && gardenRemoved.length > 0) {
                           const names = gardenRemoved.map(id => getIngName('td-extra2', id)).filter(Boolean);
                           if (names.length > 0) {
                              const suffix = ` (No ${names.join(', No ')})`;
                              sel.label = `Side Garden Salad${suffix}`;
                           }
                        }
                        else if (sel.id === 'td-extra3' && caesarRemoved.length > 0) {
                           const names = caesarRemoved.map(id => getIngName('td-extra3', id)).filter(Boolean);
                           if (names.length > 0) {
                              const suffix = ` (No ${names.join(', No ')})`;
                              sel.label = `Side Caesar Salad${suffix}`;
                           }
                        }
                     });

                     // 2. Patch Customizations
                     const soupSaladCat = customizations.find(c => c.category === 'Side Soups, Salads, & Extra Bread' || c.category === 'Soups & Salads');
                     if (soupSaladCat && soupSaladCat.items) {
                        soupSaladCat.items = soupSaladCat.items.map(itemStr => {
                           if (itemStr.startsWith('Side Garden Salad') && gardenRemoved.length > 0) {
                              const names = gardenRemoved.map(id => getIngName('td-extra2', id)).filter(Boolean);
                              if (names.length > 0) return `Side Garden Salad (No ${names.join(', No ')})`;
                           }
                           if (itemStr.startsWith('Side Caesar Salad') && caesarRemoved.length > 0) {
                              const names = caesarRemoved.map(id => getIngName('td-extra3', id)).filter(Boolean);
                              if (names.length > 0) return `Side Caesar Salad (No ${names.join(', No ')})`;
                           }
                           return itemStr;
                        });
                     }

                     // 3. Ensure Extra Bread Quantity in Customizations if needed
                     // (Though current logic in selections handles it, enforcing in customizations is safer for display)
                     if (extraBreadQuantity > 0) {
                         const breadLabel = extraBreadQuantity > 1 ? `Extra Bread x${extraBreadQuantity}` : `Extra Bread`;
                         // Check if present
                         if (soupSaladCat && soupSaladCat.items) {
                             // Remove any existing Extra Bread entry to avoid dupes/stale data
                             soupSaladCat.items = soupSaladCat.items.filter(i => !i.includes('Extra Bread'));
                             // Add correct one
                             soupSaladCat.items.push(breadLabel);
                         } else {
                             customizations.push({
                                 category: 'Side Soups, Salads, & Extra Bread',
                                 items: [breadLabel]
                             });
                         }
                     }

                     console.log('[TD_ADD_TO_CART_BUILD]', { 
                        extraBreadQty: extraBreadQuantity,
                        gardenRemoved, 
                        caesarRemoved, 
                        customizationsBuilt: customizations 
                     });
                  }

                  // --- SIZE FILTERING LOGIC (Start) ---
                  if (isNoSizePizza) {
                      if (filteredSelections && filteredSelections.length > 0) {
                          const initialCount = filteredSelections.length;
                          filteredSelections = stripSizeSelections(filteredSelections);
                          const afterCount = filteredSelections.length;
                          if (debugCartEnabled && initialCount !== afterCount) {
                              console.log('[NO_SIZE_DEBUG_ADD_TO_CART]', { 
                                  productId: modifiedProduct.id, 
                                  category: modifiedProduct.category, 
                                  before: initialCount, 
                                  after: afterCount 
                              });
                          }
                      }

                      if (customizations && customizations.length > 0) {
                           for (let i = customizations.length - 1; i >= 0; i--) {
                               const c = customizations[i];
                               if (c.category === 'Size') {
                                   customizations.splice(i, 1);
                                   continue;
                               }
                               if (c.items && c.items.length > 0) {
                                   const originalItemsCount = c.items.length;
                                   c.items = c.items.filter(txt => {
                                       if (/^(Small|Medium|Large|Jumbo|Personal)\b/i.test(txt)) return false;
                                       if (/\d+"\s+(Small|Medium|Large|Jumbo)/i.test(txt)) return false;
                                       return true;
                                   });
                                   if (c.items.length !== originalItemsCount && debugCartEnabled) {
                                        console.log('[NO_SIZE_DEBUG_ADD_TO_CART] Removed sizes from customization items:', { category: c.category, removed: originalItemsCount - c.items.length });
                                   }
                                   if (c.items.length === 0) {
                                       customizations.splice(i, 1);
                                   }
                               }
                           }
                      }
                  }
                  // --- SIZE FILTERING LOGIC (End) ---

                  onAddToCart(modifiedProduct, quantity, customizations, filteredSelections);
                  onBack();
                }}
                className="bg-[rgb(167,32,32)] hover:bg-[#8B1A1A] text-white h-[2.73rem] flex items-center justify-center gap-3 xl:gap-4 font-semibold px-6 xl:px-10 rounded-md transition-colors flex-shrink-0"
              >
                <span className="text-[17px] xl:text-[20px] leading-none whitespace-nowrap">${calculateTotal()}</span>
                <span className="text-white/40 text-base xl:text-lg">|</span>
                <span className="text-[17px] xl:text-[20px] leading-none whitespace-nowrap">{isEditMode ? 'SAVE' : 'ADD TO CART'}</span>
              </Button>
          </div>
        </div>
      </div>
      </div>

      {/* Soup of the Day Dialog */}
      <AlertDialog open={showSoupDialog} onOpenChange={setShowSoupDialog}>
        <AlertDialogContent>
          <button
            onClick={() => setShowSoupDialog(false)}
            className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"
          >
            <X className="h-4 w-4" />
            <span className="sr-only">Close</span>
          </button>
          <AlertDialogHeader>
            <AlertDialogTitle>Soup of the Day</AlertDialogTitle>
            <AlertDialogDescription>
              Call the restaurant to find out today's soup.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter className="flex-col gap-3 sm:flex-col">
            <AlertDialogAction 
              onClick={() => {
                setShowSoupDialog(false);
                window.location.href = 'tel:+18568400998';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Moorestown - (856) 840-0998
            </AlertDialogAction>
            <AlertDialogAction 
              onClick={() => {
                setShowSoupDialog(false);
                window.location.href = 'tel:+18566161010';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Haddonfield - (856) 616-1010
            </AlertDialogAction>
            <AlertDialogAction 
              onClick={() => {
                setShowSoupDialog(false);
                window.location.href = 'tel:+18567847272';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Voorhees - (856) 784-7272
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Build Your Own Pasta - Soup of the Day Dialog */}
      <AlertDialog open={showBuildPastaSoupDialog} onOpenChange={setShowBuildPastaSoupDialog}>
        <AlertDialogContent>
          <button
            onClick={() => setShowBuildPastaSoupDialog(false)}
            className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"
          >
            <X className="h-4 w-4" />
            <span className="sr-only">Close</span>
          </button>
          <AlertDialogHeader>
            <AlertDialogTitle>Soup of the Day</AlertDialogTitle>
            <AlertDialogDescription>
              For today&apos;s selection, please contact us:
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter className="flex-col gap-3 sm:flex-col">
            <AlertDialogAction 
              onClick={() => {
                setShowBuildPastaSoupDialog(false);
                window.location.href = 'tel:+18568400998';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Moorestown - (856) 840-0998
            </AlertDialogAction>
            <AlertDialogAction 
              onClick={() => {
                setShowBuildPastaSoupDialog(false);
                window.location.href = 'tel:+18566161010';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Haddonfield - (856) 616-1010
            </AlertDialogAction>
            <AlertDialogAction 
              onClick={() => {
                setShowBuildPastaSoupDialog(false);
                window.location.href = 'tel:+18567847272';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Voorhees - (856) 784-7272
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Call Us Dialog */}
      <AlertDialog open={showCallUsDialog} onOpenChange={setShowCallUsDialog}>
        <AlertDialogContent>
          <button
            onClick={() => setShowCallUsDialog(false)}
            className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground"
          >
            <X className="h-4 w-4" />
            <span className="sr-only">Close</span>
          </button>
          <AlertDialogHeader>
            <AlertDialogTitle>Call Us</AlertDialogTitle>
            <AlertDialogDescription>
              Contact your preferred location.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter className="flex-col gap-3 sm:flex-col">
            <AlertDialogAction 
              onClick={() => {
                setShowCallUsDialog(false);
                window.location.href = 'tel:+18568400998';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Moorestown - (856) 840-0998
            </AlertDialogAction>
            <AlertDialogAction 
              onClick={() => {
                setShowCallUsDialog(false);
                window.location.href = 'tel:+18566161010';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Haddonfield - (856) 616-1010
            </AlertDialogAction>
            <AlertDialogAction 
              onClick={() => {
                setShowCallUsDialog(false);
                window.location.href = 'tel:+18567847272';
              }}
              className="bg-[#A72020] hover:bg-[#8B1A1A] w-full"
            >
               Call Voorhees - (856) 784-7272
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
}
